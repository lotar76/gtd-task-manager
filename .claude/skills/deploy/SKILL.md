---
name: deploy
description: –î–µ–ø–ª–æ–π GTD Task Manager –Ω–∞ production —Å–µ—Ä–≤–µ—Ä
---

# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –¥–µ–ø–ª–æ—è

–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–∑—ã–≤–∞–µ—Ç `/deploy`, –≤—ã–ø–æ–ª–Ω–∏ —Å–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:

## 0. –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–ö–†–ò–¢–ò–ß–ù–û!)
**–ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä api_frontend –∑–∞–ø—É—â–µ–Ω:**
```bash
docker ps | grep api_frontend
```

–ï—Å–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ù–ï –∑–∞–ø—É—â–µ–Ω, –∑–∞–ø—É—Å—Ç–∏ –µ–≥–æ:
```bash
docker-compose -f docker-compose.local.yml up -d frontend
```

–ü–æ–¥–æ–∂–¥–∏ 5-10 —Å–µ–∫—É–Ω–¥ —á—Ç–æ–±—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å—Ç–∞—Ä—Ç–æ–≤–∞–ª.

## 1. –°–±–æ—Ä–∫–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
–í—ã–ø–æ–ª–Ω–∏ –∫–æ–º–∞–Ω–¥—É —á–µ—Ä–µ–∑ Bash tool:
```bash
docker exec -e VITE_API_URL=/api api_frontend npm run build
```
**–í–ê–ñ–ù–û:** –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `VITE_API_URL=/api` –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞! –ë–µ–∑ –Ω–µ—ë –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç dev-URL `http://localhost:9090/api`, –∫–æ—Ç–æ—Ä—ã–π ¬´–≤—à–∏–≤–∞–µ—Ç—Å—è¬ª –≤ –±–∞–Ω–¥–ª –∏ –ª–æ–º–∞–µ—Ç production.

**–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–í–ï–†–ö–ê:** –ü–æ—Å–ª–µ —Å–±–æ—Ä–∫–∏ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –ø—Ä–æ–≤–µ—Ä—å —á—Ç–æ –ø–æ—è–≤–∏–ª–∏—Å—å –∏–∑–º–µ–Ω–µ–Ω–∏—è:
```bash
git status public/
```

**–ï—Å–ª–∏ `git status` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "nothing to commit, working tree clean"** ‚Äî –û–°–¢–ê–ù–û–í–ò–°–¨! –°–±–æ—Ä–∫–∞ –Ω–µ –≤—ã–ø–æ–ª–Ω–∏–ª–∞—Å—å. –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:
- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –∑–∞–ø—É—â–µ–Ω (—Å–º. —à–∞–≥ 0)
- –ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∏—Å—Ö–æ–¥–Ω–∏–∫–∞—Ö `resources/js/`
- –ü—Ä–æ–±–ª–µ–º–∞ —Å npm/vite –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

–í —ç—Ç–æ–º —Å–ª—É—á–∞–µ **–°–ü–†–û–°–ò –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø** —á—Ç–æ –¥–µ–ª–∞—Ç—å, –Ω–µ –ø—Ä–æ–¥–æ–ª–∂–∞–π –¥–µ–ø–ª–æ–π!

## 2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ git
–í—ã–ø–æ–ª–Ω–∏ `git add public/` —á–µ—Ä–µ–∑ Bash tool.

## 3. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –¥–µ–ø–ª–æ—è
- –í—ã–ø–æ–ª–Ω–∏ `git diff --cached --name-only` —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∏–∑–º–µ–Ω—ë–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- –ü—Ä–æ–≤–µ—Ä—å —Å–ø–∏—Å–æ–∫ –∏–∑–º–µ–Ω—ë–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤:
  - –ï—Å–ª–∏ –≤ —Å–ø–∏—Å–∫–µ –µ—Å—Ç—å `Dockerfile`, `docker-compose.prod.yml` –∏–ª–∏ —Ñ–∞–π–ª—ã –∏–∑ –ø–∞–ø–∫–∏ `docker/*` ‚Üí —Ç–∏–ø –¥–µ–ø–ª–æ—è: **FULL rebuild**
  - –ò–Ω–∞—á–µ ‚Üí —Ç–∏–ø –¥–µ–ø–ª–æ—è: **FAST deploy**

## 4. Commit –∏ push
- –ï—Å–ª–∏ —Ç–∏–ø –¥–µ–ø–ª–æ—è **FULL rebuild**: –≤—ã–ø–æ–ª–Ω–∏ `git commit -m "üê≥ Deploy (full rebuild)"`
- –ï—Å–ª–∏ —Ç–∏–ø –¥–µ–ø–ª–æ—è **FAST deploy**: –≤—ã–ø–æ–ª–Ω–∏ `git commit -m "‚ö° Deploy"`
- –í—ã–ø–æ–ª–Ω–∏ `git push` (–Ω–∞ —Ç–µ–∫—É—â—É—é –≤–µ—Ç–∫—É)

## 5. –ó–∞–ø—É—Å–∫ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
–°–Ω–∞—á–∞–ª–∞ —Å–±—Ä–æ—Å—å –ª–æ–∫–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ, –∑–∞—Ç–µ–º –∑–∞–ø—É—Å—Ç–∏ –¥–µ–ø–ª–æ–π:

**FAST deploy:**
```bash
ssh root@37.220.82.214 "cd /home/projects/todo && git checkout -- . && git clean -fd public/assets/ && git pull"
```

**FULL rebuild:**
```bash
ssh root@37.220.82.214 "cd /home/projects/todo && git checkout -- . && git clean -fd public/assets/ && git pull && docker-compose -f docker-compose.prod.yml up -d --build"
```

## 6. –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–µ–π Laravel (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!)
**–í—Å–µ–≥–¥–∞ –≤—ã–ø–æ–ª–Ω—è–π –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –¥–µ–ø–ª–æ—è**, –∏–Ω–∞—á–µ Laravel –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞—Ä—ã–µ –∑–∞–∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–æ—É—Ç—ã/–∫–æ–Ω—Ñ–∏–≥–∏ –∏ –≤—Å—ë –ª–æ–º–∞–µ—Ç—Å—è:
```bash
ssh root@37.220.82.214 "cd /home/projects/todo && docker-compose -f docker-compose.prod.yml exec -T app php artisan route:clear && docker-compose -f docker-compose.prod.yml exec -T app php artisan config:clear && docker-compose -f docker-compose.prod.yml exec -T app php artisan view:clear && docker-compose -f docker-compose.prod.yml exec -T app php artisan config:cache && docker-compose -f docker-compose.prod.yml exec -T app php artisan route:cache && docker-compose -f docker-compose.prod.yml exec -T app php artisan view:cache"
```

## 7. –ú–∏–≥—Ä–∞—Ü–∏–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å –Ω–æ–≤—ã–µ)
–ü—Ä–æ–≤–µ—Ä—å, –µ—Å—Ç—å –ª–∏ –≤ –∫–æ–º–º–∏—Ç–µ –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã `database/migrations/`. –ï—Å–ª–∏ –¥–∞:
```bash
ssh root@37.220.82.214 "cd /home/projects/todo && docker-compose -f docker-compose.prod.yml exec -T app php artisan migrate --force"
```

## 8. –°–æ–æ–±—â–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å–æ–æ–±—â–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é:
- –¢–∏–ø –¥–µ–ø–ª–æ—è (FAST –∏–ª–∏ FULL)
- –°—Ç–∞—Ç—É—Å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
- –ë—ã–ª–∏ –ª–∏ –º–∏–≥—Ä–∞—Ü–∏–∏
- –°–∞–π—Ç: https://todo.e-api.ru

---

## –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –≥—Ä–∞–±–ª–∏ (—á—Ç–æ–±—ã –Ω–µ –Ω–∞—Å—Ç—É–ø–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ)

1. **–ù–µ–∑–∞–ø—É—â–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä api_frontend** (2024-02-09) ‚Äî –µ—Å–ª–∏ `api_frontend` –Ω–µ –∑–∞–ø—É—â–µ–Ω, –∫–æ–º–∞–Ω–¥–∞ `docker exec` –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–∫–∏, –Ω–æ —Å–±–æ—Ä–∫–∞ –ù–ï –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è. –§—Ä–æ–Ω—Ç–µ–Ω–¥ –Ω–µ –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ—Ç—Å—è, –∏ –Ω–∞ –ø—Ä–æ–¥ –ø–æ–ø–∞–¥–∞—é—Ç —Ç–æ–ª—å–∫–æ –∏—Å—Ö–æ–¥–Ω–∏–∫–∏ –±–µ–∑ —Å–æ–±—Ä–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤. **–†–µ—à–µ–Ω–∏–µ:** –í–°–ï–ì–î–ê –ø—Ä–æ–≤–µ—Ä—è—Ç—å —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—â–µ–Ω (—à–∞–≥ 0) –∏ –í–°–ï–ì–î–ê –ø—Ä–æ–≤–µ—Ä—è—Ç—å `git status public/` –ø–æ—Å–ª–µ —Å–±–æ—Ä–∫–∏ (—à–∞–≥ 1).

2. **VITE_API_URL** ‚Äî –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä `api_frontend` –∏–º–µ–µ—Ç `VITE_API_URL=http://localhost:9090/api` –∏–∑ docker-compose.local.yml. –ü—Ä–∏ –±–∏–ª–¥–µ –í–°–ï–ì–î–ê –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å `-e VITE_API_URL=/api`.

3. **Route cache** ‚Äî –µ—Å–ª–∏ —É–¥–∞–ª—ë–Ω/–ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä, –∞ route:cache –Ω–µ –æ—á–∏—â–µ–Ω, Laravel –ø–∞–¥–∞–µ—Ç —Å 500 –Ω–∞ –í–°–ï–• –∑–∞–ø—Ä–æ—Å–∞—Ö. –ü–æ—ç—Ç–æ–º—É —à–∞–≥ 6 –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω.

4. **Config cache** ‚Äî –Ω–æ–≤—ã–µ env-–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–µ –ø–æ–¥—Ö–≤–∞—Ç—ã–≤–∞—é—Ç—Å—è –±–µ–∑ `config:cache`. –ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ `.env` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –∫—ç—à.

5. **Docker env_file** ‚Äî `docker-compose.prod.yml` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `env_file: .env` (–Ω–µ `environment:`). –í—Å–µ env-–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ `.env` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.

6. **git push** ‚Äî –ø—É—à–∏–º –≤ —Ç–µ–∫—É—â—É—é –≤–µ—Ç–∫—É (–Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ main). –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ `git pull` –ø–æ–¥—Ç—è–Ω–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –≤–µ—Ç–∫—É.
