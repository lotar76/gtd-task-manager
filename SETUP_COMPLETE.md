# ‚úÖ –ü—Ä–æ–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω!

## üìã –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á–µ—Ç

### –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

‚úÖ **Docker –æ–∫—Ä—É–∂–µ–Ω–∏–µ**
- PHP-FPM 8.2 —Å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è–º–∏ (pdo_mysql, gd, zip, intl, bcmath, exif, pcntl)
- –î–≤–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏: –ª–æ–∫–∞–ª—å–Ω–∞—è (`docker-compose.local.yml`) –∏ production (`docker-compose.prod.yml`)
- Nginx –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (–ø–æ—Ä—Ç 9090)
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Traefik –¥–ª—è production (–¥–æ–º–µ–Ω: e-api.ru)

‚úÖ **Laravel API (–ø–æ—Å–ª–µ–¥–Ω—è—è LTS –≤–µ—Ä—Å–∏—è)**
- API-only —Ä–µ–∂–∏–º (–±–µ–∑ Blade views)
- –í—Å–µ —Ä–æ—É—Ç—ã –≤ `routes/api.php`
- –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –≤ `App\Http\Controllers\Api\V1`
- –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ API —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `/v1`

‚úÖ **–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –≤–Ω–µ—à–Ω–µ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö**
- MySQL –Ω–∞ `83.147.245.158:3306`
- SSL —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ
- –ú–∏–≥—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ
- –í—Å–µ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã

‚úÖ **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è**
- Laravel Sanctum –¥–ª—è token-based –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- Spatie Laravel Permission –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–æ–ª—è–º–∏ –∏ –ø—Ä–∞–≤–∞–º–∏
- –†–æ–ª–∏: `admin`, `user`
- –ü—Ä–∞–≤–∞: `files.upload`, `files.view`, `files.download`, `files.delete`

‚úÖ **S3 Storage**
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è S3-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
- Service `FileStorageService` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–∞–º–∏
- Controller `FileController` —Å –º–µ—Ç–æ–¥–∞–º–∏: upload, show, download, delete

‚úÖ **API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã**
- `POST /api/v1/register` - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
- `POST /api/v1/login` - –≤—Ö–æ–¥
- `GET /api/v1/me` - –ø–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
- `POST /api/v1/logout` - –≤—ã—Ö–æ–¥
- `POST /api/v1/files/upload` - –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞
- `GET /api/v1/files/show` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ–∞–π–ª–µ
- `GET /api/v1/files/download` - –≤—Ä–µ–º–µ–Ω–Ω–∞—è —Å—Å—ã–ª–∫–∞ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
- `DELETE /api/v1/files/delete` - —É–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞

‚úÖ **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏**
- CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- Rate Limiting (auth: 5 req/min, uploads: 10 req/min, api: 60 req/min)
- –ï–¥–∏–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç JSON-–æ—Ç–≤–µ—Ç–æ–≤ (`ApiResponse`)
- Custom Exception Handler
- Request/Response Middleware –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- PHPUnit —Ç–µ—Å—Ç—ã (AuthTest, FileStorageTest)

‚úÖ **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**
- `README.md` - –æ–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
- `DEPLOYMENT.md` - –ø–æ–¥—Ä–æ–±–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é
- `.env.example` - —à–∞–±–ª–æ–Ω –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

‚úÖ **Scripts –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è**
- `scripts/setup-local.sh` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ
- `scripts/setup-prod.sh` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ production

---

## üöÄ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ

### –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
cd /home/projects/api
./scripts/setup-local.sh
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

```bash
# –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
curl -X POST http://localhost:9090/api/v1/register \
  -H "Content-Type: application/json" \
  -H "Accept: application/json" \
  -d '{
    "name": "Test User",
    "email": "test@example.com",
    "password": "password123",
    "password_confirmation": "password123"
  }'

# –í—Ö–æ–¥
curl -X POST http://localhost:9090/api/v1/login \
  -H "Content-Type: application/json" \
  -H "Accept: application/json" \
  -d '{
    "email": "test@example.com",
    "password": "password123"
  }'

# –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è (–∑–∞–º–µ–Ω–∏—Ç–µ YOUR_TOKEN –Ω–∞ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω)
curl http://localhost:9090/api/v1/me \
  -H "Accept: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose -f docker-compose.local.yml logs -f

# –í—Ö–æ–¥ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker-compose -f docker-compose.local.yml exec app bash

# –ó–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–π
docker-compose -f docker-compose.local.yml exec app php artisan migrate

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
docker-compose -f docker-compose.local.yml exec app php artisan test

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
docker-compose -f docker-compose.local.yml restart

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
docker-compose -f docker-compose.local.yml down
```

---

## üåê –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ production

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. **Traefik –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω**
   ```bash
   # –°–æ–∑–¥–∞–π—Ç–µ —Å–µ—Ç—å (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —Å–æ–∑–¥–∞–Ω–∞)
   docker network create traefik
   ```

2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ Traefik** –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Let's Encrypt –∏ –¥–æ–º–µ–Ω–æ–º `e-api.ru`

3. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ `.env.prod`**
   ```bash
   cp .env.example .env.prod
   # –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env.prod —Å production –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
   ```

### –ó–∞–ø—É—Å–∫

```bash
cd /home/projects/api
./scripts/setup-prod.sh
```

API –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞: `https://e-api.ru`

---

## üîß –†–µ—à–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. **Docker –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ WSL**
**–†–µ—à–µ–Ω–∏–µ**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∫–ª—é—á–∏–ª Docker Desktop WSL Integration

### 2. **–ü–æ—Ä—Ç 8000 –∑–∞–Ω—è—Ç**
**–†–µ—à–µ–Ω–∏–µ**: –ò–∑–º–µ–Ω–µ–Ω –ø–æ—Ä—Ç –Ω–∞ 9090 –≤ `docker-compose.local.yml`

### 3. **–û—à–∏–±–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –ø—Ä–∏ composer install**
**–†–µ—à–µ–Ω–∏–µ**: –í—ã–ø–æ–ª–Ω–µ–Ω–æ `chown -R www-data:www-data /var/www/html`

### 4. **SSL connection required –¥–ª—è MySQL**
**–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω—ã SSL –æ–ø—Ü–∏–∏ –≤ `config/database.php`

### 5. **Access denied –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ sql_mode**
**–†–µ—à–µ–Ω–∏–µ**: –£–¥–∞–ª–µ–Ω–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ `PDO::MYSQL_ATTR_INIT_COMMAND` –∏–∑ –æ–ø—Ü–∏–π MySQL

### 6. **–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ç–∞–±–ª–∏—Ü–∞ permissions**
**–†–µ—à–µ–Ω–∏–µ**: –û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω—ã –∏ –∑–∞–ø—É—â–µ–Ω—ã –º–∏–≥—Ä–∞—Ü–∏–∏ `spatie/laravel-permission`

### 7. **TypeError: FileViewFinder paths must be array**
**–†–µ—à–µ–Ω–∏–µ**: –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `config/view.php` –∏ –ø–∞–ø–∫–∞ `resources/views`

---

## üìù –ß—Ç–æ –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ

### S3 Storage

–í `.env` (–∏–ª–∏ `.env.local` / `.env.prod`) —É–∫–∞–∂–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤–∞—à–µ–≥–æ S3 —Ö—Ä–∞–Ω–∏–ª–∏—â–∞:

```env
AWS_ACCESS_KEY_ID=your-access-key
AWS_SECRET_ACCESS_KEY=your-secret-key
AWS_DEFAULT_REGION=us-east-1
AWS_BUCKET=your-bucket-name
AWS_ENDPOINT=https://s3.amazonaws.com
AWS_USE_PATH_STYLE_ENDPOINT=false  # true –¥–ª—è MinIO
```

–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é):
```env
FILESYSTEM_DISK=local
```

### CORS

–ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –≤ `.env`:

```env
CORS_ALLOWED_ORIGINS=http://localhost:3000,https://your-frontend.com
```

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **README.md** - –û—Å–Ω–æ–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
- **DEPLOYMENT.md** - –ü–æ–¥—Ä–æ–±–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é
- **API —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Postman –∫–æ–ª–ª–µ–∫—Ü–∏—é –∏–ª–∏ curl –ø—Ä–∏–º–µ—Ä—ã

---

## ‚ú® –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã API –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç:

‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚úÖ –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É
‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
‚úÖ –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
‚úÖ –†–æ–ª–∏ –∏ –ø—Ä–∞–≤–∞ –Ω–∞–∑–Ω–∞—á–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å S3** (–µ—Å–ª–∏ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å)
2. **–î–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã** –ø–æ –≤–∞—à–∏–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º
3. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å CI/CD** –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
4. **–î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** (Sentry, New Relic –∏ —Ç.–¥.)
5. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –æ—á–µ—Ä–µ–¥–∏** –¥–ª—è –¥–æ–ª–≥–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
6. **–î–æ–±–∞–≤–∏—Ç—å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ** (Redis)

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `docker-compose -f docker-compose.local.yml logs -f`
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–æ—Å—Ç—É–ø–Ω–∞
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `.env` —Ñ–∞–π–ª
4. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –≤ `DEPLOYMENT.md`

---

## üéâ –ì–æ—Ç–æ–≤–æ!

–ü—Ä–æ–µ–∫—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!

**URL –ª–æ–∫–∞–ª—å–Ω–æ**: http://localhost:9090
**URL production**: https://e-api.ru

**–¢–µ—Å—Ç–æ–≤—ã–π –∞–∫–∫–∞—É–Ω—Ç —Å–æ–∑–¥–∞–Ω**:
- Email: test5@example.com
- Password: password123
- Role: user

