# üß† –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–µ–∫—Ç–∞ - –í–∞–∂–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è –∏ –ø—Ä–∏–Ω—Ü–∏–ø—ã

> **–¶–µ–ª—å**: –•—Ä–∞–Ω–∏—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–∏–Ω—è—Ç—ã—Ö —Ä–µ—à–µ–Ω–∏—è—Ö, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è –æ—à–∏–±–æ–∫ –∏ –Ω–µ–Ω—É–∂–Ω–æ–π —Ä–∞–±–æ—Ç—ã.

---

## üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û - –ù–ï –¢–†–û–ì–ê–¢–¨ –ë–ï–ó –†–ê–ó–†–ï–®–ï–ù–ò–Ø

### Frontend Build System
- **`vite.config.js`** - ‚ö†Ô∏è –ù–ï –ú–ï–ù–Ø–¢–¨ –±–µ–∑ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è
  - `emptyOutDir: false` - –∫—Ä–∏—Ç–∏—á–Ω–æ! –ò–Ω–∞—á–µ —É–¥–∞–ª—è–µ—Ç—Å—è `index.php` Laravel
  - `define` –¥–ª—è `VITE_API_URL` - –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –¥–ª—è production
  
- **`resources/js/services/api.js`** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `import.meta.env.VITE_API_URL || '/api'`
  - –ü—Ä–æ—Å—Ç–∞—è –ª–æ–≥–∏–∫–∞ –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–æ–∫ MODE
  - –ó–Ω–∞—á–µ–Ω–∏–µ –±–µ—Ä–µ—Ç—Å—è –∏–∑ .env —Ñ–∞–π–ª–æ–≤ (`.env.production` –¥–ª—è production)
  - **–í–∞–∂–Ω–æ**: –í `.env.production` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `VITE_API_URL=/api`

### Docker Compose
- **`docker-compose.prod.yml`** - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Traefik, –Ω–µ –º–µ–Ω—è—Ç—å –±–µ–∑ –ø–æ–Ω–∏–º–∞–Ω–∏—è
- **`docker-compose.local.yml`** - –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (–ø–æ—Ä—Ç 9090)

### Nginx Config
- **`docker/nginx/nginx.conf`** - –ø–æ—Ä—è–¥–æ–∫ location –±–ª–æ–∫–æ–≤ –∫—Ä–∏—Ç–∏—á–µ–Ω:
  1. `/api/` ‚Üí PHP
  2. `/assets/` ‚Üí —Å—Ç–∞—Ç–∏–∫–∞
  3. `\.php$` ‚Üí PHP-FPM
  4. `/` ‚Üí SPA (index.html)

---

## üìã –ü—Ä–∏–Ω—è—Ç—ã–µ —Ä–µ—à–µ–Ω–∏—è

### Frontend Deployment
- ‚úÖ **–§—Ä–æ–Ω—Ç–µ–Ω–¥ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –õ–û–ö–ê–õ–¨–ù–û**, –Ω–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- ‚úÖ –°–æ–±—Ä–∞–Ω–Ω—ã–π —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –∫–æ–º–º–∏—Ç–∏—Ç—Å—è –≤ git (`public/`)
- ‚úÖ –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ —Ç–æ–ª—å–∫–æ `git pull` - –±–µ–∑ —Å–±–æ—Ä–∫–∏
- ‚úÖ `VITE_API_URL` –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ production (—Ç–æ–ª—å–∫–æ `/api`)

**–ü–æ—á–µ–º—É**: 
- –ë—ã—Å—Ç—Ä–µ–µ –¥–µ–ø–ª–æ–π (–Ω–µ—Ç npm install –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ)
- –ú–µ–Ω—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
- –ú–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–±–æ—Ä–∫—É –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º
- –ò–∑–±–µ–≥–∞–µ–º –ø—Ä–æ–±–ª–µ–º —Å –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞

### PHP-FPM Configuration
- ‚úÖ –ö–∞—Å—Ç–æ–º–Ω—ã–π –∫–æ–Ω—Ñ–∏–≥ `docker/php-fpm/www.conf` –±–µ–∑ `user`/`group` –¥–∏—Ä–µ–∫—Ç–∏–≤
- ‚úÖ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –æ—Ç `www-data` —á–µ—Ä–µ–∑ `USER` –≤ Dockerfile

**–ü–æ—á–µ–º—É**: –£–±–∏—Ä–∞–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –≤ –ª–æ–≥–∞—Ö PHP-FPM

### Sanctum Configuration
- ‚úÖ –£–±—Ä–∞–Ω `localhost` –∏–∑ –¥–µ—Ñ–æ–ª—Ç–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –≤ `config/sanctum.php`
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ `Sanctum::currentApplicationUrlWithPort()`

**–ü–æ—á–µ–º—É**: –î–ª—è production –Ω–µ –Ω—É–∂–Ω—ã localhost –¥–æ–º–µ–Ω—ã

---

## üîß –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞: localhost:9090 –≤ —Å–æ–±—Ä–∞–Ω–Ω–æ–º JS
**–°–∏–º–ø—Ç–æ–º—ã**: API –∑–∞–ø—Ä–æ—Å—ã –∏–¥—É—Ç –Ω–∞ `http://localhost:9090/api` –≤–º–µ—Å—Ç–æ `/api`

**–ü—Ä–∏—á–∏–Ω–∞**: Vite —á–∏—Ç–∞–µ—Ç .env —Ñ–∞–π–ª—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. –ï—Å–ª–∏ –≤ `.env` –∏–ª–∏ `.env.local` –µ—Å—Ç—å `VITE_API_URL=http://localhost:9090/api`, –æ–Ω –ø–æ–ø–∞–¥–∞–µ—Ç –≤ —Å–±–æ—Ä–∫—É –¥–∞–∂–µ –¥–ª—è production.

**–†–µ—à–µ–Ω–∏–µ**: 
- ‚úÖ –í `.env.production` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω `VITE_API_URL=/api` (–æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å)
- ‚úÖ –í `.env.local` –º–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `VITE_API_URL=http://localhost:9090/api` –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- ‚úÖ –ö–æ–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `import.meta.env.VITE_API_URL || '/api'` - –ø—Ä–æ—Å—Ç–æ –∏ –ø–æ–Ω—è—Ç–Ω–æ
- ‚úÖ –ü—Ä–∏ —Å–±–æ—Ä–∫–µ —Å `--mode production` Vite –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–∏—Ç–∞–µ—Ç `.env.production`
- ‚úÖ –ù–ï –Ω—É–∂–Ω–æ —É—Å–ª–æ–∂–Ω—è—Ç—å –∫–æ–¥ –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏ MODE - –ø—Ä–æ—Å—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å .env —Ñ–∞–π–ª—ã

### –ü—Ä–æ–±–ª–µ–º–∞: index.php —É–¥–∞–ª—è–µ—Ç—Å—è –ø—Ä–∏ —Å–±–æ—Ä–∫–µ —Ñ—Ä–æ–Ω—Ç–∞
**–°–∏–º–ø—Ç–æ–º—ã**: API –ø–µ—Ä–µ—Å—Ç–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ—Å–ª–µ `npm run build`

**–ü—Ä–∏—á–∏–Ω–∞**: `emptyOutDir: true` –≤ vite.config.js

**–†–µ—à–µ–Ω–∏–µ**: –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ `emptyOutDir: false` –≤ vite.config.js

### –ü—Ä–æ–±–ª–µ–º–∞: –¶–∏–∫–ª –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ nginx
**–°–∏–º–ø—Ç–æ–º—ã**: 500 –æ—à–∏–±–∫–∞, "rewrite or internal redirection cycle"

**–ü—Ä–∏—á–∏–Ω–∞**: –ö–æ–Ω—Ñ–ª–∏–∫—Ç –º–µ–∂–¥—É `location ~ \.html$` –∏ `location /`

**–†–µ—à–µ–Ω–∏–µ**: –£–±—Ä–∞–Ω –æ—Ç–¥–µ–ª—å–Ω—ã–π location –¥–ª—è `.html$`, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ `location /`

---

## üìù Workflow

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
```bash
./scripts/setup-local.sh
# –∏–ª–∏
docker-compose -f docker-compose.local.yml up -d
```

### Production –¥–µ–ø–ª–æ–π
```bash
# –õ–æ–∫–∞–ª—å–Ω–æ:
npm run build
git add public/
git commit -m "Build frontend"
git push

# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:
./scripts/deploy.sh
# –∏–ª–∏
git pull
docker-compose -f docker-compose.prod.yml up -d --build
```

### –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
```bash
./scripts/rebuild-frontend.sh
```

---

## üóÑÔ∏è –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ **–í–Ω–µ—à–Ω—è—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** (–Ω–µ –≤ Docker)
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤ `.env`:
  - `DB_CONNECTION` (mysql/pgsql)
  - `DB_HOST`
  - `DB_PORT`
  - `DB_DATABASE`
  - `DB_USERNAME`
  - `DB_PASSWORD`

### S3 Storage
- ‚úÖ **–í–Ω–µ—à–Ω–∏–π S3** (AWS S3 –∏–ª–∏ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π)
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ `.env`:
  - `AWS_ACCESS_KEY_ID`
  - `AWS_SECRET_ACCESS_KEY`
  - `AWS_DEFAULT_REGION`
  - `AWS_BUCKET`
  - `AWS_URL` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  - `AWS_ENDPOINT` (–¥–ª—è S3-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã—Ö —Ö—Ä–∞–Ω–∏–ª–∏—â)
  - `FILESYSTEM_DISK=s3` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)

---

## üîê –ö—Ä–∏—Ç–∏—á–Ω—ã–µ Environment Variables

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –¥–ª—è Production

#### Application
- `APP_NAME` - –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- `APP_ENV=production` - –æ–∫—Ä—É–∂–µ–Ω–∏–µ
- `APP_DEBUG=false` - –æ—Ç–∫–ª—é—á–∏—Ç—å debug –≤ production!
- `APP_URL` - –ø–æ–ª–Ω—ã–π URL –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (https://todo.e-api.ru)
- `APP_KEY` - –∫–ª—é—á —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è Laravel (–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ `php artisan key:generate`)

#### Database (–≤–Ω–µ—à–Ω—è—è)
- `DB_CONNECTION` - —Ç–∏–ø –ë–î (mysql/pgsql)
- `DB_HOST` - —Ö–æ—Å—Ç –ë–î
- `DB_PORT` - –ø–æ—Ä—Ç –ë–î
- `DB_DATABASE` - –∏–º—è –ë–î
- `DB_USERNAME` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ë–î
- `DB_PASSWORD` - –ø–∞—Ä–æ–ª—å –ë–î

#### S3 Storage (–≤–Ω–µ—à–Ω–∏–π)
- `AWS_ACCESS_KEY_ID` - –∫–ª—é—á –¥–æ—Å—Ç—É–ø–∞
- `AWS_SECRET_ACCESS_KEY` - —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á
- `AWS_DEFAULT_REGION` - —Ä–µ–≥–∏–æ–Ω
- `AWS_BUCKET` - –∏–º—è –±–∞–∫–µ—Ç–∞
- `FILESYSTEM_DISK=s3` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å S3

#### Security
- `SANCTUM_STATEFUL_DOMAINS` - –¥–æ–º–µ–Ω—ã –¥–ª—è Sanctum (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –±–µ—Ä–µ—Ç—Å—è –∏–∑ APP_URL)
- `CORS_ALLOWED_ORIGINS` - —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ origins –¥–ª—è CORS

### –í–∞–∂–Ω—ã–µ, –Ω–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ
- `LOG_LEVEL` - —É—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (error –¥–ª—è production)
- `SESSION_DRIVER` - –¥—Ä–∞–π–≤–µ—Ä —Å–µ—Å—Å–∏–π (file/database)
- `CACHE_DRIVER` - –¥—Ä–∞–π–≤–µ—Ä –∫–µ—à–∞ (file/redis)

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –õ–æ–≥–∏

### –ì–¥–µ —Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏

#### Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
```bash
# –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (Laravel)
docker-compose -f docker-compose.prod.yml logs -f app

# –õ–æ–≥–∏ Nginx
docker-compose -f docker-compose.prod.yml logs -f nginx

# –í—Å–µ –ª–æ–≥–∏
docker-compose -f docker-compose.prod.yml logs -f
```

#### Laravel –ª–æ–≥–∏
```bash
# –í–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ app
docker-compose -f docker-compose.prod.yml exec app tail -f storage/logs/laravel.log

# –ò–ª–∏ —á–µ—Ä–µ–∑ volume (–µ—Å–ª–∏ —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω)
tail -f storage/logs/laravel.log
```

#### Nginx –ª–æ–≥–∏
```bash
# Access –ª–æ–≥–∏
docker-compose -f docker-compose.prod.yml exec nginx tail -f /var/log/nginx/access.log

# Error –ª–æ–≥–∏
docker-compose -f docker-compose.prod.yml exec nginx tail -f /var/log/nginx/error.log
```

#### Traefik –ª–æ–≥–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
```bash
docker logs traefik -f
```

### –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö
1. **–°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤**: `docker-compose -f docker-compose.prod.yml ps`
2. **–õ–æ–≥–∏ Laravel**: –æ—à–∏–±–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –∏—Å–∫–ª—é—á–µ–Ω–∏—è
3. **–õ–æ–≥–∏ Nginx**: 500 –æ—à–∏–±–∫–∏, –ø—Ä–æ–±–ª–µ–º—ã —Å –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–µ–π
4. **–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î**: –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –ª–æ–≥–∞—Ö Laravel
5. **S3 –¥–æ—Å—Ç—É–ø**: –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –ª–æ–≥–∞—Ö –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–æ–≤

---

## üìå TODO –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è

- [ ] –û–ø–∏—Å–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ –ø—Ä–æ–±–ª–µ–º
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É API endpoints
- [ ] –î–æ–±–∞–≤–∏—Ç—å —á–µ–∫–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º

---

## üîÑ –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

### 2025-11-25
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Å localhost:9090 –≤ —Å–æ–±—Ä–∞–Ω–Ω–æ–º JS
- –ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ —Å–±–æ—Ä–∫–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –±–µ–∑ VITE_API_URL
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è PHP-FPM
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Sanctum
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è nginx (—É–±—Ä–∞–Ω—ã —Ü–∏–∫–ª—ã –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è)

