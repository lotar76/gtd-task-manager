import{u as L,r as q,a as H,c as J,b as K,d as P,T as Q}from"./TaskModal-Bt8hXbQv.js";import{u as R}from"./workspace-DAAAEE4q.js";import{_ as U}from"./TaskList-CRMaIUUb.js";import{r as $}from"./CalendarDaysIcon-Hnc9L522.js";import{r as X}from"./RectangleStackIcon-CFgA8cl4.js";import{r as Y}from"./PlusIcon-B1n2MYRE.js";import{k as p,r as k,c as o,a as r,f as _,b,F as w,z as S,l as j,t as m,A as F,e as T,o as s,p as N,m as Z}from"./index-jm_WZfPo.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ru-B7JyRvIu.js";const ee={class:"p-4 lg:p-8"},te={class:"max-w-4xl mx-auto"},ae={class:"mb-6"},re={key:0,class:"flex flex-wrap gap-2"},se=["onClick"],oe={class:"ml-1.5 opacity-75"},le={key:0,class:"w-px bg-gray-200 dark:bg-gray-600 mx-1 self-stretch"},ne=["onClick"],ie={class:"ml-1.5 opacity-75"},ce={key:0,class:"text-center py-12"},de={key:0,class:"mb-3 flex items-center justify-between"},ue={class:"text-sm text-gray-500 dark:text-gray-400"},me={key:2,class:"text-center py-12"},ge={key:3,class:"text-center py-12"},ve={class:"max-w-md mx-auto"},pe={class:"w-16 h-16 mx-auto mb-4 rounded-full bg-gray-50 dark:bg-gray-800 flex items-center justify-center"},$e={__name:"AllTasks",setup(ke){const u=L();R();const n=p(()=>u.filteredTasks),E=p(()=>u.loading),g=k(!1),i=k(null),x=k(""),c=k(null),d=k(null),M={inbox:{label:"Входящие",icon:P,activeBg:"bg-blue-500",order:0},today:{label:"Сегодня",icon:K,activeBg:"bg-amber-500",order:1},next_action:{label:"Следующие",icon:J,activeBg:"bg-yellow-500",order:2},tomorrow:{label:"Завтра",icon:$,activeBg:"bg-indigo-500",order:3},scheduled:{label:"Запланированные",icon:$,activeBg:"bg-teal-500",order:4},waiting:{label:"Ожидание",icon:H,activeBg:"bg-orange-500",order:5},someday:{label:"Когда-нибудь",icon:q,activeBg:"bg-purple-500",order:6}},V=p(()=>{const a={};for(const e of n.value)a[e.status]=(a[e.status]||0)+1;return Object.entries(M).filter(([e])=>a[e]>0).map(([e,t])=>({value:e,label:t.label,icon:t.icon,activeBg:t.activeBg,order:t.order,count:a[e]})).sort((e,t)=>e.order-t.order)}),y=p(()=>{const a={},e={};for(const t of n.value)a[t.workspace_id]=(a[t.workspace_id]||0)+1,t.workspace&&(e[t.workspace_id]=t.workspace.name);return Object.entries(a).map(([t,l])=>({id:Number(t),name:e[t]||"Без пространства",count:l})).sort((t,l)=>t.name.localeCompare(l.name))}),f=p(()=>{let a=n.value;return c.value&&(a=a.filter(e=>e.status===c.value)),d.value&&(a=a.filter(e=>e.workspace_id===d.value)),a}),W=a=>{c.value=c.value===a?null:a},A=a=>{d.value=d.value===a?null:a},C=()=>{c.value=null,d.value=null},O=a=>{i.value=a,g.value=!0},z=()=>{i.value=null,g.value=!0},D=async a=>{try{a.status==="completed"?await u.updateTask(a.id,{status:"inbox"}):await u.completeTask(a.id)}catch(e){console.error("Error toggling task:",e)}},G=async a=>{var e,t,l,B;x.value="";try{i.value?await u.updateTask(i.value.id,a):await u.createTask(a),g.value=!1,i.value=null}catch(v){console.error("Error saving task:",v);let h="Ошибка при сохранении задачи";(t=(e=v.response)==null?void 0:e.data)!=null&&t.errors?h=Object.values(v.response.data.errors).flat().join(", "):(B=(l=v.response)==null?void 0:l.data)!=null&&B.message&&(h=v.response.data.message),x.value=h}},I=()=>{g.value=!1,i.value=null,x.value=""};return(a,e)=>(s(),o("div",ee,[r("div",te,[r("div",ae,[e[0]||(e[0]=r("h1",{class:"text-xl lg:text-2xl font-semibold text-gray-900 dark:text-white mb-4"},"Все задачи",-1)),n.value.length>0?(s(),o("div",re,[(s(!0),o(w,null,S(V.value,t=>(s(),o("button",{key:t.value,onClick:l=>W(t.value),class:N(["inline-flex items-center px-3 py-1.5 text-xs font-medium rounded-full border transition-colors",c.value===t.value?"border-transparent text-white "+t.activeBg:"border-gray-200 dark:border-gray-600 text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700"])},[(s(),j(Z(t.icon),{class:"w-3.5 h-3.5 mr-1.5"})),T(" "+m(t.label)+" ",1),r("span",oe,m(t.count),1)],10,se))),128)),y.value.length>1?(s(),o("div",le)):b("",!0),y.value.length>1?(s(!0),o(w,{key:1},S(y.value,t=>(s(),o("button",{key:t.id,onClick:l=>A(t.id),class:N(["inline-flex items-center px-3 py-1.5 text-xs font-medium rounded-full border transition-colors",d.value===t.id?"border-transparent bg-indigo-500 text-white":"border-gray-200 dark:border-gray-600 text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700"])},[T(m(t.name)+" ",1),r("span",ie,m(t.count),1)],10,ne))),128)):b("",!0)])):b("",!0)]),E.value?(s(),o("div",ce,[...e[1]||(e[1]=[r("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"},null,-1)])])):(s(),o(w,{key:1},[n.value.length>0&&(c.value||d.value)?(s(),o("div",de,[r("span",ue," Показано "+m(f.value.length)+" из "+m(n.value.length),1),r("button",{onClick:C,class:"text-xs text-primary-600 hover:text-primary-700 dark:text-primary-400"}," Сбросить фильтры ")])):b("",!0),f.value.length>0?(s(),j(U,{key:1,tasks:f.value,onTaskClick:O,onToggleComplete:D},null,8,["tasks"])):n.value.length>0?(s(),o("div",me,[e[2]||(e[2]=r("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Нет задач по выбранным фильтрам",-1)),r("button",{onClick:C,class:"mt-2 text-sm text-primary-600 hover:text-primary-700 dark:text-primary-400"}," Сбросить фильтры ")])):(s(),o("div",ge,[r("div",ve,[r("div",pe,[_(F(X),{class:"w-8 h-8 text-gray-400"})]),e[4]||(e[4]=r("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white mb-2"},"Задач пока нет",-1)),e[5]||(e[5]=r("p",{class:"text-sm text-gray-500 dark:text-gray-400 mb-6 leading-relaxed"}," Здесь отображаются все ваши активные задачи из всех разделов GTD. Начните с добавления задач во «Входящие» — записывайте всё, что приходит в голову, а затем распределяйте по нужным спискам. ",-1)),r("button",{onClick:z,class:"inline-flex items-center px-4 py-2 bg-primary-600 text-white text-sm font-medium rounded-lg hover:bg-primary-700 transition-colors"},[_(F(Y),{class:"w-5 h-5 mr-1.5"}),e[3]||(e[3]=T(" Добавить задачу ",-1))])])]))],64)),_(Q,{show:g.value,task:i.value,"server-error":x.value,onClose:I,onSubmit:G},null,8,["show","task","server-error"])])]))}};export{$e as default};
