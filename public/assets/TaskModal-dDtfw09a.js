import{J as se,r as _,k as p,G as h,c as g,a as o,o as v,B as V,s as oe,x as ae,l as R,f as le,g as re,b as F,w as q,t as T,d as $,K as ne,v as L,p as ee,m as te,F as G,z as J,D as K,T as ie,C as ue,j as de}from"./index-BTCQYrbC.js";import{u as X}from"./workspace-BpPzoPNB.js";import{_ as ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Ae=se("tasks",()=>{const l=_([]),m=_(!1),y=_(!1),f=_(localStorage.getItem("taskViewMode")||"list"),x=X(),B=p(()=>x.selectedWorkspaces.map(e=>e.id)),w=p(()=>{const e=B.value;return e.length?l.value.filter(t=>e.includes(t.workspace_id)):[]}),j=p(()=>w.value.filter(e=>e.status==="inbox")),b=p(()=>w.value.filter(e=>e.status==="next_action")),I=p(()=>w.value.filter(e=>e.status==="today")),C=p(()=>w.value.filter(e=>e.status==="tomorrow")),M=p(()=>w.value.filter(e=>e.status==="waiting")),a=p(()=>w.value.filter(e=>e.status==="someday")),r=p(()=>w.value.filter(e=>e.status==="scheduled")),i=p(()=>({inbox:j.value.length,next_actions:b.value.length,today:I.value.length,tomorrow:C.value.length,waiting:M.value.length,someday:a.value.length,scheduled:r.value.length})),u=(e,t)=>w.value.filter(n=>{if(!n.due_date)return!1;const d=n.due_date.substring(0,10);return d>=e&&d<=t}),k=async({force:e=!1}={})=>{var t;if(!(y.value&&!e)){m.value=!0;try{const n=await h.get("/v1/tasks");l.value=((t=n.data.data)==null?void 0:t.tasks)||n.data.tasks||n.data||[],y.value=!0}finally{m.value=!1}}},S=e=>{const t={...e};return t.estimated_time===""&&(t.estimated_time=null),t.due_date===""&&(t.due_date=null),t.description===""&&(t.description=null),(t.project_id===""||t.project_id===null)&&(t.project_id=null),t},O=async e=>{var U;const t=(e==null?void 0:e.workspace_id)||((U=x.currentWorkspace)==null?void 0:U.id);if(!t){console.error("Cannot create task: workspace_id not found");return}const n=S(e);n.workspace_id=t;const d=await h.post(`/v1/workspaces/${t}/tasks`,n),c=d.data.data||d.data;return c.status!=="completed"&&l.value.unshift(c),c},P=async(e,t)=>{var Y;const n=l.value.find(N=>N.id===e),d=(n==null?void 0:n.workspace_id)||(t==null?void 0:t.workspace_id)||((Y=x.currentWorkspace)==null?void 0:Y.id);if(!d){console.error("Cannot update task: workspace_id not found");return}const c=S(t);delete c.workspace_id;const U=await h.put(`/v1/workspaces/${d}/tasks/${e}`,c),H=U.data.data||U.data,Z=l.value.findIndex(N=>N.id===e);return Z!==-1&&(H.status==="completed"?l.value.splice(Z,1):l.value[Z]=H),H},z=async e=>{var d;const t=l.value.find(c=>c.id===e),n=(t==null?void 0:t.workspace_id)||((d=x.currentWorkspace)==null?void 0:d.id);if(!n){console.error("Cannot complete task: workspace_id not found");return}await h.post(`/v1/workspaces/${n}/tasks/${e}/complete`),l.value=l.value.filter(c=>c.id!==e)},W=async e=>{var d;const t=l.value.find(c=>c.id===e),n=(t==null?void 0:t.workspace_id)||((d=x.currentWorkspace)==null?void 0:d.id);if(!n){console.error("Cannot delete task: workspace_id not found");return}await h.delete(`/v1/workspaces/${n}/tasks/${e}`),l.value=l.value.filter(c=>c.id!==e)},A=e=>{f.value=e,localStorage.setItem("taskViewMode",e)};let D=null;return{allTasks:l,loading:m,loaded:y,filteredTasks:w,inboxTasks:j,nextActionTasks:b,todayTasks:I,tomorrowTasks:C,waitingTasks:M,somedayTasks:a,scheduledTasks:r,counts:i,calendarTasks:u,viewMode:f,fetchAllTasks:k,createTask:O,updateTask:P,completeTask:z,deleteTask:W,setViewMode:A,startSync:()=>{D=setInterval(()=>k({force:!0}),5*60*1e3)},stopSync:()=>{D&&clearInterval(D)}}}),ve=se("projects",()=>{const l=_([]),m=_(!1),y=X(),f=p(()=>{var r;return(r=y.currentWorkspace)==null?void 0:r.id}),x=async(r=!1)=>{if(f.value){m.value=!0;try{const i=r?{include_archived:!0}:{},u=await h.get(`/v1/workspaces/${f.value}/projects`,{params:i});l.value=u.data.data||u.data||[]}finally{m.value=!1}}},B=async r=>{if(f.value){m.value=!0;try{const i=await h.get(`/v1/workspaces/${f.value}/projects/${r}`);return i.data.data||i.data}finally{m.value=!1}}},w=async r=>{if(!f.value)return;const i=await h.post(`/v1/workspaces/${f.value}/projects`,r),u=i.data.data||i.data;return l.value.push(u),u},j=async(r,i)=>{if(!f.value)return;const u=await h.put(`/v1/workspaces/${f.value}/projects/${r}`,i),k=u.data.data||u.data,S=l.value.findIndex(O=>O.id===r);return S!==-1&&(l.value[S]=k),k},b=async r=>await j(r,{status:"archived"}),I=async r=>await j(r,{status:"active"}),C=async r=>{f.value&&(await h.delete(`/v1/workspaces/${f.value}/projects/${r}`),l.value=l.value.filter(i=>i.id!==r))},M=p(()=>l.value.filter(r=>r.status==="active"||!r.status)),a=p(()=>l.value.filter(r=>r.status==="archived"));return{projects:l,activeProjects:M,archivedProjects:a,loading:m,fetchProjects:x,fetchProject:B,createProject:w,updateProject:j,archiveProject:b,unarchiveProject:I,deleteProject:C}});function pe(l,m){return v(),g("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m20.25 7.5-.625 10.632a2.25 2.25 0 0 1-2.247 2.118H6.622a2.25 2.25 0 0 1-2.247-2.118L3.75 7.5M10 11.25h4M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125Z"})])}function me(l,m){return v(),g("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m3.75 13.5 10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75Z"})])}function Q(l,m){return v(),g("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5"})])}function fe(l,m){return v(),g("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})])}function we(l,m){return v(),g("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.25 13.5h3.86a2.25 2.25 0 0 1 2.012 1.244l.256.512a2.25 2.25 0 0 0 2.013 1.244h3.218a2.25 2.25 0 0 0 2.013-1.244l.256-.512a2.25 2.25 0 0 1 2.013-1.244h3.859m-19.5.338V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18v-4.162c0-.224-.034-.447-.1-.661L19.24 5.338a2.25 2.25 0 0 0-2.15-1.588H6.911a2.25 2.25 0 0 0-2.15 1.588L2.35 13.177a2.25 2.25 0 0 0-.1.661Z"})])}const ke={class:"flex min-h-screen items-center justify-center p-4"},ge={class:"flex items-center justify-between p-6 border-b border-gray-200"},ye={class:"text-xl font-semibold text-gray-900"},be={class:"flex items-center space-x-3 pb-4 border-b border-gray-200"},xe={class:"flex items-center space-x-2 cursor-pointer"},_e={class:"text-sm font-medium text-gray-700"},he={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},je={class:"relative"},Se={class:"flex items-center space-x-2"},$e={key:0,class:"absolute z-10 mt-1 w-full bg-white border border-gray-300 rounded-lg shadow-lg"},Ce=["onClick"],Me={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Te={key:0},Ve=["value"],Be=["value"],Ie={key:1,class:"text-red-600 text-sm bg-red-50 p-3 rounded-lg"},Pe={class:"flex justify-end space-x-3 pt-4"},Oe=["disabled"],De={__name:"TaskModal",props:{show:{type:Boolean,default:!1},task:{type:Object,default:null},serverError:{type:String,default:""}},emits:["close","submit"],setup(l,{emit:m}){const y=l,f=m,x=de(),B=X(),w=ve(),j=p(()=>B.workspaces),b=p(()=>B.currentWorkspace),I=p(()=>w.activeProjects),C=()=>{const s=x.path;return s.includes("/inbox")?"inbox":s.includes("/today")?"today":s.includes("/next-actions")?"next_action":s.includes("/tomorrow")?"tomorrow":s.includes("/waiting")?"waiting":s.includes("/someday")?"someday":"inbox"},M=()=>{const s=x.path;if(s.includes("/today"))return new Date().toISOString().split("T")[0];if(s.includes("/tomorrow")){const e=new Date;return e.setDate(e.getDate()+1),e.toISOString().split("T")[0]}return""},a=_({title:"",description:"",status:"inbox",priority:"medium",due_date:"",estimated_time:"",end_time:"",workspace_id:null,project_id:null}),r=_(!1),i=_(""),u=_(!1),k=_(null),S={inbox:{label:"Входящие",icon:we},next_action:{label:"Следующие",icon:me},today:{label:"Сегодня",icon:Q},tomorrow:{label:"Завтра",icon:Q},waiting:{label:"Ожидание",icon:fe},someday:{label:"Когда-нибудь",icon:pe},scheduled:{label:"Запланировано",icon:Q}},O=s=>{if(a.value.status=s,u.value=!1,s==="today"){const e=new Date;a.value.due_date=e.toISOString().split("T")[0]}else if(s==="tomorrow"){const e=new Date;e.setDate(e.getDate()+1),a.value.due_date=e.toISOString().split("T")[0]}},P=p(()=>a.value.status==="completed"),z=s=>{s.target.checked?a.value.status!=="completed"&&(k.value=a.value.status,a.value.status="completed"):(a.value.status=k.value||"inbox",k.value=null)},W=s=>s?/^\d{4}-\d{2}-\d{2}$/.test(s)?s:s.split("T")[0]:"",A=s=>s?/^\d{2}:\d{2}$/.test(s)?s:s.substring(0,5):"";V(()=>y.task,(s,e)=>{var t,n,d;if(e&&!s){a.value={title:"",description:"",status:"inbox",priority:"medium",due_date:"",estimated_time:"",end_time:"",workspace_id:(t=b.value)==null?void 0:t.id,project_id:null},k.value=null,i.value="",u.value=!1;return}if(s)console.log("Task received:",s),console.log("Original due_date:",s.due_date),console.log("Formatted due_date:",W(s.due_date)),s.status==="completed"?k.value=s.previous_status||"inbox":k.value=s.status||"inbox",a.value={title:s.title||"",description:s.description||"",status:s.status||"inbox",priority:s.priority||"medium",due_date:W(s.due_date),estimated_time:A(s.estimated_time),end_time:A(s.end_time),workspace_id:s.workspace_id||((n=b.value)==null?void 0:n.id),project_id:s.project_id||null};else{const c=C();k.value=c,a.value={title:"",description:"",status:c,priority:"medium",due_date:M(),estimated_time:"",end_time:"",workspace_id:(d=b.value)==null?void 0:d.id,project_id:null}}i.value="",u.value=!1},{immediate:!0}),V(()=>y.serverError,s=>{i.value=s,s&&(r.value=!1)}),V(()=>y.show,s=>{var e,t,n;s?y.task?a.value.workspace_id||(a.value.workspace_id=(t=b.value)==null?void 0:t.id):(a.value.workspace_id=(e=b.value)==null?void 0:e.id,a.value.status=C(),a.value.due_date=M()):(a.value={title:"",description:"",status:"inbox",priority:"medium",due_date:"",estimated_time:"",end_time:"",workspace_id:(n=b.value)==null?void 0:n.id,project_id:null},k.value=null,u.value=!1,r.value=!1,i.value="")}),V(()=>y.show,s=>{var e;s&&((e=b.value)!=null&&e.id)&&w.fetchProjects()}),V(()=>x.path,()=>{if(!y.task){a.value.status=C();const s=M();(s||x.path.includes("/today"))&&(a.value.due_date=s)}}),V(()=>{var s;return(s=b.value)==null?void 0:s.id},s=>{!y.task&&s&&(a.value.workspace_id=s)}),V(()=>a.value.due_date,s=>{if(!s||a.value.status==="completed")return;const e=new Date().toISOString().split("T")[0],t=new Date;t.setDate(t.getDate()+1);const n=t.toISOString().split("T")[0];s===e?a.value.status="today":s===n?a.value.status="tomorrow":["today","tomorrow","completed"].includes(a.value.status)||(a.value.status="scheduled")});const D=()=>{i.value="",r.value=!0,f("submit",a.value)},E=s=>{u.value&&!s.target.closest(".relative")&&(u.value=!1)};return oe(()=>{document.addEventListener("click",E)}),ae(()=>{document.removeEventListener("click",E)}),(s,e)=>(v(),R(ue,{to:"body"},[le(ie,{name:"modal"},{default:re(()=>[l.show?(v(),g("div",{key:0,class:"fixed inset-0 z-50 overflow-y-auto",onClick:e[13]||(e[13]=q(t=>s.$emit("close"),["self"]))},[e[27]||(e[27]=o("div",{class:"fixed inset-0 bg-black bg-opacity-50 transition-opacity"},null,-1)),o("div",ke,[o("div",{class:"relative bg-white rounded-lg shadow-xl max-w-2xl w-full mx-auto",onClick:e[12]||(e[12]=q(()=>{},["stop"]))},[o("div",ge,[o("h3",ye,T(l.task?"Редактировать задачу":"Новая задача"),1),o("button",{onClick:e[0]||(e[0]=t=>s.$emit("close")),class:"text-gray-400 hover:text-gray-600"},[...e[14]||(e[14]=[o("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),o("form",{onSubmit:q(D,["prevent"]),class:"p-6 space-y-4"},[o("div",be,[o("label",xe,[$(o("input",{type:"checkbox","onUpdate:modelValue":e[1]||(e[1]=t=>P.value=t),onChange:z,class:"w-5 h-5 text-primary-600 border-gray-300 rounded focus:ring-primary-500"},null,544),[[ne,P.value]]),o("span",_e,T(P.value?"Задача выполнена":"Отметить как выполненную"),1)])]),o("div",null,[e[15]||(e[15]=o("label",{for:"title",class:"block text-sm font-medium text-gray-700 mb-2"}," Название задачи * ",-1)),$(o("input",{id:"title","onUpdate:modelValue":e[2]||(e[2]=t=>a.value.title=t),type:"text",required:"",class:ee(["input",{"opacity-60":P.value}]),placeholder:"Введите название задачи"},null,2),[[L,a.value.title]])]),o("div",null,[e[16]||(e[16]=o("label",{for:"description",class:"block text-sm font-medium text-gray-700 mb-2"}," Описание ",-1)),$(o("textarea",{id:"description","onUpdate:modelValue":e[3]||(e[3]=t=>a.value.description=t),rows:"3",class:"input",placeholder:"Добавьте описание"},null,512),[[L,a.value.description]])]),o("div",he,[o("div",null,[e[18]||(e[18]=o("label",{for:"status",class:"block text-sm font-medium text-gray-700 mb-2"}," Статус ",-1)),o("div",je,[o("button",{type:"button",onClick:e[4]||(e[4]=t=>u.value=!u.value),class:"input w-full flex items-center justify-between"},[o("span",Se,[(v(),R(te(S[a.value.status].icon),{class:"w-5 h-5 text-gray-500"})),o("span",null,T(S[a.value.status].label),1)]),e[17]||(e[17]=o("svg",{class:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})],-1))]),u.value?(v(),g("div",$e,[(v(),g(G,null,J(S,(t,n)=>o("button",{key:n,type:"button",onClick:d=>O(n),class:ee(["w-full flex items-center space-x-2 px-3 py-2 text-sm hover:bg-gray-50 first:rounded-t-lg last:rounded-b-lg transition-colors",a.value.status===n?"bg-primary-50 text-primary-700":"text-gray-700"])},[(v(),R(te(t.icon),{class:"w-5 h-5"})),o("span",null,T(t.label),1)],10,Ce)),64))])):F("",!0)])]),o("div",null,[e[20]||(e[20]=o("label",{for:"priority",class:"block text-sm font-medium text-gray-700 mb-2"}," Приоритет ",-1)),$(o("select",{id:"priority","onUpdate:modelValue":e[5]||(e[5]=t=>a.value.priority=t),class:"input"},[...e[19]||(e[19]=[o("option",{value:"low"},"Низкий",-1),o("option",{value:"medium"},"Средний",-1),o("option",{value:"high"},"Высокий",-1),o("option",{value:"urgent"},"Срочный",-1)])],512),[[K,a.value.priority]])])]),o("div",Me,[o("div",null,[e[21]||(e[21]=o("label",{for:"due_date",class:"block text-sm font-medium text-gray-700 mb-2"}," Срок выполнения ",-1)),$(o("input",{id:"due_date","onUpdate:modelValue":e[6]||(e[6]=t=>a.value.due_date=t),type:"date",class:"input"},null,512),[[L,a.value.due_date]])]),o("div",null,[e[22]||(e[22]=o("label",{for:"estimated_time",class:"block text-sm font-medium text-gray-700 mb-2"}," Время начала ",-1)),$(o("input",{id:"estimated_time","onUpdate:modelValue":e[7]||(e[7]=t=>a.value.estimated_time=t),type:"time",class:"input",placeholder:"12:30"},null,512),[[L,a.value.estimated_time]])])]),o("div",null,[e[23]||(e[23]=o("label",{for:"end_time",class:"block text-sm font-medium text-gray-700 mb-2"}," Время окончания ",-1)),$(o("input",{id:"end_time","onUpdate:modelValue":e[8]||(e[8]=t=>a.value.end_time=t),type:"time",class:"input",placeholder:"13:30"},null,512),[[L,a.value.end_time]])]),j.value.length>1?(v(),g("div",Te,[e[24]||(e[24]=o("label",{for:"workspace_id",class:"block text-sm font-medium text-gray-700 mb-2"}," Рабочее пространство ",-1)),$(o("select",{id:"workspace_id","onUpdate:modelValue":e[9]||(e[9]=t=>a.value.workspace_id=t),class:"input"},[(v(!0),g(G,null,J(j.value,t=>(v(),g("option",{key:t.id,value:t.id},T(t.name),9,Ve))),128))],512),[[K,a.value.workspace_id]])])):F("",!0),o("div",null,[e[26]||(e[26]=o("label",{for:"project_id",class:"block text-sm font-medium text-gray-700 mb-2"}," Проект ",-1)),$(o("select",{id:"project_id","onUpdate:modelValue":e[10]||(e[10]=t=>a.value.project_id=t),class:"input"},[e[25]||(e[25]=o("option",{value:null},"Без проекта",-1)),(v(!0),g(G,null,J(I.value,t=>(v(),g("option",{key:t.id,value:t.id},T(t.name),9,Be))),128))],512),[[K,a.value.project_id]])]),i.value?(v(),g("div",Ie,T(i.value),1)):F("",!0),o("div",Pe,[o("button",{type:"button",onClick:e[11]||(e[11]=t=>s.$emit("close")),class:"btn btn-secondary"}," Отмена "),o("button",{type:"submit",disabled:r.value,class:"btn btn-primary"},T(r.value?"Сохранение...":"Сохранить"),9,Oe)])],32)])])])):F("",!0)]),_:1})]))}},Fe=ce(De,[["__scopeId","data-v-97b0fe88"]]);export{Fe as T,fe as a,Q as b,me as c,we as d,ve as e,pe as r,Ae as u};
