import{k as b,r as p,H as O,c as n,a as r,f as v,b as h,p as y,F as w,z,A as C,e as F,o as l,d as I,l as H,m as L,t as _,I as W}from"./index-Ay-5fVOp.js";import{u as q,r as J,a as K,c as P,b as Q,d as R,T as U}from"./TaskModal-DKgrON56.js";import{_ as X}from"./TaskList-DxUZ6oIQ.js";import{r as T}from"./CalendarDaysIcon-BnGN39sH.js";import{r as Y}from"./RectangleStackIcon-BbLiZyVe.js";import{r as Z}from"./PlusIcon-aIuDvZJu.js";import"./workspace-Be_ypMAx.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ru-B7JyRvIu.js";const ee={class:"p-4 lg:p-8"},te={class:"max-w-4xl mx-auto"},se={class:"mb-6 flex items-center justify-between"},oe={key:0,class:"flex items-center bg-gray-100 dark:bg-gray-700 rounded-lg p-0.5"},re={key:0,class:"text-center py-12"},ae={key:0,class:"space-y-6"},le=["onClick"],ne={class:"text-sm font-semibold text-gray-700 dark:text-gray-300"},ie={class:"ml-2 text-xs text-gray-400 dark:text-gray-500"},de={key:1,class:"text-center py-12"},ce={class:"max-w-md mx-auto"},ue={class:"w-16 h-16 mx-auto mb-4 rounded-full bg-gray-50 dark:bg-gray-800 flex items-center justify-center"},Ce={__name:"AllTasks",setup(me){const c=q(),x=b(()=>c.filteredTasks),$=b(()=>c.loading),u=p(!1),i=p(null),g=p(""),m=p("section"),k=O(new Set),B={inbox:{label:"Входящие",icon:R,iconColor:"text-blue-500",order:0},today:{label:"Сегодня",icon:Q,iconColor:"text-amber-500",order:1},next_action:{label:"Следующие действия",icon:P,iconColor:"text-yellow-500",order:2},tomorrow:{label:"Завтра",icon:T,iconColor:"text-indigo-500",order:3},scheduled:{label:"Запланированные",icon:T,iconColor:"text-teal-500",order:4},waiting:{label:"Ожидание",icon:K,iconColor:"text-orange-500",order:5},someday:{label:"Когда-нибудь",icon:J,iconColor:"text-purple-500",order:6}},S=b(()=>m.value==="section"?j(x.value):M(x.value));function j(o){const e={};for(const t of o){const s=t.status;if(!e[s]){const a=B[s]||{label:s,icon:null,iconColor:"",order:99};e[s]={key:`section-${s}`,label:a.label,icon:a.icon,iconColor:a.iconColor,order:a.order,tasks:[]}}e[s].tasks.push(t)}return Object.values(e).sort((t,s)=>t.order-s.order)}function M(o){var t;const e={};for(const s of o){const a=s.workspace_id,d=((t=s.workspace)==null?void 0:t.name)||"Без пространства";e[a]||(e[a]={key:`ws-${a}`,label:d,icon:null,iconColor:"",tasks:[]}),e[a].tasks.push(s)}return Object.values(e).sort((s,a)=>s.label.localeCompare(a.label))}const N=o=>{k.has(o)?k.delete(o):k.add(o)},E=o=>{i.value=o,u.value=!0},V=()=>{i.value=null,u.value=!0},A=async o=>{try{o.status==="completed"?await c.updateTask(o.id,{status:"inbox"}):await c.completeTask(o.id)}catch(e){console.error("Error toggling task:",e)}},D=async o=>{var e,t,s,a;g.value="";try{i.value?await c.updateTask(i.value.id,o):await c.createTask(o),u.value=!1,i.value=null}catch(d){console.error("Error saving task:",d);let f="Ошибка при сохранении задачи";(t=(e=d.response)==null?void 0:e.data)!=null&&t.errors?f=Object.values(d.response.data.errors).flat().join(", "):(a=(s=d.response)==null?void 0:s.data)!=null&&a.message&&(f=d.response.data.message),g.value=f}},G=()=>{u.value=!1,i.value=null,g.value=""};return(o,e)=>(l(),n("div",ee,[r("div",te,[r("div",se,[e[2]||(e[2]=r("h1",{class:"text-xl lg:text-2xl font-semibold text-gray-900 dark:text-white"},"Все задачи",-1)),x.value.length>0?(l(),n("div",oe,[r("button",{onClick:e[0]||(e[0]=t=>m.value="section"),class:y(["px-3 py-1.5 text-xs font-medium rounded-md transition-colors",m.value==="section"?"bg-white dark:bg-gray-600 text-gray-900 dark:text-white shadow-sm":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"])}," По секциям ",2),r("button",{onClick:e[1]||(e[1]=t=>m.value="workspace"),class:y(["px-3 py-1.5 text-xs font-medium rounded-md transition-colors",m.value==="workspace"?"bg-white dark:bg-gray-600 text-gray-900 dark:text-white shadow-sm":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"])}," По пространствам ",2)])):h("",!0)]),$.value?(l(),n("div",re,[...e[3]||(e[3]=[r("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"},null,-1)])])):(l(),n(w,{key:1},[x.value.length>0?(l(),n("div",ae,[(l(!0),n(w,null,z(S.value,t=>(l(),n("div",{key:t.key},[r("button",{onClick:s=>N(t.key),class:"flex items-center w-full text-left mb-2 group"},[(l(),n("svg",{class:y(["w-4 h-4 mr-2 text-gray-400 transition-transform",{"-rotate-90":k.has(t.key)}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...e[4]||(e[4]=[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2)),t.icon?(l(),H(L(t.icon),{key:0,class:y(["w-4 h-4 mr-2",t.iconColor])},null,8,["class"])):h("",!0),r("span",ne,_(t.label),1),r("span",ie,_(t.tasks.length),1)],8,le),I(r("div",null,[v(X,{tasks:t.tasks,onTaskClick:E,onToggleComplete:A},null,8,["tasks"])],512),[[W,!k.has(t.key)]])]))),128))])):(l(),n("div",de,[r("div",ce,[r("div",ue,[v(C(Y),{class:"w-8 h-8 text-gray-400"})]),e[6]||(e[6]=r("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white mb-2"},"Задач пока нет",-1)),e[7]||(e[7]=r("p",{class:"text-sm text-gray-500 dark:text-gray-400 mb-6 leading-relaxed"}," Здесь отображаются все ваши активные задачи из всех разделов GTD. Начните с добавления задач во «Входящие» — записывайте всё, что приходит в голову, а затем распределяйте по нужным спискам. ",-1)),r("button",{onClick:V,class:"inline-flex items-center px-4 py-2 bg-primary-600 text-white text-sm font-medium rounded-lg hover:bg-primary-700 transition-colors"},[v(C(Z),{class:"w-5 h-5 mr-1.5"}),e[5]||(e[5]=F(" Добавить задачу ",-1))])])]))],64)),v(U,{show:u.value,task:i.value,"server-error":g.value,onClose:G,onSubmit:D},null,8,["show","task","server-error"])])]))}};export{Ce as default};
