import{r as i,B as T,c as l,a as t,f as C,b as P,E as A,t as S,e as F,i as H,j as L,o as n}from"./index-BbattLL9.js";import{u as U}from"./projects-pUYbRipo.js";import{u as q,T as D}from"./TaskModal-CPOJYm8j.js";import{u as G}from"./workspace-B3uH3rGF.js";import{T as J}from"./TaskList-CyYHu9Ci.js";import{P as K}from"./ProjectModal-DkMFoRTh.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ru-B7JyRvIu.js";const O={class:"p-4 lg:p-8"},Q={class:"max-w-4xl mx-auto"},X={class:"flex flex-col lg:flex-row lg:items-center lg:justify-between mb-6"},Y={class:"flex items-center space-x-3 mb-4 lg:mb-0"},Z={class:"text-xl lg:text-2xl font-semibold text-gray-900 dark:text-white"},ee={key:0,class:"text-sm text-gray-600 dark:text-gray-400 mt-1"},re={class:"flex items-center space-x-2"},te={key:0,class:"text-center py-12"},oe={key:1},ae={class:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700"},se={class:"p-4 border-b border-gray-200 dark:border-gray-700"},le={class:"text-lg font-semibold text-gray-900 dark:text-white"},ne={key:0,class:"text-sm font-normal text-gray-500 dark:text-gray-400"},ce={key:0,class:"p-12 text-center text-gray-500 dark:text-gray-400"},ie={key:1,class:"divide-y divide-gray-200 dark:divide-gray-700"},fe={__name:"Show",setup(de){const m=L(),b=H(),g=U(),d=q(),x=G(),o=i(null),u=i([]),_=i(!1),p=i(!1),y=i(!1),c=i(null),f=i(""),j=i(""),v=async()=>{var a,s,k;const e=parseInt(m.params.projectId),r=(a=x.currentWorkspace)==null?void 0:a.id;if(!r||!e){console.error("Missing workspaceId or projectId",{workspaceId:r,projectId:e});return}_.value=!0;try{const h=await g.fetchProject(e);if(o.value=h,o.value.workspace_id!==r){console.error("Project does not belong to current workspace"),b.push(`/workspaces/${r}/projects`);return}w()}catch(h){console.error("Error loading project:",h),console.error("Error details:",(s=h.response)==null?void 0:s.data),((k=h.response)==null?void 0:k.status)===404&&b.push(`/workspaces/${r}/projects`)}finally{_.value=!1}},w=()=>{const e=parseInt(m.params.projectId);if(!e){u.value=[];return}u.value=d.filteredTasks.filter(r=>r.project_id===e)},E=()=>{y.value=!0},I=async()=>{var e,r;if(confirm(`Архивировать проект "${(e=o.value)==null?void 0:e.name}"?`))try{await g.archiveProject(o.value.id),await v(),b.push(`/workspaces/${(r=x.currentWorkspace)==null?void 0:r.id}/projects`)}catch(a){console.error("Error archiving project:",a),alert("Ошибка при архивировании проекта")}},M=async()=>{try{await g.unarchiveProject(o.value.id),await v()}catch(e){console.error("Error unarchiving project:",e),alert("Ошибка при восстановлении проекта")}},B=()=>{c.value=null,p.value=!0},V=e=>{c.value=e,p.value=!0},N=async e=>{var r,a;f.value="";try{c.value||(e.project_id=o.value.id),c.value?await d.updateTask(c.value.id,e):await d.createTask(e),p.value=!1,c.value=null,w()}catch(s){console.error("Error saving task:",s),f.value=((a=(r=s.response)==null?void 0:r.data)==null?void 0:a.message)||s.message||"Ошибка при сохранении задачи"}},W=()=>{p.value=!1,c.value=null,f.value=""},$=async e=>{var r,a;j.value="";try{await g.updateProject(o.value.id,e),y.value=!1,await v()}catch(s){console.error("Error saving project:",s),j.value=((a=(r=s.response)==null?void 0:r.data)==null?void 0:a.message)||s.message||"Ошибка при сохранении проекта"}},R=()=>{y.value=!1,j.value=""},z=async e=>{try{e.status==="completed"?await d.updateTask(e.id,{status:"inbox"}):await d.completeTask(e.id),w()}catch(r){console.error("Error toggling task:",r)}};return T(()=>m.params.projectId,()=>{v()},{immediate:!0}),T(()=>{var e;return(e=x.currentWorkspace)==null?void 0:e.id},()=>{m.params.projectId&&v()}),T(()=>d.filteredTasks,()=>{w()},{deep:!0}),(e,r)=>{var a,s,k;return n(),l("div",O,[t("div",Q,[t("div",X,[t("div",Y,[o.value?(n(),l("div",{key:0,class:"w-4 h-4 rounded-full",style:A({backgroundColor:o.value.color||"#3B82F6"})},null,4)):P("",!0),t("div",null,[t("h1",Z,S(((a=o.value)==null?void 0:a.name)||"Загрузка..."),1),(s=o.value)!=null&&s.description?(n(),l("p",ee,S(o.value.description),1)):P("",!0)])]),t("div",re,[t("button",{onClick:E,class:"btn btn-secondary"}," Редактировать "),((k=o.value)==null?void 0:k.status)!=="archived"?(n(),l("button",{key:0,onClick:I,class:"btn btn-secondary"}," Архивировать ")):(n(),l("button",{key:1,onClick:M,class:"btn btn-secondary"}," Восстановить "))])]),_.value?(n(),l("div",te,[...r[0]||(r[0]=[t("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"},null,-1)])])):(n(),l("div",oe,[t("div",ae,[t("div",se,[t("h2",le,[r[1]||(r[1]=F(" Задачи проекта ",-1)),u.value.length>0?(n(),l("span",ne," ("+S(u.value.length)+") ",1)):P("",!0)])]),u.value.length===0?(n(),l("div",ce,[r[2]||(r[2]=t("svg",{class:"w-16 h-16 mx-auto mb-4 text-gray-300 dark:text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})],-1)),r[3]||(r[3]=t("p",null,"Нет задач в проекте",-1)),t("button",{onClick:B,class:"mt-4 btn btn-primary"}," Создать задачу ")])):(n(),l("div",ie,[C(J,{tasks:u.value,onTaskClick:V,onToggleComplete:z},null,8,["tasks"])]))])])),C(D,{show:p.value,task:c.value,"server-error":f.value,onClose:W,onSubmit:N},null,8,["show","task","server-error"]),C(K,{show:y.value,project:o.value,"server-error":j.value,onClose:R,onSubmit:$},null,8,["show","project","server-error"])])])}}};export{fe as default};
