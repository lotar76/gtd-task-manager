import{r as i,B as E,c as l,a as o,f as T,b as C,E as A,t as P,e as F,i as G,j as H,G as L,o as c}from"./index-CdN_pyDO.js";import{e as U,u as q,T as D}from"./TaskModal-9pWiNZlS.js";import{u as J}from"./workspace-CLZDVMrF.js";import{T as K}from"./TaskList-DDewgCzI.js";import{P as O}from"./ProjectModal-B-otYHXd.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ru-B7JyRvIu.js";const Q={class:"p-4 lg:p-8"},X={class:"max-w-4xl mx-auto"},Y={class:"flex flex-col lg:flex-row lg:items-center lg:justify-between mb-6"},Z={class:"flex items-center space-x-3 mb-4 lg:mb-0"},ee={class:"text-xl lg:text-2xl font-semibold text-gray-900"},te={key:0,class:"text-sm text-gray-600 mt-1"},re={class:"flex items-center space-x-2"},se={key:0,class:"text-center py-12"},oe={key:1},ae={class:"bg-white rounded-lg shadow-sm border border-gray-200"},le={class:"p-4 border-b border-gray-200"},ce={class:"text-lg font-semibold text-gray-900"},ne={key:0,class:"text-sm font-normal text-gray-500"},ie={key:0,class:"p-12 text-center text-gray-500"},de={key:1,class:"divide-y divide-gray-200"},we={__name:"Show",setup(ue){const k=H(),b=G(),m=U(),g=q(),y=J(),a=i(null),d=i([]),_=i(!1),u=i(!1),w=i(!1),n=i(null),f=i(""),j=i(""),p=async()=>{var s,r,v;const t=parseInt(k.params.projectId),e=(s=y.currentWorkspace)==null?void 0:s.id;if(!e||!t){console.error("Missing workspaceId or projectId",{workspaceId:e,projectId:t});return}_.value=!0;try{const h=await m.fetchProject(t);if(a.value=h,a.value.workspace_id!==e){console.error("Project does not belong to current workspace"),b.push(`/workspaces/${e}/projects`);return}await x()}catch(h){console.error("Error loading project:",h),console.error("Error details:",(r=h.response)==null?void 0:r.data),((v=h.response)==null?void 0:v.status)===404&&b.push(`/workspaces/${e}/projects`)}finally{_.value=!1}},x=async()=>{var s;const t=parseInt(k.params.projectId),e=(s=y.currentWorkspace)==null?void 0:s.id;if(!(!e||!t))try{const r=await L.get(`/v1/workspaces/${e}/projects/${t}/tasks`);d.value=r.data.data||r.data||[]}catch(r){console.error("Error loading tasks:",r),d.value=[]}},S=()=>{w.value=!0},I=async()=>{var t,e;if(confirm(`Архивировать проект "${(t=a.value)==null?void 0:t.name}"?`))try{await m.archiveProject(a.value.id),await p(),b.push(`/workspaces/${(e=y.currentWorkspace)==null?void 0:e.id}/projects`)}catch(s){console.error("Error archiving project:",s),alert("Ошибка при архивировании проекта")}},M=async()=>{try{await m.unarchiveProject(a.value.id),await p()}catch(t){console.error("Error unarchiving project:",t),alert("Ошибка при восстановлении проекта")}},B=()=>{n.value=null,u.value=!0},$=t=>{n.value=t,u.value=!0},V=async t=>{var e,s;f.value="";try{n.value||(t.project_id=a.value.id),n.value?await g.updateTask(n.value.id,t):await g.createTask(t),u.value=!1,n.value=null,await x()}catch(r){console.error("Error saving task:",r),f.value=((s=(e=r.response)==null?void 0:e.data)==null?void 0:s.message)||r.message||"Ошибка при сохранении задачи"}},W=()=>{u.value=!1,n.value=null,f.value=""},N=async t=>{var e,s;j.value="";try{await m.updateProject(a.value.id,t),w.value=!1,await p()}catch(r){console.error("Error saving project:",r),j.value=((s=(e=r.response)==null?void 0:e.data)==null?void 0:s.message)||r.message||"Ошибка при сохранении проекта"}},R=()=>{w.value=!1,j.value=""},z=async t=>{try{t.status==="completed"?await g.updateTask(t.id,{status:"inbox"}):await g.completeTask(t.id),await x()}catch(e){console.error("Error toggling task:",e)}};return E(()=>k.params.projectId,()=>{p()},{immediate:!0}),E(()=>{var t;return(t=y.currentWorkspace)==null?void 0:t.id},()=>{k.params.projectId&&p()}),(t,e)=>{var s,r,v;return c(),l("div",Q,[o("div",X,[o("div",Y,[o("div",Z,[a.value?(c(),l("div",{key:0,class:"w-4 h-4 rounded-full",style:A({backgroundColor:a.value.color||"#3B82F6"})},null,4)):C("",!0),o("div",null,[o("h1",ee,P(((s=a.value)==null?void 0:s.name)||"Загрузка..."),1),(r=a.value)!=null&&r.description?(c(),l("p",te,P(a.value.description),1)):C("",!0)])]),o("div",re,[o("button",{onClick:S,class:"btn btn-secondary"}," Редактировать "),((v=a.value)==null?void 0:v.status)!=="archived"?(c(),l("button",{key:0,onClick:I,class:"btn btn-secondary"}," Архивировать ")):(c(),l("button",{key:1,onClick:M,class:"btn btn-secondary"}," Восстановить "))])]),_.value?(c(),l("div",se,[...e[0]||(e[0]=[o("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"},null,-1)])])):(c(),l("div",oe,[o("div",ae,[o("div",le,[o("h2",ce,[e[1]||(e[1]=F(" Задачи проекта ",-1)),d.value.length>0?(c(),l("span",ne," ("+P(d.value.length)+") ",1)):C("",!0)])]),d.value.length===0?(c(),l("div",ie,[e[2]||(e[2]=o("svg",{class:"w-16 h-16 mx-auto mb-4 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})],-1)),e[3]||(e[3]=o("p",null,"Нет задач в проекте",-1)),o("button",{onClick:B,class:"mt-4 btn btn-primary"}," Создать задачу ")])):(c(),l("div",de,[T(K,{tasks:d.value,onTaskClick:$,onToggleComplete:z},null,8,["tasks"])]))])])),T(D,{show:u.value,task:n.value,"server-error":f.value,onClose:W,onSubmit:V},null,8,["show","task","server-error"]),T(O,{show:w.value,project:a.value,"server-error":j.value,onClose:R,onSubmit:N},null,8,["show","project","server-error"])])])}}};export{we as default};
