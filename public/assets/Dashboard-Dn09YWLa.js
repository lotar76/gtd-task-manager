import{E as $e,G as pe,r as j,z as ae,H as xe,k as A,c as s,o as r,a as e,b as M,t as u,e as de,F as C,C as L,p as X,D as W,f as K,l as J,x as ie,w as ye,s as ke,m as Me,y as se}from"./index-CnkTNq8J.js";import{u as be}from"./workspace-DnamxNfV.js";import{d as ne,T as _e}from"./TaskView-IIz2npxp.js";import{u as ce,T as we}from"./TaskModal-CY_2zmW9.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./projects-CEoyNY3i.js";import"./lifeSpheres-BNGfdyGE.js";import"./goals-CNAspvLr.js";const ue=$e("dashboard",()=>{const a=pe({}),$=j(localStorage.getItem("dashboardPeriod")||"day"),h=be(),v=t=>{a[t]||(a[t]={lifeMirror:null,aiMessage:null,loading:!1,aiLoading:!1,aiSilentLoading:!1})},d=async t=>{if(t){v(t),a[t].loading=!0;try{const p=await xe.get("/v1/dashboard/life-mirror",{params:{workspace_id:t,period:$.value}});a[t].lifeMirror=p.data}catch(p){console.error(`Failed to fetch life mirror for ws ${t}:`,p),a[t].lifeMirror=null}finally{a[t].loading=!1}}},k=async(t,p=!1,x=!1)=>{if(t){v(t),x?a[t].aiSilentLoading=!0:a[t].aiLoading=!0;try{const T=await xe.get("/v1/dashboard/ai-message",{params:{workspace_id:t,period:$.value,force:p?1:0}});a[t].aiMessage=T.data}catch(T){console.error(`Failed to fetch AI message for ws ${t}:`,T),a[t].aiMessage=null}finally{x?a[t].aiSilentLoading=!1:a[t].aiLoading=!1}}},_=async(t,p=!1)=>{await d(t),await k(t,!1,p)},w=async()=>{const t=h.selectedWorkspaces;t.length&&await Promise.all(t.map(p=>_(p.id)))},c=t=>{$.value=t,localStorage.setItem("dashboardPeriod",t),w()};return ae(()=>h.selectedWorkspaces.map(t=>t.id).join(","),()=>{w()}),{dataByWorkspace:a,selectedPeriod:$,fetchLifeMirror:d,fetchAiMessage:k,fetchForWorkspace:_,fetchAllWorkspaces:w,setPeriod:c}}),Ce={class:"mb-6"},Se={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-4"},Te={class:"flex flex-col gap-1"},ze={class:"text-sm text-gray-500 dark:text-gray-400"},Le={key:0,class:"flex-1 max-w-2xl mx-4"},We={class:"text-gray-600 dark:text-gray-400 text-sm italic leading-relaxed"},Pe={class:"text-gray-400 dark:text-gray-500 not-italic ml-1"},Ae={class:"inline-flex rounded-xl bg-gray-100 dark:bg-gray-800 p-1",role:"group"},Ye=["onClick"],Ee={__name:"DashboardHeader",props:{period:{type:String,required:!0},bibleVerse:{type:Object,default:null}},emits:["change-period"],setup(a){ne.locale("ru");const $=a,h=[{value:"day",label:"День"},{value:"week",label:"Неделя"},{value:"month",label:"Месяц"},{value:"year",label:"Год"}],v=A(()=>{const d=ne();switch($.period){case"day":return d.format("D MMMM YYYY, dddd");case"week":{const k=d.startOf("week"),_=d.endOf("week");return`${k.format("D MMM")} — ${_.format("D MMM YYYY")}`}case"month":return d.format("MMMM YYYY");case"year":return d.format("YYYY год");default:return d.format("D MMMM YYYY")}});return(d,k)=>(r(),s("div",Ce,[e("div",Se,[e("div",Te,[k[0]||(k[0]=e("h1",{class:"text-xl sm:text-2xl font-bold text-gray-900 dark:text-white"}," Зеркало жизни ",-1)),e("p",ze,u(v.value),1)]),a.bibleVerse?(r(),s("div",Le,[e("p",We,[de(" «"+u(a.bibleVerse.text)+"» ",1),e("span",Pe,"— "+u(a.bibleVerse.ref),1)])])):M("",!0),e("div",Ae,[(r(),s(C,null,L(h,_=>e("button",{key:_.value,onClick:w=>d.$emit("change-period",_.value),type:"button",class:X(["px-3 py-1.5 text-xs sm:text-sm font-medium rounded-lg transition-all duration-200",[a.period===_.value?"bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"]])},u(_.label),11,Ye)),64))])])]))}},je={class:"relative overflow-hidden rounded-2xl shadow-sm border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 h-full flex flex-col"},De={key:0,class:"absolute top-2 right-2 z-10"},Be={class:"p-4 sm:p-6 flex-1 flex flex-col"},Ie={class:"max-h-[40vh] overflow-y-auto sm:max-h-none sm:overflow-visible scrollbar-thin flex-1 flex flex-col justify-center"},He={key:0,class:"animate-pulse space-y-3"},Ve={key:1},Ne={class:"text-sm sm:text-base text-gray-900 dark:text-gray-100 leading-relaxed"},Xe={key:0,class:"mt-2 sm:mt-3 bg-gray-50 dark:bg-gray-700/50 rounded-xl p-3 sm:p-4"},Oe={class:"text-gray-700 dark:text-gray-300 text-xs sm:text-sm leading-relaxed"},Re={key:1,class:"mt-3 sm:mt-4 flex flex-wrap gap-1.5 sm:gap-2"},Fe={key:2,class:"mt-3 flex items-center gap-2"},qe={class:"text-xs text-gray-400 dark:text-gray-500"},Ue={key:2,class:"flex flex-col items-center justify-center flex-1 text-center"},ve={__name:"AiHeroBanner",props:{message:{type:Object,default:null},loading:{type:Boolean,default:!1},silentLoading:{type:Boolean,default:!1}},emits:["refresh","analyze"],setup(a){const $=h=>{const v=new Date(h),k=new Date-v,_=Math.floor(k/6e4);if(_<60)return`${_} мин. назад`;const w=Math.floor(_/60);if(w<24)return`${w} ч. назад`;const c=v.getDate().toString().padStart(2,"0"),t=(v.getMonth()+1).toString().padStart(2,"0"),p=v.getHours().toString().padStart(2,"0"),x=v.getMinutes().toString().padStart(2,"0");return`${c}.${t} в ${p}:${x}`};return(h,v)=>{var d;return r(),s("div",null,[e("div",je,[a.silentLoading?(r(),s("div",De,[...v[2]||(v[2]=[e("svg",{class:"animate-spin h-4 w-4 text-primary-600 dark:text-primary-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)])])):M("",!0),e("div",Be,[e("div",Ie,[a.loading?(r(),s("div",He,[...v[3]||(v[3]=[e("div",{class:"h-5 bg-gray-200 dark:bg-gray-700 rounded w-2/3"},null,-1),e("div",{class:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-full"},null,-1),e("div",{class:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-4/5"},null,-1)])])):a.message?(r(),s("div",Ve,[e("p",Ne,u(a.message.main_message),1),a.message.followup_message?(r(),s("div",Xe,[e("p",Oe,u(a.message.followup_message),1)])):M("",!0),(d=a.message.recommendations)!=null&&d.length?(r(),s("div",Re,[(r(!0),s(C,null,L(a.message.recommendations,(k,_)=>(r(),s("div",{key:_,class:"bg-gray-100 dark:bg-gray-700 rounded-lg px-2.5 py-1.5 sm:px-3 sm:py-2 text-xs sm:text-sm text-gray-700 dark:text-gray-300 flex items-center gap-1.5 sm:gap-2"},[e("div",{class:"w-2 h-2 rounded-full flex-shrink-0",style:W({backgroundColor:k.sphere_color||"#9ca3af"})},null,4),e("span",null,u(k.action),1)]))),128))])):M("",!0),a.message.generated_at?(r(),s("div",Fe,[e("p",qe," Анализ от "+u($(a.message.generated_at)),1),a.message.is_stale?(r(),s("button",{key:0,onClick:v[0]||(v[0]=k=>h.$emit("refresh")),class:"text-xs font-medium text-green-600 dark:text-green-500 hover:text-green-700 dark:hover:text-green-400 transition-colors cursor-pointer"}," • нужно проанализировать состояние ")):M("",!0)])):M("",!0)])):(r(),s("div",Ue,[v[4]||(v[4]=e("p",{class:"text-gray-500 dark:text-gray-400 text-xs sm:text-sm mb-4"},"Получи AI анализ баланса жизненных сфер",-1)),e("button",{onClick:v[1]||(v[1]=k=>h.$emit("analyze")),class:"px-4 py-2 bg-primary-600 hover:bg-primary-700 text-white rounded-lg text-sm font-medium transition-colors mx-auto"}," Проанализировать ")]))])])])])}}},Ge={class:"flex flex-col items-center"},Ze=["width","height","viewBox"],Je=["cx","cy","r"],Ke=["cx","cy","r"],Qe=["x1","y1","x2","y2"],et=["d","fill-opacity","stroke","stroke-width"],tt=["d","fill","fill-opacity","stroke","stroke-width"],rt=["d","stroke"],at=["d","stroke"],st=["x","y","fill","text-anchor"],ot=["x","dy"],lt=["d","onMouseenter","onClick"],nt=["cx","cy","r"],dt=["x","y"],it=["x","y"],re=50,fe=.03,oe={__name:"BalanceWheel",props:{spheres:{type:Array,default:()=>[]},balanceIndex:{type:Number,default:0},size:{type:Number,default:280},hoveredSphereName:{type:String,default:null}},emits:["sphere-hover","sphere-leave","sphere-click"],setup(a,{emit:$}){const h=a,v=$,d=j(null),k=j([]),_=o=>{var n;d.value=o,v("sphere-hover",(n=h.spheres[o])==null?void 0:n.name)},w=()=>{d.value=null,v("sphere-leave")},c=(o,n)=>{n.total===0&&v("sphere-click",o)};ae([()=>h.spheres,()=>h.hoveredSphereName,d],()=>{k.value=h.spheres.map((o,n)=>{const l=d.value===n,i=h.hoveredSphereName&&h.hoveredSphereName===o.name;return l||i})},{immediate:!0,deep:!0});const t=A(()=>h.size/2),p=A(()=>h.size/2-50),x=A(()=>p.value*.35),T=A(()=>h.spheres.length),D=A(()=>T.value>0?2*Math.PI/T.value:0),g=[25,50,75],Y=o=>D.value*o-Math.PI/2+fe/2,O=o=>D.value*(o+1)-Math.PI/2-fe/2,F=o=>(Y(o)+O(o))/2,B=(o,n)=>t.value+n*Math.cos(o),I=(o,n)=>t.value+n*Math.sin(o),U=A(()=>h.spheres.length?Math.max(...h.spheres.map(o=>o.total||0),1):1),V=(o,n,l)=>{if(T.value===0||l<=n)return"";const i=Y(o),b=O(o),H=b-i>Math.PI?1:0;return[`M ${B(i,n)} ${I(i,n)}`,`L ${B(i,l)} ${I(i,l)}`,`A ${l} ${l} 0 ${H} 1 ${B(b,l)} ${I(b,l)}`,`L ${B(b,n)} ${I(b,n)}`,`A ${n} ${n} 0 ${H} 0 ${B(i,n)} ${I(i,n)}`,"Z"].join(" ")},G=(o,n)=>{if(T.value===0)return"";const l=Y(o),i=O(o),b=i-l>Math.PI?1:0;return`M ${B(l,n)} ${I(l,n)} A ${n} ${n} 0 ${b} 1 ${B(i,n)} ${I(i,n)}`},z=o=>{if(!o.total||o.total===0)return x.value;const n=o.total/U.value;return x.value+(p.value-x.value)*Math.max(n,.1)},P=o=>{if(!o.done||o.done===0)return x.value;const n=o.done/U.value;return x.value+(p.value-x.value)*Math.max(n,.08)},E=o=>G(o,p.value),N=(o,n)=>{const l=z(n);return l<=x.value?"":V(o,x.value,l)},R=(o,n)=>{const l=P(n);return l<=x.value?"":V(o,x.value,l)},S=(o,n)=>{const l=P(n);return l<=x.value?"":G(o,l)},Z=A(()=>T.value<=1?[]:h.spheres.map((o,n)=>{const l=D.value*n-Math.PI/2;return{x1:B(l,x.value),y1:I(l,x.value),x2:B(l,p.value),y2:I(l,p.value)}})),y=A(()=>h.spheres.map((o,n)=>{const l=p.value+18;return{x:B(F(n),l),y:I(F(n),l)}})),f=o=>{const n=F(o)*180/Math.PI;return n>-60&&n<60?"start":n>120||n<-120?"end":"middle"},m=o=>{if(!o)return[""];const n=11;if(o.length<=n)return[o];const l=o.split(" ");if(l.length===1)return[o.substring(0,n-1)+"…"];const i=[];let b="";for(let H=0;H<l.length;H++){const q=l[H],ee=b?b+" "+q:q;ee.length<=n?b=ee:b?(i.push(b),b=q):(i.push(q.substring(0,n-1)+"…"),b="")}return b&&i.push(b),i.length>2?(i[1]=i[1].substring(0,n-1)+"…",i.slice(0,2)):i};return(o,n)=>(r(),s("div",Ge,[(r(),s("svg",{width:a.size,height:a.size,viewBox:`${-re} ${-re} ${a.size+re*2} ${a.size+re*2}`},[(r(),s(C,null,L(g,l=>e("circle",{key:"grid-"+l,cx:t.value,cy:t.value,r:x.value+(p.value-x.value)*l/100,fill:"none",stroke:"currentColor",class:"text-gray-200 dark:text-gray-700","stroke-width":"0.5","stroke-dasharray":"3 3"},null,8,Je)),64)),e("circle",{cx:t.value,cy:t.value,r:p.value,fill:"none",stroke:"currentColor",class:"text-gray-300 dark:text-gray-600","stroke-width":"1.5"},null,8,Ke),(r(!0),s(C,null,L(Z.value,(l,i)=>(r(),s("line",{key:"div-"+i,x1:l.x1,y1:l.y1,x2:l.x2,y2:l.y2,stroke:"currentColor",class:"text-gray-300 dark:text-gray-600","stroke-width":"1"},null,8,Qe))),128)),(r(!0),s(C,null,L(a.spheres,(l,i)=>(r(),s("path",{key:"total-"+i,d:N(i,l),fill:"currentColor",class:"text-gray-400 dark:text-gray-500 transition-all duration-300 ease-out","fill-opacity":k.value[i]?"0.5":"0.25",stroke:k.value[i]?l.color:"none","stroke-width":k.value[i]?"2":"0"},null,8,et))),128)),(r(!0),s(C,null,L(a.spheres,(l,i)=>(r(),s("path",{key:"done-"+i,d:R(i,l),fill:l.color||"#888","fill-opacity":k.value[i]?"1":"0.45",stroke:k.value[i]?l.color:"none","stroke-width":k.value[i]?"3":"0",class:"transition-all duration-300 ease-out"},null,8,tt))),128)),(r(!0),s(C,null,L(a.spheres,(l,i)=>(r(),s("path",{key:"edge-"+i,d:S(i,l),fill:"none",stroke:l.color||"#888","stroke-width":"2.5","stroke-linecap":"round",class:"transition-all duration-700 ease-out"},null,8,rt))),128)),(r(!0),s(C,null,L(a.spheres,(l,i)=>(r(),s("path",{key:"arc-"+i,d:E(i),fill:"none",stroke:l.color||"#888","stroke-width":"3","stroke-opacity":"0.25","stroke-linecap":"round"},null,8,at))),128)),(r(!0),s(C,null,L(a.spheres,(l,i)=>(r(),s("text",{key:"label-"+i,x:y.value[i].x,y:y.value[i].y,fill:l.color||"#888","font-size":"13","font-weight":"600","text-anchor":f(i)},[(r(!0),s(C,null,L(m(l.name),(b,H)=>(r(),s("tspan",{key:H,x:y.value[i].x,dy:H===0?m(l.name).length>1?"-0.3em":"0.3em":"1.1em"},u(b),9,ot))),128))],8,st))),128)),(r(!0),s(C,null,L(a.spheres,(l,i)=>(r(),s("path",{key:"hover-"+i,d:V(i,x.value,p.value),fill:"transparent",class:X(l.total===0?"cursor-pointer":"cursor-default"),onMouseenter:b=>_(i),onMouseleave:w,onClick:b=>c(i,l)},null,42,lt))),128)),e("circle",{cx:t.value,cy:t.value,r:x.value,class:"fill-white dark:fill-gray-900 stroke-gray-300 dark:stroke-gray-600","stroke-width":"1"},null,8,nt),e("text",{x:t.value,y:t.value-8,"text-anchor":"middle","dominant-baseline":"central","font-size":"28","font-weight":"bold",class:"fill-gray-900 dark:fill-white"},u(a.balanceIndex),9,dt),e("text",{x:t.value,y:t.value+14,"text-anchor":"middle","dominant-baseline":"central","font-size":"10",class:"fill-gray-400 dark:fill-gray-500"}," баланс ",8,it)],8,Ze))]))}},ct={class:"flex items-center justify-between mb-2"},ut={class:"flex items-center gap-2"},gt={class:"text-sm font-semibold text-gray-900 dark:text-white"},ht={key:0,class:"text-xs px-2 py-0.5 rounded-full bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-400"},mt={class:"flex items-center gap-3"},xt={class:"flex-1 bg-gray-200 dark:bg-gray-700 rounded-full h-2 overflow-hidden"},yt={class:"text-xs font-medium text-gray-600 dark:text-gray-400 tabular-nums whitespace-nowrap"},vt={__name:"SphereCard",props:{sphere:{type:Object,required:!0}},setup(a){const $=a,h=j(!1),v=A(()=>$.sphere.tasks_total?Math.round($.sphere.tasks_done/$.sphere.tasks_total*100):0);return(d,k)=>(r(),s("div",{class:"rounded-xl border bg-white/80 dark:bg-gray-800/80 border-gray-200 dark:border-gray-700 p-4 transition-all duration-200 cursor-pointer group border-l-4",style:W({borderLeftColor:a.sphere.color,boxShadow:h.value?`0 0 20px ${a.sphere.color}30`:"none"}),onMouseenter:k[0]||(k[0]=_=>h.value=!0),onMouseleave:k[1]||(k[1]=_=>h.value=!1)},[e("div",ct,[e("div",ut,[e("div",{class:"w-3 h-3 rounded-full",style:W({backgroundColor:a.sphere.color})},null,4),e("span",gt,u(a.sphere.name),1)]),a.sphere.days_without_attention!==null&&a.sphere.days_without_attention>0?(r(),s("span",ht,u(a.sphere.days_without_attention)+" дн. ",1)):M("",!0)]),e("div",mt,[e("div",xt,[e("div",{class:"h-full rounded-full transition-all duration-500",style:W({width:v.value+"%",backgroundColor:a.sphere.color})},null,4)]),e("span",yt,u(a.sphere.tasks_done)+"/"+u(a.sphere.tasks_total),1)])],36))}},ft={class:"bg-white/80 dark:bg-gray-800/80 rounded-xl border border-dashed border-gray-300 dark:border-gray-600 p-4"},pt={class:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-2"},kt={class:"min-w-0 flex-1"},bt={class:"text-xs font-medium text-gray-700 dark:text-gray-300 truncate"},_t={class:"text-[10px] text-gray-400 dark:text-gray-500"},wt={__name:"MissingSpheres",props:{spheres:{type:Array,default:()=>[]}},setup(a){const $=h=>{const v=Math.abs(h)%100,d=v%10;return v>10&&v<20?"дней":d===1?"день":d>=2&&d<=4?"дня":"дней"};return(h,v)=>(r(),s("div",ft,[v[0]||(v[0]=e("h3",{class:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3"}," Сферы без внимания ",-1)),e("div",pt,[(r(!0),s(C,null,L(a.spheres,d=>(r(),s("div",{key:d.id,class:"flex items-center gap-2 rounded-lg border border-dashed p-3 transition-colors hover:bg-gray-50 dark:hover:bg-gray-700/50",style:W({borderColor:d.color+"40",backgroundColor:d.color+"08"})},[e("div",{class:"w-2.5 h-2.5 rounded-full flex-shrink-0",style:W({backgroundColor:d.color})},null,4),e("div",kt,[e("p",bt,u(d.name),1),e("p",_t,u(d.days_without_attention!==null?`${d.days_without_attention} ${$(d.days_without_attention)} без внимания`:"Нет задач"),1)])],4))),128))])]))}},$t={key:0,class:"h-full"},Mt={class:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4 h-full flex flex-col"},Ct={key:0,class:"space-y-1.5 flex-1 overflow-y-auto"},St=["onClick","onMouseenter"],Tt={class:"flex-1 min-w-0"},zt={class:"flex items-center gap-1.5"},Lt={key:0,class:"w-2.5 h-2.5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Wt={key:0,class:"px-1.5 py-0.5 text-[10px] font-medium rounded-full flex-shrink-0 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400"},Pt={key:0},At={key:1},Yt={key:2},Et={key:1,class:"flex-1 flex flex-col items-center justify-center py-8 text-center"},jt={key:2,class:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700"},Dt={class:"flex items-center justify-between text-xs"},Bt={class:"text-gray-600 dark:text-gray-400"},It={class:"font-semibold text-gray-900 dark:text-white"},Ht={class:"font-semibold text-emerald-600 dark:text-emerald-400"},le={__name:"PeriodDayView",props:{data:{type:Object,default:null},hoveredSphereName:{type:String,default:null},workspaceId:{type:Number,required:!0}},emits:["task-hover","task-leave"],setup(a,{emit:$}){const h=ce(),v=ue(),d=a,k=$,_=j(!1),w=j(!1),c=j(null),t=j(null),p=j(""),x=A(()=>{var P;if(!d.data)return[];const z=[];return d.data.spheres&&d.data.spheres.forEach(E=>{var N;(N=E.tasks)!=null&&N.length&&E.tasks.forEach(R=>{z.push({...R,sphere_name:E.name,sphere_color:E.color})})}),(P=d.data.tasks_without_sphere)!=null&&P.length&&d.data.tasks_without_sphere.forEach(E=>{z.push({...E,sphere_name:"Без сферы",sphere_color:"#6b7280"})}),z.sort((E,N)=>E.completed_at&&!N.completed_at?1:!E.completed_at&&N.completed_at?-1:E.sphere_name.localeCompare(N.sphere_name))}),T=z=>d.hoveredSphereName&&z.sphere_name===d.hoveredSphereName,D=z=>{k("task-hover",z)},g=()=>{k("task-leave")},Y=z=>{t.value=z,w.value=!0},O=()=>{const z=new Date().toISOString().split("T")[0];c.value={workspace_id:d.workspaceId,due_date:z,status:"today",estimated_time:null,end_time:null},_.value=!0},F=()=>{_.value=!1,c.value=null,p.value=""},B=()=>{c.value=t.value,w.value=!1,_.value=!0},I=async z=>{try{await h.completeTask(z.id),await v.fetchLifeMirror(d.workspaceId),await v.fetchAiMessage(d.workspaceId,!1)}catch(P){console.error("Error completing task:",P)}},U=async z=>{try{await h.uncompleteTask(z.id),await v.fetchLifeMirror(d.workspaceId),await v.fetchAiMessage(d.workspaceId,!1)}catch(P){console.error("Error uncompleting task:",P)}},V=z=>z?/^\d{2}:\d{2}$/.test(z)?z:z.substring(0,5):"",G=async z=>{var P,E,N;p.value="";try{(P=c.value)!=null&&P.id?await h.updateTask(c.value.id,z):await h.createTask(z),F(),await v.fetchLifeMirror(d.workspaceId),await v.fetchAiMessage(d.workspaceId,!1)}catch(R){console.error("Error saving task:",R),p.value=((N=(E=R.response)==null?void 0:E.data)==null?void 0:N.message)||R.message||"Ошибка при сохранении задачи"}};return(z,P)=>{var E,N,R;return a.data?(r(),s("div",$t,[e("div",Mt,[e("div",{class:"flex items-center justify-between mb-3"},[P[2]||(P[2]=e("h3",{class:"text-sm font-semibold text-gray-900 dark:text-white"},"Задачи на сегодня",-1)),e("button",{onClick:O,class:"flex items-center gap-1.5 px-3 py-1.5 bg-primary-600 hover:bg-primary-700 text-white text-xs font-medium rounded-lg transition-colors duration-200"},[...P[1]||(P[1]=[e("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),e("span",{class:"hidden sm:inline"},"Добавить",-1)])])]),x.value.length?(r(),s("div",Ct,[(r(!0),s(C,null,L(x.value,S=>(r(),s("div",{key:S.id,onClick:Z=>Y(S),onMouseenter:Z=>D(S.sphere_name),onMouseleave:g,class:X(["group flex items-start gap-2 p-2 rounded-lg border transition-all duration-200 cursor-pointer",S.completed_at?"bg-gray-50/50 dark:bg-gray-700/30 border-gray-200 dark:border-gray-600":"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"]),style:W(T(S)?{borderLeftColor:S.sphere_color}:{})},[e("div",{class:"w-0.5 h-full rounded-full flex-shrink-0 mt-0.5 transition-all duration-200",style:W({backgroundColor:S.sphere_color})},null,4),e("div",Tt,[e("div",zt,[e("div",{class:X(["w-4 h-4 rounded border flex items-center justify-center flex-shrink-0 transition-colors",S.completed_at?"bg-emerald-500 border-emerald-500":"border-gray-300 dark:border-gray-600 group-hover:border-gray-400 dark:group-hover:border-gray-500"])},[S.completed_at?(r(),s("svg",Lt,[...P[3]||(P[3]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"3",d:"M5 13l4 4L19 7"},null,-1)])])):M("",!0)],2),e("span",{class:X(["text-xs font-medium truncate flex-1",S.completed_at?"line-through text-gray-400 dark:text-gray-500":"text-gray-900 dark:text-white"])},u(S.title),3),S.estimated_time||S.end_time?(r(),s("span",Wt,[S.estimated_time&&S.end_time?(r(),s("span",Pt,u(V(S.estimated_time))+"-"+u(V(S.end_time)),1)):S.estimated_time?(r(),s("span",At,u(V(S.estimated_time)),1)):S.end_time?(r(),s("span",Yt," до "+u(V(S.end_time)),1)):M("",!0)])):M("",!0),e("span",{class:"px-1.5 py-0.5 text-[10px] font-medium rounded-full flex-shrink-0 transition-all duration-200",style:W({backgroundColor:S.sphere_color+"20",color:S.sphere_color})},u(S.sphere_name),5)])])],46,St))),128))])):(r(),s("div",Et,[...P[4]||(P[4]=[e("svg",{class:"w-8 h-8 text-gray-300 dark:text-gray-600 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})],-1),e("p",{class:"text-xs font-medium text-gray-600 dark:text-gray-400"},"Нет задач на сегодня",-1)])])),x.value.length?(r(),s("div",jt,[e("div",Dt,[e("span",Bt,[e("span",It,u(((E=a.data.summary)==null?void 0:E.completed)||0),1),de("/"+u(((N=a.data.summary)==null?void 0:N.total_tasks)||0),1)]),e("span",Ht,u(((R=a.data.summary)==null?void 0:R.completion_rate)||0)+"%",1)])])):M("",!0)]),K(_e,{show:w.value,task:t.value,onClose:P[0]||(P[0]=S=>{w.value=!1,t.value=null}),onEnterEdit:B,onCompleteTask:I,onUncompleteTask:U},null,8,["show","task"]),_.value?(r(),J(we,{key:0,show:_.value,task:c.value,"server-error":p.value,onClose:F,onSubmit:G},null,8,["show","task","server-error"])):M("",!0)])):M("",!0)}}},Vt={class:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4"},Nt={class:"flex items-center justify-between mb-4"},Xt={key:0,class:"flex items-center gap-2"},Ot=["disabled"],Rt=["disabled"],Ft={key:0,class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},qt={key:1,class:"w-3.5 h-3.5 animate-spin",fill:"none",viewBox:"0 0 24 24"},Ut={class:"relative"},Gt={class:"flex border-b border-gray-200 dark:border-gray-700"},Zt={class:"absolute inset-0 flex"},Jt=["onMousedown","onClick"],Kt=["onMousedown"],Qt={class:"pointer-events-none"},er={class:"text-[10px] text-gray-500 dark:text-gray-400"},tr=["onMousedown"],rr={key:0,class:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700"},ar={class:"flex flex-wrap gap-2"},sr=["onClick"],Q=24,or={__name:"DayTimeline",props:{tasks:{type:Array,default:()=>[]}},emits:["task-click","changes-saved"],setup(a,{emit:$}){const h=a,v=$,d=ce(),k=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23],_=j(null),w=j(!1),c=j(!1),t=pe({taskId:null,type:null,startX:0,startLeft:0,startWidth:0,left:0,width:0,startTime:null,endTime:null,clickStartX:0,clickStartY:0}),p=j(!1),x=j(new Map),T=A(()=>h.tasks.filter(y=>y.estimated_time&&y.end_time)),D=A(()=>h.tasks.filter(y=>!y.estimated_time||!y.end_time)),g=A(()=>{const y=new Date,f=y.getHours()*60+y.getMinutes(),m=Q*60;return f/m*100}),Y=y=>`${y}:00`,O=y=>y?/^\d{2}:\d{2}$/.test(y)?y:y.substring(0,5):"",F=y=>{const[f,m]=O(y).split(":").map(Number);return f*60+m},B=y=>{const f=Math.floor(y/60)%24,m=Math.floor(y%60);return`${String(f).padStart(2,"0")}:${String(m).padStart(2,"0")}`},I=y=>{const f=x.value.get(y.id),m=(f==null?void 0:f.estimated_time)||y.estimated_time,o=F(m),n=Q*60;return o/n*100},U=y=>{const f=x.value.get(y.id),m=(f==null?void 0:f.estimated_time)||y.estimated_time,o=(f==null?void 0:f.end_time)||y.end_time,n=F(m);let i=F(o)-n;i<0&&(i+=24*60);const b=Q*60;return i/b*100},V=y=>Math.round(y/100*Q*60),G=(y,f)=>{if(w.value&&t.taskId===y.id)return f==="start"?t.startTime:t.endTime;const m=x.value.get(y.id);return m?f==="start"?m.estimated_time:m.end_time:f==="start"?y.estimated_time:y.end_time},z=async()=>{if(p.value||x.value.size===0)return;p.value=!0;const y=Array.from(x.value.entries());try{await Promise.all(y.map(([f,m])=>d.updateTask(f,{estimated_time:m.estimated_time,end_time:m.end_time}))),v("changes-saved",()=>{x.value.clear(),p.value=!1})}catch(f){console.error("Failed to save task times:",f),p.value=!1}},P=()=>{x.value.clear()},E=(y,f,m)=>{y.preventDefault(),y.stopPropagation(),!(f.completed_at||p.value)&&(w.value=!0,t.taskId=f.id,t.type=m==="left"?"resize-left":"resize-right",t.startX=y.clientX,t.startLeft=I(f),t.startWidth=U(f),t.left=t.startLeft,t.width=t.startWidth,t.startTime=f.estimated_time,t.endTime=f.end_time,t.clickStartX=y.clientX,t.clickStartY=y.clientY)},N=(y,f)=>{if(f.completed_at||p.value)return;const m=y.currentTarget.getBoundingClientRect(),o=y.clientX-m.left;o<8||o>m.width-8||(w.value=!0,t.taskId=f.id,t.type="move",t.startX=y.clientX,t.startLeft=I(f),t.startWidth=U(f),t.left=t.startLeft,t.width=t.startWidth,t.startTime=f.estimated_time,t.endTime=f.end_time,t.clickStartX=y.clientX,t.clickStartY=y.clientY)},R=y=>{if(!w.value||!_.value)return;const m=_.value.getBoundingClientRect().width,n=(y.clientX-t.startX)/m*100;if(t.type==="move"){let l=t.startLeft+n;l=Math.max(0,Math.min(100-t.width,l)),t.left=l;const i=V(l),b=i+V(t.width);t.startTime=B(i),t.endTime=B(b)}else if(t.type==="resize-left"){let l=t.startLeft+n,i=t.startWidth-n;const b=15/(Q*60)*100;i<b&&(i=b,l=t.startLeft+t.startWidth-b),l=Math.max(0,l),t.left=l,t.width=i;const H=V(l),q=V(l+i);t.startTime=B(H),t.endTime=B(q)}else if(t.type==="resize-right"){let l=t.startWidth+n;const i=15/(Q*60)*100;l=Math.max(i,l);const b=100-t.left;l=Math.min(b,l),t.width=l;const H=V(t.left),q=V(t.left+l);t.startTime=B(H),t.endTime=B(q)}},S=y=>{if(!w.value)return;const f=h.tasks.find(l=>l.id===t.taskId);if(!f){w.value=!1;return}const m=Math.abs(y.clientX-t.clickStartX),o=Math.abs(y.clientY-t.clickStartY);(m>5||o>5)&&(c.value=!0,setTimeout(()=>{c.value=!1},100),x.value.set(f.id,{estimated_time:t.startTime,end_time:t.endTime})),w.value=!1,t.taskId=null,t.type=null},Z=(y,f)=>{!w.value&&!c.value&&v("task-click",f)};return ie(()=>{x.value.clear()}),(y,f)=>(r(),s("div",Vt,[e("div",Nt,[f[3]||(f[3]=e("h3",{class:"text-sm font-semibold text-gray-900 dark:text-white"},"Расписание на день",-1)),x.value.size>0?(r(),s("div",Xt,[e("button",{onClick:P,disabled:p.value,class:"flex items-center gap-1.5 px-3 py-1.5 bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 disabled:opacity-50 text-gray-700 dark:text-gray-300 text-xs font-medium rounded-lg transition-colors"},[...f[0]||(f[0]=[e("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),e("span",null,"Сбросить",-1)])],8,Ot),e("button",{onClick:z,disabled:p.value,class:"flex items-center gap-1.5 px-3 py-1.5 bg-primary-600 hover:bg-primary-700 disabled:bg-gray-400 text-white text-xs font-medium rounded-lg transition-colors"},[p.value?(r(),s("svg",qt,[...f[2]||(f[2]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):(r(),s("svg",Ft,[...f[1]||(f[1]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])),e("span",null,u(p.value?"Сохранение...":`Сохранить (${x.value.size})`),1)],8,Rt)])):M("",!0)]),e("div",Ut,[e("div",Gt,[(r(),s(C,null,L(k,m=>e("div",{key:m,class:"flex-1 text-center pb-2 text-xs text-gray-500 dark:text-gray-400"},u(Y(m)),1)),64))]),e("div",{ref_key:"timelineContainer",ref:_,class:X(["relative mt-2",{"pointer-events-none opacity-60":p.value}]),style:{"min-height":"120px"},onMousemove:R,onMouseup:S,onMouseleave:S},[e("div",Zt,[(r(),s(C,null,L(k,m=>e("div",{key:"grid-"+m,class:"flex-1 border-r border-gray-100 dark:border-gray-700"})),64))]),e("div",{class:"absolute top-0 bottom-0 w-px bg-red-500 z-20",style:W({left:g.value+"%"})},null,4),(r(!0),s(C,null,L(T.value,m=>(r(),s("div",{key:m.id,class:X(["absolute h-16 rounded-lg border-2 p-2 transition-all hover:shadow-md hover:z-10 select-none",{"opacity-60":m.completed_at,"cursor-move":!m.completed_at&&!w.value,"cursor-grabbing":w.value&&t.taskId===m.id,"z-30":w.value&&t.taskId===m.id}]),style:W({left:(w.value&&t.taskId===m.id?t.left:I(m))+"%",width:(w.value&&t.taskId===m.id?t.width:U(m))+"%",backgroundColor:m.completed_at?"#e5e7eb":m.sphere_color+"20",borderColor:m.completed_at?"#9ca3af":m.sphere_color,top:"0px"}),onMousedown:o=>N(o,m),onClick:o=>Z(o,m)},[m.completed_at?M("",!0):(r(),s("div",{key:0,class:"absolute left-0 top-0 bottom-0 w-2 cursor-ew-resize hover:bg-black/10 rounded-l-lg",onMousedown:ye(o=>E(o,m,"left"),["stop"])},null,40,Kt)),e("div",Qt,[e("div",{class:"text-xs font-medium truncate",style:W({color:m.completed_at?"#6b7280":m.sphere_color})},u(m.title),5),e("div",er,u(O(G(m,"start")))+" - "+u(O(G(m,"end"))),1)]),m.completed_at?M("",!0):(r(),s("div",{key:1,class:"absolute right-0 top-0 bottom-0 w-2 cursor-ew-resize hover:bg-black/10 rounded-r-lg",onMousedown:ye(o=>E(o,m,"right"),["stop"])},null,40,tr))],46,Jt))),128))],34),D.value.length?(r(),s("div",rr,[f[4]||(f[4]=e("div",{class:"text-xs text-gray-500 dark:text-gray-400 mb-2"},"Без времени:",-1)),e("div",ar,[(r(!0),s(C,null,L(D.value,m=>(r(),s("div",{key:m.id,class:X(["px-3 py-1.5 rounded-lg text-xs font-medium cursor-pointer hover:shadow-sm transition-all",{"opacity-60":m.completed_at}]),style:W({backgroundColor:m.completed_at?"#e5e7eb":m.sphere_color+"20",color:m.completed_at?"#6b7280":m.sphere_color}),onClick:o=>y.$emit("task-click",m)},u(m.title),15,sr))),128))])])):M("",!0)])]))}},lr={key:0,class:"space-y-6"},nr={class:"grid grid-cols-2 sm:grid-cols-3 gap-3"},dr={class:"bg-white dark:bg-gray-800 rounded-xl p-4 border border-gray-200 dark:border-gray-700"},ir={class:"text-2xl font-bold text-gray-900 dark:text-white mt-1"},cr={class:"bg-white dark:bg-gray-800 rounded-xl p-4 border border-gray-200 dark:border-gray-700"},ur={class:"text-2xl font-bold text-emerald-600 dark:text-emerald-400 mt-1"},gr={class:"bg-white dark:bg-gray-800 rounded-xl p-4 border border-gray-200 dark:border-gray-700"},hr={class:"text-2xl font-bold text-gray-900 dark:text-white mt-1"},mr={class:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4"},xr={class:"flex items-end gap-1 h-32"},yr={class:"w-full flex flex-col-reverse gap-px",style:{height:"100px"}},vr=["title"],fr={key:0,class:"w-full h-full flex items-center justify-center"},pr={class:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4"},kr={class:"space-y-2"},br={class:"w-20 text-xs text-gray-600 dark:text-gray-400 truncate"},_r={class:"flex-1 bg-gray-200 dark:bg-gray-700 rounded-full h-2 overflow-hidden"},wr={class:"text-xs font-medium text-gray-500 dark:text-gray-400 tabular-nums w-12 text-right"},$r={key:0,class:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4"},Mr={class:"space-y-2"},Cr={class:"flex-1 min-w-0"},Sr={class:"flex items-center gap-2"},Tr={class:"text-sm text-gray-900 dark:text-white truncate"},zr={key:0,class:"text-[10px] text-amber-600 dark:text-amber-400 bg-amber-50 dark:bg-amber-900/20 px-1.5 py-0.5 rounded"},Lr={class:"flex items-center gap-2"},Wr={class:"w-16 bg-gray-200 dark:bg-gray-700 rounded-full h-1.5 overflow-hidden"},Pr={class:"text-xs text-gray-500 dark:text-gray-400 tabular-nums"},Ar={__name:"PeriodWeekView",props:{data:{type:Object,default:null}},setup(a){const $=a,h=A(()=>{var t;if(!((t=$.data)!=null&&t.daily_breakdown))return 1;let c=0;for(const p of $.data.daily_breakdown){const x=Object.values(p.by_sphere).reduce((T,D)=>T+D,0);x>c&&(c=x)}return Math.max(c,1)}),v=c=>Math.max(c/h.value*80,4),d=A(()=>{var t;const c={};if((t=$.data)!=null&&t.attention_distribution)for(const p of $.data.attention_distribution)c[p.sphere_id]=p;return c}),k=c=>{var t;return((t=d.value[c])==null?void 0:t.color)||"#888"},_=c=>{var t;return((t=d.value[c])==null?void 0:t.name)||""},w=c=>ne().format("YYYY-MM-DD")===c;return(c,t)=>{var p,x,T,D;return a.data?(r(),s("div",lr,[e("div",nr,[e("div",dr,[t[0]||(t[0]=e("p",{class:"text-xs text-gray-500 dark:text-gray-400"},"Всего задач",-1)),e("p",ir,u(((p=a.data.summary)==null?void 0:p.total_tasks)||0),1)]),e("div",cr,[t[1]||(t[1]=e("p",{class:"text-xs text-gray-500 dark:text-gray-400"},"Выполнено",-1)),e("p",ur,u(((x=a.data.summary)==null?void 0:x.completed)||0),1)]),e("div",gr,[t[2]||(t[2]=e("p",{class:"text-xs text-gray-500 dark:text-gray-400"},"Выполнение",-1)),e("p",hr,u(((T=a.data.summary)==null?void 0:T.completion_rate)||0)+"%",1)])]),e("div",mr,[t[4]||(t[4]=e("h3",{class:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4"},"Рентген недели",-1)),e("div",xr,[(r(!0),s(C,null,L(a.data.daily_breakdown,g=>(r(),s("div",{key:g.date,class:"flex-1 flex flex-col items-center gap-1"},[e("div",yr,[(r(!0),s(C,null,L(Object.keys(g.by_sphere),Y=>(r(),s("div",{key:Y,class:"w-full rounded-sm transition-all duration-300",style:W({height:v(g.by_sphere[Y])+"px",backgroundColor:k(parseInt(Y)),opacity:.8}),title:`${_(parseInt(Y))}: ${g.by_sphere[Y]}`},null,12,vr))),128)),Object.keys(g.by_sphere).length?M("",!0):(r(),s("div",fr,[...t[3]||(t[3]=[e("span",{class:"text-gray-300 dark:text-gray-600 text-xs"},"—",-1)])]))]),e("span",{class:X(["text-xs mt-1",w(g.date)?"font-bold text-primary-600 dark:text-primary-400":"text-gray-500 dark:text-gray-400"])},u(g.day),3)]))),128))])]),e("div",pr,[t[5]||(t[5]=e("h3",{class:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3"},"Распределение внимания",-1)),e("div",kr,[(r(!0),s(C,null,L(a.data.attention_distribution,g=>(r(),s("div",{key:g.sphere_id,class:"flex items-center gap-3"},[e("div",br,u(g.name),1),e("div",_r,[e("div",{class:"h-full rounded-full transition-all duration-500",style:W({width:g.percentage+"%",backgroundColor:g.color,opacity:g.percentage>0?1:.3})},null,4)]),e("span",wr,u(g.percentage)+"% ",1)]))),128))])]),(D=a.data.projects)!=null&&D.length?(r(),s("div",$r,[t[6]||(t[6]=e("h3",{class:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3"},"Потоки",-1)),e("div",Mr,[(r(!0),s(C,null,L(a.data.projects,g=>(r(),s("div",{key:g.id,class:X(["flex items-center gap-3 p-2 rounded-lg",g.is_stalled?"opacity-50":""])},[e("div",{class:"w-2 h-2 rounded-full flex-shrink-0",style:W({backgroundColor:g.sphere_color||g.color})},null,4),e("div",Cr,[e("div",Sr,[e("span",Tr,u(g.name),1),g.is_stalled?(r(),s("span",zr,"стоит")):M("",!0)])]),e("div",Lr,[e("div",Wr,[e("div",{class:"h-full rounded-full",style:W({width:(g.total>0?g.done/g.total*100:0)+"%",backgroundColor:g.sphere_color||g.color})},null,4)]),e("span",Pr,u(g.done)+"/"+u(g.total),1)])],2))),128))])])):M("",!0)])):M("",!0)}}},Yr={key:0,class:"space-y-6"},Er={class:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4"},jr={class:"flex items-center gap-4 mb-2"},Dr={class:"flex-1 bg-gray-200 dark:bg-gray-700 rounded-full h-3 overflow-hidden"},Br={class:"text-sm font-bold text-gray-900 dark:text-white tabular-nums"},Ir={class:"text-xs text-gray-500 dark:text-gray-400"},Hr={class:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4"},Vr={class:"space-y-2"},Nr={class:"w-20 text-xs text-gray-600 dark:text-gray-400 truncate"},Xr={class:"text-xs text-gray-400 dark:text-gray-500 tabular-nums w-8 text-right"},Or={class:"flex-1 bg-gray-200 dark:bg-gray-700 rounded-full h-2 overflow-hidden relative"},Rr={key:0,class:"bg-white dark:bg-gray-800 rounded-xl border border-amber-200 dark:border-amber-900/50 p-4"},Fr={class:"space-y-2"},qr={class:"text-sm text-gray-700 dark:text-gray-300 flex-1"},Ur={class:"text-xs text-amber-600 dark:text-amber-400"},Gr={key:1,class:"bg-white dark:bg-gray-800 rounded-xl border border-rose-200 dark:border-rose-900/50 p-4"},Zr={class:"space-y-3"},Jr={class:"flex items-center justify-between mb-2"},Kr={class:"flex items-center gap-2"},Qr={class:"text-sm font-medium text-gray-900 dark:text-white"},ea={class:"text-xs text-gray-500 dark:text-gray-400"},ta={class:"flex items-center gap-3"},ra={class:"flex-1 bg-gray-200 dark:bg-gray-700 rounded-full h-2 overflow-hidden relative"},aa=["title"],sa={class:"text-xs text-rose-600 dark:text-rose-400 tabular-nums"},oa={class:"text-gray-400"},la={__name:"PeriodMonthView",props:{data:{type:Object,default:null}},setup(a){const $=a,h=A(()=>{var d;return((d=$.data)==null?void 0:d.planned_vs_done)||{planned:0,done:0,days_passed:0,days_remaining:0,required_daily_pace:0,completion_rate:0}}),v=d=>d>2?"text-emerald-600 dark:text-emerald-400":d<-2?"text-rose-600 dark:text-rose-400":"text-gray-400 dark:text-gray-500";return(d,k)=>{var _,w;return a.data?(r(),s("div",Yr,[e("div",Er,[k[0]||(k[0]=e("h3",{class:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3"},"Нагрузка",-1)),e("div",jr,[e("div",Dr,[e("div",{class:"h-full rounded-full bg-primary-500 transition-all duration-500",style:W({width:(h.value.completion_rate||0)+"%"})},null,4)]),e("span",Br,u(h.value.done)+"/"+u(h.value.planned),1)]),e("p",Ir," Осталось "+u(h.value.planned-h.value.done)+" задач, ~"+u(h.value.required_daily_pace)+"/день чтобы успеть. Прошло "+u(h.value.days_passed)+" дн., осталось "+u(h.value.days_remaining)+" дн. ",1)]),e("div",Hr,[k[1]||(k[1]=e("h3",{class:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3"},"Было → Стало",-1)),e("div",Vr,[(r(!0),s(C,null,L(a.data.sphere_trends,c=>(r(),s("div",{key:c.sphere_id,class:"flex items-center gap-3"},[e("div",Nr,u(c.name),1),e("span",Xr,u(c.prev_pct)+"%",1),e("div",Or,[e("div",{class:"absolute top-0 h-full w-0.5 bg-gray-400 dark:bg-gray-500 z-10",style:W({left:c.prev_pct+"%"})},null,4),e("div",{class:"h-full rounded-full transition-all duration-500",style:W({width:c.current_pct+"%",backgroundColor:c.color})},null,4)]),e("span",{class:"text-xs font-medium tabular-nums w-8 text-right",style:W({color:c.color})},u(c.current_pct)+"% ",5),e("span",{class:X(["text-xs tabular-nums w-10 text-right",v(c.change)])},u(c.change>0?"+":"")+u(c.change)+"% ",3)]))),128))])]),(_=a.data.stalled_projects)!=null&&_.length?(r(),s("div",Rr,[k[2]||(k[2]=e("h3",{class:"text-sm font-semibold text-amber-600 dark:text-amber-400 mb-3"},"Застрявшие потоки",-1)),e("div",Fr,[(r(!0),s(C,null,L(a.data.stalled_projects,c=>(r(),s("div",{key:c.id,class:"flex items-center gap-3 p-2 rounded-lg bg-amber-50/50 dark:bg-amber-900/10"},[e("div",{class:"w-2 h-2 rounded-full",style:W({backgroundColor:c.sphere_color||"#F59E0B"})},null,4),e("span",qr,u(c.name),1),e("span",Ur,u(c.days_since_activity)+" дн. без движения ",1)]))),128))])])):M("",!0),(w=a.data.goals_at_risk)!=null&&w.length?(r(),s("div",Gr,[k[3]||(k[3]=e("h3",{class:"text-sm font-semibold text-rose-600 dark:text-rose-400 mb-3"},"Цели под угрозой",-1)),e("div",Zr,[(r(!0),s(C,null,L(a.data.goals_at_risk,c=>(r(),s("div",{key:c.id,class:"p-3 rounded-lg bg-rose-50/50 dark:bg-rose-900/10"},[e("div",Jr,[e("div",Kr,[e("div",{class:"w-2 h-2 rounded-full",style:W({backgroundColor:c.sphere_color})},null,4),e("span",Qr,u(c.name),1)]),e("span",ea,u(c.days_left)+" дн. до дедлайна",1)]),e("div",ta,[e("div",ra,[e("div",{class:"absolute top-0 h-full w-0.5 bg-rose-400 z-10",style:W({left:c.expected_progress+"%"}),title:"Ожидаемый: "+c.expected_progress+"%"},null,12,aa),e("div",{class:"h-full rounded-full bg-rose-500",style:W({width:c.progress+"%"})},null,4)]),e("span",sa,[de(u(c.progress)+"% ",1),e("span",oa,"из "+u(c.expected_progress)+"%",1)])])]))),128))])])):M("",!0)])):M("",!0)}}},na={key:0,class:"space-y-6"},da={class:"grid grid-cols-2 sm:grid-cols-5 gap-3"},ia={class:"bg-white dark:bg-gray-800 rounded-xl p-4 border border-gray-200 dark:border-gray-700"},ca={class:"text-2xl font-bold text-gray-900 dark:text-white mt-1"},ua={class:"bg-white dark:bg-gray-800 rounded-xl p-4 border border-emerald-200 dark:border-emerald-900/50"},ga={class:"text-2xl font-bold text-emerald-600 dark:text-emerald-400 mt-1"},ha={class:"bg-white dark:bg-gray-800 rounded-xl p-4 border border-blue-200 dark:border-blue-900/50"},ma={class:"text-2xl font-bold text-blue-600 dark:text-blue-400 mt-1"},xa={class:"bg-white dark:bg-gray-800 rounded-xl p-4 border border-amber-200 dark:border-amber-900/50"},ya={class:"text-2xl font-bold text-amber-600 dark:text-amber-400 mt-1"},va={class:"bg-white dark:bg-gray-800 rounded-xl p-4 border border-gray-200 dark:border-gray-700"},fa={class:"text-2xl font-bold text-gray-400 mt-1"},pa={key:0,class:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4"},ka={class:"flex items-end gap-2 h-32"},ba={class:"text-xs font-bold text-gray-900 dark:text-white tabular-nums"},_a={class:"text-[10px] text-gray-500 dark:text-gray-400 truncate max-w-full"},wa={key:1,class:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4"},$a={class:"space-y-3"},Ma={class:"flex-1 min-w-0"},Ca={class:"flex items-center gap-2 mb-1"},Sa={class:"text-sm text-gray-900 dark:text-white truncate"},Ta={class:"flex items-center gap-2"},za={class:"flex-1 bg-gray-200 dark:bg-gray-700 rounded-full h-1.5 overflow-hidden"},La={class:"text-xs text-gray-500 dark:text-gray-400 tabular-nums"},Wa={key:0,class:"text-xs text-gray-400 tabular-nums whitespace-nowrap"},Pa={key:2,class:"bg-white dark:bg-gray-800 rounded-xl border border-emerald-200 dark:border-emerald-900/50 p-4"},Aa={class:"space-y-2"},Ya={class:"text-sm text-gray-900 dark:text-white flex-1"},Ea={class:"text-xs text-gray-400"},ja={key:3,class:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4"},Da={class:"space-y-2"},Ba={class:"text-xs text-gray-600 dark:text-gray-400 w-20 truncate"},Ia={class:"text-[10px] text-gray-400 dark:text-gray-500"},Ha={__name:"PeriodYearView",props:{data:{type:Object,default:null}},setup(a){const $=a,h=A(()=>{var c;return((c=$.data)==null?void 0:c.goals_summary)||{total:0,achieved:0,on_track:0,behind:0,at_risk:0,stalled:0}}),v={ahead:"bg-emerald-100 dark:bg-emerald-900/20 text-emerald-700 dark:text-emerald-400",on_track:"bg-blue-100 dark:bg-blue-900/20 text-blue-700 dark:text-blue-400",behind:"bg-amber-100 dark:bg-amber-900/20 text-amber-700 dark:text-amber-400",at_risk:"bg-rose-100 dark:bg-rose-900/20 text-rose-700 dark:text-rose-400",stalled:"bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-400"},d={ahead:"опережает",on_track:"по графику",behind:"отстаёт",at_risk:"под угрозой",stalled:"стоит"},k={growing:"↑",falling:"↓",stable:"→",stalled:"·"},_={growing:"растёт",falling:"падает",stable:"стабильно",stalled:"стоит"},w=c=>c==="growing"?"text-emerald-600 dark:text-emerald-400":c==="falling"?"text-rose-600 dark:text-rose-400":"text-gray-400 dark:text-gray-500";return(c,t)=>{var p,x,T,D;return a.data?(r(),s("div",na,[e("div",da,[e("div",ia,[t[0]||(t[0]=e("p",{class:"text-xs text-gray-500 dark:text-gray-400"},"Всего целей",-1)),e("p",ca,u(h.value.total),1)]),e("div",ua,[t[1]||(t[1]=e("p",{class:"text-xs text-emerald-600 dark:text-emerald-400"},"Достигнуто",-1)),e("p",ga,u(h.value.achieved),1)]),e("div",ha,[t[2]||(t[2]=e("p",{class:"text-xs text-blue-600 dark:text-blue-400"},"По графику",-1)),e("p",ma,u(h.value.on_track),1)]),e("div",xa,[t[3]||(t[3]=e("p",{class:"text-xs text-amber-600 dark:text-amber-400"},"Отстают",-1)),e("p",ya,u(h.value.behind+h.value.at_risk),1)]),e("div",va,[t[4]||(t[4]=e("p",{class:"text-xs text-gray-400"},"Стоят",-1)),e("p",fa,u(h.value.stalled),1)])]),(p=a.data.monthly_balance_trend)!=null&&p.length?(r(),s("div",pa,[t[5]||(t[5]=e("h3",{class:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4"},"Индекс баланса — тренд",-1)),e("div",ka,[(r(!0),s(C,null,L(a.data.monthly_balance_trend,g=>(r(),s("div",{key:g.month_key,class:"flex-1 flex flex-col items-center gap-1"},[e("span",ba,u(g.balance_index),1),e("div",{class:X(["w-full rounded-t transition-all duration-300",g.is_current?"bg-primary-500 shadow-lg shadow-primary-500/30":"bg-gray-300 dark:bg-gray-600"]),style:W({height:Math.max(g.balance_index,5)+"%"})},null,6),e("span",_a,u(g.month.split(" ")[0]),1)]))),128))])])):M("",!0),(x=a.data.active_goals)!=null&&x.length?(r(),s("div",wa,[t[6]||(t[6]=e("h3",{class:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3"},"Цели года",-1)),e("div",$a,[(r(!0),s(C,null,L(a.data.active_goals,g=>(r(),s("div",{key:g.id,class:X(["flex items-center gap-3 p-2 rounded-lg",g.status==="stalled"?"opacity-50":""])},[e("div",{class:"w-2.5 h-2.5 rounded-full flex-shrink-0",style:W({backgroundColor:g.sphere_color})},null,4),e("div",Ma,[e("div",Ca,[e("span",Sa,u(g.name),1),e("span",{class:X(["text-[10px] px-1.5 py-0.5 rounded-full",v[g.status]||v.on_track])},u(d[g.status]||g.status),3)]),e("div",Ta,[e("div",za,[e("div",{class:"h-full rounded-full transition-all duration-500",style:W({width:g.progress+"%",backgroundColor:g.sphere_color})},null,4)]),e("span",La,u(g.progress)+"%",1)])]),g.days_left?(r(),s("span",Wa,u(g.days_left)+" дн. ",1)):M("",!0)],2))),128))])])):M("",!0),(T=a.data.achieved_goals)!=null&&T.length?(r(),s("div",Pa,[t[8]||(t[8]=e("h3",{class:"text-sm font-semibold text-emerald-600 dark:text-emerald-400 mb-3"},"Достигнутые цели",-1)),e("div",Aa,[(r(!0),s(C,null,L(a.data.achieved_goals,g=>(r(),s("div",{key:g.id,class:"flex items-center gap-3 p-2"},[t[7]||(t[7]=e("svg",{class:"w-5 h-5 text-emerald-500 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("span",Ya,u(g.name),1),e("span",Ea,u(g.completed_at),1)]))),128))])])):M("",!0),(D=a.data.sphere_yearly_trends)!=null&&D.length?(r(),s("div",ja,[t[9]||(t[9]=e("h3",{class:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3"},"Тренды по сферам",-1)),e("div",Da,[(r(!0),s(C,null,L(a.data.sphere_yearly_trends,g=>(r(),s("div",{key:g.sphere_id,class:"flex items-center gap-3"},[e("div",{class:"w-2 h-2 rounded-full",style:W({backgroundColor:g.color})},null,4),e("span",Ba,u(g.name),1),e("span",{class:X(["text-xs tabular-nums w-12",w(g.trend)])},u(k[g.trend]||"—")+" "+u(g.avg_attention)+"% ",3),e("span",Ia,u(_[g.trend]||""),1)]))),128))])])):M("",!0)])):M("",!0)}}},Va={key:0,class:"flex items-center justify-center py-16"},Na={key:1,class:"text-center py-16"},Xa={class:"grid grid-cols-1 lg:grid-cols-3 gap-4 mb-6"},Oa={class:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-2 sm:p-4"},Ra={class:"flex gap-2 mb-4 border-b border-gray-200 dark:border-gray-700"},Fa={class:"flex flex-col items-center justify-center"},qa={key:2,class:"flex items-center justify-center py-16 text-gray-400 dark:text-gray-500 text-sm"},Ua={class:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6"},Ga={class:"lg:col-span-1 flex items-center justify-center"},Za={class:"lg:col-span-2 grid grid-cols-1 sm:grid-cols-2 gap-3"},Ja={__name:"WorkspaceDashboard",props:{workspaceId:{type:Number,required:!0},period:{type:String,required:!0},data:{type:Object,default:null}},emits:["refresh-ai","analyze-ai"],setup(a,{emit:$}){const h=a,v=ce(),d=ue(),k=j(null),_=j("spheres"),w=j(window.innerWidth),c=j(!1),t=j(!1),p=j(null),x=j(null),T=j(""),D=()=>{w.value=window.innerWidth};ke(()=>{window.addEventListener("resize",D)}),ie(()=>{window.removeEventListener("resize",D)});const g=A(()=>w.value>=1024?440:w.value>=768?360:280),Y=o=>{k.value=o},O=()=>{k.value=null},F=$,B=()=>{F("analyze-ai",!1)},I=()=>{F("analyze-ai",!0)},U=o=>{const n=Z.value[o];if(!n||n.total!==0)return;const l=new Date().toISOString().split("T")[0];p.value={workspace_id:h.workspaceId,life_sphere_id:n.id,due_date:h.period==="day"?l:null,status:h.period==="day"?"today":"new"},c.value=!0},V=()=>{c.value=!1,p.value=null,x.value=null,T.value=""},G=o=>{x.value={...o},t.value=!0},z=()=>{p.value={...x.value},t.value=!1,c.value=!0},P=async o=>{try{await v.completeTask(o.id),await d.fetchForWorkspace(h.workspaceId,!0)}catch(n){console.error("Error completing task:",n)}},E=async o=>{try{await v.uncompleteTask(o.id),await d.fetchForWorkspace(h.workspaceId,!0)}catch(n){console.error("Error uncompleting task:",n)}},N=async o=>{await d.fetchForWorkspace(h.workspaceId,!0),o&&o()},R=async o=>{var n,l;T.value="";try{o.id?await v.updateTask(o.id,o):await v.createTask(o),V(),await d.fetchForWorkspace(h.workspaceId,!0)}catch(i){console.error("Error saving task:",i),T.value=((l=(n=i.response)==null?void 0:n.data)==null?void 0:l.message)||i.message||"Ошибка при сохранении задачи"}},S=A(()=>({day:le,week:Ar,month:la,year:Ha})[h.period]||le),Z=A(()=>{var i;const o=(i=h.data)==null?void 0:i.lifeMirror;if(!o)return[];const n=(o.spheres||[]).map(b=>({id:b.id,name:b.name,total:b.tasks_total||0,done:b.tasks_done||0,color:b.color})),l=(o.missing_spheres||[]).map(b=>({id:b.id,name:b.name,total:0,done:0,color:b.color}));return[...n,...l]}),y=A(()=>{var n;const o=(n=h.data)==null?void 0:n.lifeMirror;return o!=null&&o.goals?o.goals.map(l=>({name:l.name,total:100,done:l.progress||0,color:l.color||"#9ca3af"})):[]}),f=A(()=>{if(!y.value.length)return 0;const o=y.value.reduce((n,l)=>n+l.done,0);return Math.round(o/y.value.length)}),m=A(()=>{var l,i;const o=(l=h.data)==null?void 0:l.lifeMirror;if(!o)return[];const n=[];return o.spheres&&o.spheres.forEach(b=>{var H;(H=b.tasks)!=null&&H.length&&b.tasks.forEach(q=>{n.push({...q,sphere_name:b.name,sphere_color:b.color})})}),(i=o.tasks_without_sphere)!=null&&i.length&&o.tasks_without_sphere.forEach(b=>{n.push({...b,sphere_name:"Без сферы",sphere_color:"#6b7280"})}),n});return(o,n)=>{var l,i,b,H,q,ee,ge,he,me;return r(),s(C,null,[(l=a.data)!=null&&l.loading&&!((i=a.data)!=null&&i.lifeMirror)?(r(),s("div",Va,[...n[3]||(n[3]=[e("div",{class:"animate-spin rounded-full h-10 w-10 border-2 border-primary-600 border-t-transparent"},null,-1)])])):!((b=a.data)!=null&&b.loading)&&!((H=a.data)!=null&&H.lifeMirror)?(r(),s("div",Na,[...n[4]||(n[4]=[e("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})],-1),e("h3",{class:"mt-2 text-sm font-medium text-gray-900 dark:text-white"},"Нет данных",-1),e("p",{class:"mt-1 text-sm text-gray-500 dark:text-gray-400"},"Создайте сферы жизни и задачи для аналитики",-1)])])):(r(),s(C,{key:2},[a.period==="day"?(r(),s(C,{key:0},[e("div",Xa,[K(ve,{message:a.data.aiMessage,loading:a.data.aiLoading,"silent-loading":a.data.aiSilentLoading,onAnalyze:B,onRefresh:I},null,8,["message","loading","silent-loading"]),e("div",Oa,[e("div",Ra,[e("button",{onClick:n[0]||(n[0]=te=>_.value="spheres"),class:X(["px-4 py-2 text-sm font-medium transition-colors border-b-2",_.value==="spheres"?"text-primary-600 dark:text-primary-400 border-primary-600 dark:border-primary-400":"text-gray-500 dark:text-gray-400 border-transparent hover:text-gray-700 dark:hover:text-gray-300"])}," Сферы ",2),e("button",{onClick:n[1]||(n[1]=te=>_.value="goals"),class:X(["px-4 py-2 text-sm font-medium transition-colors border-b-2",_.value==="goals"?"text-primary-600 dark:text-primary-400 border-primary-600 dark:border-primary-400":"text-gray-500 dark:text-gray-400 border-transparent hover:text-gray-700 dark:hover:text-gray-300"])}," Цели ",2)]),e("div",Fa,[_.value==="spheres"?(r(),J(oe,{key:0,spheres:Z.value,"balance-index":((q=a.data.lifeMirror)==null?void 0:q.balance_index)||0,size:g.value,"hovered-sphere-name":k.value,onSphereHover:Y,onSphereLeave:O,onSphereClick:U},null,8,["spheres","balance-index","size","hovered-sphere-name"])):_.value==="goals"&&y.value.length?(r(),J(oe,{key:1,spheres:y.value,"balance-index":f.value,size:g.value,"hovered-sphere-name":k.value,onSphereHover:Y,onSphereLeave:O,onSphereClick:U},null,8,["spheres","balance-index","size","hovered-sphere-name"])):(r(),s("div",qa," Нет целей "))])]),K(le,{data:a.data.lifeMirror,"workspace-id":a.workspaceId,"hovered-sphere-name":k.value,onTaskHover:Y,onTaskLeave:O},null,8,["data","workspace-id","hovered-sphere-name"])]),K(or,{tasks:m.value,onTaskClick:G,onChangesSaved:N},null,8,["tasks"])],64)):(r(),J(ve,{key:1,message:a.data.aiMessage,loading:a.data.aiLoading,onAnalyze:B,onRefresh:I,class:"mb-6"},null,8,["message","loading"])),a.period!=="day"?(r(),s(C,{key:2},[e("div",Ua,[e("div",Ga,[K(oe,{spheres:Z.value,"balance-index":((ee=a.data.lifeMirror)==null?void 0:ee.balance_index)||0,size:g.value,"hovered-sphere-name":k.value,onSphereHover:Y,onSphereLeave:O,onSphereClick:U},null,8,["spheres","balance-index","size","hovered-sphere-name"])]),e("div",Za,[(r(!0),s(C,null,L((ge=a.data.lifeMirror)==null?void 0:ge.spheres,te=>(r(),J(vt,{key:te.id,sphere:te},null,8,["sphere"]))),128))])]),(me=(he=a.data.lifeMirror)==null?void 0:he.missing_spheres)!=null&&me.length?(r(),J(wt,{key:0,spheres:a.data.lifeMirror.missing_spheres,class:"mb-6"},null,8,["spheres"])):M("",!0)],64)):M("",!0),a.period!=="day"?(r(),J(Me(S.value),{key:3,data:a.data.lifeMirror},null,8,["data"])):M("",!0)],64)),K(_e,{show:t.value,task:x.value,onClose:n[2]||(n[2]=te=>{t.value=!1,x.value=null}),onEnterEdit:z,onCompleteTask:P,onUncompleteTask:E},null,8,["show","task"]),c.value?(r(),J(we,{key:3,show:c.value,task:p.value,"server-error":T.value,onClose:V,onSubmit:R},null,8,["show","task","server-error"])):M("",!0)],64)}}},Ka={class:"min-h-screen bg-gray-50 dark:bg-gray-900"},Qa={class:"w-full mx-auto px-4 sm:px-6 lg:px-8 py-6"},es={key:0,class:"text-center py-16"},ts={key:0,class:"mb-6"},rs={class:"flex gap-2 overflow-x-auto pb-1 scrollbar-hide"},as=["onClick"],ss={key:0,class:"text-base"},hs={__name:"Dashboard",setup(a){const $=ue(),h=be(),v=A(()=>h.selectedWorkspaces),d=j(null),k=A(()=>d.value&&$.dataByWorkspace[d.value]||null);ae(()=>v.value.map(x=>x.id),x=>{if(!x.length){d.value=null;return}(!d.value||!x.includes(d.value))&&(d.value=x[0])},{immediate:!0});const _=(x=!1)=>{d.value&&$.fetchAiMessage(d.value,x)},w=()=>{!document.hidden&&d.value&&$.fetchForWorkspace(d.value,!0)};let c=null;const t=()=>{c=setInterval(()=>{!document.hidden&&d.value&&$.fetchForWorkspace(d.value,!0)},3e4)},p=()=>{c&&(clearInterval(c),c=null)};return ke(()=>{$.fetchAllWorkspaces(),document.addEventListener("visibilitychange",w),t()}),ie(()=>{document.removeEventListener("visibilitychange",w),p()}),ae(d,(x,T)=>{x&&x!==T&&$.fetchForWorkspace(x)}),(x,T)=>{var D,g;return r(),s("div",Ka,[e("div",Qa,[K(Ee,{period:se($).selectedPeriod,"bible-verse":(g=(D=k.value)==null?void 0:D.aiMessage)==null?void 0:g.bible_verse,onChangePeriod:se($).setPeriod},null,8,["period","bible-verse","onChangePeriod"]),v.value.length?(r(),s(C,{key:1},[v.value.length>1?(r(),s("div",ts,[e("div",rs,[(r(!0),s(C,null,L(v.value,Y=>(r(),s("button",{key:Y.id,onClick:O=>d.value=Y.id,class:X(["flex items-center gap-1.5 px-4 py-2 text-sm font-medium rounded-xl whitespace-nowrap transition-all duration-200",[d.value===Y.id?"bg-white dark:bg-gray-800 text-gray-900 dark:text-white shadow-sm ring-1 ring-gray-200 dark:ring-gray-700":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800/50"]])},[Y.emoji?(r(),s("span",ss,u(Y.emoji),1)):M("",!0),e("span",null,u(Y.name),1)],10,as))),128))])])):M("",!0),d.value?(r(),J(Ja,{key:d.value,"workspace-id":d.value,period:se($).selectedPeriod,data:k.value,onAnalyzeAi:_},null,8,["workspace-id","period","data"])):M("",!0)],64)):(r(),s("div",es,[...T[0]||(T[0]=[e("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})],-1),e("h3",{class:"mt-2 text-sm font-medium text-gray-900 dark:text-white"},"Нет данных",-1),e("p",{class:"mt-1 text-sm text-gray-500 dark:text-gray-400"},"Выберите workspace для просмотра аналитики",-1)])]))])])}}};export{hs as default};
