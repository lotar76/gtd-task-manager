import{r as x,k as c,j as de,c as r,b as n,a,f as k,t as u,y as H,D as J,p as D,e as ce,F as w,C as L,l as ve,I as ge,i as ke,o as s,w as he}from"./index-DARtzBY4.js";import{u as me}from"./goals-BJQeUNzD.js";import{u as ye,T as pe}from"./TaskModal-BIlBZZXN.js";import{u as xe}from"./projects-D094yu9W.js";import{u as fe}from"./workspace-CT6nSM7Z.js";import{T as P}from"./TaskList-CqQUr9x3.js";import{T as _e}from"./TaskView-B5rxzcd8.js";import{G as we}from"./GoalModal-BLUDzrOc.js";import{r as be,a as Te,b as Ce}from"./PencilIcon-CoBL7iEl.js";import"./lifeSpheres-Cp-dWg_N.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ru-B7JyRvIu.js";const Se={key:0,class:"w-full overflow-hidden"},Me=["src"],Ee={class:"p-4 lg:p-8"},Ge={class:"max-w-4xl mx-auto"},$e={class:"flex items-start justify-between mb-4"},Ve={class:"text-xl lg:text-2xl font-semibold text-gray-900 dark:text-white"},Be={class:"flex items-center space-x-1 flex-shrink-0 ml-3"},De={class:"space-y-3 mb-8"},Pe={key:0,class:"flex items-center gap-1.5 text-sm text-gray-500 dark:text-gray-400"},Ne={key:0,class:"grayscale"},ze={key:1,class:"flex items-center gap-1.5 text-sm text-gray-500 dark:text-gray-400"},Ae={key:3,class:"text-sm text-gray-600 dark:text-gray-300 leading-relaxed"},He={key:4,class:"text-sm italic text-gray-500 dark:text-gray-400 border-l-2 border-gray-300 dark:border-gray-600 pl-3"},Le=["title"],Re={class:"text-xs text-gray-400 ml-1"},Ue={key:0,class:"mb-8"},Ie={class:"space-y-2"},je=["onClick"],Fe={class:"flex items-center flex-1 min-w-0"},We={class:"flex-1 min-w-0"},qe={class:"text-sm font-medium text-gray-900 dark:text-white truncate"},Je={class:"flex items-center ml-3 gap-2"},Ke={key:0,class:"text-xs text-gray-400"},Oe=["onClick"],Qe={key:0,class:"px-4 pb-1"},Xe={class:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-1"},Ye={key:1,class:"px-4 pb-3 pt-1"},Ze={key:0,class:"mt-2 opacity-50"},et={key:1,class:"text-sm text-gray-400 text-center py-2"},tt={key:1},at={key:1,class:"mt-4"},st={class:"opacity-50"},rt={key:2,class:"py-12 text-center"},pt={__name:"Show",setup(lt){const R=de(),U=ke(),_=me(),v=ye(),K=xe(),O=fe(),p=x(new Set),b=x(!1),T=x(!1),C=x(!1),h=x(null),S=x(""),M=x(""),m=c(()=>parseInt(R.params.goalId)),o=c(()=>m.value&&_.allGoals.find(e=>e.id===m.value)||null),E=c(()=>m.value?K.allProjects.filter(e=>e.goal_id===m.value).map(e=>({...e,tasks:v.allTasks.filter(t=>t.project_id===e.id)})):[]),G=c(()=>o.value?O.workspaces.find(e=>e.id===o.value.workspace_id):null),N=c(()=>{var e;return((e=o.value)==null?void 0:e.life_sphere)||null}),I=c(()=>m.value?v.allTasks.filter(e=>e.goal_id===m.value&&!e.project_id):[]),z=c(()=>I.value.filter(e=>!e.completed_at)),A=c(()=>I.value.filter(e=>e.completed_at)),y=c(()=>m.value?v.allTasks.filter(e=>e.goal_id===m.value||E.value.some(t=>t.id===e.project_id)):[]),$=c(()=>y.value.filter(e=>e.completed_at).length),j=e=>{if(!e)return null;const t=new Date(e),i=new Date;return i.setHours(0,0,0,0),t.setHours(0,0,0,0),Math.ceil((t-i)/(1e3*60*60*24))},Q=e=>{const t=j(e);return t===null?"":t<0?`Просрочено на ${Math.abs(t)} дн.`:t===0?"Сегодня":t===1?"Завтра":t<=30?`${t} дн.`:new Date(e).toLocaleDateString("ru-RU",{day:"numeric",month:"short",year:"numeric"})},X=c(()=>{var t;if(!((t=o.value)!=null&&t.deadline))return"text-gray-500 dark:text-gray-400";const e=j(o.value.deadline);return e<0?"text-red-500 dark:text-red-400":e<=3?"text-orange-500 dark:text-orange-400":e<=7?"text-yellow-600 dark:text-yellow-400":"text-gray-500 dark:text-gray-400"}),Y=e=>{p.value.has(e)?p.value.delete(e):p.value.add(e),p.value=new Set(p.value)},Z=e=>{const t=R.params.id;U.push(`/workspaces/${t}/projects/${e.id}`)},ee=()=>{C.value=!0},te=async()=>{var e;if(confirm(`Архивировать цель "${(e=o.value)==null?void 0:e.name}"?`))try{await _.updateGoal(o.value.id,{status:"archived"}),U.push(`/workspaces/${o.value.workspace_id}/goals`)}catch(t){console.error("Error archiving goal:",t),alert("Ошибка при архивировании цели")}},ae=async()=>{try{await _.updateGoal(o.value.id,{status:"active"})}catch(e){console.error("Error unarchiving goal:",e),alert("Ошибка при восстановлении цели")}},V=e=>{h.value=e,T.value=!0},se=()=>{T.value=!1,b.value=!0},re=async e=>{try{await v.completeTask(e.id)}catch(t){console.error("Error completing task:",t)}},le=async e=>{try{await v.uncompleteTask(e.id)}catch(t){console.error("Error uncompleting task:",t)}},B=async e=>{try{e.completed_at?await v.uncompleteTask(e.id):await v.completeTask(e.id)}catch(t){console.error("Error toggling task:",t)}},oe=async e=>{var t,i,g;S.value="";try{(t=h.value)!=null&&t.id?await v.updateTask(h.value.id,e):await v.createTask(e),b.value=!1,h.value=null}catch(f){console.error("Error saving task:",f),S.value=((g=(i=f.response)==null?void 0:i.data)==null?void 0:g.message)||f.message||"Ошибка при сохранении задачи"}},ne=()=>{b.value=!1,h.value=null,S.value=""},ie=async e=>{var t,i;M.value="";try{await _.updateGoal(o.value.id,e),C.value=!1,await _.fetchAllGoals({force:!0})}catch(g){console.error("Error saving goal:",g),M.value=((i=(t=g.response)==null?void 0:t.data)==null?void 0:i.message)||g.message||"Ошибка при сохранении цели"}},ue=()=>{C.value=!1,M.value=""};return(e,t)=>{var i,g,f,F,W,q;return s(),r("div",null,[(i=o.value)!=null&&i.image_url?(s(),r("div",Se,[a("img",{src:o.value.image_url,class:"w-full h-48 lg:h-64 object-cover"},null,8,Me)])):n("",!0),a("div",Ee,[a("div",Ge,[a("div",$e,[a("h1",Ve,u(((g=o.value)==null?void 0:g.name)||"Загрузка..."),1),a("div",Be,[a("button",{onClick:ee,class:"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",title:"Редактировать"},[k(H(be),{class:"w-5 h-5"})]),((f=o.value)==null?void 0:f.status)!=="archived"?(s(),r("button",{key:0,onClick:te,class:"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",title:"Архивировать"},[k(H(Te),{class:"w-5 h-5"})])):(s(),r("button",{key:1,onClick:ae,class:"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",title:"Восстановить"},[k(H(Ce),{class:"w-5 h-5"})]))])]),a("div",De,[G.value?(s(),r("div",Pe,[G.value.emoji?(s(),r("span",Ne,u(G.value.emoji),1)):n("",!0),a("span",null,u(G.value.name),1)])):n("",!0),N.value?(s(),r("div",ze,[a("span",{class:"w-2.5 h-2.5 rounded-full flex-shrink-0",style:J({backgroundColor:N.value.color})},null,4),a("span",null,u(N.value.name),1)])):n("",!0),(F=o.value)!=null&&F.deadline?(s(),r("div",{key:2,class:D(["flex items-center text-sm",X.value])},[t[1]||(t[1]=a("svg",{class:"w-4 h-4 mr-1.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),ce(" "+u(Q(o.value.deadline)),1)],2)):n("",!0),(W=o.value)!=null&&W.description?(s(),r("p",Ae,u(o.value.description),1)):n("",!0),(q=o.value)!=null&&q.bible_verse?(s(),r("p",He,u(o.value.bible_verse),1)):n("",!0),y.value.length>0?(s(),r("div",{key:5,class:"flex items-center gap-1",title:`${$.value} / ${y.value.length} выполнено`},[y.value.length<=20?(s(!0),r(w,{key:0},L(y.value.length,l=>(s(),r("div",{key:l,class:D(["w-2.5 h-2.5 rounded-sm",l<=$.value?"bg-green-500":"bg-gray-300 dark:bg-gray-600"])},null,2))),128)):(s(),r(w,{key:1},[(s(),r(w,null,L(20,l=>a("div",{key:l,class:D(["w-2.5 h-2.5 rounded-sm",l<=Math.round($.value/y.value.length*20)?"bg-green-500":"bg-gray-300 dark:bg-gray-600"])},null,2)),64)),a("span",Re,u($.value)+"/"+u(y.value.length),1)],64))],8,Le)):n("",!0)]),o.value?(s(),r(w,{key:0},[E.value.length>0?(s(),r("div",Ue,[t[4]||(t[4]=a("h2",{class:"text-xs font-semibold text-gray-400 dark:text-gray-500 uppercase tracking-wider mb-3 px-1"}," Потоки ",-1)),a("div",Ie,[(s(!0),r(w,null,L(E.value,l=>(s(),r("div",{key:l.id,class:"border border-gray-200 dark:border-gray-700 rounded-lg bg-white dark:bg-gray-800 overflow-hidden"},[a("div",{class:"flex items-center justify-between p-4 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",onClick:d=>Y(l.id)},[a("div",Fe,[(s(),r("svg",{class:D(["w-4 h-4 mr-2 text-gray-400 transition-transform flex-shrink-0",{"rotate-90":p.value.has(l.id)}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...t[2]||(t[2]=[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"},null,-1)])],2)),a("div",We,[a("h3",qe,u(l.name),1)])]),a("div",Je,[l.tasks?(s(),r("span",Ke,u(l.tasks.filter(d=>d.completed_at).length)+"/"+u(l.tasks.length),1)):n("",!0),a("button",{onClick:he(d=>Z(l),["stop"]),class:"p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 rounded transition-colors",title:"Открыть поток"},[...t[3]||(t[3]=[a("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})],-1)])],8,Oe)])],8,je),l.tasks&&l.tasks.length>0?(s(),r("div",Qe,[a("div",Xe,[a("div",{class:"bg-green-500 h-1 rounded-full transition-all",style:J({width:Math.round(l.tasks.filter(d=>d.completed_at).length/l.tasks.length*100)+"%"})},null,4)])])):n("",!0),p.value.has(l.id)&&l.tasks&&l.tasks.length>0?(s(),r("div",Ye,[k(P,{tasks:l.tasks.filter(d=>!d.completed_at),onTaskClick:V,onToggleComplete:B},null,8,["tasks"]),l.tasks.filter(d=>d.completed_at).length>0?(s(),r("div",Ze,[k(P,{tasks:l.tasks.filter(d=>d.completed_at),onTaskClick:V,onToggleComplete:B},null,8,["tasks"])])):n("",!0),l.tasks.length===0?(s(),r("div",et," Нет задач ")):n("",!0)])):n("",!0)]))),128))])])):n("",!0),z.value.length>0||A.value.length>0?(s(),r("div",tt,[t[6]||(t[6]=a("h2",{class:"text-xs font-semibold text-gray-400 dark:text-gray-500 uppercase tracking-wider mb-3 px-1"}," Задачи ",-1)),z.value.length>0?(s(),ve(P,{key:0,tasks:z.value,onTaskClick:V,onToggleComplete:B},null,8,["tasks"])):n("",!0),A.value.length>0?(s(),r("div",at,[t[5]||(t[5]=a("h3",{class:"text-xs font-semibold text-gray-400 dark:text-gray-500 uppercase tracking-wider mb-3 px-1"}," Выполненные ",-1)),a("div",st,[k(P,{tasks:A.value,onTaskClick:V,onToggleComplete:B},null,8,["tasks"])])])):n("",!0)])):n("",!0),E.value.length===0&&y.value.length===0?(s(),r("div",rt,[...t[7]||(t[7]=[ge('<div class="max-w-md mx-auto"><div class="w-16 h-16 mx-auto mb-4 rounded-full bg-blue-50 dark:bg-blue-900/30 flex items-center justify-center"><svg class="w-8 h-8 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path></svg></div><h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">В цели пока нет задач и потоков</h3><p class="text-sm text-gray-500 dark:text-gray-400 leading-relaxed"> Привяжите к цели потоки или создайте задачи, чтобы начать двигаться к результату. </p></div>',1)])])):n("",!0)],64)):n("",!0),k(_e,{show:T.value,task:h.value,onClose:t[0]||(t[0]=l=>{T.value=!1,h.value=null}),onEnterEdit:se,onCompleteTask:re,onUncompleteTask:le},null,8,["show","task"]),k(pe,{show:b.value,task:h.value,"server-error":S.value,onClose:ne,onSubmit:oe},null,8,["show","task","server-error"]),k(we,{show:C.value,goal:o.value,"server-error":M.value,onClose:ue,onSubmit:ie},null,8,["show","goal","server-error"])])])])}}};export{pt as default};
