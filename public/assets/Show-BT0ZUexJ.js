import{c as s,a as t,o as l,r as d,A as P,f as u,b as S,D as z,t as C,z as g,e as E,i as A,j as U}from"./index-CM0cfn01.js";import{u as D}from"./projects-Djv7RB1g.js";import{u as F,T as W}from"./TaskModal-BX9O0CeU.js";import{u as q}from"./workspace-CklmZmV4.js";import{T as G}from"./TaskList-2US4b4un.js";import{P as J}from"./ProjectModal-CiP0Gd6L.js";import{r as K}from"./RectangleStackIcon-C1sog69S.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ru-B7JyRvIu.js";function O(k,i){return l(),s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m20.25 7.5-.625 10.632a2.25 2.25 0 0 1-2.247 2.118H6.622a2.25 2.25 0 0 1-2.247-2.118L3.75 7.5m8.25 3v6.75m0 0-3-3m3 3 3-3M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125Z"})])}function Q(k,i){return l(),s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 15 3 9m0 0 6-6M3 9h12a6 6 0 0 1 0 12h-3"})])}function X(k,i){return l(),s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L6.832 19.82a4.5 4.5 0 0 1-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 0 1 1.13-1.897L16.863 4.487Zm0 0L19.5 7.125"})])}function Y(k,i){return l(),s("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"fill-rule":"evenodd",d:"M12 3.75a.75.75 0 0 1 .75.75v6.75h6.75a.75.75 0 0 1 0 1.5h-6.75v6.75a.75.75 0 0 1-1.5 0v-6.75H4.5a.75.75 0 0 1 0-1.5h6.75V4.5a.75.75 0 0 1 .75-.75Z","clip-rule":"evenodd"})])}const ee={class:"p-4 lg:p-8"},re={class:"max-w-4xl mx-auto"},te={class:"flex items-center justify-between mb-6"},oe={class:"flex items-center space-x-3 min-w-0 flex-1"},ae={class:"min-w-0"},se={class:"text-xl lg:text-2xl font-semibold text-gray-900 dark:text-white truncate"},le={key:0,class:"text-sm text-gray-600 dark:text-gray-400 mt-1 truncate"},ne={class:"flex items-center space-x-1 flex-shrink-0 ml-2"},ce={key:0,class:"text-center py-12"},ie={key:1},de={key:0,class:"py-12 text-center"},ue={class:"max-w-md mx-auto"},ve={class:"w-16 h-16 mx-auto mb-4 rounded-full bg-blue-50 dark:bg-blue-900/30 flex items-center justify-center"},pe={key:1,class:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700"},he={class:"p-4 border-b border-gray-200 dark:border-gray-700"},me={class:"text-lg font-semibold text-gray-900 dark:text-white"},ge={class:"text-sm font-normal text-gray-500 dark:text-gray-400"},ke={class:"divide-y divide-gray-200 dark:divide-gray-700"},Pe={__name:"Show",setup(k){const i=U(),w=A(),x=D(),p=F();q();const o=d(null),h=d([]),j=d(!1),m=d(!1),y=d(!1),v=d(null),f=d(""),_=d(""),T=async()=>{var c,n;const r=parseInt(i.params.projectId),e=parseInt(i.params.id);if(!e||!r){console.error("Missing workspaceId or projectId",{workspaceId:e,projectId:r});return}j.value=!0;try{const a=await x.fetchProject(r);if(!a){w.push(`/workspaces/${e}/projects`);return}if(o.value=a,o.value.workspace_id!==e){console.error("Project does not belong to workspace from URL"),w.push(`/workspaces/${e}/projects`);return}b()}catch(a){console.error("Error loading project:",a),console.error("Error details:",(c=a.response)==null?void 0:c.data),((n=a.response)==null?void 0:n.status)===404&&w.push(`/workspaces/${e}/projects`)}finally{j.value=!1}},b=()=>{const r=parseInt(i.params.projectId);if(!r){h.value=[];return}h.value=p.allTasks.filter(e=>e.project_id===r)},I=()=>{y.value=!0},M=async()=>{var r;if(confirm(`Архивировать проект "${(r=o.value)==null?void 0:r.name}"?`))try{await x.archiveProject(o.value.id),w.push(`/workspaces/${o.value.workspace_id}/projects`)}catch(e){console.error("Error archiving project:",e),alert("Ошибка при архивировании проекта")}},$=async()=>{try{await x.unarchiveProject(o.value.id),await T()}catch(r){console.error("Error unarchiving project:",r),alert("Ошибка при восстановлении проекта")}},B=()=>{o.value&&(v.value={project_id:o.value.id},m.value=!0)},L=r=>{v.value=r,m.value=!0},V=async r=>{var e,c,n;f.value="";try{(e=v.value)!=null&&e.id?await p.updateTask(v.value.id,r):(r.project_id=o.value.id,await p.createTask(r)),m.value=!1,v.value=null,b()}catch(a){console.error("Error saving task:",a),f.value=((n=(c=a.response)==null?void 0:c.data)==null?void 0:n.message)||a.message||"Ошибка при сохранении задачи"}},N=()=>{m.value=!1,v.value=null,f.value=""},H=async r=>{var e,c;_.value="";try{await x.updateProject(o.value.id,r),y.value=!1,await T()}catch(n){console.error("Error saving project:",n),_.value=((c=(e=n.response)==null?void 0:e.data)==null?void 0:c.message)||n.message||"Ошибка при сохранении проекта"}},R=()=>{y.value=!1,_.value=""},Z=async r=>{try{r.status==="completed"?await p.updateTask(r.id,{status:"inbox"}):await p.completeTask(r.id),b()}catch(e){console.error("Error toggling task:",e)}};return P(()=>[i.params.projectId,i.params.id],()=>{T()},{immediate:!0}),P(()=>p.allTasks,()=>{b()},{deep:!0}),(r,e)=>{var c,n,a;return l(),s("div",ee,[t("div",re,[t("div",te,[t("div",oe,[o.value?(l(),s("div",{key:0,class:"w-4 h-4 rounded-full flex-shrink-0",style:z({backgroundColor:o.value.color||"#3B82F6"})},null,4)):S("",!0),t("div",ae,[t("h1",se,C(((c=o.value)==null?void 0:c.name)||"Загрузка..."),1),(n=o.value)!=null&&n.description?(l(),s("p",le,C(o.value.description),1)):S("",!0)])]),t("div",ne,[t("button",{onClick:I,class:"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",title:"Редактировать"},[u(g(X),{class:"w-5 h-5"})]),((a=o.value)==null?void 0:a.status)!=="archived"?(l(),s("button",{key:0,onClick:M,class:"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",title:"Архивировать"},[u(g(O),{class:"w-5 h-5"})])):(l(),s("button",{key:1,onClick:$,class:"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",title:"Восстановить"},[u(g(Q),{class:"w-5 h-5"})]))])]),j.value?(l(),s("div",ce,[...e[0]||(e[0]=[t("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"},null,-1)])])):(l(),s("div",ie,[h.value.length===0?(l(),s("div",de,[t("div",ue,[t("div",ve,[u(g(K),{class:"w-8 h-8 text-blue-500"})]),e[2]||(e[2]=t("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white mb-2"},"В проекте пока нет задач",-1)),e[3]||(e[3]=t("p",{class:"text-sm text-gray-500 dark:text-gray-400 mb-6 leading-relaxed"}," Проект — это любая цель, требующая более одного действия. Разбейте его на конкретные шаги и добавьте первую задачу, чтобы начать двигаться к результату. ",-1)),t("button",{onClick:B,class:"inline-flex items-center px-4 py-2 bg-primary-600 hover:bg-primary-700 text-white rounded-lg transition-colors text-sm font-medium"},[u(g(Y),{class:"w-5 h-5 mr-1.5"}),e[1]||(e[1]=E(" Добавить задачу ",-1))])])])):(l(),s("div",pe,[t("div",he,[t("h2",me,[e[4]||(e[4]=E(" Задачи проекта ",-1)),t("span",ge," ("+C(h.value.length)+") ",1)])]),t("div",ke,[u(G,{tasks:h.value,onTaskClick:L,onToggleComplete:Z},null,8,["tasks"])])]))])),u(W,{show:m.value,task:v.value,"server-error":f.value,onClose:N,onSubmit:V},null,8,["show","task","server-error"]),u(J,{show:y.value,project:o.value,"server-error":_.value,onClose:R,onSubmit:H},null,8,["show","project","server-error"])])])}}};export{Pe as default};
