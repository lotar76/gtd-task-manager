import{u as R,T as U,a as X}from"./TaskModal-DdsrWByb.js";import{u as Z}from"./workspace-CeXQgviw.js";import{d as v}from"./ru-D_ksFwAV.js";import{_ as ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{c as a,a as s,o as n,r as h,k as Y,z as W,q as te,b as p,f as T,p as y,D as O,t as i,F as _,y as x,e as se}from"./index-k8OeIxN1.js";function re(N,f){return n(),a("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})])}function oe(N,f){return n(),a("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m8.25 4.5 7.5 7.5-7.5 7.5"})])}const ae={class:"p-2 sm:p-4 lg:p-8"},ne={class:"max-w-7xl mx-auto"},ie={class:"flex flex-col lg:flex-row lg:items-center lg:justify-between mb-4 lg:mb-6"},le={class:"flex items-center space-x-1 sm:space-x-2 mt-3 lg:mt-0 overflow-x-auto pb-2 lg:pb-0"},de={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-3 sm:p-4 mb-4 lg:mb-6"},ce={class:"flex items-center justify-between"},me={class:"text-base sm:text-lg font-semibold text-gray-900 text-center px-2"},ue={key:0,class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden"},pe={class:"grid grid-cols-7 border-b border-gray-200"},ye={class:"grid grid-cols-7"},ge=["onClick"],ve={class:"flex flex-col h-full"},he={class:"flex justify-between items-start mb-1"},_e={key:0,class:"inline-flex items-center justify-center min-w-[20px] h-5 px-1.5 text-xs font-semibold bg-primary-600 text-white rounded-full"},xe={key:1,class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden"},be={class:"hidden lg:block"},fe={class:"grid grid-cols-7 border-b border-gray-200"},we={class:"grid grid-cols-7"},Ye={class:"mb-2"},Me={class:"space-y-2"},ke=["onClick"],De={class:"font-medium truncate"},Te={key:0,class:"text-[10px] opacity-75 mt-1"},Ce={key:0},$e={key:1},Se={key:2},je={class:"lg:hidden overflow-x-auto"},Oe={class:"flex min-w-max"},Ne={class:"mb-3 sticky top-0 bg-inherit pb-2 border-b border-gray-200"},Be={class:"text-xs text-gray-500 mb-1"},Ee={class:"space-y-2"},Pe=["onClick"],Ve={class:"font-medium text-sm mb-1"},We={key:0,class:"text-xs text-gray-600 mt-1"},ze={key:0},Fe={key:1},Le={key:2},qe={key:0,class:"text-xs text-gray-400 text-center py-4"},Ie={key:2,class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden"},Ae={class:"p-3 sm:p-4 border-b border-gray-200"},Ge={class:"text-base sm:text-lg font-semibold text-gray-900"},He={class:"p-3 sm:p-4"},Je={class:"space-y-2 sm:space-y-3"},Ke=["onClick"],Qe={class:"flex items-start justify-between"},Re={class:"flex-1 min-w-0"},Ue={class:"font-medium text-sm sm:text-base text-gray-900 mb-1"},Xe={key:0,class:"text-xs sm:text-sm text-gray-600 mt-1 line-clamp-2"},Ze={class:"flex flex-wrap items-center gap-2 mt-2"},et={key:0,class:"text-xs text-gray-600 flex items-center"},tt={key:0},st={key:1},rt={key:2},ot={key:0,class:"text-center py-8 sm:py-12 text-gray-500 text-sm sm:text-base"},at={__name:"Calendar",setup(N){v.locale("ru");const f=R(),B=Z(),l=h(v()),M=h([]),E=h(!1),z=h(!1),c=h("month"),k=h(!1),w=h(null),D=h(""),C=["Пн","Вт","Ср","Чт","Пт","Сб","Вс"],F=Y(()=>l.value.format("MMMM")),L=Y(()=>l.value.format("YYYY")),q=Y(()=>{if(c.value==="month")return`${F.value} ${L.value}`;if(c.value==="week"){const t=l.value.startOf("week"),o=t.add(6,"day");return t.month()===o.month()?`${t.format("D")} - ${o.format("D MMMM YYYY")}`:`${t.format("D MMM")} - ${o.format("D MMM YYYY")}`}else return l.value.format("D MMMM YYYY")}),P=Y(()=>{const t=l.value.startOf("week"),o=[];for(let e=0;e<7;e++){const d=t.add(e,"day"),r=d.format("YYYY-MM-DD"),m=M.value.filter(u=>u.due_date&&v(u.due_date).format("YYYY-MM-DD")===r&&u.status!=="completed");o.push({day:d.date(),monthName:d.format("MMM"),date:r,isToday:d.isSame(v(),"day"),tasks:m})}return o}),V=Y(()=>{const t=l.value.format("YYYY-MM-DD");return M.value.filter(o=>o.due_date&&v(o.due_date).format("YYYY-MM-DD")===t&&o.status!=="completed")}),I=Y(()=>{const t=[],o=l.value.startOf("month"),e=l.value.endOf("month"),d=o.day()===0?6:o.day()-1;for(let m=d-1;m>=0;m--){const u=o.subtract(m+1,"day");t.push($(u,!1))}for(let m=0;m<e.date();m++){const u=o.add(m,"day");t.push($(u,!0))}const r=42-t.length;for(let m=0;m<r;m++){const u=e.add(m+1,"day");t.push($(u,!1))}return t}),$=(t,o)=>{const e=t.format("YYYY-MM-DD"),d=M.value.filter(r=>r.due_date&&v(r.due_date).format("YYYY-MM-DD")===e&&r.status!=="completed");return{day:t.date(),date:e,currentMonth:o,isToday:t.isSame(v(),"day"),taskCount:d.length,tasks:d}},b=async()=>{E.value=!0;try{let t,o;if(c.value==="month")t=l.value.startOf("month").subtract(7,"days").format("YYYY-MM-DD"),o=l.value.endOf("month").add(7,"days").format("YYYY-MM-DD");else if(c.value==="week"){const e=l.value.startOf("week");t=e.format("YYYY-MM-DD"),o=e.add(6,"day").format("YYYY-MM-DD")}else t=l.value.format("YYYY-MM-DD"),o=l.value.format("YYYY-MM-DD");await f.fetchCalendar(t,o,z.value),M.value=f.tasks}finally{E.value=!1}};W(()=>c.value,()=>{b()});const A=()=>{c.value==="month"?l.value=l.value.subtract(1,"month"):c.value==="week"?l.value=l.value.subtract(1,"week"):l.value=l.value.subtract(1,"day"),b()},G=()=>{c.value==="month"?l.value=l.value.add(1,"month"):c.value==="week"?l.value=l.value.add(1,"week"):l.value=l.value.add(1,"day"),b()},g=t=>t?/^\d{2}:\d{2}$/.test(t)?t:t.substring(0,5):"",H=t=>({high:"Высокий",medium:"Средний",low:"Низкий",urgent:"Срочный"})[t]||t,S=t=>{w.value=t,k.value=!0},J=t=>{l.value=v(t),c.value="day",b()},K=async t=>{var o,e,d,r,m;D.value="";try{w.value?await f.updateTask(w.value.id,t):await f.createTask(t),k.value=!1,w.value=null,await b()}catch(u){console.error("Error saving task:",u),console.error("Error details:",(o=u.response)==null?void 0:o.data);let j="Ошибка при сохранении задачи";(d=(e=u.response)==null?void 0:e.data)!=null&&d.errors?j=Object.values(u.response.data.errors).flat().join(", "):(m=(r=u.response)==null?void 0:r.data)!=null&&m.message&&(j=u.response.data.message),D.value=j}},Q=()=>{k.value=!1,w.value=null,D.value=""};return W(()=>{var t;return(t=B.currentWorkspace)==null?void 0:t.id},t=>{t&&b()},{immediate:!0}),te(()=>{var t;(t=B.currentWorkspace)!=null&&t.id&&b()}),(t,o)=>(n(),a("div",ae,[s("div",ne,[s("div",ie,[o[3]||(o[3]=s("div",null,[s("h1",{class:"text-lg sm:text-xl lg:text-2xl font-semibold text-gray-900"},"Календарь")],-1)),s("div",le,[s("button",{onClick:o[0]||(o[0]=e=>c.value="day"),class:y(["px-3 sm:px-4 py-2 text-xs sm:text-sm font-medium rounded-lg transition-colors whitespace-nowrap touch-manipulation",c.value==="day"?"bg-primary-600 text-white":"bg-gray-100 text-gray-700 active:bg-gray-200"])}," День ",2),s("button",{onClick:o[1]||(o[1]=e=>c.value="week"),class:y(["px-3 sm:px-4 py-2 text-xs sm:text-sm font-medium rounded-lg transition-colors whitespace-nowrap touch-manipulation",c.value==="week"?"bg-primary-600 text-white":"bg-gray-100 text-gray-700 active:bg-gray-200"])}," Неделя ",2),s("button",{onClick:o[2]||(o[2]=e=>c.value="month"),class:y(["px-3 sm:px-4 py-2 text-xs sm:text-sm font-medium rounded-lg transition-colors whitespace-nowrap touch-manipulation",c.value==="month"?"bg-primary-600 text-white":"bg-gray-100 text-gray-700 active:bg-gray-200"])}," Месяц ",2)])]),s("div",de,[s("div",ce,[s("button",{onClick:A,class:"p-2 sm:p-3 rounded-lg bg-gray-100 hover:bg-gray-200 active:bg-gray-300 transition-colors touch-manipulation"},[T(O(re),{class:"w-5 h-5 sm:w-6 sm:h-6 text-gray-700"})]),s("h2",me,i(q.value),1),s("button",{onClick:G,class:"p-2 sm:p-3 rounded-lg bg-gray-100 hover:bg-gray-200 active:bg-gray-300 transition-colors touch-manipulation"},[T(O(oe),{class:"w-5 h-5 sm:w-6 sm:h-6 text-gray-700"})])])]),c.value==="month"?(n(),a("div",ue,[s("div",pe,[(n(),a(_,null,x(C,e=>s("div",{key:e,class:"text-center py-2 sm:py-3 text-xs sm:text-sm font-medium text-gray-700 border-r border-gray-200 last:border-r-0"},i(e),1)),64))]),s("div",ye,[(n(!0),a(_,null,x(I.value,(e,d)=>(n(),a("div",{key:d,onClick:r=>J(e.date),class:y(["min-h-[60px] sm:min-h-[80px] lg:min-h-[100px] border-b border-r border-gray-200 last:border-r-0 p-1 sm:p-2 cursor-pointer touch-manipulation hover:bg-gray-50 active:bg-gray-100 transition-colors",{"bg-gray-50":!e.currentMonth,"bg-primary-50 hover:bg-primary-100":e.isToday}])},[s("div",ve,[s("div",he,[s("span",{class:y(["text-xs sm:text-sm font-medium",{"text-gray-400":!e.currentMonth,"text-primary-700":e.isToday,"text-gray-900":e.currentMonth&&!e.isToday}])},i(e.day),3),e.taskCount>0?(n(),a("span",_e,i(e.taskCount),1)):p("",!0)])])],10,ge))),128))])])):p("",!0),c.value==="week"?(n(),a("div",xe,[s("div",be,[s("div",fe,[(n(),a(_,null,x(C,e=>s("div",{key:e,class:"text-center py-3 text-sm font-medium text-gray-700 border-r border-gray-200 last:border-r-0"},i(e),1)),64))]),s("div",we,[(n(!0),a(_,null,x(P.value,(e,d)=>(n(),a("div",{key:d,class:y(["min-h-[400px] border-b border-r border-gray-200 last:border-r-0 p-3",{"bg-primary-50":e.isToday}])},[s("div",Ye,[s("span",{class:y(["text-sm font-medium",{"text-primary-700":e.isToday,"text-gray-900":!e.isToday}])},i(e.day)+" "+i(e.monthName),3)]),s("div",Me,[(n(!0),a(_,null,x(e.tasks,r=>(n(),a("div",{key:r.id,onClick:m=>S(r),class:y(["p-2 rounded cursor-pointer text-xs touch-manipulation",{"bg-primary-100 text-primary-700 border-l-2 border-primary-500":r.status!=="completed","bg-gray-100 text-gray-500 line-through":r.status==="completed"}])},[s("div",De,i(r.title),1),r.estimated_time||r.end_time?(n(),a("div",Te,[r.estimated_time&&r.end_time?(n(),a("span",Ce,i(g(r.estimated_time))+" - "+i(g(r.end_time)),1)):r.estimated_time?(n(),a("span",$e,i(g(r.estimated_time)),1)):r.end_time?(n(),a("span",Se," до "+i(g(r.end_time)),1)):p("",!0)])):p("",!0)],10,ke))),128))])],2))),128))])]),s("div",je,[s("div",Oe,[(n(!0),a(_,null,x(P.value,(e,d)=>(n(),a("div",{key:d,class:y(["w-[280px] min-w-[280px] border-r border-gray-200 last:border-r-0 p-3",{"bg-primary-50":e.isToday}])},[s("div",Ne,[s("div",Be,i(C[d]),1),s("span",{class:y(["text-base font-semibold",{"text-primary-700":e.isToday,"text-gray-900":!e.isToday}])},i(e.day)+" "+i(e.monthName),3)]),s("div",Ee,[(n(!0),a(_,null,x(e.tasks,r=>(n(),a("div",{key:r.id,onClick:m=>S(r),class:y(["p-3 rounded-lg cursor-pointer touch-manipulation",{"bg-primary-100 text-primary-700 border-l-4 border-primary-500":r.status!=="completed","bg-gray-100 text-gray-500 line-through":r.status==="completed"}])},[s("div",Ve,i(r.title),1),r.estimated_time||r.end_time?(n(),a("div",We,[o[4]||(o[4]=se(" ⏱ ",-1)),r.estimated_time&&r.end_time?(n(),a("span",ze,i(g(r.estimated_time))+" - "+i(g(r.end_time)),1)):r.estimated_time?(n(),a("span",Fe,i(g(r.estimated_time)),1)):r.end_time?(n(),a("span",Le," до "+i(g(r.end_time)),1)):p("",!0)])):p("",!0)],10,Pe))),128)),e.tasks.length===0?(n(),a("div",qe," Нет задач ")):p("",!0)])],2))),128))])])])):p("",!0),c.value==="day"?(n(),a("div",Ie,[s("div",Ae,[s("h3",Ge,i(l.value.format("D MMMM YYYY")),1)]),s("div",He,[s("div",Je,[(n(!0),a(_,null,x(V.value,e=>(n(),a("div",{key:e.id,onClick:d=>S(e),class:y(["p-3 sm:p-4 rounded-lg cursor-pointer border-l-4 touch-manipulation active:scale-[0.98] transition-transform",{"bg-primary-50 border-primary-500":e.status!=="completed","bg-gray-50 border-gray-300 line-through":e.status==="completed"}])},[s("div",Qe,[s("div",Re,[s("div",Ue,i(e.title),1),e.description?(n(),a("div",Xe,i(e.description),1)):p("",!0),s("div",Ze,[e.estimated_time||e.end_time?(n(),a("span",et,[T(O(X),{class:"w-3 h-3 mr-1"}),e.estimated_time&&e.end_time?(n(),a("span",tt,i(g(e.estimated_time))+" - "+i(g(e.end_time)),1)):e.estimated_time?(n(),a("span",st,i(g(e.estimated_time)),1)):e.end_time?(n(),a("span",rt," до "+i(g(e.end_time)),1)):p("",!0)])):p("",!0),s("span",{class:y(["text-xs px-2 py-0.5 rounded-full",{"bg-red-100 text-red-700":e.priority==="urgent","bg-primary-100 text-primary-700":e.priority==="high","bg-yellow-100 text-yellow-700":e.priority==="medium","bg-gray-100 text-gray-700":e.priority==="low"}])},i(H(e.priority)),3)])])])],10,Ke))),128)),V.value.length===0?(n(),a("div",ot," Нет задач на этот день ")):p("",!0)])])])):p("",!0),T(U,{show:k.value,task:w.value,"server-error":D.value,onClose:Q,onSubmit:K},null,8,["show","task","server-error"])])]))}},ut=ee(at,[["__scopeId","data-v-d9bfd7cf"]]);export{ut as default};
