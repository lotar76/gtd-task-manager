import{r as m,k as u,s as P,c as a,a as r,f as C,F as M,C as $,i as S,o as n,b as v,t as p,w as B}from"./index-BQRmz4GQ.js";import{u as V}from"./projects-BB9qncDe.js";import{u as W}from"./workspace-DTkHaZL8.js";import{P as A}from"./ProjectModal-CQ0rKKVC.js";import"./goals-D1Fsmasl.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const E={class:"p-4 lg:p-8"},N={class:"flex items-center justify-between mb-6"},F={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},H=["onClick"],I={class:"flex items-start justify-between mb-4"},z={class:"flex-1 min-w-0"},L={class:"text-lg font-semibold text-gray-900 dark:text-white truncate"},R={key:0,class:"text-sm text-gray-500 dark:text-gray-400 truncate"},q=["onClick"],D={key:0,class:"text-sm text-gray-600 dark:text-gray-300 mb-4 line-clamp-2"},G={class:"flex items-center justify-between text-sm"},J={class:"text-gray-500 dark:text-gray-400"},K={key:0,class:"px-2 py-1 bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-400 rounded-full text-xs"},O={key:1,class:"text-center py-16"},te={__name:"Index",setup(Q){S();const l=V(),g=W(),i=m(!1),c=m(null),d=m(""),k=u(()=>l.activeProjects),x=u(()=>g.currentWorkspace),y=u(()=>g.workspaces),f=u(()=>g.selectedWorkspaces.map(s=>s.id)),w=s=>{const e=y.value.find(t=>t.id===s);return(e==null?void 0:e.name)||""},b=async s=>{var e,t;d.value="";try{c.value?await l.updateProject(c.value.id,s):await l.createProject(s),i.value=!1,c.value=null,await l.fetchAllProjects({force:!0})}catch(o){console.error("Error saving project:",o),d.value=((t=(e=o.response)==null?void 0:e.data)==null?void 0:t.message)||o.message||"Ошибка при сохранении потока"}},_=()=>{i.value=!1,c.value=null,d.value=""},j=async s=>{var e,t;if(confirm(`Архивировать поток "${s.name}"?`))try{await l.archiveProject(s.id),await l.fetchAllProjects({force:!0})}catch(o){console.error("Error archiving project:",o),alert("Ошибка при архивировании потока: "+(((t=(e=o.response)==null?void 0:e.data)==null?void 0:t.message)||o.message))}};return P(async()=>{await l.fetchAllProjects()}),(s,e)=>(n(),a("div",E,[r("div",N,[e[3]||(e[3]=r("h1",{class:"text-2xl font-bold text-gray-900 dark:text-white"},"Потоки",-1)),r("button",{onClick:e[0]||(e[0]=t=>i.value=!0),class:"px-4 py-2 bg-primary-600 hover:bg-primary-700 text-white rounded-lg flex items-center space-x-2 transition-colors"},[...e[2]||(e[2]=[r("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),r("span",null,"Создать поток",-1)])])]),k.value.length>0?(n(),a("div",F,[(n(!0),a(M,null,$(k.value,t=>(n(),a("div",{key:t.id,class:"bg-white dark:bg-gray-800 rounded-lg p-6 border border-gray-200 dark:border-gray-700 hover:shadow-lg transition-shadow cursor-pointer",onClick:o=>{var h;return s.$router.push(`/workspaces/${(h=x.value)==null?void 0:h.id}/projects/${t.id}`)}},[r("div",I,[r("div",z,[r("h3",L,p(t.name),1),f.value.length>1?(n(),a("p",R,p(w(t.workspace_id)),1)):v("",!0)]),r("button",{onClick:B(o=>j(t),["stop"]),class:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 p-1 transition-colors",title:"Архивировать"},[...e[4]||(e[4]=[r("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"})],-1)])],8,q)]),t.description?(n(),a("p",D,p(t.description),1)):v("",!0),r("div",G,[r("span",J,p(t.tasks_count||0)+" задач ",1),t.status==="active"?(n(),a("span",K," Активен ")):v("",!0)])],8,H))),128))])):(n(),a("div",O,[e[5]||(e[5]=r("svg",{class:"mx-auto h-16 w-16 text-gray-400 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),e[6]||(e[6]=r("h3",{class:"text-lg font-medium text-gray-900 dark:text-white mb-2"},"Нет потоков",-1)),e[7]||(e[7]=r("p",{class:"text-gray-500 dark:text-gray-400 mb-4"},"Создайте первый поток для организации ваших задач",-1)),r("button",{onClick:e[1]||(e[1]=t=>i.value=!0),class:"px-4 py-2 bg-primary-600 hover:bg-primary-700 text-white rounded-lg transition-colors"}," Создать поток ")])),C(A,{show:i.value,project:c.value,"server-error":d.value,onClose:_,onSubmit:b},null,8,["show","project","server-error"])]))}};export{te as default};
