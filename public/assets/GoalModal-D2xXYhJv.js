import{k as x,r as v,s as E,x as T,z as b,l as z,o,f as N,g as W,c as i,b as g,a as l,w as _,t as d,d as u,B,F as U,C as V,v as f,T as q,A as D}from"./index-BQRmz4GQ.js";import{u as O}from"./workspace-DTkHaZL8.js";import{u as R}from"./lifeSpheres-DDVy7cpI.js";import{_ as A}from"./_plugin-vue_export-helper-DlAUqK2U.js";const K={class:"flex min-h-screen items-center justify-center p-4"},P={class:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700"},H={class:"text-xl font-semibold text-gray-900 dark:text-white"},J={key:0},Q=["value"],X=["value"],Y={key:0,class:"relative mb-2"},Z=["src"],G={key:1,class:"text-red-600 dark:text-red-400 text-sm bg-red-50 dark:bg-red-900/20 p-3 rounded-lg"},ee={class:"flex justify-end space-x-3 pt-4"},le=["disabled"],te={__name:"GoalModal",props:{show:{type:Boolean,default:!1},goal:{type:Object,default:null},serverError:{type:String,default:""}},emits:["close","submit"],setup(c,{emit:j}){const p=c,w=j,h=O(),S=R(),C=x(()=>h.workspaces),k=x(()=>h.currentWorkspace),L=x(()=>{const t=s.value.workspace_id;return t?S.allSpheres.filter(e=>e.workspace_id===t):S.allSpheres}),M=t=>{t.key==="Escape"&&p.show&&w("close")};E(()=>document.addEventListener("keydown",M)),T(()=>document.removeEventListener("keydown",M));const s=v({workspace_id:null,life_sphere_id:null,name:"",deadline:"",description:"",bible_verse:"",image_url:null,imageFile:null}),m=v(!1),r=v(""),y=v(null),n=v(null);b(()=>p.goal,t=>{var e,a;t?s.value={workspace_id:t.workspace_id||((e=k.value)==null?void 0:e.id),life_sphere_id:t.life_sphere_id||null,name:t.name||"",deadline:t.deadline?t.deadline.substring(0,10):"",description:t.description||"",bible_verse:t.bible_verse||"",image_url:t.image_url||null,imageFile:null}:s.value={workspace_id:(a=k.value)==null?void 0:a.id,life_sphere_id:null,name:"",deadline:"",description:"",bible_verse:"",image_url:null,imageFile:null},n.value=null,r.value=""},{immediate:!0}),b(()=>{var t;return(t=k.value)==null?void 0:t.id},t=>{!s.value.name&&t&&(s.value.workspace_id=t)}),b(()=>p.show,t=>{t||(m.value=!1,r.value="",n.value=null)}),b(()=>p.serverError,t=>{r.value=t,t&&(m.value=!1)});const $=t=>{const e=t.target.files[0];if(e){if(e.size>5*1024*1024){r.value="Максимальный размер файла 5MB";return}if(!e.type.startsWith("image/")){r.value="Выберите изображение";return}s.value.imageFile=e,n.value=URL.createObjectURL(e),r.value=""}},F=()=>{s.value.imageFile=null,s.value.image_url=null,n.value=null,y.value&&(y.value.value="")},I=()=>{r.value="",m.value=!0,w("submit",{...s.value})};return(t,e)=>(o(),z(D,{to:"body"},[N(q,{name:"modal"},{default:W(()=>[c.show?(o(),i("div",{key:0,class:"fixed inset-0 z-50 overflow-y-auto",onClick:e[10]||(e[10]=_(a=>t.$emit("close"),["self"]))},[e[21]||(e[21]=l("div",{class:"fixed inset-0 bg-black bg-opacity-50 transition-opacity"},null,-1)),l("div",K,[l("div",{class:"relative bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full mx-auto",onClick:e[9]||(e[9]=_(()=>{},["stop"]))},[l("div",P,[l("h3",H,d(c.goal?"Редактировать цель":"Новая цель"),1),l("button",{onClick:e[0]||(e[0]=a=>t.$emit("close")),class:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"},[...e[11]||(e[11]=[l("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),l("form",{onSubmit:_(I,["prevent"]),class:"p-6 space-y-4"},[C.value.length>1?(o(),i("div",J,[e[12]||(e[12]=l("label",{for:"goal_workspace_id",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Рабочее пространство * ",-1)),u(l("select",{id:"goal_workspace_id","onUpdate:modelValue":e[1]||(e[1]=a=>s.value.workspace_id=a),required:"",class:"input"},[(o(!0),i(U,null,V(C.value,a=>(o(),i("option",{key:a.id,value:a.id},d(a.name),9,Q))),128))],512),[[B,s.value.workspace_id]])])):g("",!0),l("div",null,[e[14]||(e[14]=l("label",{for:"goal_life_sphere_id",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Сфера жизни ",-1)),u(l("select",{id:"goal_life_sphere_id","onUpdate:modelValue":e[2]||(e[2]=a=>s.value.life_sphere_id=a),class:"input"},[e[13]||(e[13]=l("option",{value:null},"Без сферы",-1)),(o(!0),i(U,null,V(L.value,a=>(o(),i("option",{key:a.id,value:a.id},d(a.name),9,X))),128))],512),[[B,s.value.life_sphere_id]])]),l("div",null,[e[15]||(e[15]=l("label",{for:"goal_name",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Что * ",-1)),u(l("input",{id:"goal_name","onUpdate:modelValue":e[3]||(e[3]=a=>s.value.name=a),type:"text",required:"",class:"input",placeholder:"Что хочу достичь?"},null,512),[[f,s.value.name]])]),l("div",null,[e[16]||(e[16]=l("label",{for:"goal_deadline",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Когда ",-1)),u(l("input",{id:"goal_deadline","onUpdate:modelValue":e[4]||(e[4]=a=>s.value.deadline=a),type:"date",class:"input"},null,512),[[f,s.value.deadline]])]),l("div",null,[e[17]||(e[17]=l("label",{for:"goal_description",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Зачем ",-1)),u(l("textarea",{id:"goal_description","onUpdate:modelValue":e[5]||(e[5]=a=>s.value.description=a),rows:"2",class:"input",placeholder:"Зачем мне это нужно?"},null,512),[[f,s.value.description]])]),l("div",null,[e[18]||(e[18]=l("label",{for:"goal_bible_verse",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Стих из библии ",-1)),u(l("textarea",{id:"goal_bible_verse","onUpdate:modelValue":e[6]||(e[6]=a=>s.value.bible_verse=a),rows:"2",class:"input",placeholder:"Стих для вдохновения"},null,512),[[f,s.value.bible_verse]])]),l("div",null,[e[20]||(e[20]=l("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Картинка ",-1)),n.value||s.value.image_url?(o(),i("div",Y,[l("img",{src:n.value||s.value.image_url,class:"w-full h-48 object-cover rounded-lg"},null,8,Z),l("button",{type:"button",onClick:F,class:"absolute top-2 right-2 bg-black bg-opacity-50 text-white rounded-full p-1 hover:bg-opacity-70 transition-opacity"},[...e[19]||(e[19]=[l("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])):g("",!0),l("input",{type:"file",ref_key:"fileInput",ref:y,accept:"image/*",onChange:$,class:"hidden"},null,544),l("button",{type:"button",onClick:e[7]||(e[7]=a=>t.$refs.fileInput.click()),class:"w-full px-4 py-2 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg text-gray-500 dark:text-gray-400 hover:border-primary-500 hover:text-primary-500 transition-colors text-sm"},d(n.value||s.value.image_url?"Заменить изображение":"Выбрать изображение"),1)]),r.value?(o(),i("div",G,d(r.value),1)):g("",!0),l("div",ee,[l("button",{type:"button",onClick:e[8]||(e[8]=a=>t.$emit("close")),class:"btn btn-secondary"}," Отмена "),l("button",{type:"submit",disabled:m.value,class:"btn btn-primary"},d(m.value?"Сохранение...":"Сохранить"),9,le)])],32)])])])):g("",!0)]),_:1})]))}},ie=A(te,[["__scopeId","data-v-fd50b9c9"]]);export{ie as G};
