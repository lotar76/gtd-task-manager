import{H as se,r as h,k as c,E as A,c as p,a as s,o as d,z as j,s as re,x as le,l as K,f as ne,g as ie,b as z,w as G,t as C,d as b,I as de,v as L,p as te,m as oe,F as J,C as Q,B as X,T as ue,A as ce,j as pe}from"./index-BM-3aGKM.js";import{u as ae}from"./workspace-CoKcgfuB.js";import{u as ve}from"./projects-DIMWl5aI.js";import{_ as me}from"./_plugin-vue_export-helper-DlAUqK2U.js";const We=se("tasks",()=>{const n=h([]),k=h(!1),m=h(!1),D=h(localStorage.getItem("taskViewMode")||"list"),w=ae(),B=c(()=>w.selectedWorkspaces.map(a=>a.id)),v=c(()=>{const a=B.value;return a.length?n.value.filter(e=>a.includes(e.workspace_id)&&!e.completed_at):[]}),H=c(()=>v.value.filter(a=>a.status==="inbox")),x=c(()=>v.value.filter(a=>a.status==="next_action")),U=c(()=>v.value.filter(a=>a.status==="today")),M=c(()=>v.value.filter(a=>a.status==="tomorrow")),$=c(()=>v.value.filter(a=>a.status==="waiting")),r=c(()=>v.value.filter(a=>a.status==="someday")),S=c(()=>v.value.filter(a=>a.status==="scheduled")),_=c(()=>{const a=B.value;return a.length?n.value.filter(e=>a.includes(e.workspace_id)&&e.completed_at).sort((e,l)=>new Date(l.completed_at||l.updated_at)-new Date(e.completed_at||e.updated_at)).slice(0,20):[]}),g=c(()=>({inbox:H.value.length,next_actions:x.value.length,today:U.value.length,tomorrow:M.value.length,waiting:$.value.length,someday:r.value.length,scheduled:S.value.length})),O=(a,e)=>v.value.filter(l=>{if(!l.due_date)return!1;const i=l.due_date.substring(0,10);return i>=a&&i<=e}),T=async({force:a=!1}={})=>{var e;if(!(m.value&&!a)){k.value=!0;try{const l=await A.get("/v1/tasks");n.value=((e=l.data.data)==null?void 0:e.tasks)||l.data.tasks||l.data||[],m.value=!0}finally{k.value=!1}}},E=a=>{const e={...a};return e.estimated_time===""&&(e.estimated_time=null),e.due_date===""&&(e.due_date=null),e.description===""&&(e.description=null),(e.project_id===""||e.project_id===null)&&(e.project_id=null),e},V=async a=>{var y;const e=(a==null?void 0:a.workspace_id)||((y=w.currentWorkspace)==null?void 0:y.id);if(!e){console.error("Cannot create task: workspace_id not found");return}const l=E(a);l.workspace_id=e;const i=await A.post(`/v1/workspaces/${e}/tasks`,l),f=i.data.data||i.data;return n.value.unshift(f),f},N=async(a,e)=>{var ee;const l=n.value.find(q=>q.id===a),i=(e==null?void 0:e.workspace_id)||(l==null?void 0:l.workspace_id)||((ee=w.currentWorkspace)==null?void 0:ee.id);if(!i){console.error("Cannot update task: workspace_id not found");return}const f=E(e),y=await A.put(`/v1/workspaces/${i}/tasks/${a}`,f),u=y.data.data||y.data,Z=n.value.findIndex(q=>q.id===a);return Z!==-1&&(n.value[Z]=u),u},F=async a=>{var y;const e=n.value.findIndex(u=>u.id===a);if(e===-1)return;const l=n.value[e],i=l.workspace_id||((y=w.currentWorkspace)==null?void 0:y.id);if(!i){console.error("Cannot complete task: workspace_id not found");return}const f={...l};n.value[e]={...l,completed_at:new Date().toISOString()};try{const u=await A.post(`/v1/workspaces/${i}/tasks/${a}/complete`),Z=u.data.data||u.data;n.value[e]=Z}catch(u){throw n.value[e]=f,u}},W=async a=>{var y;const e=n.value.findIndex(u=>u.id===a);if(e===-1)return;const l=n.value[e],i=l.workspace_id||((y=w.currentWorkspace)==null?void 0:y.id);if(!i){console.error("Cannot uncomplete task: workspace_id not found");return}const f={...l};n.value[e]={...l,completed_at:null};try{const u=await A.post(`/v1/workspaces/${i}/tasks/${a}/uncomplete`),Z=u.data.data||u.data;n.value[e]=Z}catch(u){throw n.value[e]=f,u}},R=async a=>{var i;const e=n.value.find(f=>f.id===a),l=(e==null?void 0:e.workspace_id)||((i=w.currentWorkspace)==null?void 0:i.id);if(!l){console.error("Cannot delete task: workspace_id not found");return}await A.delete(`/v1/workspaces/${l}/tasks/${a}`),n.value=n.value.filter(f=>f.id!==a)},P=a=>{D.value=a,localStorage.setItem("taskViewMode",a)};let I=null;return{allTasks:n,loading:k,loaded:m,filteredTasks:v,inboxTasks:H,nextActionTasks:x,todayTasks:U,tomorrowTasks:M,waitingTasks:$,somedayTasks:r,scheduledTasks:S,archivedTasks:_,counts:g,calendarTasks:O,viewMode:D,fetchAllTasks:T,createTask:V,updateTask:N,completeTask:F,uncompleteTask:W,deleteTask:R,setViewMode:P,startSync:()=>{I=setInterval(()=>T({force:!0}),5*60*1e3)},stopSync:()=>{I&&clearInterval(I)}}});function fe(n,k){return d(),p("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m20.25 7.5-.625 10.632a2.25 2.25 0 0 1-2.247 2.118H6.622a2.25 2.25 0 0 1-2.247-2.118L3.75 7.5M10 11.25h4M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125Z"})])}function ke(n,k){return d(),p("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m3.75 13.5 10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75Z"})])}function Pe(n,k){return d(),p("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5m-9-6h.008v.008H12v-.008ZM12 15h.008v.008H12V15Zm0 2.25h.008v.008H12v-.008ZM9.75 15h.008v.008H9.75V15Zm0 2.25h.008v.008H9.75v-.008ZM7.5 15h.008v.008H7.5V15Zm0 2.25h.008v.008H7.5v-.008Zm6.75-4.5h.008v.008h-.008v-.008Zm0 2.25h.008v.008h-.008V15Zm0 2.25h.008v.008h-.008v-.008Zm2.25-4.5h.008v.008H16.5v-.008Zm0 2.25h.008v.008H16.5V15Z"})])}function Y(n,k){return d(),p("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5"})])}function we(n,k){return d(),p("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})])}function ge(n,k){return d(),p("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.25 13.5h3.86a2.25 2.25 0 0 1 2.012 1.244l.256.512a2.25 2.25 0 0 0 2.013 1.244h3.218a2.25 2.25 0 0 0 2.013-1.244l.256-.512a2.25 2.25 0 0 1 2.013-1.244h3.859m-19.5.338V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18v-4.162c0-.224-.034-.447-.1-.661L19.24 5.338a2.25 2.25 0 0 0-2.15-1.588H6.911a2.25 2.25 0 0 0-2.15 1.588L2.35 13.177a2.25 2.25 0 0 0-.1.661Z"})])}const ye={class:"flex min-h-screen items-center justify-center p-4"},xe={class:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700"},_e={class:"text-xl font-semibold text-gray-900 dark:text-white"},be={class:"flex items-center space-x-3 pb-4 border-b border-gray-200 dark:border-gray-700"},he={class:"flex items-center space-x-2 cursor-pointer"},Se={class:"text-sm font-medium text-gray-700 dark:text-gray-300"},je={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ce={class:"relative"},Me={class:"flex items-center space-x-2"},$e={key:0,class:"absolute z-10 mt-1 w-full bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg shadow-lg"},Te=["onClick"],Ve={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ie={key:0},Ze=["value"],Ae=["value"],De={key:1,class:"text-red-600 dark:text-red-400 text-sm bg-red-50 dark:bg-red-900/20 p-3 rounded-lg"},Be={class:"flex justify-end space-x-3 pt-4"},He=["disabled"],Oe={__name:"TaskModal",props:{show:{type:Boolean,default:!1},task:{type:Object,default:null},serverError:{type:String,default:""},defaultDate:{type:String,default:""}},emits:["close","submit"],setup(n,{emit:k}){const m=n,D=k,w=pe(),B=ae(),v=ve(),H=c(()=>B.workspaces),x=c(()=>B.currentWorkspace),U=c(()=>{const o=r.value.workspace_id;return o?v.allProjects.filter(t=>t.workspace_id===o&&(t.status==="active"||!t.status)):[]}),M=()=>{const o=w.path;return o.includes("/inbox")?"inbox":o.includes("/today")?"today":o.includes("/next-actions")?"next_action":o.includes("/tomorrow")?"tomorrow":o.includes("/waiting")?"waiting":o.includes("/someday")?"someday":"inbox"},$=()=>{const o=w.path;if(o.includes("/today"))return new Date().toISOString().split("T")[0];if(o.includes("/tomorrow")){const t=new Date;return t.setDate(t.getDate()+1),t.toISOString().split("T")[0]}return""},r=h({title:"",description:"",status:"inbox",priority:"medium",due_date:"",estimated_time:"",end_time:"",workspace_id:null,project_id:null,completed_at:null}),S=h(!1),_=h(""),g=h(!1),O=h(null),T={inbox:{label:"Входящие",icon:ge},next_action:{label:"Следующие",icon:ke},today:{label:"Сегодня",icon:Y},tomorrow:{label:"Завтра",icon:Y},waiting:{label:"Ожидание",icon:we},someday:{label:"Когда-нибудь",icon:fe},scheduled:{label:"Запланировано",icon:Y}},E=o=>{if(r.value.status=o,g.value=!1,o==="today"){const t=new Date;r.value.due_date=t.toISOString().split("T")[0]}else if(o==="tomorrow"){const t=new Date;t.setDate(t.getDate()+1),r.value.due_date=t.toISOString().split("T")[0]}},V=c(()=>!!r.value.completed_at),N=o=>{o.target.checked?r.value.completed_at=new Date().toISOString():r.value.completed_at=null},F=o=>o?/^\d{4}-\d{2}-\d{2}$/.test(o)?o:o.split("T")[0]:"",W=o=>o?/^\d{2}:\d{2}$/.test(o)?o:o.substring(0,5):"";j(()=>m.task,(o,t)=>{var a,e,l;if(t&&!o){r.value={title:"",description:"",status:"inbox",priority:"medium",due_date:"",estimated_time:"",end_time:"",workspace_id:(a=x.value)==null?void 0:a.id,project_id:null,completed_at:null},O.value=null,_.value="",g.value=!1;return}if(o)console.log("Task received:",o),console.log("Original due_date:",o.due_date),console.log("Formatted due_date:",F(o.due_date)),r.value={title:o.title||"",description:o.description||"",status:o.status||"inbox",priority:o.priority||"medium",due_date:F(o.due_date),estimated_time:W(o.estimated_time),end_time:W(o.end_time),workspace_id:o.workspace_id||((e=x.value)==null?void 0:e.id),project_id:o.project_id||null,completed_at:o.completed_at||null};else{const i=M();O.value=i,r.value={title:"",description:"",status:i,priority:"medium",due_date:$(),estimated_time:"",end_time:"",workspace_id:(l=x.value)==null?void 0:l.id,project_id:null,completed_at:null}}_.value="",g.value=!1},{immediate:!0}),j(()=>m.serverError,o=>{_.value=o,o&&(S.value=!1)}),j(()=>m.show,o=>{var t,a,e;o?m.task?r.value.workspace_id||(r.value.workspace_id=(a=x.value)==null?void 0:a.id):(r.value.workspace_id=(t=x.value)==null?void 0:t.id,r.value.status=M(),r.value.due_date=m.defaultDate||$()):(r.value={title:"",description:"",status:"inbox",priority:"medium",due_date:"",estimated_time:"",end_time:"",workspace_id:(e=x.value)==null?void 0:e.id,project_id:null},O.value=null,g.value=!1,S.value=!1,_.value="")}),j(()=>m.show,o=>{o&&!v.loaded&&v.fetchAllProjects()}),j(()=>w.path,()=>{if(!m.task){r.value.status=M();const o=$();(o||w.path.includes("/today"))&&(r.value.due_date=o)}}),j(()=>{var o;return(o=x.value)==null?void 0:o.id},o=>{!m.task&&o&&(r.value.workspace_id=o)}),j(()=>r.value.workspace_id,(o,t)=>{if(!(!t||o===t)&&r.value.project_id){const a=v.allProjects.find(e=>e.id===r.value.project_id);a&&a.workspace_id!==o&&(r.value.project_id=null)}}),j(()=>r.value.due_date,o=>{if(!o||r.value.completed_at)return;const t=new Date().toISOString().split("T")[0],a=new Date;a.setDate(a.getDate()+1);const e=a.toISOString().split("T")[0];o===t?r.value.status="today":o===e?r.value.status="tomorrow":["today","tomorrow","completed"].includes(r.value.status)||(r.value.status="scheduled")});const R=()=>{_.value="",S.value=!0,D("submit",r.value)},P=o=>{g.value&&!o.target.closest(".relative")&&(g.value=!1)},I=o=>{o.key==="Escape"&&m.show&&D("close")};return re(()=>{document.addEventListener("click",P),document.addEventListener("keydown",I)}),le(()=>{document.removeEventListener("click",P),document.removeEventListener("keydown",I)}),(o,t)=>(d(),K(ce,{to:"body"},[ne(ue,{name:"modal"},{default:ie(()=>{var a;return[n.show?(d(),p("div",{key:0,class:"fixed inset-0 z-50 overflow-y-auto",onClick:t[13]||(t[13]=G(e=>o.$emit("close"),["self"]))},[t[27]||(t[27]=s("div",{class:"fixed inset-0 bg-black bg-opacity-50 transition-opacity"},null,-1)),s("div",ye,[s("div",{class:"relative bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full mx-auto",onClick:t[12]||(t[12]=G(()=>{},["stop"]))},[s("div",xe,[s("h3",_e,C((a=n.task)!=null&&a.id?"Редактировать задачу":"Новая задача"),1),s("button",{onClick:t[0]||(t[0]=e=>o.$emit("close")),class:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"},[...t[14]||(t[14]=[s("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),s("form",{onSubmit:G(R,["prevent"]),class:"p-6 space-y-4"},[s("div",be,[s("label",he,[b(s("input",{type:"checkbox","onUpdate:modelValue":t[1]||(t[1]=e=>V.value=e),onChange:N,class:"w-5 h-5 text-primary-600 border-gray-300 dark:border-gray-600 rounded focus:ring-primary-500 dark:bg-gray-700"},null,544),[[de,V.value]]),s("span",Se,C(V.value?"Задача выполнена":"Отметить как выполненную"),1)])]),s("div",null,[t[15]||(t[15]=s("label",{for:"title",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Название задачи * ",-1)),b(s("input",{id:"title","onUpdate:modelValue":t[2]||(t[2]=e=>r.value.title=e),type:"text",required:"",class:te(["input",{"opacity-60":V.value}]),placeholder:"Введите название задачи"},null,2),[[L,r.value.title]])]),s("div",null,[t[16]||(t[16]=s("label",{for:"description",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Описание ",-1)),b(s("textarea",{id:"description","onUpdate:modelValue":t[3]||(t[3]=e=>r.value.description=e),rows:"3",class:"input",placeholder:"Добавьте описание"},null,512),[[L,r.value.description]])]),s("div",je,[s("div",null,[t[18]||(t[18]=s("label",{for:"status",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Статус ",-1)),s("div",Ce,[s("button",{type:"button",onClick:t[4]||(t[4]=e=>g.value=!g.value),class:"input w-full flex items-center justify-between"},[s("span",Me,[(d(),K(oe(T[r.value.status].icon),{class:"w-5 h-5 text-gray-500 dark:text-gray-400"})),s("span",null,C(T[r.value.status].label),1)]),t[17]||(t[17]=s("svg",{class:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})],-1))]),g.value?(d(),p("div",$e,[(d(),p(J,null,Q(T,(e,l)=>s("button",{key:l,type:"button",onClick:i=>E(l),class:te(["w-full flex items-center space-x-2 px-3 py-2 text-sm hover:bg-gray-50 dark:hover:bg-gray-600 first:rounded-t-lg last:rounded-b-lg transition-colors",r.value.status===l?"bg-primary-50 dark:bg-primary-900/30 text-primary-700 dark:text-primary-400":"text-gray-700 dark:text-gray-300"])},[(d(),K(oe(e.icon),{class:"w-5 h-5"})),s("span",null,C(e.label),1)],10,Te)),64))])):z("",!0)])]),s("div",null,[t[20]||(t[20]=s("label",{for:"priority",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Приоритет ",-1)),b(s("select",{id:"priority","onUpdate:modelValue":t[5]||(t[5]=e=>r.value.priority=e),class:"input"},[...t[19]||(t[19]=[s("option",{value:"low"},"Низкий",-1),s("option",{value:"medium"},"Средний",-1),s("option",{value:"high"},"Высокий",-1),s("option",{value:"urgent"},"Срочный",-1)])],512),[[X,r.value.priority]])])]),s("div",Ve,[s("div",null,[t[21]||(t[21]=s("label",{for:"due_date",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Срок выполнения ",-1)),b(s("input",{id:"due_date","onUpdate:modelValue":t[6]||(t[6]=e=>r.value.due_date=e),type:"date",class:"input"},null,512),[[L,r.value.due_date]])]),s("div",null,[t[22]||(t[22]=s("label",{for:"estimated_time",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Время начала ",-1)),b(s("input",{id:"estimated_time","onUpdate:modelValue":t[7]||(t[7]=e=>r.value.estimated_time=e),type:"time",class:"input",placeholder:"12:30"},null,512),[[L,r.value.estimated_time]])])]),s("div",null,[t[23]||(t[23]=s("label",{for:"end_time",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Время окончания ",-1)),b(s("input",{id:"end_time","onUpdate:modelValue":t[8]||(t[8]=e=>r.value.end_time=e),type:"time",class:"input",placeholder:"13:30"},null,512),[[L,r.value.end_time]])]),H.value.length>1?(d(),p("div",Ie,[t[24]||(t[24]=s("label",{for:"workspace_id",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Рабочее пространство ",-1)),b(s("select",{id:"workspace_id","onUpdate:modelValue":t[9]||(t[9]=e=>r.value.workspace_id=e),class:"input"},[(d(!0),p(J,null,Q(H.value,e=>(d(),p("option",{key:e.id,value:e.id},C(e.name),9,Ze))),128))],512),[[X,r.value.workspace_id]])])):z("",!0),s("div",null,[t[26]||(t[26]=s("label",{for:"project_id",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Проект ",-1)),b(s("select",{id:"project_id","onUpdate:modelValue":t[10]||(t[10]=e=>r.value.project_id=e),class:"input"},[t[25]||(t[25]=s("option",{value:null},"Без проекта",-1)),(d(!0),p(J,null,Q(U.value,e=>(d(),p("option",{key:e.id,value:e.id},C(e.name),9,Ae))),128))],512),[[X,r.value.project_id]])]),_.value?(d(),p("div",De,C(_.value),1)):z("",!0),s("div",Be,[s("button",{type:"button",onClick:t[11]||(t[11]=e=>o.$emit("close")),class:"btn btn-secondary"}," Отмена "),s("button",{type:"submit",disabled:S.value,class:"btn btn-primary"},C(S.value?"Сохранение...":"Сохранить"),9,He)])],32)])])])):z("",!0)]}),_:1})]))}},ze=me(Oe,[["__scopeId","data-v-57fc4056"]]);export{ze as T,Pe as a,we as b,Y as c,ke as d,ge as e,fe as r,We as u};
