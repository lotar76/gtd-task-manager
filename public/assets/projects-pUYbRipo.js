import{H as W,r as f,k as i,I as u}from"./index-BbattLL9.js";import{u as S}from"./workspace-B3uH3rGF.js";const F=W("projects",()=>{const r=f([]),c=f(!1),d=S(),o=i(()=>{var e;return(e=d.currentWorkspace)==null?void 0:e.id}),p=i(()=>d.selectedWorkspaces.map(e=>e.id)),k=async(e=!1)=>{if(o.value){c.value=!0;try{const a=e?{include_archived:!0}:{},t=await u.get(`/v1/workspaces/${o.value}/projects`,{params:a});r.value=t.data.data||t.data||[]}finally{c.value=!1}}},w=async(e=!1)=>{if(p.value.length!==0){c.value=!0;try{const a=e?{include_archived:!0}:{},t=await Promise.all(p.value.map(s=>u.get(`/v1/workspaces/${s}/projects`,{params:a}).then(n=>({workspace_id:s,projects:n.data.data||n.data||[]})).catch(n=>(console.error(`Error fetching projects for workspace ${s}:`,n),{workspace_id:s,projects:[]}))));r.value=t.flatMap(s=>s.projects)}finally{c.value=!1}}},h=async e=>{if(o.value){c.value=!0;try{const a=await u.get(`/v1/workspaces/${o.value}/projects/${e}`);return a.data.data||a.data}finally{c.value=!1}}},j=async e=>{const a=e.workspace_id||o.value;if(!a)return;const t=await u.post(`/v1/workspaces/${a}/projects`,e),s=t.data.data||t.data;return r.value.push(s),s},l=async(e,a)=>{const t=a.workspace_id||o.value;if(!t)return;const s=await u.put(`/v1/workspaces/${t}/projects/${e}`,a),n=s.data.data||s.data,v=r.value.findIndex(g=>g.id===e);return v!==-1&&(r.value[v]=n),n},y=async e=>{const a=r.value.find(t=>t.id===e);return await l(e,{workspace_id:a==null?void 0:a.workspace_id,status:"archived"})},P=async e=>{const a=r.value.find(t=>t.id===e);return await l(e,{workspace_id:a==null?void 0:a.workspace_id,status:"active"})},_=async e=>{const a=r.value.find(s=>s.id===e),t=(a==null?void 0:a.workspace_id)||o.value;t&&(await u.delete(`/v1/workspaces/${t}/projects/${e}`),r.value=r.value.filter(s=>s.id!==e))},m=i(()=>r.value.filter(e=>e.status==="active"||!e.status)),$=i(()=>r.value.filter(e=>e.status==="archived"));return{projects:r,activeProjects:m,archivedProjects:$,loading:c,fetchProjects:k,fetchProjectsForSelectedWorkspaces:w,fetchProject:h,createProject:j,updateProject:l,archiveProject:y,unarchiveProject:P,deleteProject:_}});export{F as u};
