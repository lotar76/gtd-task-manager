import{i as N,r as p,s as q,c as l,o as s,a as t,w as L,b as x,d as h,v as S,t as g,u as O,k as M,D as W,e as A,F as G,z as H,p as j,J as V,G as T,j as J,B as K,l as B}from"./index-C1HwSpFq.js";import{u as E}from"./workspace-Dx7mGwO1.js";const P={class:"space-y-6"},Q={class:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6"},X={key:0,class:"text-red-600 dark:text-red-400 text-sm bg-red-50 dark:bg-red-900/20 p-3 rounded-lg"},Y={key:1,class:"text-green-600 dark:text-green-400 text-sm bg-green-50 dark:bg-green-900/20 p-3 rounded-lg"},Z=["disabled"],ee={class:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-red-200 dark:border-red-900/50 p-6"},te=["disabled"],re={__name:"GeneralTab",props:{workspace:{type:Object,required:!0}},setup(w){const b=w,v=N(),f=E(),u=p({name:"",description:""}),d=p(!1),o=p(!1),m=p(""),_=p("");q(()=>{b.workspace&&(u.value.name=b.workspace.name||"",u.value.description=b.workspace.description||"")});const i=async()=>{var r,e;m.value="",_.value="",d.value=!0;try{await f.updateWorkspace(b.workspace.id,u.value),_.value="Настройки сохранены"}catch(a){m.value=((e=(r=a.response)==null?void 0:r.data)==null?void 0:e.message)||"Ошибка сохранения"}finally{d.value=!1}},k=async()=>{var r,e,a;if(confirm(`Удалить пространство "${(r=b.workspace)==null?void 0:r.name}"? Это действие необратимо.`)){o.value=!0;try{await f.deleteWorkspace(b.workspace.id),v.push("/")}catch($){m.value=((a=(e=$.response)==null?void 0:e.data)==null?void 0:a.message)||"Ошибка удаления"}finally{o.value=!1}}};return(r,e)=>(s(),l("div",P,[t("div",Q,[e[4]||(e[4]=t("h2",{class:"text-lg font-semibold text-gray-900 dark:text-white mb-4"},"Основные",-1)),t("form",{onSubmit:L(i,["prevent"]),class:"space-y-4"},[t("div",null,[e[2]||(e[2]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"}," Название ",-1)),h(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>u.value.name=a),type:"text",class:"input",required:""},null,512),[[S,u.value.name]])]),t("div",null,[e[3]||(e[3]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"}," Описание ",-1)),h(t("textarea",{"onUpdate:modelValue":e[1]||(e[1]=a=>u.value.description=a),class:"input",rows:"3",placeholder:"Описание пространства (необязательно)"},null,512),[[S,u.value.description]])]),m.value?(s(),l("div",X,g(m.value),1)):x("",!0),_.value?(s(),l("div",Y,g(_.value),1)):x("",!0),t("button",{type:"submit",disabled:d.value,class:"btn btn-primary"},g(d.value?"Сохранение...":"Сохранить"),9,Z)],32)]),t("div",ee,[e[5]||(e[5]=t("h2",{class:"text-lg font-semibold text-red-600 dark:text-red-400 mb-2"},"Опасная зона",-1)),e[6]||(e[6]=t("p",{class:"text-sm text-gray-600 dark:text-gray-400 mb-4"}," Удаление пространства приведёт к удалению всех задач, проектов и данных. ",-1)),t("button",{onClick:k,disabled:o.value,class:"px-4 py-2 text-sm font-medium text-red-600 dark:text-red-400 bg-red-50 dark:bg-red-900/20 border border-red-300 dark:border-red-800 rounded-lg hover:bg-red-100 dark:hover:bg-red-900/40 transition-colors"},g(o.value?"Удаление...":"Удалить пространство"),9,te)])]))}},ae={class:"space-y-6"},se={key:0,class:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6"},oe=["disabled"],ne={key:0,class:"mt-3 text-red-600 dark:text-red-400 text-sm bg-red-50 dark:bg-red-900/20 p-3 rounded-lg"},le={key:1,class:"mt-3 text-green-600 dark:text-green-400 text-sm bg-green-50 dark:bg-green-900/20 p-3 rounded-lg"},de={class:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700"},ie={class:"p-4 border-b border-gray-200 dark:border-gray-700"},ue={class:"text-lg font-semibold text-gray-900 dark:text-white"},me={key:0,class:"text-sm font-normal text-gray-500 dark:text-gray-400"},ce={key:0,class:"p-8 text-center"},be={key:1,class:"divide-y divide-gray-200 dark:divide-gray-700"},ge={class:"flex items-center space-x-3"},ve={class:"w-10 h-10 rounded-full bg-primary-100 dark:bg-primary-900/30 flex items-center justify-center text-sm font-medium text-primary-700 dark:text-primary-400"},pe={class:"text-sm font-medium text-gray-900 dark:text-white"},ye={class:"text-xs text-gray-500 dark:text-gray-400"},xe={class:"flex items-center space-x-3"},ke=["onClick"],fe={__name:"MembersTab",props:{workspace:{type:Object,required:!0},canManage:{type:Boolean,default:!1}},setup(w){const b=w,v=E(),f=O(),u=p([]),d=p(!0),o=p(!1),m=p(""),_=p(""),i=p({email:"",role:"member"}),k=M(()=>{var c;return(c=f.user)==null?void 0:c.id}),r=async()=>{var c;if((c=b.workspace)!=null&&c.id){d.value=!0;try{const n=await v.fetchMembers(b.workspace.id);u.value=n||[]}catch(n){console.error("Error loading members:",n)}finally{d.value=!1}}},e=async()=>{var c,n;m.value="",_.value="",o.value=!0;try{await v.addMember(b.workspace.id,i.value),_.value=`${i.value.email} добавлен`,i.value.email="",await r()}catch(y){m.value=((n=(c=y.response)==null?void 0:c.data)==null?void 0:n.message)||"Ошибка добавления"}finally{o.value=!1}},a=async c=>{if(confirm(`Удалить ${c.name} из пространства?`))try{await v.removeMember(b.workspace.id,c.id),await r()}catch(n){console.error("Error removing member:",n)}},$=c=>c?c.split(" ").map(n=>n[0]).join("").toUpperCase().slice(0,2):"?",C=c=>{const n={owner:"bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400",admin:"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400",member:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400",viewer:"bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-400"};return n[c]||n.member},U=c=>({owner:"Владелец",admin:"Админ",member:"Участник",viewer:"Просмотр"})[c]||c;return q(r),(c,n)=>(s(),l("div",ae,[w.canManage?(s(),l("div",se,[n[3]||(n[3]=t("h2",{class:"text-lg font-semibold text-gray-900 dark:text-white mb-4"},"Добавить участника",-1)),t("form",{onSubmit:L(e,["prevent"]),class:"flex flex-col sm:flex-row gap-3"},[h(t("input",{"onUpdate:modelValue":n[0]||(n[0]=y=>i.value.email=y),type:"email",class:"input flex-1",placeholder:"Email пользователя",required:""},null,512),[[S,i.value.email]]),h(t("select",{"onUpdate:modelValue":n[1]||(n[1]=y=>i.value.role=y),class:"input w-full sm:w-36"},[...n[2]||(n[2]=[t("option",{value:"viewer"},"Просмотр",-1),t("option",{value:"member"},"Участник",-1),t("option",{value:"admin"},"Админ",-1)])],512),[[W,i.value.role]]),t("button",{type:"submit",disabled:o.value,class:"btn btn-primary whitespace-nowrap"},g(o.value?"...":"Добавить"),9,oe)],32),m.value?(s(),l("div",ne,g(m.value),1)):x("",!0),_.value?(s(),l("div",le,g(_.value),1)):x("",!0)])):x("",!0),t("div",de,[t("div",ie,[t("h2",ue,[n[4]||(n[4]=A(" Участники ",-1)),u.value.length>0?(s(),l("span",me," ("+g(u.value.length)+") ",1)):x("",!0)])]),d.value?(s(),l("div",ce,[...n[5]||(n[5]=[t("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"},null,-1)])])):(s(),l("div",be,[(s(!0),l(G,null,H(u.value,y=>{var R,D,I,F,z;return s(),l("div",{key:y.id,class:"flex items-center justify-between p-4"},[t("div",ge,[t("div",ve,g($(y.name)),1),t("div",null,[t("p",pe,g(y.name),1),t("p",ye,g(y.email),1)])]),t("div",xe,[t("span",{class:j(["px-2 py-1 text-xs font-medium rounded-full",C(((R=y.pivot)==null?void 0:R.role)||(y.id===((D=w.workspace)==null?void 0:D.owner_id)?"owner":"member"))])},g(U(((I=y.pivot)==null?void 0:I.role)||(y.id===((F=w.workspace)==null?void 0:F.owner_id)?"owner":"member"))),3),w.canManage&&y.id!==((z=w.workspace)==null?void 0:z.owner_id)&&y.id!==k.value?(s(),l("button",{key:0,onClick:Pe=>a(y),class:"text-gray-400 hover:text-red-500 dark:hover:text-red-400 transition-colors",title:"Удалить"},[...n[6]||(n[6]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,ke)):x("",!0)])])}),128))]))])]))}},_e={key:0,class:"text-center py-12"},we={key:1,class:"space-y-6"},he={class:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6"},$e={key:0,class:"text-center py-6"},Me={key:1,class:"text-center py-6"},Se={key:0,class:"text-sm text-gray-400 dark:text-gray-500 mb-4"},Ce=["disabled"],Te={key:2},je={class:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 mb-4"},Ue=["href"],Ve={key:3},Be={class:"flex items-center space-x-2 mb-6"},qe={key:0,class:"text-sm text-gray-400 dark:text-gray-500"},Le={class:"flex items-center justify-between"},Ee={key:0,class:"ml-4"},Re={class:"flex items-center justify-between"},De={key:1,class:"ml-4"},Ie={class:"flex items-center justify-between"},Fe={key:2,class:"text-red-600 dark:text-red-400 text-sm bg-red-50 dark:bg-red-900/20 p-3 rounded-lg"},ze={key:3,class:"text-green-600 dark:text-green-400 text-sm bg-green-50 dark:bg-green-900/20 p-3 rounded-lg"},Ne={class:"flex items-center justify-between pt-4 border-t border-gray-200 dark:border-gray-700"},Oe=["disabled"],We={__name:"TelegramTab",props:{workspace:{type:Object,required:!0}},setup(w){const b=p(!0),v=p(!1),f=p(""),u=p(""),d=p({bot_configured:!1,bot_username:null,subscribed:!1,is_active:!1,connect_url:null}),o=p({morning_digest_time:"08:00",reminder_minutes_before:30,notify_overdue:!0,notify_morning_digest:!0,notify_reminders:!0}),m=async()=>{b.value=!0;try{const e=(await T.get("/v1/telegram/subscription")).data;d.value={bot_configured:e.bot_configured,bot_username:e.bot_username||null,subscribed:e.subscribed||!1,is_active:e.is_active||!1,connect_url:e.connect_url||null},e.subscribed&&e.is_active&&(o.value={morning_digest_time:e.morning_digest_time||"08:00",reminder_minutes_before:e.reminder_minutes_before||30,notify_overdue:e.notify_overdue??!0,notify_morning_digest:e.notify_morning_digest??!0,notify_reminders:e.notify_reminders??!0})}catch(r){console.error("Error loading telegram data:",r)}finally{b.value=!1}},_=async()=>{var r,e;f.value="",v.value=!0;try{await T.post("/v1/telegram/subscription"),await m()}catch(a){f.value=((e=(r=a.response)==null?void 0:r.data)==null?void 0:e.message)||"Ошибка подписки"}finally{v.value=!1}},i=async()=>{var r,e;f.value="",u.value="",v.value=!0;try{await T.put("/v1/telegram/subscription",o.value),u.value="Настройки сохранены",setTimeout(()=>{u.value=""},3e3)}catch(a){f.value=((e=(r=a.response)==null?void 0:r.data)==null?void 0:e.message)||"Ошибка сохранения"}finally{v.value=!1}},k=async()=>{var r,e;if(confirm("Отключить Telegram уведомления?")){v.value=!0;try{await T.delete("/v1/telegram/subscription"),await m()}catch(a){f.value=((e=(r=a.response)==null?void 0:r.data)==null?void 0:e.message)||"Ошибка отключения"}finally{v.value=!1}}};return q(m),(r,e)=>(s(),l("div",null,[b.value?(s(),l("div",_e,[...e[5]||(e[5]=[t("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"},null,-1)])])):(s(),l("div",we,[t("div",he,[e[19]||(e[19]=t("h2",{class:"text-lg font-semibold text-gray-900 dark:text-white mb-4"},"Telegram уведомления",-1)),d.value.bot_configured?d.value.subscribed?d.value.is_active?(s(),l("div",Ve,[t("div",Be,[e[11]||(e[11]=t("span",{class:"w-2 h-2 bg-green-500 rounded-full"},null,-1)),e[12]||(e[12]=t("span",{class:"text-sm text-green-700 dark:text-green-400 font-medium"},"Telegram подключен",-1)),d.value.bot_username?(s(),l("span",qe," (@"+g(d.value.bot_username)+") ",1)):x("",!0)]),e[18]||(e[18]=t("p",{class:"text-xs text-gray-500 dark:text-gray-400 mb-4"}," Уведомления приходят по задачам из всех ваших пространств. ",-1)),t("form",{onSubmit:L(i,["prevent"]),class:"space-y-4"},[t("div",Le,[e[13]||(e[13]=t("div",null,[t("label",{class:"text-sm font-medium text-gray-900 dark:text-white"},"Утренний дайджест"),t("p",{class:"text-xs text-gray-500 dark:text-gray-400"},"Список задач на сегодня")],-1)),h(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>o.value.notify_morning_digest=a),type:"checkbox",class:"h-4 w-4 rounded border-gray-300 text-primary-600 focus:ring-primary-500"},null,512),[[V,o.value.notify_morning_digest]])]),o.value.notify_morning_digest?(s(),l("div",Ee,[e[14]||(e[14]=t("label",{class:"block text-sm text-gray-600 dark:text-gray-400 mb-1"},"Время отправки",-1)),h(t("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>o.value.morning_digest_time=a),type:"time",class:"input w-32"},null,512),[[S,o.value.morning_digest_time]])])):x("",!0),t("div",Re,[e[15]||(e[15]=t("div",null,[t("label",{class:"text-sm font-medium text-gray-900 dark:text-white"},"Напоминания"),t("p",{class:"text-xs text-gray-500 dark:text-gray-400"},"Перед началом задачи")],-1)),h(t("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>o.value.notify_reminders=a),type:"checkbox",class:"h-4 w-4 rounded border-gray-300 text-primary-600 focus:ring-primary-500"},null,512),[[V,o.value.notify_reminders]])]),o.value.notify_reminders?(s(),l("div",De,[e[16]||(e[16]=t("label",{class:"block text-sm text-gray-600 dark:text-gray-400 mb-1"},"За сколько минут",-1)),h(t("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>o.value.reminder_minutes_before=a),type:"number",min:"5",max:"120",class:"input w-32"},null,512),[[S,o.value.reminder_minutes_before,void 0,{number:!0}]])])):x("",!0),t("div",Ie,[e[17]||(e[17]=t("div",null,[t("label",{class:"text-sm font-medium text-gray-900 dark:text-white"},"Просроченные задачи"),t("p",{class:"text-xs text-gray-500 dark:text-gray-400"},"Ежедневно в 09:00")],-1)),h(t("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>o.value.notify_overdue=a),type:"checkbox",class:"h-4 w-4 rounded border-gray-300 text-primary-600 focus:ring-primary-500"},null,512),[[V,o.value.notify_overdue]])]),f.value?(s(),l("div",Fe,g(f.value),1)):x("",!0),u.value?(s(),l("div",ze,g(u.value),1)):x("",!0),t("div",Ne,[t("button",{type:"submit",disabled:v.value,class:"btn btn-primary"},g(v.value?"Сохранение...":"Сохранить"),9,Oe),t("button",{type:"button",onClick:k,class:"text-sm text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300"}," Отключить Telegram ")])],32)])):(s(),l("div",Te,[t("div",je,[e[9]||(e[9]=t("p",{class:"text-sm font-medium text-blue-800 dark:text-blue-300 mb-2"}," Перейдите по ссылке и нажмите Start: ",-1)),t("a",{href:d.value.connect_url,target:"_blank",class:"inline-flex items-center space-x-2 text-primary-600 dark:text-primary-400 hover:underline font-medium"},[...e[8]||(e[8]=[t("span",null,"Открыть в Telegram",-1),t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})],-1)])],8,Ue)]),e[10]||(e[10]=t("p",{class:"text-sm text-gray-500 dark:text-gray-400"}," После нажатия Start в Telegram, обновите эту страницу. ",-1)),t("div",{class:"mt-4 flex space-x-3"},[t("button",{onClick:m,class:"btn btn-secondary text-sm"}," Обновить статус "),t("button",{onClick:k,class:"text-sm text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300"}," Отменить ")])])):(s(),l("div",Me,[e[7]||(e[7]=t("p",{class:"text-gray-600 dark:text-gray-400 mb-2"}," Подключите Telegram для получения уведомлений и управления задачами из всех ваших пространств. ",-1)),d.value.bot_username?(s(),l("p",Se," Бот: @"+g(d.value.bot_username),1)):x("",!0),t("button",{onClick:_,disabled:v.value,class:"btn btn-primary"},g(v.value?"Подключение...":"Подключить Telegram"),9,Ce)])):(s(),l("div",$e,[...e[6]||(e[6]=[t("svg",{class:"w-12 h-12 mx-auto mb-3 text-gray-300 dark:text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})],-1),t("p",{class:"text-gray-500 dark:text-gray-400"}," Telegram бот не настроен. ",-1),t("p",{class:"text-sm text-gray-400 dark:text-gray-500 mt-1"}," Обратитесь к администратору. ",-1)])]))])]))]))}},Ae={class:"p-4 lg:p-8"},Ge={class:"max-w-3xl mx-auto"},He={class:"text-2xl font-bold text-gray-900 dark:text-white mb-6"},Je={class:"border-b border-gray-200 dark:border-gray-700 mb-6"},Ke={class:"flex space-x-6"},Ye={__name:"Settings",setup(w){const b=J(),v=N(),f=E(),u=O(),d=M(()=>parseInt(b.params.id)),o=M(()=>f.workspaces.find(k=>k.id===d.value)),m=M(()=>{var a,$,C;const k=o.value,r=(a=u.user)==null?void 0:a.id;if(!k||!r)return!1;if(k.owner_id===r)return!0;const e=($=k.members)==null?void 0:$.find(U=>U.id===r);return((C=e==null?void 0:e.pivot)==null?void 0:C.role)==="admin"}),_=M(()=>m.value?"general":"members"),i=p(b.query.tab||_.value);return K(i,k=>{v.replace({query:{...b.query,tab:k}})}),(k,r)=>{var e;return s(),l("div",Ae,[t("div",Ge,[t("h1",He," Настройки — "+g(((e=o.value)==null?void 0:e.name)||"Пространство"),1),t("div",Je,[t("nav",Ke,[m.value?(s(),l("button",{key:0,onClick:r[0]||(r[0]=a=>i.value="general"),class:j(["pb-3 text-sm font-medium border-b-2 transition-colors",i.value==="general"?"border-primary-600 text-primary-600 dark:text-primary-400 dark:border-primary-400":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"])}," Общие ",2)):x("",!0),t("button",{onClick:r[1]||(r[1]=a=>i.value="members"),class:j(["pb-3 text-sm font-medium border-b-2 transition-colors",i.value==="members"?"border-primary-600 text-primary-600 dark:text-primary-400 dark:border-primary-400":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"])}," Участники ",2),t("button",{onClick:r[2]||(r[2]=a=>i.value="telegram"),class:j(["pb-3 text-sm font-medium border-b-2 transition-colors",i.value==="telegram"?"border-primary-600 text-primary-600 dark:text-primary-400 dark:border-primary-400":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"])}," Telegram ",2)])]),i.value==="general"&&m.value?(s(),B(re,{key:d.value,workspace:o.value},null,8,["workspace"])):x("",!0),i.value==="members"?(s(),B(fe,{key:d.value,workspace:o.value,"can-manage":m.value},null,8,["workspace","can-manage"])):x("",!0),i.value==="telegram"?(s(),B(We,{key:d.value,workspace:o.value},null,8,["workspace"])):x("",!0)])])}}};export{Ye as default};
