import{E as xe,G as me,r as R,z as K,H as le,k as P,c as s,o as r,a as e,b as w,t as d,e as ae,F as _,C as z,p as V,D as T,f as U,l as G,s as ie,x as ce,m as ye,y as Q}from"./index-B82rmahJ.js";import{u as ue}from"./workspace-BO8xjwdg.js";import{d as re,T as be}from"./TaskView-C-gJAHla.js";import{u as ve,T as fe}from"./TaskModal-D2gjI_Nz.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./projects-CPq-QPWC.js";import"./lifeSpheres-DpNFy_cY.js";import"./goals-CAy1_JiH.js";const ge=xe("dashboard",()=>{const t=me({}),f=R(localStorage.getItem("dashboardPeriod")||"day"),c=ue(),u=a=>{t[a]||(t[a]={lifeMirror:null,aiMessage:null,loading:!1,aiLoading:!1,aiSilentLoading:!1})},o=async a=>{if(a){u(a),t[a].loading=!0;try{const x=await le.get("/v1/dashboard/life-mirror",{params:{workspace_id:a,period:f.value}});t[a].lifeMirror=x.data}catch(x){console.error(`Failed to fetch life mirror for ws ${a}:`,x),t[a].lifeMirror=null}finally{t[a].loading=!1}}},h=async(a,x=!1,i=!1)=>{if(a){u(a),i?t[a].aiSilentLoading=!0:t[a].aiLoading=!0;try{const k=await le.get("/v1/dashboard/ai-message",{params:{workspace_id:a,period:f.value,force:x?1:0}});t[a].aiMessage=k.data}catch(k){console.error(`Failed to fetch AI message for ws ${a}:`,k),t[a].aiMessage=null}finally{i?t[a].aiSilentLoading=!1:t[a].aiLoading=!1}}},p=async(a,x=!1)=>{await o(a),await h(a,!1,x)},$=async()=>{const a=c.selectedWorkspaces;a.length&&await Promise.all(a.map(x=>p(x.id)))},l=a=>{f.value=a,localStorage.setItem("dashboardPeriod",a),$()};return K(()=>c.selectedWorkspaces.map(a=>a.id).join(","),()=>{$()}),{dataByWorkspace:t,selectedPeriod:f,fetchLifeMirror:o,fetchAiMessage:h,fetchForWorkspace:p,fetchAllWorkspaces:$,setPeriod:l}}),pe={class:"mb-6"},ke={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-4"},_e={class:"flex flex-col gap-1"},we={class:"text-sm text-gray-500 dark:text-gray-400"},$e={key:0,class:"flex-1 max-w-2xl mx-4"},Me={class:"text-gray-600 dark:text-gray-400 text-sm italic leading-relaxed"},Ce={class:"text-gray-400 dark:text-gray-500 not-italic ml-1"},Se={class:"inline-flex rounded-xl bg-gray-100 dark:bg-gray-800 p-1",role:"group"},ze=["onClick"],Te={__name:"DashboardHeader",props:{period:{type:String,required:!0},bibleVerse:{type:Object,default:null}},emits:["change-period"],setup(t){re.locale("ru");const f=t,c=[{value:"day",label:"День"},{value:"week",label:"Неделя"},{value:"month",label:"Месяц"},{value:"year",label:"Год"}],u=P(()=>{const o=re();switch(f.period){case"day":return o.format("D MMMM YYYY, dddd");case"week":{const h=o.startOf("week"),p=o.endOf("week");return`${h.format("D MMM")} — ${p.format("D MMM YYYY")}`}case"month":return o.format("MMMM YYYY");case"year":return o.format("YYYY год");default:return o.format("D MMMM YYYY")}});return(o,h)=>(r(),s("div",pe,[e("div",ke,[e("div",_e,[h[0]||(h[0]=e("h1",{class:"text-xl sm:text-2xl font-bold text-gray-900 dark:text-white"}," Зеркало жизни ",-1)),e("p",we,d(u.value),1)]),t.bibleVerse?(r(),s("div",$e,[e("p",Me,[ae(" «"+d(t.bibleVerse.text)+"» ",1),e("span",Ce,"— "+d(t.bibleVerse.ref),1)])])):w("",!0),e("div",Se,[(r(),s(_,null,z(c,p=>e("button",{key:p.value,onClick:$=>o.$emit("change-period",p.value),type:"button",class:V(["px-3 py-1.5 text-xs sm:text-sm font-medium rounded-lg transition-all duration-200",[t.period===p.value?"bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"]])},d(p.label),11,ze)),64))])])]))}},Le={class:"relative overflow-hidden rounded-2xl shadow-sm border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 h-full flex flex-col"},Pe={key:0,class:"absolute top-2 right-2 z-10"},Ae={class:"p-4 sm:p-6 flex-1 flex flex-col"},We={class:"max-h-[40vh] overflow-y-auto sm:max-h-none sm:overflow-visible scrollbar-thin flex-1 flex flex-col justify-center"},je={key:0,class:"animate-pulse space-y-3"},Ye={key:1},De={class:"text-sm sm:text-base text-gray-900 dark:text-gray-100 leading-relaxed"},Be={key:0,class:"mt-2 sm:mt-3 bg-gray-50 dark:bg-gray-700/50 rounded-xl p-3 sm:p-4"},Ee={class:"text-gray-700 dark:text-gray-300 text-xs sm:text-sm leading-relaxed"},He={key:1,class:"mt-3 sm:mt-4 flex flex-wrap gap-1.5 sm:gap-2"},Ve={key:2,class:"mt-3 flex items-center gap-2"},Ne={class:"text-xs text-gray-400 dark:text-gray-500"},Oe={key:2,class:"flex flex-col items-center justify-center flex-1 text-center"},ne={__name:"AiHeroBanner",props:{message:{type:Object,default:null},loading:{type:Boolean,default:!1},silentLoading:{type:Boolean,default:!1}},emits:["refresh","analyze"],setup(t){const f=c=>{const u=new Date(c),h=new Date-u,p=Math.floor(h/6e4);if(p<60)return`${p} мин. назад`;const $=Math.floor(p/60);if($<24)return`${$} ч. назад`;const l=u.getDate().toString().padStart(2,"0"),a=(u.getMonth()+1).toString().padStart(2,"0"),x=u.getHours().toString().padStart(2,"0"),i=u.getMinutes().toString().padStart(2,"0");return`${l}.${a} в ${x}:${i}`};return(c,u)=>{var o;return r(),s("div",null,[e("div",Le,[t.silentLoading?(r(),s("div",Pe,[...u[2]||(u[2]=[e("svg",{class:"animate-spin h-4 w-4 text-primary-600 dark:text-primary-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)])])):w("",!0),e("div",Ae,[e("div",We,[t.loading?(r(),s("div",je,[...u[3]||(u[3]=[e("div",{class:"h-5 bg-gray-200 dark:bg-gray-700 rounded w-2/3"},null,-1),e("div",{class:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-full"},null,-1),e("div",{class:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-4/5"},null,-1)])])):t.message?(r(),s("div",Ye,[e("p",De,d(t.message.main_message),1),t.message.followup_message?(r(),s("div",Be,[e("p",Ee,d(t.message.followup_message),1)])):w("",!0),(o=t.message.recommendations)!=null&&o.length?(r(),s("div",He,[(r(!0),s(_,null,z(t.message.recommendations,(h,p)=>(r(),s("div",{key:p,class:"bg-gray-100 dark:bg-gray-700 rounded-lg px-2.5 py-1.5 sm:px-3 sm:py-2 text-xs sm:text-sm text-gray-700 dark:text-gray-300 flex items-center gap-1.5 sm:gap-2"},[e("div",{class:"w-2 h-2 rounded-full flex-shrink-0",style:T({backgroundColor:h.sphere_color||"#9ca3af"})},null,4),e("span",null,d(h.action),1)]))),128))])):w("",!0),t.message.generated_at?(r(),s("div",Ve,[e("p",Ne," Анализ от "+d(f(t.message.generated_at)),1),t.message.is_stale?(r(),s("button",{key:0,onClick:u[0]||(u[0]=h=>c.$emit("refresh")),class:"text-xs font-medium text-green-600 dark:text-green-500 hover:text-green-700 dark:hover:text-green-400 transition-colors cursor-pointer"}," • нужно проанализировать состояние ")):w("",!0)])):w("",!0)])):(r(),s("div",Oe,[u[4]||(u[4]=e("p",{class:"text-gray-500 dark:text-gray-400 text-xs sm:text-sm mb-4"},"Получи AI анализ баланса жизненных сфер",-1)),e("button",{onClick:u[1]||(u[1]=h=>c.$emit("analyze")),class:"px-4 py-2 bg-primary-600 hover:bg-primary-700 text-white rounded-lg text-sm font-medium transition-colors mx-auto"}," Проанализировать ")]))])])])])}}},Re={class:"flex flex-col items-center"},Fe=["width","height","viewBox"],Ie=["cx","cy","r"],qe=["cx","cy","r"],Ge=["x1","y1","x2","y2"],Ue=["d","fill-opacity","stroke","stroke-width"],Ze=["d","fill","fill-opacity","stroke","stroke-width"],Je=["d","stroke"],Ke=["d","stroke"],Qe=["x","y","fill","text-anchor"],Xe=["x","dy"],et=["d","onMouseenter"],tt=["cx","cy","r"],rt=["x","y"],at=["x","y"],J=50,de=.03,X={__name:"BalanceWheel",props:{spheres:{type:Array,default:()=>[]},balanceIndex:{type:Number,default:0},size:{type:Number,default:280},hoveredSphereName:{type:String,default:null}},emits:["sphere-hover","sphere-leave"],setup(t,{emit:f}){const c=t,u=f,o=R(null),h=R([]),p=v=>{var y;o.value=v,u("sphere-hover",(y=c.spheres[v])==null?void 0:y.name)},$=()=>{o.value=null,u("sphere-leave")};K([()=>c.spheres,()=>c.hoveredSphereName,o],()=>{h.value=c.spheres.map((v,y)=>{const g=o.value===y,b=c.hoveredSphereName&&c.hoveredSphereName===v.name;return g||b})},{immediate:!0,deep:!0});const l=P(()=>c.size/2),a=P(()=>c.size/2-50),x=P(()=>a.value*.35),i=P(()=>c.spheres.length),k=P(()=>i.value>0?2*Math.PI/i.value:0),m=[25,50,75],n=v=>k.value*v-Math.PI/2+de/2,L=v=>k.value*(v+1)-Math.PI/2-de/2,q=v=>(n(v)+L(v))/2,N=(v,y)=>l.value+y*Math.cos(v),M=(v,y)=>l.value+y*Math.sin(v),W=P(()=>c.spheres.length?Math.max(...c.spheres.map(v=>v.total||0),1):1),Y=(v,y,g)=>{if(i.value===0||g<=y)return"";const b=n(v),j=L(v),I=j-b>Math.PI?1:0;return[`M ${N(b,y)} ${M(b,y)}`,`L ${N(b,g)} ${M(b,g)}`,`A ${g} ${g} 0 ${I} 1 ${N(j,g)} ${M(j,g)}`,`L ${N(j,y)} ${M(j,y)}`,`A ${y} ${y} 0 ${I} 0 ${N(b,y)} ${M(b,y)}`,"Z"].join(" ")},B=(v,y)=>{if(i.value===0)return"";const g=n(v),b=L(v),j=b-g>Math.PI?1:0;return`M ${N(g,y)} ${M(g,y)} A ${y} ${y} 0 ${j} 1 ${N(b,y)} ${M(b,y)}`},E=v=>{if(!v.total||v.total===0)return x.value;const y=v.total/W.value;return x.value+(a.value-x.value)*Math.max(y,.1)},C=v=>{if(!v.done||v.done===0)return x.value;const y=v.done/W.value;return x.value+(a.value-x.value)*Math.max(y,.08)},A=v=>B(v,a.value),D=(v,y)=>{const g=E(y);return g<=x.value?"":Y(v,x.value,g)},H=(v,y)=>{const g=C(y);return g<=x.value?"":Y(v,x.value,g)},O=(v,y)=>{const g=C(y);return g<=x.value?"":B(v,g)},S=P(()=>i.value<=1?[]:c.spheres.map((v,y)=>{const g=k.value*y-Math.PI/2;return{x1:N(g,x.value),y1:M(g,x.value),x2:N(g,a.value),y2:M(g,a.value)}})),F=P(()=>c.spheres.map((v,y)=>{const g=a.value+18;return{x:N(q(y),g),y:M(q(y),g)}})),he=v=>{const y=q(v)*180/Math.PI;return y>-60&&y<60?"start":y>120||y<-120?"end":"middle"},se=v=>{if(!v)return[""];const y=11;if(v.length<=y)return[v];const g=v.split(" ");if(g.length===1)return[v.substring(0,y-1)+"…"];const b=[];let j="";for(let I=0;I<g.length;I++){const Z=g[I],oe=j?j+" "+Z:Z;oe.length<=y?j=oe:j?(b.push(j),j=Z):(b.push(Z.substring(0,y-1)+"…"),j="")}return j&&b.push(j),b.length>2?(b[1]=b[1].substring(0,y-1)+"…",b.slice(0,2)):b};return(v,y)=>(r(),s("div",Re,[(r(),s("svg",{width:t.size,height:t.size,viewBox:`${-J} ${-J} ${t.size+J*2} ${t.size+J*2}`},[(r(),s(_,null,z(m,g=>e("circle",{key:"grid-"+g,cx:l.value,cy:l.value,r:x.value+(a.value-x.value)*g/100,fill:"none",stroke:"currentColor",class:"text-gray-200 dark:text-gray-700","stroke-width":"0.5","stroke-dasharray":"3 3"},null,8,Ie)),64)),e("circle",{cx:l.value,cy:l.value,r:a.value,fill:"none",stroke:"currentColor",class:"text-gray-300 dark:text-gray-600","stroke-width":"1.5"},null,8,qe),(r(!0),s(_,null,z(S.value,(g,b)=>(r(),s("line",{key:"div-"+b,x1:g.x1,y1:g.y1,x2:g.x2,y2:g.y2,stroke:"currentColor",class:"text-gray-300 dark:text-gray-600","stroke-width":"1"},null,8,Ge))),128)),(r(!0),s(_,null,z(t.spheres,(g,b)=>(r(),s("path",{key:"total-"+b,d:D(b,g),fill:"currentColor",class:"text-gray-400 dark:text-gray-500 transition-all duration-300 ease-out","fill-opacity":h.value[b]?"0.5":"0.25",stroke:h.value[b]?g.color:"none","stroke-width":h.value[b]?"2":"0"},null,8,Ue))),128)),(r(!0),s(_,null,z(t.spheres,(g,b)=>(r(),s("path",{key:"done-"+b,d:H(b,g),fill:g.color||"#888","fill-opacity":h.value[b]?"1":"0.45",stroke:h.value[b]?g.color:"none","stroke-width":h.value[b]?"3":"0",class:"transition-all duration-300 ease-out"},null,8,Ze))),128)),(r(!0),s(_,null,z(t.spheres,(g,b)=>(r(),s("path",{key:"edge-"+b,d:O(b,g),fill:"none",stroke:g.color||"#888","stroke-width":"2.5","stroke-linecap":"round",class:"transition-all duration-700 ease-out"},null,8,Je))),128)),(r(!0),s(_,null,z(t.spheres,(g,b)=>(r(),s("path",{key:"arc-"+b,d:A(b),fill:"none",stroke:g.color||"#888","stroke-width":"3","stroke-opacity":"0.25","stroke-linecap":"round"},null,8,Ke))),128)),(r(!0),s(_,null,z(t.spheres,(g,b)=>(r(),s("text",{key:"label-"+b,x:F.value[b].x,y:F.value[b].y,fill:g.color||"#888","font-size":"13","font-weight":"600","text-anchor":he(b)},[(r(!0),s(_,null,z(se(g.name),(j,I)=>(r(),s("tspan",{key:I,x:F.value[b].x,dy:I===0?se(g.name).length>1?"-0.3em":"0.3em":"1.1em"},d(j),9,Xe))),128))],8,Qe))),128)),(r(!0),s(_,null,z(t.spheres,(g,b)=>(r(),s("path",{key:"hover-"+b,d:Y(b,x.value,a.value),fill:"transparent",class:"cursor-pointer",onMouseenter:j=>p(b),onMouseleave:$},null,40,et))),128)),e("circle",{cx:l.value,cy:l.value,r:x.value,class:"fill-white dark:fill-gray-900 stroke-gray-300 dark:stroke-gray-600","stroke-width":"1"},null,8,tt),e("text",{x:l.value,y:l.value-8,"text-anchor":"middle","dominant-baseline":"central","font-size":"28","font-weight":"bold",class:"fill-gray-900 dark:fill-white"},d(t.balanceIndex),9,rt),e("text",{x:l.value,y:l.value+14,"text-anchor":"middle","dominant-baseline":"central","font-size":"10",class:"fill-gray-400 dark:fill-gray-500"}," баланс ",8,at)],8,Fe))]))}},st={class:"flex items-center justify-between mb-2"},ot={class:"flex items-center gap-2"},lt={class:"text-sm font-semibold text-gray-900 dark:text-white"},nt={key:0,class:"text-xs px-2 py-0.5 rounded-full bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-400"},dt={class:"flex items-center gap-3"},it={class:"flex-1 bg-gray-200 dark:bg-gray-700 rounded-full h-2 overflow-hidden"},ct={class:"text-xs font-medium text-gray-600 dark:text-gray-400 tabular-nums whitespace-nowrap"},ut={__name:"SphereCard",props:{sphere:{type:Object,required:!0}},setup(t){const f=t,c=R(!1),u=P(()=>f.sphere.tasks_total?Math.round(f.sphere.tasks_done/f.sphere.tasks_total*100):0);return(o,h)=>(r(),s("div",{class:"rounded-xl border bg-white/80 dark:bg-gray-800/80 border-gray-200 dark:border-gray-700 p-4 transition-all duration-200 cursor-pointer group border-l-4",style:T({borderLeftColor:t.sphere.color,boxShadow:c.value?`0 0 20px ${t.sphere.color}30`:"none"}),onMouseenter:h[0]||(h[0]=p=>c.value=!0),onMouseleave:h[1]||(h[1]=p=>c.value=!1)},[e("div",st,[e("div",ot,[e("div",{class:"w-3 h-3 rounded-full",style:T({backgroundColor:t.sphere.color})},null,4),e("span",lt,d(t.sphere.name),1)]),t.sphere.days_without_attention!==null&&t.sphere.days_without_attention>0?(r(),s("span",nt,d(t.sphere.days_without_attention)+" дн. ",1)):w("",!0)]),e("div",dt,[e("div",it,[e("div",{class:"h-full rounded-full transition-all duration-500",style:T({width:u.value+"%",backgroundColor:t.sphere.color})},null,4)]),e("span",ct,d(t.sphere.tasks_done)+"/"+d(t.sphere.tasks_total),1)])],36))}},gt={class:"bg-white/80 dark:bg-gray-800/80 rounded-xl border border-dashed border-gray-300 dark:border-gray-600 p-4"},ht={class:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-2"},xt={class:"min-w-0 flex-1"},mt={class:"text-xs font-medium text-gray-700 dark:text-gray-300 truncate"},yt={class:"text-[10px] text-gray-400 dark:text-gray-500"},bt={__name:"MissingSpheres",props:{spheres:{type:Array,default:()=>[]}},setup(t){const f=c=>{const u=Math.abs(c)%100,o=u%10;return u>10&&u<20?"дней":o===1?"день":o>=2&&o<=4?"дня":"дней"};return(c,u)=>(r(),s("div",gt,[u[0]||(u[0]=e("h3",{class:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3"}," Сферы без внимания ",-1)),e("div",ht,[(r(!0),s(_,null,z(t.spheres,o=>(r(),s("div",{key:o.id,class:"flex items-center gap-2 rounded-lg border border-dashed p-3 transition-colors hover:bg-gray-50 dark:hover:bg-gray-700/50",style:T({borderColor:o.color+"40",backgroundColor:o.color+"08"})},[e("div",{class:"w-2.5 h-2.5 rounded-full flex-shrink-0",style:T({backgroundColor:o.color})},null,4),e("div",xt,[e("p",mt,d(o.name),1),e("p",yt,d(o.days_without_attention!==null?`${o.days_without_attention} ${f(o.days_without_attention)} без внимания`:"Нет задач"),1)])],4))),128))])]))}},vt={key:0,class:"h-full"},ft={class:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4 h-full flex flex-col"},pt={key:0,class:"space-y-1.5 flex-1 overflow-y-auto"},kt=["onClick","onMouseenter"],_t={class:"flex-1 min-w-0"},wt={class:"flex items-center gap-1.5"},$t={key:0,class:"w-2.5 h-2.5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Mt={key:0,class:"px-1.5 py-0.5 text-[10px] font-medium rounded-full flex-shrink-0 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400"},Ct={key:0},St={key:1},zt={key:2},Tt={key:1,class:"flex-1 flex flex-col items-center justify-center py-8 text-center"},Lt={key:2,class:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700"},Pt={class:"flex items-center justify-between text-xs"},At={class:"text-gray-600 dark:text-gray-400"},Wt={class:"font-semibold text-gray-900 dark:text-white"},jt={class:"font-semibold text-emerald-600 dark:text-emerald-400"},ee={__name:"PeriodDayView",props:{data:{type:Object,default:null},hoveredSphereName:{type:String,default:null},workspaceId:{type:Number,required:!0}},emits:["task-hover","task-leave"],setup(t,{emit:f}){const c=ve(),u=ge(),o=t,h=f,p=R(!1),$=R(!1),l=R(null),a=R(null),x=R(""),i=P(()=>{var A;if(!((A=o.data)!=null&&A.spheres))return[];const C=[];return o.data.spheres.forEach(D=>{var H;(H=D.tasks)!=null&&H.length&&D.tasks.forEach(O=>{C.push({...O,sphere_name:D.name,sphere_color:D.color})})}),C.sort((D,H)=>D.completed_at&&!H.completed_at?1:!D.completed_at&&H.completed_at?-1:D.sphere_name.localeCompare(H.sphere_name))}),k=C=>o.hoveredSphereName&&C.sphere_name===o.hoveredSphereName,m=C=>{h("task-hover",C)},n=()=>{h("task-leave")},L=C=>{a.value=C,$.value=!0},q=()=>{const C=new Date().toISOString().split("T")[0];l.value={workspace_id:o.workspaceId,due_date:C,status:"today",estimated_time:null,end_time:null},p.value=!0},N=()=>{p.value=!1,l.value=null,x.value=""},M=()=>{l.value=a.value,$.value=!1,p.value=!0},W=async C=>{try{await c.completeTask(C.id),await u.fetchLifeMirror(o.workspaceId),await u.fetchAiMessage(o.workspaceId,!1)}catch(A){console.error("Error completing task:",A)}},Y=async C=>{try{await c.uncompleteTask(C.id),await u.fetchLifeMirror(o.workspaceId),await u.fetchAiMessage(o.workspaceId,!1)}catch(A){console.error("Error uncompleting task:",A)}},B=C=>C?/^\d{2}:\d{2}$/.test(C)?C:C.substring(0,5):"",E=async C=>{var A,D,H;x.value="";try{(A=l.value)!=null&&A.id?await c.updateTask(l.value.id,C):await c.createTask(C),N(),await u.fetchLifeMirror(o.workspaceId),await u.fetchAiMessage(o.workspaceId,!1)}catch(O){console.error("Error saving task:",O),x.value=((H=(D=O.response)==null?void 0:D.data)==null?void 0:H.message)||O.message||"Ошибка при сохранении задачи"}};return(C,A)=>{var D,H,O;return t.data?(r(),s("div",vt,[e("div",ft,[e("div",{class:"flex items-center justify-between mb-3"},[A[2]||(A[2]=e("h3",{class:"text-sm font-semibold text-gray-900 dark:text-white"},"Задачи на сегодня",-1)),e("button",{onClick:q,class:"flex items-center gap-1.5 px-3 py-1.5 bg-primary-600 hover:bg-primary-700 text-white text-xs font-medium rounded-lg transition-colors duration-200"},[...A[1]||(A[1]=[e("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),e("span",{class:"hidden sm:inline"},"Добавить",-1)])])]),i.value.length?(r(),s("div",pt,[(r(!0),s(_,null,z(i.value,S=>(r(),s("div",{key:S.id,onClick:F=>L(S),onMouseenter:F=>m(S.sphere_name),onMouseleave:n,class:V(["group flex items-start gap-2 p-2 rounded-lg border transition-all duration-200 cursor-pointer",S.completed_at?"bg-gray-50/50 dark:bg-gray-700/30 border-gray-200 dark:border-gray-600":"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"]),style:T(k(S)?{borderLeftColor:S.sphere_color}:{})},[e("div",{class:"w-0.5 h-full rounded-full flex-shrink-0 mt-0.5 transition-all duration-200",style:T({backgroundColor:S.sphere_color})},null,4),e("div",_t,[e("div",wt,[e("div",{class:V(["w-4 h-4 rounded border flex items-center justify-center flex-shrink-0 transition-colors",S.completed_at?"bg-emerald-500 border-emerald-500":"border-gray-300 dark:border-gray-600 group-hover:border-gray-400 dark:group-hover:border-gray-500"])},[S.completed_at?(r(),s("svg",$t,[...A[3]||(A[3]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"3",d:"M5 13l4 4L19 7"},null,-1)])])):w("",!0)],2),e("span",{class:V(["text-xs font-medium truncate flex-1",S.completed_at?"line-through text-gray-400 dark:text-gray-500":"text-gray-900 dark:text-white"])},d(S.title),3),S.estimated_time||S.end_time?(r(),s("span",Mt,[S.estimated_time&&S.end_time?(r(),s("span",Ct,d(B(S.estimated_time))+"-"+d(B(S.end_time)),1)):S.estimated_time?(r(),s("span",St,d(B(S.estimated_time)),1)):S.end_time?(r(),s("span",zt," до "+d(B(S.end_time)),1)):w("",!0)])):w("",!0),e("span",{class:"px-1.5 py-0.5 text-[10px] font-medium rounded-full flex-shrink-0 transition-all duration-200",style:T({backgroundColor:S.sphere_color+"20",color:S.sphere_color})},d(S.sphere_name),5)])])],46,kt))),128))])):(r(),s("div",Tt,[...A[4]||(A[4]=[e("svg",{class:"w-8 h-8 text-gray-300 dark:text-gray-600 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})],-1),e("p",{class:"text-xs font-medium text-gray-600 dark:text-gray-400"},"Нет задач на сегодня",-1)])])),i.value.length?(r(),s("div",Lt,[e("div",Pt,[e("span",At,[e("span",Wt,d(((D=t.data.summary)==null?void 0:D.completed)||0),1),ae("/"+d(((H=t.data.summary)==null?void 0:H.total_tasks)||0),1)]),e("span",jt,d(((O=t.data.summary)==null?void 0:O.completion_rate)||0)+"%",1)])])):w("",!0)]),U(be,{show:$.value,task:a.value,onClose:A[0]||(A[0]=S=>{$.value=!1,a.value=null}),onEnterEdit:M,onCompleteTask:W,onUncompleteTask:Y},null,8,["show","task"]),p.value?(r(),G(fe,{key:0,show:p.value,task:l.value,"server-error":x.value,onClose:N,onSubmit:E},null,8,["show","task","server-error"])):w("",!0)])):w("",!0)}}},Yt={class:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4"},Dt={class:"relative"},Bt={class:"flex border-b border-gray-200 dark:border-gray-700"},Et={class:"relative mt-2",style:{"min-height":"120px"}},Ht={class:"absolute inset-0 flex"},Vt=["onClick"],Nt={class:"text-[10px] text-gray-500 dark:text-gray-400"},Ot={key:0,class:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700"},Rt={class:"flex flex-wrap gap-2"},Ft=["onClick"],te=24,It={__name:"DayTimeline",props:{tasks:{type:Array,default:()=>[]}},emits:["task-click"],setup(t){const f=t,c=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23],u=P(()=>f.tasks.filter(i=>i.estimated_time&&i.end_time)),o=P(()=>f.tasks.filter(i=>!i.estimated_time||!i.end_time)),h=P(()=>{const i=new Date,k=i.getHours()*60+i.getMinutes(),m=te*60;return k/m*100}),p=i=>`${i}:00`,$=i=>i?/^\d{2}:\d{2}$/.test(i)?i:i.substring(0,5):"",l=i=>{const[k,m]=$(i).split(":").map(Number);return k*60+m},a=i=>{const k=l(i.estimated_time),m=te*60;return k/m*100},x=i=>{const k=l(i.estimated_time);let n=l(i.end_time)-k;n<0&&(n+=24*60);const L=te*60;return n/L*100};return(i,k)=>(r(),s("div",Yt,[k[1]||(k[1]=e("h3",{class:"text-sm font-semibold text-gray-900 dark:text-white mb-4"},"Расписание на день",-1)),e("div",Dt,[e("div",Bt,[(r(),s(_,null,z(c,m=>e("div",{key:m,class:"flex-1 text-center pb-2 text-xs text-gray-500 dark:text-gray-400"},d(p(m)),1)),64))]),e("div",Et,[e("div",Ht,[(r(),s(_,null,z(c,m=>e("div",{key:"grid-"+m,class:"flex-1 border-r border-gray-100 dark:border-gray-700"})),64))]),e("div",{class:"absolute top-0 bottom-0 w-px bg-red-500 z-20",style:T({left:h.value+"%"})},null,4),(r(!0),s(_,null,z(u.value,m=>(r(),s("div",{key:m.id,class:V(["absolute h-16 rounded-lg border-2 p-2 cursor-pointer transition-all hover:shadow-md hover:z-10",{"opacity-60":m.completed_at}]),style:T({left:a(m)+"%",width:x(m)+"%",backgroundColor:m.completed_at?"#e5e7eb":m.sphere_color+"20",borderColor:m.completed_at?"#9ca3af":m.sphere_color,top:"0px"}),onClick:n=>i.$emit("task-click",m)},[e("div",{class:"text-xs font-medium truncate",style:T({color:m.completed_at?"#6b7280":m.sphere_color})},d(m.title),5),e("div",Nt,d($(m.estimated_time))+" - "+d($(m.end_time)),1)],14,Vt))),128))]),o.value.length?(r(),s("div",Ot,[k[0]||(k[0]=e("div",{class:"text-xs text-gray-500 dark:text-gray-400 mb-2"},"Без времени:",-1)),e("div",Rt,[(r(!0),s(_,null,z(o.value,m=>(r(),s("div",{key:m.id,class:V(["px-3 py-1.5 rounded-lg text-xs font-medium cursor-pointer hover:shadow-sm transition-all",{"opacity-60":m.completed_at}]),style:T({backgroundColor:m.completed_at?"#e5e7eb":m.sphere_color+"20",color:m.completed_at?"#6b7280":m.sphere_color}),onClick:n=>i.$emit("task-click",m)},d(m.title),15,Ft))),128))])])):w("",!0)])]))}},qt={key:0,class:"space-y-6"},Gt={class:"grid grid-cols-2 sm:grid-cols-3 gap-3"},Ut={class:"bg-white dark:bg-gray-800 rounded-xl p-4 border border-gray-200 dark:border-gray-700"},Zt={class:"text-2xl font-bold text-gray-900 dark:text-white mt-1"},Jt={class:"bg-white dark:bg-gray-800 rounded-xl p-4 border border-gray-200 dark:border-gray-700"},Kt={class:"text-2xl font-bold text-emerald-600 dark:text-emerald-400 mt-1"},Qt={class:"bg-white dark:bg-gray-800 rounded-xl p-4 border border-gray-200 dark:border-gray-700"},Xt={class:"text-2xl font-bold text-gray-900 dark:text-white mt-1"},er={class:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4"},tr={class:"flex items-end gap-1 h-32"},rr={class:"w-full flex flex-col-reverse gap-px",style:{height:"100px"}},ar=["title"],sr={key:0,class:"w-full h-full flex items-center justify-center"},or={class:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4"},lr={class:"space-y-2"},nr={class:"w-20 text-xs text-gray-600 dark:text-gray-400 truncate"},dr={class:"flex-1 bg-gray-200 dark:bg-gray-700 rounded-full h-2 overflow-hidden"},ir={class:"text-xs font-medium text-gray-500 dark:text-gray-400 tabular-nums w-12 text-right"},cr={key:0,class:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4"},ur={class:"space-y-2"},gr={class:"flex-1 min-w-0"},hr={class:"flex items-center gap-2"},xr={class:"text-sm text-gray-900 dark:text-white truncate"},mr={key:0,class:"text-[10px] text-amber-600 dark:text-amber-400 bg-amber-50 dark:bg-amber-900/20 px-1.5 py-0.5 rounded"},yr={class:"flex items-center gap-2"},br={class:"w-16 bg-gray-200 dark:bg-gray-700 rounded-full h-1.5 overflow-hidden"},vr={class:"text-xs text-gray-500 dark:text-gray-400 tabular-nums"},fr={__name:"PeriodWeekView",props:{data:{type:Object,default:null}},setup(t){const f=t,c=P(()=>{var a;if(!((a=f.data)!=null&&a.daily_breakdown))return 1;let l=0;for(const x of f.data.daily_breakdown){const i=Object.values(x.by_sphere).reduce((k,m)=>k+m,0);i>l&&(l=i)}return Math.max(l,1)}),u=l=>Math.max(l/c.value*80,4),o=P(()=>{var a;const l={};if((a=f.data)!=null&&a.attention_distribution)for(const x of f.data.attention_distribution)l[x.sphere_id]=x;return l}),h=l=>{var a;return((a=o.value[l])==null?void 0:a.color)||"#888"},p=l=>{var a;return((a=o.value[l])==null?void 0:a.name)||""},$=l=>re().format("YYYY-MM-DD")===l;return(l,a)=>{var x,i,k,m;return t.data?(r(),s("div",qt,[e("div",Gt,[e("div",Ut,[a[0]||(a[0]=e("p",{class:"text-xs text-gray-500 dark:text-gray-400"},"Всего задач",-1)),e("p",Zt,d(((x=t.data.summary)==null?void 0:x.total_tasks)||0),1)]),e("div",Jt,[a[1]||(a[1]=e("p",{class:"text-xs text-gray-500 dark:text-gray-400"},"Выполнено",-1)),e("p",Kt,d(((i=t.data.summary)==null?void 0:i.completed)||0),1)]),e("div",Qt,[a[2]||(a[2]=e("p",{class:"text-xs text-gray-500 dark:text-gray-400"},"Выполнение",-1)),e("p",Xt,d(((k=t.data.summary)==null?void 0:k.completion_rate)||0)+"%",1)])]),e("div",er,[a[4]||(a[4]=e("h3",{class:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4"},"Рентген недели",-1)),e("div",tr,[(r(!0),s(_,null,z(t.data.daily_breakdown,n=>(r(),s("div",{key:n.date,class:"flex-1 flex flex-col items-center gap-1"},[e("div",rr,[(r(!0),s(_,null,z(Object.keys(n.by_sphere),L=>(r(),s("div",{key:L,class:"w-full rounded-sm transition-all duration-300",style:T({height:u(n.by_sphere[L])+"px",backgroundColor:h(parseInt(L)),opacity:.8}),title:`${p(parseInt(L))}: ${n.by_sphere[L]}`},null,12,ar))),128)),Object.keys(n.by_sphere).length?w("",!0):(r(),s("div",sr,[...a[3]||(a[3]=[e("span",{class:"text-gray-300 dark:text-gray-600 text-xs"},"—",-1)])]))]),e("span",{class:V(["text-xs mt-1",$(n.date)?"font-bold text-primary-600 dark:text-primary-400":"text-gray-500 dark:text-gray-400"])},d(n.day),3)]))),128))])]),e("div",or,[a[5]||(a[5]=e("h3",{class:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3"},"Распределение внимания",-1)),e("div",lr,[(r(!0),s(_,null,z(t.data.attention_distribution,n=>(r(),s("div",{key:n.sphere_id,class:"flex items-center gap-3"},[e("div",nr,d(n.name),1),e("div",dr,[e("div",{class:"h-full rounded-full transition-all duration-500",style:T({width:n.percentage+"%",backgroundColor:n.color,opacity:n.percentage>0?1:.3})},null,4)]),e("span",ir,d(n.percentage)+"% ",1)]))),128))])]),(m=t.data.projects)!=null&&m.length?(r(),s("div",cr,[a[6]||(a[6]=e("h3",{class:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3"},"Потоки",-1)),e("div",ur,[(r(!0),s(_,null,z(t.data.projects,n=>(r(),s("div",{key:n.id,class:V(["flex items-center gap-3 p-2 rounded-lg",n.is_stalled?"opacity-50":""])},[e("div",{class:"w-2 h-2 rounded-full flex-shrink-0",style:T({backgroundColor:n.sphere_color||n.color})},null,4),e("div",gr,[e("div",hr,[e("span",xr,d(n.name),1),n.is_stalled?(r(),s("span",mr,"стоит")):w("",!0)])]),e("div",yr,[e("div",br,[e("div",{class:"h-full rounded-full",style:T({width:(n.total>0?n.done/n.total*100:0)+"%",backgroundColor:n.sphere_color||n.color})},null,4)]),e("span",vr,d(n.done)+"/"+d(n.total),1)])],2))),128))])])):w("",!0)])):w("",!0)}}},pr={key:0,class:"space-y-6"},kr={class:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4"},_r={class:"flex items-center gap-4 mb-2"},wr={class:"flex-1 bg-gray-200 dark:bg-gray-700 rounded-full h-3 overflow-hidden"},$r={class:"text-sm font-bold text-gray-900 dark:text-white tabular-nums"},Mr={class:"text-xs text-gray-500 dark:text-gray-400"},Cr={class:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4"},Sr={class:"space-y-2"},zr={class:"w-20 text-xs text-gray-600 dark:text-gray-400 truncate"},Tr={class:"text-xs text-gray-400 dark:text-gray-500 tabular-nums w-8 text-right"},Lr={class:"flex-1 bg-gray-200 dark:bg-gray-700 rounded-full h-2 overflow-hidden relative"},Pr={key:0,class:"bg-white dark:bg-gray-800 rounded-xl border border-amber-200 dark:border-amber-900/50 p-4"},Ar={class:"space-y-2"},Wr={class:"text-sm text-gray-700 dark:text-gray-300 flex-1"},jr={class:"text-xs text-amber-600 dark:text-amber-400"},Yr={key:1,class:"bg-white dark:bg-gray-800 rounded-xl border border-rose-200 dark:border-rose-900/50 p-4"},Dr={class:"space-y-3"},Br={class:"flex items-center justify-between mb-2"},Er={class:"flex items-center gap-2"},Hr={class:"text-sm font-medium text-gray-900 dark:text-white"},Vr={class:"text-xs text-gray-500 dark:text-gray-400"},Nr={class:"flex items-center gap-3"},Or={class:"flex-1 bg-gray-200 dark:bg-gray-700 rounded-full h-2 overflow-hidden relative"},Rr=["title"],Fr={class:"text-xs text-rose-600 dark:text-rose-400 tabular-nums"},Ir={class:"text-gray-400"},qr={__name:"PeriodMonthView",props:{data:{type:Object,default:null}},setup(t){const f=t,c=P(()=>{var o;return((o=f.data)==null?void 0:o.planned_vs_done)||{planned:0,done:0,days_passed:0,days_remaining:0,required_daily_pace:0,completion_rate:0}}),u=o=>o>2?"text-emerald-600 dark:text-emerald-400":o<-2?"text-rose-600 dark:text-rose-400":"text-gray-400 dark:text-gray-500";return(o,h)=>{var p,$;return t.data?(r(),s("div",pr,[e("div",kr,[h[0]||(h[0]=e("h3",{class:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3"},"Нагрузка",-1)),e("div",_r,[e("div",wr,[e("div",{class:"h-full rounded-full bg-primary-500 transition-all duration-500",style:T({width:(c.value.completion_rate||0)+"%"})},null,4)]),e("span",$r,d(c.value.done)+"/"+d(c.value.planned),1)]),e("p",Mr," Осталось "+d(c.value.planned-c.value.done)+" задач, ~"+d(c.value.required_daily_pace)+"/день чтобы успеть. Прошло "+d(c.value.days_passed)+" дн., осталось "+d(c.value.days_remaining)+" дн. ",1)]),e("div",Cr,[h[1]||(h[1]=e("h3",{class:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3"},"Было → Стало",-1)),e("div",Sr,[(r(!0),s(_,null,z(t.data.sphere_trends,l=>(r(),s("div",{key:l.sphere_id,class:"flex items-center gap-3"},[e("div",zr,d(l.name),1),e("span",Tr,d(l.prev_pct)+"%",1),e("div",Lr,[e("div",{class:"absolute top-0 h-full w-0.5 bg-gray-400 dark:bg-gray-500 z-10",style:T({left:l.prev_pct+"%"})},null,4),e("div",{class:"h-full rounded-full transition-all duration-500",style:T({width:l.current_pct+"%",backgroundColor:l.color})},null,4)]),e("span",{class:"text-xs font-medium tabular-nums w-8 text-right",style:T({color:l.color})},d(l.current_pct)+"% ",5),e("span",{class:V(["text-xs tabular-nums w-10 text-right",u(l.change)])},d(l.change>0?"+":"")+d(l.change)+"% ",3)]))),128))])]),(p=t.data.stalled_projects)!=null&&p.length?(r(),s("div",Pr,[h[2]||(h[2]=e("h3",{class:"text-sm font-semibold text-amber-600 dark:text-amber-400 mb-3"},"Застрявшие потоки",-1)),e("div",Ar,[(r(!0),s(_,null,z(t.data.stalled_projects,l=>(r(),s("div",{key:l.id,class:"flex items-center gap-3 p-2 rounded-lg bg-amber-50/50 dark:bg-amber-900/10"},[e("div",{class:"w-2 h-2 rounded-full",style:T({backgroundColor:l.sphere_color||"#F59E0B"})},null,4),e("span",Wr,d(l.name),1),e("span",jr,d(l.days_since_activity)+" дн. без движения ",1)]))),128))])])):w("",!0),($=t.data.goals_at_risk)!=null&&$.length?(r(),s("div",Yr,[h[3]||(h[3]=e("h3",{class:"text-sm font-semibold text-rose-600 dark:text-rose-400 mb-3"},"Цели под угрозой",-1)),e("div",Dr,[(r(!0),s(_,null,z(t.data.goals_at_risk,l=>(r(),s("div",{key:l.id,class:"p-3 rounded-lg bg-rose-50/50 dark:bg-rose-900/10"},[e("div",Br,[e("div",Er,[e("div",{class:"w-2 h-2 rounded-full",style:T({backgroundColor:l.sphere_color})},null,4),e("span",Hr,d(l.name),1)]),e("span",Vr,d(l.days_left)+" дн. до дедлайна",1)]),e("div",Nr,[e("div",Or,[e("div",{class:"absolute top-0 h-full w-0.5 bg-rose-400 z-10",style:T({left:l.expected_progress+"%"}),title:"Ожидаемый: "+l.expected_progress+"%"},null,12,Rr),e("div",{class:"h-full rounded-full bg-rose-500",style:T({width:l.progress+"%"})},null,4)]),e("span",Fr,[ae(d(l.progress)+"% ",1),e("span",Ir,"из "+d(l.expected_progress)+"%",1)])])]))),128))])])):w("",!0)])):w("",!0)}}},Gr={key:0,class:"space-y-6"},Ur={class:"grid grid-cols-2 sm:grid-cols-5 gap-3"},Zr={class:"bg-white dark:bg-gray-800 rounded-xl p-4 border border-gray-200 dark:border-gray-700"},Jr={class:"text-2xl font-bold text-gray-900 dark:text-white mt-1"},Kr={class:"bg-white dark:bg-gray-800 rounded-xl p-4 border border-emerald-200 dark:border-emerald-900/50"},Qr={class:"text-2xl font-bold text-emerald-600 dark:text-emerald-400 mt-1"},Xr={class:"bg-white dark:bg-gray-800 rounded-xl p-4 border border-blue-200 dark:border-blue-900/50"},ea={class:"text-2xl font-bold text-blue-600 dark:text-blue-400 mt-1"},ta={class:"bg-white dark:bg-gray-800 rounded-xl p-4 border border-amber-200 dark:border-amber-900/50"},ra={class:"text-2xl font-bold text-amber-600 dark:text-amber-400 mt-1"},aa={class:"bg-white dark:bg-gray-800 rounded-xl p-4 border border-gray-200 dark:border-gray-700"},sa={class:"text-2xl font-bold text-gray-400 mt-1"},oa={key:0,class:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4"},la={class:"flex items-end gap-2 h-32"},na={class:"text-xs font-bold text-gray-900 dark:text-white tabular-nums"},da={class:"text-[10px] text-gray-500 dark:text-gray-400 truncate max-w-full"},ia={key:1,class:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4"},ca={class:"space-y-3"},ua={class:"flex-1 min-w-0"},ga={class:"flex items-center gap-2 mb-1"},ha={class:"text-sm text-gray-900 dark:text-white truncate"},xa={class:"flex items-center gap-2"},ma={class:"flex-1 bg-gray-200 dark:bg-gray-700 rounded-full h-1.5 overflow-hidden"},ya={class:"text-xs text-gray-500 dark:text-gray-400 tabular-nums"},ba={key:0,class:"text-xs text-gray-400 tabular-nums whitespace-nowrap"},va={key:2,class:"bg-white dark:bg-gray-800 rounded-xl border border-emerald-200 dark:border-emerald-900/50 p-4"},fa={class:"space-y-2"},pa={class:"text-sm text-gray-900 dark:text-white flex-1"},ka={class:"text-xs text-gray-400"},_a={key:3,class:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4"},wa={class:"space-y-2"},$a={class:"text-xs text-gray-600 dark:text-gray-400 w-20 truncate"},Ma={class:"text-[10px] text-gray-400 dark:text-gray-500"},Ca={__name:"PeriodYearView",props:{data:{type:Object,default:null}},setup(t){const f=t,c=P(()=>{var l;return((l=f.data)==null?void 0:l.goals_summary)||{total:0,achieved:0,on_track:0,behind:0,at_risk:0,stalled:0}}),u={ahead:"bg-emerald-100 dark:bg-emerald-900/20 text-emerald-700 dark:text-emerald-400",on_track:"bg-blue-100 dark:bg-blue-900/20 text-blue-700 dark:text-blue-400",behind:"bg-amber-100 dark:bg-amber-900/20 text-amber-700 dark:text-amber-400",at_risk:"bg-rose-100 dark:bg-rose-900/20 text-rose-700 dark:text-rose-400",stalled:"bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-400"},o={ahead:"опережает",on_track:"по графику",behind:"отстаёт",at_risk:"под угрозой",stalled:"стоит"},h={growing:"↑",falling:"↓",stable:"→",stalled:"·"},p={growing:"растёт",falling:"падает",stable:"стабильно",stalled:"стоит"},$=l=>l==="growing"?"text-emerald-600 dark:text-emerald-400":l==="falling"?"text-rose-600 dark:text-rose-400":"text-gray-400 dark:text-gray-500";return(l,a)=>{var x,i,k,m;return t.data?(r(),s("div",Gr,[e("div",Ur,[e("div",Zr,[a[0]||(a[0]=e("p",{class:"text-xs text-gray-500 dark:text-gray-400"},"Всего целей",-1)),e("p",Jr,d(c.value.total),1)]),e("div",Kr,[a[1]||(a[1]=e("p",{class:"text-xs text-emerald-600 dark:text-emerald-400"},"Достигнуто",-1)),e("p",Qr,d(c.value.achieved),1)]),e("div",Xr,[a[2]||(a[2]=e("p",{class:"text-xs text-blue-600 dark:text-blue-400"},"По графику",-1)),e("p",ea,d(c.value.on_track),1)]),e("div",ta,[a[3]||(a[3]=e("p",{class:"text-xs text-amber-600 dark:text-amber-400"},"Отстают",-1)),e("p",ra,d(c.value.behind+c.value.at_risk),1)]),e("div",aa,[a[4]||(a[4]=e("p",{class:"text-xs text-gray-400"},"Стоят",-1)),e("p",sa,d(c.value.stalled),1)])]),(x=t.data.monthly_balance_trend)!=null&&x.length?(r(),s("div",oa,[a[5]||(a[5]=e("h3",{class:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4"},"Индекс баланса — тренд",-1)),e("div",la,[(r(!0),s(_,null,z(t.data.monthly_balance_trend,n=>(r(),s("div",{key:n.month_key,class:"flex-1 flex flex-col items-center gap-1"},[e("span",na,d(n.balance_index),1),e("div",{class:V(["w-full rounded-t transition-all duration-300",n.is_current?"bg-primary-500 shadow-lg shadow-primary-500/30":"bg-gray-300 dark:bg-gray-600"]),style:T({height:Math.max(n.balance_index,5)+"%"})},null,6),e("span",da,d(n.month.split(" ")[0]),1)]))),128))])])):w("",!0),(i=t.data.active_goals)!=null&&i.length?(r(),s("div",ia,[a[6]||(a[6]=e("h3",{class:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3"},"Цели года",-1)),e("div",ca,[(r(!0),s(_,null,z(t.data.active_goals,n=>(r(),s("div",{key:n.id,class:V(["flex items-center gap-3 p-2 rounded-lg",n.status==="stalled"?"opacity-50":""])},[e("div",{class:"w-2.5 h-2.5 rounded-full flex-shrink-0",style:T({backgroundColor:n.sphere_color})},null,4),e("div",ua,[e("div",ga,[e("span",ha,d(n.name),1),e("span",{class:V(["text-[10px] px-1.5 py-0.5 rounded-full",u[n.status]||u.on_track])},d(o[n.status]||n.status),3)]),e("div",xa,[e("div",ma,[e("div",{class:"h-full rounded-full transition-all duration-500",style:T({width:n.progress+"%",backgroundColor:n.sphere_color})},null,4)]),e("span",ya,d(n.progress)+"%",1)])]),n.days_left?(r(),s("span",ba,d(n.days_left)+" дн. ",1)):w("",!0)],2))),128))])])):w("",!0),(k=t.data.achieved_goals)!=null&&k.length?(r(),s("div",va,[a[8]||(a[8]=e("h3",{class:"text-sm font-semibold text-emerald-600 dark:text-emerald-400 mb-3"},"Достигнутые цели",-1)),e("div",fa,[(r(!0),s(_,null,z(t.data.achieved_goals,n=>(r(),s("div",{key:n.id,class:"flex items-center gap-3 p-2"},[a[7]||(a[7]=e("svg",{class:"w-5 h-5 text-emerald-500 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("span",pa,d(n.name),1),e("span",ka,d(n.completed_at),1)]))),128))])])):w("",!0),(m=t.data.sphere_yearly_trends)!=null&&m.length?(r(),s("div",_a,[a[9]||(a[9]=e("h3",{class:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3"},"Тренды по сферам",-1)),e("div",wa,[(r(!0),s(_,null,z(t.data.sphere_yearly_trends,n=>(r(),s("div",{key:n.sphere_id,class:"flex items-center gap-3"},[e("div",{class:"w-2 h-2 rounded-full",style:T({backgroundColor:n.color})},null,4),e("span",$a,d(n.name),1),e("span",{class:V(["text-xs tabular-nums w-12",$(n.trend)])},d(h[n.trend]||"—")+" "+d(n.avg_attention)+"% ",3),e("span",Ma,d(p[n.trend]||""),1)]))),128))])])):w("",!0)])):w("",!0)}}},Sa={key:0,class:"flex items-center justify-center py-16"},za={key:1,class:"text-center py-16"},Ta={class:"grid grid-cols-1 lg:grid-cols-3 gap-4 mb-6"},La={class:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-2 sm:p-4"},Pa={class:"flex gap-2 mb-4 border-b border-gray-200 dark:border-gray-700"},Aa={class:"flex flex-col items-center justify-center"},Wa={key:2,class:"flex items-center justify-center py-16 text-gray-400 dark:text-gray-500 text-sm"},ja={class:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6"},Ya={class:"lg:col-span-1 flex items-center justify-center"},Da={class:"lg:col-span-2 grid grid-cols-1 sm:grid-cols-2 gap-3"},Ba={__name:"WorkspaceDashboard",props:{workspaceId:{type:Number,required:!0},period:{type:String,required:!0},data:{type:Object,default:null}},emits:["refresh-ai","analyze-ai"],setup(t,{emit:f}){const c=t,u=R(null),o=R("spheres"),h=R(window.innerWidth),p=()=>{h.value=window.innerWidth};ie(()=>{window.addEventListener("resize",p)}),ce(()=>{window.removeEventListener("resize",p)});const $=P(()=>h.value>=1024?440:h.value>=768?360:280),l=M=>{u.value=M},a=()=>{u.value=null},x=f,i=()=>{x("analyze-ai",!1)},k=()=>{x("analyze-ai",!0)},m=P(()=>({day:ee,week:fr,month:qr,year:Ca})[c.period]||ee),n=P(()=>{var B;const M=(B=c.data)==null?void 0:B.lifeMirror;if(!M)return[];const W=(M.spheres||[]).map(E=>({name:E.name,total:E.tasks_total||0,done:E.tasks_done||0,color:E.color})),Y=(M.missing_spheres||[]).map(E=>({name:E.name,total:0,done:0,color:E.color}));return[...W,...Y]}),L=P(()=>{var W;const M=(W=c.data)==null?void 0:W.lifeMirror;return M!=null&&M.goals?M.goals.map(Y=>({name:Y.name,total:100,done:Y.progress||0,color:Y.color||"#9ca3af"})):[]}),q=P(()=>{if(!L.value.length)return 0;const M=L.value.reduce((W,Y)=>W+Y.done,0);return Math.round(M/L.value.length)}),N=P(()=>{var Y;const M=(Y=c.data)==null?void 0:Y.lifeMirror;if(!(M!=null&&M.spheres))return[];const W=[];return M.spheres.forEach(B=>{var E;(E=B.tasks)!=null&&E.length&&B.tasks.forEach(C=>{W.push({...C,sphere_name:B.name,sphere_color:B.color})})}),W});return(M,W)=>{var Y,B,E,C,A,D,H,O,S;return(Y=t.data)!=null&&Y.loading&&!((B=t.data)!=null&&B.lifeMirror)?(r(),s("div",Sa,[...W[2]||(W[2]=[e("div",{class:"animate-spin rounded-full h-10 w-10 border-2 border-primary-600 border-t-transparent"},null,-1)])])):!((E=t.data)!=null&&E.loading)&&!((C=t.data)!=null&&C.lifeMirror)?(r(),s("div",za,[...W[3]||(W[3]=[e("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})],-1),e("h3",{class:"mt-2 text-sm font-medium text-gray-900 dark:text-white"},"Нет данных",-1),e("p",{class:"mt-1 text-sm text-gray-500 dark:text-gray-400"},"Создайте сферы жизни и задачи для аналитики",-1)])])):(r(),s(_,{key:2},[t.period==="day"?(r(),s(_,{key:0},[e("div",Ta,[U(ne,{message:t.data.aiMessage,loading:t.data.aiLoading,"silent-loading":t.data.aiSilentLoading,onAnalyze:i,onRefresh:k},null,8,["message","loading","silent-loading"]),e("div",La,[e("div",Pa,[e("button",{onClick:W[0]||(W[0]=F=>o.value="spheres"),class:V(["px-4 py-2 text-sm font-medium transition-colors border-b-2",o.value==="spheres"?"text-primary-600 dark:text-primary-400 border-primary-600 dark:border-primary-400":"text-gray-500 dark:text-gray-400 border-transparent hover:text-gray-700 dark:hover:text-gray-300"])}," Сферы ",2),e("button",{onClick:W[1]||(W[1]=F=>o.value="goals"),class:V(["px-4 py-2 text-sm font-medium transition-colors border-b-2",o.value==="goals"?"text-primary-600 dark:text-primary-400 border-primary-600 dark:border-primary-400":"text-gray-500 dark:text-gray-400 border-transparent hover:text-gray-700 dark:hover:text-gray-300"])}," Цели ",2)]),e("div",Aa,[o.value==="spheres"?(r(),G(X,{key:0,spheres:n.value,"balance-index":((A=t.data.lifeMirror)==null?void 0:A.balance_index)||0,size:$.value,"hovered-sphere-name":u.value,onSphereHover:l,onSphereLeave:a},null,8,["spheres","balance-index","size","hovered-sphere-name"])):o.value==="goals"&&L.value.length?(r(),G(X,{key:1,spheres:L.value,"balance-index":q.value,size:$.value,"hovered-sphere-name":u.value,onSphereHover:l,onSphereLeave:a},null,8,["spheres","balance-index","size","hovered-sphere-name"])):(r(),s("div",Wa," Нет целей "))])]),U(ee,{data:t.data.lifeMirror,"workspace-id":t.workspaceId,"hovered-sphere-name":u.value,onTaskHover:l,onTaskLeave:a},null,8,["data","workspace-id","hovered-sphere-name"])]),U(It,{tasks:N.value},null,8,["tasks"])],64)):(r(),G(ne,{key:1,message:t.data.aiMessage,loading:t.data.aiLoading,onAnalyze:i,onRefresh:k,class:"mb-6"},null,8,["message","loading"])),t.period!=="day"?(r(),s(_,{key:2},[e("div",ja,[e("div",Ya,[U(X,{spheres:n.value,"balance-index":((D=t.data.lifeMirror)==null?void 0:D.balance_index)||0,size:$.value,"hovered-sphere-name":u.value,onSphereHover:l,onSphereLeave:a},null,8,["spheres","balance-index","size","hovered-sphere-name"])]),e("div",Da,[(r(!0),s(_,null,z((H=t.data.lifeMirror)==null?void 0:H.spheres,F=>(r(),G(ut,{key:F.id,sphere:F},null,8,["sphere"]))),128))])]),(S=(O=t.data.lifeMirror)==null?void 0:O.missing_spheres)!=null&&S.length?(r(),G(bt,{key:0,spheres:t.data.lifeMirror.missing_spheres,class:"mb-6"},null,8,["spheres"])):w("",!0)],64)):w("",!0),t.period!=="day"?(r(),G(ye(m.value),{key:3,data:t.data.lifeMirror},null,8,["data"])):w("",!0)],64))}}},Ea={class:"min-h-screen bg-gray-50 dark:bg-gray-900"},Ha={class:"w-full mx-auto px-4 sm:px-6 lg:px-8 py-6"},Va={key:0,class:"text-center py-16"},Na={key:0,class:"mb-6"},Oa={class:"flex gap-2 overflow-x-auto pb-1 scrollbar-hide"},Ra=["onClick"],Fa={key:0,class:"text-base"},Xa={__name:"Dashboard",setup(t){const f=ge(),c=ue(),u=P(()=>c.selectedWorkspaces),o=R(null),h=P(()=>o.value&&f.dataByWorkspace[o.value]||null);K(()=>u.value.map(i=>i.id),i=>{if(!i.length){o.value=null;return}(!o.value||!i.includes(o.value))&&(o.value=i[0])},{immediate:!0});const p=(i=!1)=>{o.value&&f.fetchAiMessage(o.value,i)},$=()=>{!document.hidden&&o.value&&f.fetchForWorkspace(o.value,!0)};let l=null;const a=()=>{l=setInterval(()=>{!document.hidden&&o.value&&f.fetchForWorkspace(o.value,!0)},3e4)},x=()=>{l&&(clearInterval(l),l=null)};return ie(()=>{f.fetchAllWorkspaces(),document.addEventListener("visibilitychange",$),a()}),ce(()=>{document.removeEventListener("visibilitychange",$),x()}),K(o,(i,k)=>{i&&i!==k&&f.fetchForWorkspace(i)}),(i,k)=>{var m,n;return r(),s("div",Ea,[e("div",Ha,[U(Te,{period:Q(f).selectedPeriod,"bible-verse":(n=(m=h.value)==null?void 0:m.aiMessage)==null?void 0:n.bible_verse,onChangePeriod:Q(f).setPeriod},null,8,["period","bible-verse","onChangePeriod"]),u.value.length?(r(),s(_,{key:1},[u.value.length>1?(r(),s("div",Na,[e("div",Oa,[(r(!0),s(_,null,z(u.value,L=>(r(),s("button",{key:L.id,onClick:q=>o.value=L.id,class:V(["flex items-center gap-1.5 px-4 py-2 text-sm font-medium rounded-xl whitespace-nowrap transition-all duration-200",[o.value===L.id?"bg-white dark:bg-gray-800 text-gray-900 dark:text-white shadow-sm ring-1 ring-gray-200 dark:ring-gray-700":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800/50"]])},[L.emoji?(r(),s("span",Fa,d(L.emoji),1)):w("",!0),e("span",null,d(L.name),1)],10,Ra))),128))])])):w("",!0),o.value?(r(),G(Ba,{key:o.value,"workspace-id":o.value,period:Q(f).selectedPeriod,data:h.value,onAnalyzeAi:p},null,8,["workspace-id","period","data"])):w("",!0)],64)):(r(),s("div",Va,[...k[0]||(k[0]=[e("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})],-1),e("h3",{class:"mt-2 text-sm font-medium text-gray-900 dark:text-white"},"Нет данных",-1),e("p",{class:"mt-1 text-sm text-gray-500 dark:text-gray-400"},"Выберите workspace для просмотра аналитики",-1)])]))])])}}};export{Xa as default};
