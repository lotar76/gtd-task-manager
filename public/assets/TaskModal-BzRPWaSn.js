import{c as s,a as l,o as r,k as y,r as x,z as m,s as ee,x as te,l as I,f as le,g as oe,b as M,w as E,t as d,d as n,K as ae,v as _,p as K,m as q,F as w,C as h,B as S,T as re,A as se,j as ie}from"./index-BQRmz4GQ.js";import{u as de}from"./workspace-DTkHaZL8.js";import{u as ne}from"./projects-BB9qncDe.js";import{u as ue}from"./lifeSpheres-DDVy7cpI.js";import{u as ce}from"./goals-D1Fsmasl.js";import{_ as pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";function me(p,g){return r(),s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m20.25 7.5-.625 10.632a2.25 2.25 0 0 1-2.247 2.118H6.622a2.25 2.25 0 0 1-2.247-2.118L3.75 7.5M10 11.25h4M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125Z"})])}function ve(p,g){return r(),s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m3.75 13.5 10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75Z"})])}function F(p,g){return r(),s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5"})])}function fe(p,g){return r(),s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})])}function ge(p,g){return r(),s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.25 13.5h3.86a2.25 2.25 0 0 1 2.012 1.244l.256.512a2.25 2.25 0 0 0 2.013 1.244h3.218a2.25 2.25 0 0 0 2.013-1.244l.256-.512a2.25 2.25 0 0 1 2.013-1.244h3.859m-19.5.338V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18v-4.162c0-.224-.034-.447-.1-.661L19.24 5.338a2.25 2.25 0 0 0-2.15-1.588H6.911a2.25 2.25 0 0 0-2.15 1.588L2.35 13.177a2.25 2.25 0 0 0-.1.661Z"})])}const ke={class:"flex min-h-screen items-center justify-center p-4"},ye={class:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700"},be={class:"text-xl font-semibold text-gray-900 dark:text-white"},xe={class:"flex items-center space-x-3 pb-4 border-b border-gray-200 dark:border-gray-700"},_e={class:"flex items-center space-x-2 cursor-pointer"},we={class:"text-sm font-medium text-gray-700 dark:text-gray-300"},he={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Se={class:"relative"},je={class:"flex items-center space-x-2"},Ce={key:0,class:"absolute z-10 mt-1 w-full bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg shadow-lg"},De=["onClick"],Me={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ve={key:0},$e=["value"],Be=["value"],Le={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Oe=["value"],Ue=["value"],Ae={key:1,class:"text-red-600 dark:text-red-400 text-sm bg-red-50 dark:bg-red-900/20 p-3 rounded-lg"},Ie={class:"flex justify-end space-x-3 pt-4"},Ee=["disabled"],Fe={__name:"TaskModal",props:{show:{type:Boolean,default:!1},task:{type:Object,default:null},serverError:{type:String,default:""},defaultDate:{type:String,default:""}},emits:["close","submit"],setup(p,{emit:g}){const u=p,P=g,j=ie(),z=de(),C=ne(),V=ue(),$=ce(),G=y(()=>z.workspaces),v=y(()=>z.currentWorkspace),T=y(()=>{const t=o.value.workspace_id;return t?C.allProjects.filter(e=>e.workspace_id===t&&(e.status==="active"||!e.status)):[]}),J=y(()=>{const t=o.value.workspace_id;return t?V.allSpheres.filter(e=>e.workspace_id===t):[]}),Q=y(()=>{const t=o.value.workspace_id;return t?$.allGoals.filter(e=>e.workspace_id===t&&(e.status==="active"||!e.status)):[]}),B=()=>{const t=j.path;return t.includes("/inbox")?"inbox":t.includes("/today")?"today":t.includes("/next-actions")?"next_action":t.includes("/tomorrow")?"tomorrow":t.includes("/waiting")?"waiting":t.includes("/someday")?"someday":"inbox"},L=()=>{const t=j.path;if(t.includes("/today"))return new Date().toISOString().split("T")[0];if(t.includes("/tomorrow")){const e=new Date;return e.setDate(e.getDate()+1),e.toISOString().split("T")[0]}return""},o=x({title:"",description:"",status:"inbox",priority:"medium",due_date:"",estimated_time:"",end_time:"",workspace_id:null,project_id:null,goal_id:null,life_sphere_id:null,completed_at:null}),b=x(!1),f=x(""),c=x(!1),O=x(null),U={inbox:{label:"Входящие",icon:ge},next_action:{label:"Следующие",icon:ve},today:{label:"Сегодня",icon:F},tomorrow:{label:"Завтра",icon:F},waiting:{label:"Ожидание",icon:fe},someday:{label:"Когда-нибудь",icon:me},scheduled:{label:"Запланировано",icon:F}},W=t=>{if(o.value.status=t,c.value=!1,t==="today"){const e=new Date;o.value.due_date=e.toISOString().split("T")[0]}else if(t==="tomorrow"){const e=new Date;e.setDate(e.getDate()+1),o.value.due_date=e.toISOString().split("T")[0]}},D=y(()=>!!o.value.completed_at),X=t=>{t.target.checked?o.value.completed_at=new Date().toISOString():o.value.completed_at=null},H=t=>t?/^\d{4}-\d{2}-\d{2}$/.test(t)?t:t.split("T")[0]:"",Z=t=>t?/^\d{2}:\d{2}$/.test(t)?t:t.substring(0,5):"";m(()=>u.task,(t,e)=>{var i,a,k;if(e&&!t){o.value={title:"",description:"",status:"inbox",priority:"medium",due_date:"",estimated_time:"",end_time:"",workspace_id:(i=v.value)==null?void 0:i.id,project_id:null,goal_id:null,life_sphere_id:null,completed_at:null},O.value=null,f.value="",c.value=!1;return}if(t)console.log("Task received:",t),console.log("Original due_date:",t.due_date),console.log("Formatted due_date:",H(t.due_date)),o.value={title:t.title||"",description:t.description||"",status:t.status||"inbox",priority:t.priority||"medium",due_date:H(t.due_date),estimated_time:Z(t.estimated_time),end_time:Z(t.end_time),workspace_id:t.workspace_id||((a=v.value)==null?void 0:a.id),project_id:t.project_id||null,goal_id:t.goal_id||null,life_sphere_id:t.life_sphere_id||null,completed_at:t.completed_at||null};else{const A=B();O.value=A,o.value={title:"",description:"",status:A,priority:"medium",due_date:L(),estimated_time:"",end_time:"",workspace_id:(k=v.value)==null?void 0:k.id,project_id:null,goal_id:null,life_sphere_id:null,completed_at:null}}f.value="",c.value=!1},{immediate:!0}),m(()=>u.serverError,t=>{f.value=t,t&&(b.value=!1)}),m(()=>u.show,t=>{var e,i,a;t?u.task?o.value.workspace_id||(o.value.workspace_id=(i=v.value)==null?void 0:i.id):(o.value.workspace_id=(e=v.value)==null?void 0:e.id,o.value.status=B(),o.value.due_date=u.defaultDate||L()):(o.value={title:"",description:"",status:"inbox",priority:"medium",due_date:"",estimated_time:"",end_time:"",workspace_id:(a=v.value)==null?void 0:a.id,project_id:null,goal_id:null,life_sphere_id:null,completed_at:null},O.value=null,c.value=!1,b.value=!1,f.value="")}),m(()=>u.show,t=>{t&&(C.loaded||C.fetchAllProjects(),V.loaded||V.fetchAll(),$.loaded||$.fetchAllGoals())}),m(()=>j.path,()=>{if(!u.task){o.value.status=B();const t=L();(t||j.path.includes("/today"))&&(o.value.due_date=t)}}),m(()=>{var t;return(t=v.value)==null?void 0:t.id},t=>{!u.task&&t&&(o.value.workspace_id=t)}),m(()=>o.value.workspace_id,(t,e)=>{if(!(!e||t===e)&&o.value.project_id){const i=C.allProjects.find(a=>a.id===o.value.project_id);i&&i.workspace_id!==t&&(o.value.project_id=null)}}),m(()=>o.value.due_date,t=>{if(!t||o.value.completed_at)return;const e=new Date().toISOString().split("T")[0],i=new Date;i.setDate(i.getDate()+1);const a=i.toISOString().split("T")[0];t===e?o.value.status="today":t===a?o.value.status="tomorrow":["today","tomorrow","completed"].includes(o.value.status)||(o.value.status="scheduled")});const Y=()=>{f.value="",b.value=!0,P("submit",o.value)},N=t=>{c.value&&!t.target.closest(".relative")&&(c.value=!1)},R=t=>{t.key==="Escape"&&u.show&&P("close")};return ee(()=>{document.addEventListener("click",N),document.addEventListener("keydown",R)}),te(()=>{document.removeEventListener("click",N),document.removeEventListener("keydown",R)}),(t,e)=>(r(),I(se,{to:"body"},[le(re,{name:"modal"},{default:oe(()=>{var i;return[p.show?(r(),s("div",{key:0,class:"fixed inset-0 z-50 overflow-y-auto",onClick:e[15]||(e[15]=E(a=>t.$emit("close"),["self"]))},[e[33]||(e[33]=l("div",{class:"fixed inset-0 bg-black bg-opacity-50 transition-opacity"},null,-1)),l("div",ke,[l("div",{class:"relative bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full mx-auto",onClick:e[14]||(e[14]=E(()=>{},["stop"]))},[l("div",ye,[l("h3",be,d((i=p.task)!=null&&i.id?"Редактировать задачу":"Новая задача"),1),l("button",{onClick:e[0]||(e[0]=a=>t.$emit("close")),class:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"},[...e[16]||(e[16]=[l("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),l("form",{onSubmit:E(Y,["prevent"]),class:"p-6 space-y-4"},[l("div",xe,[l("label",_e,[n(l("input",{type:"checkbox","onUpdate:modelValue":e[1]||(e[1]=a=>D.value=a),onChange:X,class:"w-5 h-5 text-primary-600 border-gray-300 dark:border-gray-600 rounded focus:ring-primary-500 dark:bg-gray-700"},null,544),[[ae,D.value]]),l("span",we,d(D.value?"Задача выполнена":"Отметить как выполненную"),1)])]),l("div",null,[e[17]||(e[17]=l("label",{for:"title",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Название задачи * ",-1)),n(l("input",{id:"title","onUpdate:modelValue":e[2]||(e[2]=a=>o.value.title=a),type:"text",required:"",class:K(["input",{"opacity-60":D.value}]),placeholder:"Введите название задачи"},null,2),[[_,o.value.title]])]),l("div",null,[e[18]||(e[18]=l("label",{for:"description",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Описание ",-1)),n(l("textarea",{id:"description","onUpdate:modelValue":e[3]||(e[3]=a=>o.value.description=a),rows:"3",class:"input",placeholder:"Добавьте описание"},null,512),[[_,o.value.description]])]),l("div",he,[l("div",null,[e[20]||(e[20]=l("label",{for:"status",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Статус ",-1)),l("div",Se,[l("button",{type:"button",onClick:e[4]||(e[4]=a=>c.value=!c.value),class:"input w-full flex items-center justify-between"},[l("span",je,[(r(),I(q(U[o.value.status].icon),{class:"w-5 h-5 text-gray-500 dark:text-gray-400"})),l("span",null,d(U[o.value.status].label),1)]),e[19]||(e[19]=l("svg",{class:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})],-1))]),c.value?(r(),s("div",Ce,[(r(),s(w,null,h(U,(a,k)=>l("button",{key:k,type:"button",onClick:A=>W(k),class:K(["w-full flex items-center space-x-2 px-3 py-2 text-sm hover:bg-gray-50 dark:hover:bg-gray-600 first:rounded-t-lg last:rounded-b-lg transition-colors",o.value.status===k?"bg-primary-50 dark:bg-primary-900/30 text-primary-700 dark:text-primary-400":"text-gray-700 dark:text-gray-300"])},[(r(),I(q(a.icon),{class:"w-5 h-5"})),l("span",null,d(a.label),1)],10,De)),64))])):M("",!0)])]),l("div",null,[e[22]||(e[22]=l("label",{for:"priority",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Приоритет ",-1)),n(l("select",{id:"priority","onUpdate:modelValue":e[5]||(e[5]=a=>o.value.priority=a),class:"input"},[...e[21]||(e[21]=[l("option",{value:"low"},"Низкий",-1),l("option",{value:"medium"},"Средний",-1),l("option",{value:"high"},"Высокий",-1),l("option",{value:"urgent"},"Срочный",-1)])],512),[[S,o.value.priority]])])]),l("div",Me,[l("div",null,[e[23]||(e[23]=l("label",{for:"due_date",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Срок выполнения ",-1)),n(l("input",{id:"due_date","onUpdate:modelValue":e[6]||(e[6]=a=>o.value.due_date=a),type:"date",class:"input"},null,512),[[_,o.value.due_date]])]),l("div",null,[e[24]||(e[24]=l("label",{for:"estimated_time",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Время начала ",-1)),n(l("input",{id:"estimated_time","onUpdate:modelValue":e[7]||(e[7]=a=>o.value.estimated_time=a),type:"time",class:"input",placeholder:"12:30"},null,512),[[_,o.value.estimated_time]])])]),l("div",null,[e[25]||(e[25]=l("label",{for:"end_time",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Время окончания ",-1)),n(l("input",{id:"end_time","onUpdate:modelValue":e[8]||(e[8]=a=>o.value.end_time=a),type:"time",class:"input",placeholder:"13:30"},null,512),[[_,o.value.end_time]])]),G.value.length>1?(r(),s("div",Ve,[e[26]||(e[26]=l("label",{for:"workspace_id",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Рабочее пространство ",-1)),n(l("select",{id:"workspace_id","onUpdate:modelValue":e[9]||(e[9]=a=>o.value.workspace_id=a),class:"input"},[(r(!0),s(w,null,h(G.value,a=>(r(),s("option",{key:a.id,value:a.id},d(a.name),9,$e))),128))],512),[[S,o.value.workspace_id]])])):M("",!0),l("div",null,[e[28]||(e[28]=l("label",{for:"project_id",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Поток ",-1)),n(l("select",{id:"project_id","onUpdate:modelValue":e[10]||(e[10]=a=>o.value.project_id=a),class:"input"},[e[27]||(e[27]=l("option",{value:null},"Без потока",-1)),(r(!0),s(w,null,h(T.value,a=>(r(),s("option",{key:a.id,value:a.id},d(a.name),9,Be))),128))],512),[[S,o.value.project_id]])]),l("div",Le,[l("div",null,[e[30]||(e[30]=l("label",{for:"life_sphere_id",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Сфера жизни ",-1)),n(l("select",{id:"life_sphere_id","onUpdate:modelValue":e[11]||(e[11]=a=>o.value.life_sphere_id=a),class:"input"},[e[29]||(e[29]=l("option",{value:null},"Без сферы",-1)),(r(!0),s(w,null,h(J.value,a=>(r(),s("option",{key:a.id,value:a.id},d(a.emoji||"")+" "+d(a.name),9,Oe))),128))],512),[[S,o.value.life_sphere_id]])]),l("div",null,[e[32]||(e[32]=l("label",{for:"goal_id",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Цель ",-1)),n(l("select",{id:"goal_id","onUpdate:modelValue":e[12]||(e[12]=a=>o.value.goal_id=a),class:"input"},[e[31]||(e[31]=l("option",{value:null},"Без цели",-1)),(r(!0),s(w,null,h(Q.value,a=>(r(),s("option",{key:a.id,value:a.id},d(a.name),9,Ue))),128))],512),[[S,o.value.goal_id]])])]),f.value?(r(),s("div",Ae,d(f.value),1)):M("",!0),l("div",Ie,[l("button",{type:"button",onClick:e[13]||(e[13]=a=>t.$emit("close")),class:"btn btn-secondary"}," Отмена "),l("button",{type:"submit",disabled:b.value,class:"btn btn-primary"},d(b.value?"Сохранение...":"Сохранить"),9,Ee)])],32)])])])):M("",!0)]}),_:1})]))}},Re=pe(Fe,[["__scopeId","data-v-cda87ceb"]]);export{Re as T,fe as a,F as b,ve as c,ge as d,me as r};
