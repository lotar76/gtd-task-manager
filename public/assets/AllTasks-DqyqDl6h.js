import{u as P,r as Q,b as R,a as j,d as X,c as Y,e as ee,T as te}from"./TaskModal-Cpq72MKn.js";import{u as re}from"./workspace-CoKcgfuB.js";import{T as ae}from"./TaskList-DUvJ4Yzu.js";import{T as se}from"./TaskView-9FQW8AeN.js";import{c as o,a,o as s,k as g,r as v,f as b,b as C,F as B,C as M,p as w,e as y,y as $,t as u,l as V,m as oe}from"./index-BM-3aGKM.js";import{r as le}from"./RectangleStackIcon-CYdvO_zh.js";import{r as ne}from"./PlusIcon-DVD_RmjR.js";import"./projects-DIMWl5aI.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";function ie(L,l){return s(),o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"})])}const de={class:"p-4 lg:p-8"},ue={class:"max-w-4xl mx-auto"},ce={class:"mb-6"},ve={key:0,class:"flex flex-wrap gap-2"},me=["onClick"],ge={class:"ml-1.5 opacity-75"},pe={class:"ml-1.5 opacity-75"},ke={class:"ml-1.5 opacity-75"},xe=["onClick"],be={class:"ml-1.5 opacity-75"},ye={key:0,class:"text-center py-12"},fe={key:0,class:"mb-3 flex items-center justify-between"},he={class:"text-sm text-gray-500 dark:text-gray-400"},we={key:2,class:"text-center py-12"},Te={key:3,class:"text-center py-12"},_e={class:"max-w-md mx-auto"},Ce={class:"w-16 h-16 mx-auto mb-4 rounded-full bg-gray-50 dark:bg-gray-800 flex items-center justify-center"},Ne={__name:"AllTasks",setup(L){const l=P(),F=re(),n=g(()=>l.filteredTasks),N=g(()=>l.loading),p=v(!1),f=v(!1),i=v(null),h=v(""),c=v(null),d=v(null),m=v(!1),O={inbox:{label:"Входящие",icon:ee,activeBg:"bg-blue-500",order:0},today:{label:"Сегодня",icon:Y,activeBg:"bg-amber-500",order:1},next_action:{label:"Следующие",icon:X,activeBg:"bg-yellow-500",order:2},tomorrow:{label:"Завтра",icon:j,activeBg:"bg-indigo-500",order:3},scheduled:{label:"Запланированные",icon:j,activeBg:"bg-teal-500",order:4},waiting:{label:"Ожидание",icon:R,activeBg:"bg-orange-500",order:5},someday:{label:"Когда-нибудь",icon:Q,activeBg:"bg-purple-500",order:6}},A=g(()=>{const t={};for(const e of n.value)t[e.status]=(t[e.status]||0)+1;return Object.entries(O).filter(([e])=>t[e]>0).map(([e,r])=>({value:e,label:r.label,icon:r.icon,activeBg:r.activeBg,order:r.order,count:t[e]})).sort((e,r)=>e.order-r.order)}),D=g(()=>{const t=new Date;return n.value.filter(e=>!e.due_date||e.completed_at?!1:new Date(e.due_date)<t).length}),U=g(()=>{const t={};for(const e of n.value)t[e.workspace_id]=(t[e.workspace_id]||0)+1;return F.workspaces.map(e=>({id:e.id,name:e.name,count:t[e.id]||0}))}),T=g(()=>{let t=n.value;if(c.value&&(t=t.filter(e=>e.status===c.value)),d.value&&(t=t.filter(e=>e.workspace_id===d.value)),m.value){const e=new Date;t=t.filter(r=>!r.due_date||r.completed_at?!1:new Date(r.due_date)<e)}return t}),W=t=>{c.value=c.value===t?null:t},E=()=>{c.value=null,d.value=null,m.value=!1},Z=t=>{i.value=t,f.value=!0},z=()=>{i.value=null,p.value=!0},G=()=>{f.value=!1,p.value=!0},H=async t=>{try{await l.completeTask(t.id)}catch(e){console.error("Error completing task:",e)}},I=async t=>{try{await l.uncompleteTask(t.id)}catch(e){console.error("Error uncompleting task:",e)}},q=async t=>{try{t.completed_at?await l.uncompleteTask(t.id):await l.completeTask(t.id)}catch(e){console.error("Error toggling task:",e)}},J=async t=>{var e,r,k,S;h.value="";try{i.value?await l.updateTask(i.value.id,t):await l.createTask(t),p.value=!1,i.value=null}catch(x){console.error("Error saving task:",x);let _="Ошибка при сохранении задачи";(r=(e=x.response)==null?void 0:e.data)!=null&&r.errors?_=Object.values(x.response.data.errors).flat().join(", "):(S=(k=x.response)==null?void 0:k.data)!=null&&S.message&&(_=x.response.data.message),h.value=_}},K=()=>{p.value=!1,i.value=null,h.value=""};return(t,e)=>(s(),o("div",de,[a("div",ue,[a("div",ce,[e[6]||(e[6]=a("h1",{class:"text-xl lg:text-2xl font-semibold text-gray-900 dark:text-white mb-4"},"Все задачи",-1)),n.value.length>0?(s(),o("div",ve,[(s(!0),o(B,null,M(A.value,r=>(s(),o("button",{key:r.value,onClick:k=>W(r.value),class:w(["inline-flex items-center px-3 py-1.5 text-xs font-medium rounded-full border transition-colors",c.value===r.value?"border-transparent text-white "+r.activeBg:"border-gray-200 dark:border-gray-600 text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700"])},[(s(),V(oe(r.icon),{class:"w-3.5 h-3.5 mr-1.5"})),y(" "+u(r.label)+" ",1),a("span",ge,u(r.count),1)],10,me))),128)),D.value>0?(s(),o("button",{key:0,onClick:e[0]||(e[0]=r=>m.value=!m.value),class:w(["inline-flex items-center px-3 py-1.5 text-xs font-medium rounded-full border transition-colors",m.value?"border-transparent bg-red-500 text-white":"border-red-200 dark:border-red-800 text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-950"])},[b($(ie),{class:"w-3.5 h-3.5 mr-1.5"}),e[3]||(e[3]=y(" Просроченные ",-1)),a("span",pe,u(D.value),1)],2)):C("",!0),e[5]||(e[5]=a("div",{class:"w-px bg-gray-200 dark:bg-gray-600 mx-1 self-stretch"},null,-1)),a("button",{onClick:e[1]||(e[1]=r=>d.value=null),class:w(["inline-flex items-center px-3 py-1.5 text-xs font-medium rounded-full border transition-colors",d.value===null?"border-transparent bg-indigo-500 text-white":"border-gray-200 dark:border-gray-600 text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700"])},[e[4]||(e[4]=y(" Все ",-1)),a("span",ke,u(n.value.length),1)],2),(s(!0),o(B,null,M(U.value,r=>(s(),o("button",{key:r.id,onClick:k=>d.value=r.id,class:w(["inline-flex items-center px-3 py-1.5 text-xs font-medium rounded-full border transition-colors",d.value===r.id?"border-transparent bg-indigo-500 text-white":"border-gray-200 dark:border-gray-600 text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700"])},[y(u(r.name)+" ",1),a("span",be,u(r.count),1)],10,xe))),128))])):C("",!0)]),N.value?(s(),o("div",ye,[...e[7]||(e[7]=[a("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"},null,-1)])])):(s(),o(B,{key:1},[n.value.length>0&&(c.value||d.value||m.value)?(s(),o("div",fe,[a("span",he," Показано "+u(T.value.length)+" из "+u(n.value.length),1),a("button",{onClick:E,class:"text-xs text-primary-600 hover:text-primary-700 dark:text-primary-400"}," Сбросить фильтры ")])):C("",!0),T.value.length>0?(s(),V(ae,{key:1,tasks:T.value,onTaskClick:Z,onToggleComplete:q},null,8,["tasks"])):n.value.length>0?(s(),o("div",we,[e[8]||(e[8]=a("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Нет задач по выбранным фильтрам",-1)),a("button",{onClick:E,class:"mt-2 text-sm text-primary-600 hover:text-primary-700 dark:text-primary-400"}," Сбросить фильтры ")])):(s(),o("div",Te,[a("div",_e,[a("div",Ce,[b($(le),{class:"w-8 h-8 text-gray-400"})]),e[10]||(e[10]=a("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white mb-2"},"Задач пока нет",-1)),e[11]||(e[11]=a("p",{class:"text-sm text-gray-500 dark:text-gray-400 mb-6 leading-relaxed"}," Здесь отображаются все ваши активные задачи из всех разделов GTD. Начните с добавления задач во «Входящие» — записывайте всё, что приходит в голову, а затем распределяйте по нужным спискам. ",-1)),a("button",{onClick:z,class:"inline-flex items-center px-4 py-2 bg-primary-600 text-white text-sm font-medium rounded-lg hover:bg-primary-700 transition-colors"},[b($(ne),{class:"w-5 h-5 mr-1.5"}),e[9]||(e[9]=y(" Добавить задачу ",-1))])])]))],64)),b(se,{show:f.value,task:i.value,onClose:e[2]||(e[2]=r=>{f.value=!1,i.value=null}),onEnterEdit:G,onCompleteTask:H,onUncompleteTask:I},null,8,["show","task"]),b(te,{show:p.value,task:i.value,"server-error":h.value,onClose:K,onSubmit:J},null,8,["show","task","server-error"])])]))}};export{Ne as default};
