import{G as oe,r as b,k as u,H as A,c as d,a as o,o as i,z as j,s as se,x as ae,l as R,f as re,g as le,b as U,w as q,t as _,d as x,I as ne,v as B,p as Y,m as ee,F as G,C as K,B as J,T as ie,A as de,j as ue}from"./index-foeisxHv.js";import{u as te}from"./workspace-BPEeWFJ1.js";import{u as ce}from"./projects-ZcoRqfy_.js";import{_ as ve}from"./_plugin-vue_export-helper-DlAUqK2U.js";const We=oe("tasks",()=>{const l=b([]),m=b(!1),c=b(!1),T=b(localStorage.getItem("taskViewMode")||"list"),g=te(),H=u(()=>g.selectedWorkspaces.map(e=>e.id)),v=u(()=>{const e=H.value;return e.length?l.value.filter(t=>e.includes(t.workspace_id)):[]}),I=u(()=>v.value.filter(e=>e.status==="inbox")),w=u(()=>v.value.filter(e=>e.status==="next_action")),D=u(()=>v.value.filter(e=>e.status==="today")),C=u(()=>v.value.filter(e=>e.status==="tomorrow")),M=u(()=>v.value.filter(e=>e.status==="waiting")),a=u(()=>v.value.filter(e=>e.status==="someday")),h=u(()=>v.value.filter(e=>e.status==="scheduled")),y=u(()=>({inbox:I.value.length,next_actions:w.value.length,today:D.value.length,tomorrow:C.value.length,waiting:M.value.length,someday:a.value.length,scheduled:h.value.length})),f=(e,t)=>v.value.filter(r=>{if(!r.due_date)return!1;const s=r.due_date.substring(0,10);return s>=e&&s<=t}),k=async({force:e=!1}={})=>{var t;if(!(c.value&&!e)){m.value=!0;try{const r=await A.get("/v1/tasks");l.value=((t=r.data.data)==null?void 0:t.tasks)||r.data.tasks||r.data||[],c.value=!0}finally{m.value=!1}}},V=e=>{const t={...e};return t.estimated_time===""&&(t.estimated_time=null),t.due_date===""&&(t.due_date=null),t.description===""&&(t.description=null),(t.project_id===""||t.project_id===null)&&(t.project_id=null),t},W=async e=>{var p;const t=(e==null?void 0:e.workspace_id)||((p=g.currentWorkspace)==null?void 0:p.id);if(!t){console.error("Cannot create task: workspace_id not found");return}const r=V(e);r.workspace_id=t;const s=await A.post(`/v1/workspaces/${t}/tasks`,r),n=s.data.data||s.data;return n.status!=="completed"&&l.value.unshift(n),n},$=async(e,t)=>{var X;const r=l.value.find(N=>N.id===e),s=(r==null?void 0:r.workspace_id)||(t==null?void 0:t.workspace_id)||((X=g.currentWorkspace)==null?void 0:X.id);if(!s){console.error("Cannot update task: workspace_id not found");return}const n=V(t);delete n.workspace_id;const p=await A.put(`/v1/workspaces/${s}/tasks/${e}`,n),S=p.data.data||p.data,P=l.value.findIndex(N=>N.id===e);return P!==-1&&(S.status==="completed"?l.value.splice(P,1):l.value[P]=S),S},E=async e=>{var p;const t=l.value.findIndex(S=>S.id===e);if(t===-1)return;const r=l.value[t],s=r.workspace_id||((p=g.currentWorkspace)==null?void 0:p.id);if(!s){console.error("Cannot complete task: workspace_id not found");return}const n={...r};l.value.splice(t,1);try{await A.post(`/v1/workspaces/${s}/tasks/${e}/complete`)}catch(S){throw l.value.splice(t,0,n),S}},L=async e=>{var s;const t=l.value.find(n=>n.id===e),r=(t==null?void 0:t.workspace_id)||((s=g.currentWorkspace)==null?void 0:s.id);if(!r){console.error("Cannot delete task: workspace_id not found");return}await A.delete(`/v1/workspaces/${r}/tasks/${e}`),l.value=l.value.filter(n=>n.id!==e)},O=e=>{T.value=e,localStorage.setItem("taskViewMode",e)};let Z=null;return{allTasks:l,loading:m,loaded:c,filteredTasks:v,inboxTasks:I,nextActionTasks:w,todayTasks:D,tomorrowTasks:C,waitingTasks:M,somedayTasks:a,scheduledTasks:h,counts:y,calendarTasks:f,viewMode:T,fetchAllTasks:k,createTask:W,updateTask:$,completeTask:E,deleteTask:L,setViewMode:O,startSync:()=>{Z=setInterval(()=>k({force:!0}),5*60*1e3)},stopSync:()=>{Z&&clearInterval(Z)}}});function pe(l,m){return i(),d("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m20.25 7.5-.625 10.632a2.25 2.25 0 0 1-2.247 2.118H6.622a2.25 2.25 0 0 1-2.247-2.118L3.75 7.5M10 11.25h4M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125Z"})])}function me(l,m){return i(),d("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m3.75 13.5 10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75Z"})])}function Ee(l,m){return i(),d("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5m-9-6h.008v.008H12v-.008ZM12 15h.008v.008H12V15Zm0 2.25h.008v.008H12v-.008ZM9.75 15h.008v.008H9.75V15Zm0 2.25h.008v.008H9.75v-.008ZM7.5 15h.008v.008H7.5V15Zm0 2.25h.008v.008H7.5v-.008Zm6.75-4.5h.008v.008h-.008v-.008Zm0 2.25h.008v.008h-.008V15Zm0 2.25h.008v.008h-.008v-.008Zm2.25-4.5h.008v.008H16.5v-.008Zm0 2.25h.008v.008H16.5V15Z"})])}function Q(l,m){return i(),d("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5"})])}function fe(l,m){return i(),d("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})])}function ke(l,m){return i(),d("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.25 13.5h3.86a2.25 2.25 0 0 1 2.012 1.244l.256.512a2.25 2.25 0 0 0 2.013 1.244h3.218a2.25 2.25 0 0 0 2.013-1.244l.256-.512a2.25 2.25 0 0 1 2.013-1.244h3.859m-19.5.338V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18v-4.162c0-.224-.034-.447-.1-.661L19.24 5.338a2.25 2.25 0 0 0-2.15-1.588H6.911a2.25 2.25 0 0 0-2.15 1.588L2.35 13.177a2.25 2.25 0 0 0-.1.661Z"})])}const ge={class:"flex min-h-screen items-center justify-center p-4"},we={class:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700"},ye={class:"text-xl font-semibold text-gray-900 dark:text-white"},xe={class:"flex items-center space-x-3 pb-4 border-b border-gray-200 dark:border-gray-700"},be={class:"flex items-center space-x-2 cursor-pointer"},he={class:"text-sm font-medium text-gray-700 dark:text-gray-300"},_e={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Se={class:"relative"},je={class:"flex items-center space-x-2"},Ce={key:0,class:"absolute z-10 mt-1 w-full bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg shadow-lg"},Me=["onClick"],Ve={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},$e={key:0},Te=["value"],Ie=["value"],Ze={key:1,class:"text-red-600 dark:text-red-400 text-sm bg-red-50 dark:bg-red-900/20 p-3 rounded-lg"},Ae={class:"flex justify-end space-x-3 pt-4"},Be=["disabled"],He={__name:"TaskModal",props:{show:{type:Boolean,default:!1},task:{type:Object,default:null},serverError:{type:String,default:""},defaultDate:{type:String,default:""}},emits:["close","submit"],setup(l,{emit:m}){const c=l,T=m,g=ue(),H=te(),v=ce(),I=u(()=>H.workspaces),w=u(()=>H.currentWorkspace),D=u(()=>v.activeProjects),C=()=>{const e=g.path;return e.includes("/inbox")?"inbox":e.includes("/today")?"today":e.includes("/next-actions")?"next_action":e.includes("/tomorrow")?"tomorrow":e.includes("/waiting")?"waiting":e.includes("/someday")?"someday":"inbox"},M=()=>{const e=g.path;if(e.includes("/today"))return new Date().toISOString().split("T")[0];if(e.includes("/tomorrow")){const t=new Date;return t.setDate(t.getDate()+1),t.toISOString().split("T")[0]}return""},a=b({title:"",description:"",status:"inbox",priority:"medium",due_date:"",estimated_time:"",end_time:"",workspace_id:null,project_id:null}),h=b(!1),y=b(""),f=b(!1),k=b(null),V={inbox:{label:"Входящие",icon:ke},next_action:{label:"Следующие",icon:me},today:{label:"Сегодня",icon:Q},tomorrow:{label:"Завтра",icon:Q},waiting:{label:"Ожидание",icon:fe},someday:{label:"Когда-нибудь",icon:pe},scheduled:{label:"Запланировано",icon:Q}},W=e=>{if(a.value.status=e,f.value=!1,e==="today"){const t=new Date;a.value.due_date=t.toISOString().split("T")[0]}else if(e==="tomorrow"){const t=new Date;t.setDate(t.getDate()+1),a.value.due_date=t.toISOString().split("T")[0]}},$=u(()=>a.value.status==="completed"),E=e=>{e.target.checked?a.value.status!=="completed"&&(k.value=a.value.status,a.value.status="completed"):(a.value.status=k.value||"inbox",k.value=null)},L=e=>e?/^\d{4}-\d{2}-\d{2}$/.test(e)?e:e.split("T")[0]:"",O=e=>e?/^\d{2}:\d{2}$/.test(e)?e:e.substring(0,5):"";j(()=>c.task,(e,t)=>{var r,s,n;if(t&&!e){a.value={title:"",description:"",status:"inbox",priority:"medium",due_date:"",estimated_time:"",end_time:"",workspace_id:(r=w.value)==null?void 0:r.id,project_id:null},k.value=null,y.value="",f.value=!1;return}if(e)console.log("Task received:",e),console.log("Original due_date:",e.due_date),console.log("Formatted due_date:",L(e.due_date)),e.status==="completed"?k.value=e.previous_status||"inbox":k.value=e.status||"inbox",a.value={title:e.title||"",description:e.description||"",status:e.status||"inbox",priority:e.priority||"medium",due_date:L(e.due_date),estimated_time:O(e.estimated_time),end_time:O(e.end_time),workspace_id:e.workspace_id||((s=w.value)==null?void 0:s.id),project_id:e.project_id||null};else{const p=C();k.value=p,a.value={title:"",description:"",status:p,priority:"medium",due_date:M(),estimated_time:"",end_time:"",workspace_id:(n=w.value)==null?void 0:n.id,project_id:null}}y.value="",f.value=!1},{immediate:!0}),j(()=>c.serverError,e=>{y.value=e,e&&(h.value=!1)}),j(()=>c.show,e=>{var t,r,s;e?c.task?a.value.workspace_id||(a.value.workspace_id=(r=w.value)==null?void 0:r.id):(a.value.workspace_id=(t=w.value)==null?void 0:t.id,a.value.status=C(),a.value.due_date=c.defaultDate||M()):(a.value={title:"",description:"",status:"inbox",priority:"medium",due_date:"",estimated_time:"",end_time:"",workspace_id:(s=w.value)==null?void 0:s.id,project_id:null},k.value=null,f.value=!1,h.value=!1,y.value="")}),j(()=>c.show,e=>{e&&!v.loaded&&v.fetchAllProjects()}),j(()=>g.path,()=>{if(!c.task){a.value.status=C();const e=M();(e||g.path.includes("/today"))&&(a.value.due_date=e)}}),j(()=>{var e;return(e=w.value)==null?void 0:e.id},e=>{!c.task&&e&&(a.value.workspace_id=e)}),j(()=>a.value.due_date,e=>{if(!e||a.value.status==="completed")return;const t=new Date().toISOString().split("T")[0],r=new Date;r.setDate(r.getDate()+1);const s=r.toISOString().split("T")[0];e===t?a.value.status="today":e===s?a.value.status="tomorrow":["today","tomorrow","completed"].includes(a.value.status)||(a.value.status="scheduled")});const Z=()=>{y.value="",h.value=!0,T("submit",a.value)},F=e=>{f.value&&!e.target.closest(".relative")&&(f.value=!1)},z=e=>{e.key==="Escape"&&c.show&&T("close")};return se(()=>{document.addEventListener("click",F),document.addEventListener("keydown",z)}),ae(()=>{document.removeEventListener("click",F),document.removeEventListener("keydown",z)}),(e,t)=>(i(),R(de,{to:"body"},[re(ie,{name:"modal"},{default:le(()=>{var r;return[l.show?(i(),d("div",{key:0,class:"fixed inset-0 z-50 overflow-y-auto",onClick:t[13]||(t[13]=q(s=>e.$emit("close"),["self"]))},[t[27]||(t[27]=o("div",{class:"fixed inset-0 bg-black bg-opacity-50 transition-opacity"},null,-1)),o("div",ge,[o("div",{class:"relative bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full mx-auto",onClick:t[12]||(t[12]=q(()=>{},["stop"]))},[o("div",we,[o("h3",ye,_((r=l.task)!=null&&r.id?"Редактировать задачу":"Новая задача"),1),o("button",{onClick:t[0]||(t[0]=s=>e.$emit("close")),class:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"},[...t[14]||(t[14]=[o("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),o("form",{onSubmit:q(Z,["prevent"]),class:"p-6 space-y-4"},[o("div",xe,[o("label",be,[x(o("input",{type:"checkbox","onUpdate:modelValue":t[1]||(t[1]=s=>$.value=s),onChange:E,class:"w-5 h-5 text-primary-600 border-gray-300 dark:border-gray-600 rounded focus:ring-primary-500 dark:bg-gray-700"},null,544),[[ne,$.value]]),o("span",he,_($.value?"Задача выполнена":"Отметить как выполненную"),1)])]),o("div",null,[t[15]||(t[15]=o("label",{for:"title",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Название задачи * ",-1)),x(o("input",{id:"title","onUpdate:modelValue":t[2]||(t[2]=s=>a.value.title=s),type:"text",required:"",class:Y(["input",{"opacity-60":$.value}]),placeholder:"Введите название задачи"},null,2),[[B,a.value.title]])]),o("div",null,[t[16]||(t[16]=o("label",{for:"description",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Описание ",-1)),x(o("textarea",{id:"description","onUpdate:modelValue":t[3]||(t[3]=s=>a.value.description=s),rows:"3",class:"input",placeholder:"Добавьте описание"},null,512),[[B,a.value.description]])]),o("div",_e,[o("div",null,[t[18]||(t[18]=o("label",{for:"status",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Статус ",-1)),o("div",Se,[o("button",{type:"button",onClick:t[4]||(t[4]=s=>f.value=!f.value),class:"input w-full flex items-center justify-between"},[o("span",je,[(i(),R(ee(V[a.value.status].icon),{class:"w-5 h-5 text-gray-500 dark:text-gray-400"})),o("span",null,_(V[a.value.status].label),1)]),t[17]||(t[17]=o("svg",{class:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})],-1))]),f.value?(i(),d("div",Ce,[(i(),d(G,null,K(V,(s,n)=>o("button",{key:n,type:"button",onClick:p=>W(n),class:Y(["w-full flex items-center space-x-2 px-3 py-2 text-sm hover:bg-gray-50 dark:hover:bg-gray-600 first:rounded-t-lg last:rounded-b-lg transition-colors",a.value.status===n?"bg-primary-50 dark:bg-primary-900/30 text-primary-700 dark:text-primary-400":"text-gray-700 dark:text-gray-300"])},[(i(),R(ee(s.icon),{class:"w-5 h-5"})),o("span",null,_(s.label),1)],10,Me)),64))])):U("",!0)])]),o("div",null,[t[20]||(t[20]=o("label",{for:"priority",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Приоритет ",-1)),x(o("select",{id:"priority","onUpdate:modelValue":t[5]||(t[5]=s=>a.value.priority=s),class:"input"},[...t[19]||(t[19]=[o("option",{value:"low"},"Низкий",-1),o("option",{value:"medium"},"Средний",-1),o("option",{value:"high"},"Высокий",-1),o("option",{value:"urgent"},"Срочный",-1)])],512),[[J,a.value.priority]])])]),o("div",Ve,[o("div",null,[t[21]||(t[21]=o("label",{for:"due_date",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Срок выполнения ",-1)),x(o("input",{id:"due_date","onUpdate:modelValue":t[6]||(t[6]=s=>a.value.due_date=s),type:"date",class:"input"},null,512),[[B,a.value.due_date]])]),o("div",null,[t[22]||(t[22]=o("label",{for:"estimated_time",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Время начала ",-1)),x(o("input",{id:"estimated_time","onUpdate:modelValue":t[7]||(t[7]=s=>a.value.estimated_time=s),type:"time",class:"input",placeholder:"12:30"},null,512),[[B,a.value.estimated_time]])])]),o("div",null,[t[23]||(t[23]=o("label",{for:"end_time",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Время окончания ",-1)),x(o("input",{id:"end_time","onUpdate:modelValue":t[8]||(t[8]=s=>a.value.end_time=s),type:"time",class:"input",placeholder:"13:30"},null,512),[[B,a.value.end_time]])]),I.value.length>1?(i(),d("div",$e,[t[24]||(t[24]=o("label",{for:"workspace_id",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Рабочее пространство ",-1)),x(o("select",{id:"workspace_id","onUpdate:modelValue":t[9]||(t[9]=s=>a.value.workspace_id=s),class:"input"},[(i(!0),d(G,null,K(I.value,s=>(i(),d("option",{key:s.id,value:s.id},_(s.name),9,Te))),128))],512),[[J,a.value.workspace_id]])])):U("",!0),o("div",null,[t[26]||(t[26]=o("label",{for:"project_id",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Проект ",-1)),x(o("select",{id:"project_id","onUpdate:modelValue":t[10]||(t[10]=s=>a.value.project_id=s),class:"input"},[t[25]||(t[25]=o("option",{value:null},"Без проекта",-1)),(i(!0),d(G,null,K(D.value,s=>(i(),d("option",{key:s.id,value:s.id},_(s.name),9,Ie))),128))],512),[[J,a.value.project_id]])]),y.value?(i(),d("div",Ze,_(y.value),1)):U("",!0),o("div",Ae,[o("button",{type:"button",onClick:t[11]||(t[11]=s=>e.$emit("close")),class:"btn btn-secondary"}," Отмена "),o("button",{type:"submit",disabled:h.value,class:"btn btn-primary"},_(h.value?"Сохранение...":"Сохранить"),9,Be)])],32)])])])):U("",!0)]}),_:1})]))}},Fe=ve(He,[["__scopeId","data-v-f22f67f1"]]);export{Fe as T,pe as a,fe as b,Q as c,me as d,ke as e,Ee as r,We as u};
