import{u as R,T as U,a as X}from"./TaskModal-B7votAW0.js";import{u as Z}from"./workspace-DxROCKju.js";import{d as v}from"./ru-B7JyRvIu.js";import{_ as ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{c as n,a as s,o as l,r as y,k as w,z as W,q as te,b as p,f as D,p as g,D as O,t as c,F as h,y as x,e as se}from"./app-CggqkjMs.js";function re(N,f){return l(),n("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})])}function ae(N,f){return l(),n("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m8.25 4.5 7.5 7.5-7.5 7.5"})])}const oe={class:"p-2 sm:p-4 lg:p-8"},ne={class:"max-w-7xl mx-auto"},le={class:"flex flex-col lg:flex-row lg:items-center lg:justify-between mb-4 lg:mb-6"},ie={class:"flex items-center space-x-1 sm:space-x-2 mt-3 lg:mt-0 overflow-x-auto pb-2 lg:pb-0"},de={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-3 sm:p-4 mb-4 lg:mb-6"},ce={class:"flex items-center justify-between"},ue={class:"text-base sm:text-lg font-semibold text-gray-900 text-center px-2"},me={key:0,class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden"},ge={class:"grid grid-cols-7 border-b border-gray-200"},pe={class:"grid grid-cols-7"},ve=["onClick"],ye={class:"flex flex-col h-full"},he={class:"flex justify-between items-start mb-1"},xe={key:0,class:"inline-flex items-center justify-center min-w-[20px] h-5 px-1.5 text-xs font-semibold bg-primary-600 text-white rounded-full"},be={key:1,class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden"},fe={class:"hidden lg:block"},_e={class:"grid grid-cols-7 border-b border-gray-200"},we={class:"grid grid-cols-7"},Ye={class:"mb-2"},ke={class:"space-y-2"},Me=["onClick"],De={class:"font-medium truncate"},Te={key:0,class:"text-[10px] opacity-75 mt-1"},Ce={class:"lg:hidden overflow-x-auto"},$e={class:"flex min-w-max"},Se={class:"mb-3 sticky top-0 bg-inherit pb-2 border-b border-gray-200"},je={class:"text-xs text-gray-500 mb-1"},Oe={class:"space-y-2"},Ne=["onClick"],Be={class:"font-medium text-sm mb-1"},Ee={key:0,class:"text-xs text-gray-600 mt-1"},Pe={key:0,class:"text-xs text-gray-400 text-center py-4"},Ve={key:2,class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden"},We={class:"p-3 sm:p-4 border-b border-gray-200"},ze={class:"text-base sm:text-lg font-semibold text-gray-900"},Fe={class:"p-3 sm:p-4"},Le={class:"space-y-2 sm:space-y-3"},qe=["onClick"],Ie={class:"flex items-start justify-between"},Ae={class:"flex-1 min-w-0"},Ge={class:"font-medium text-sm sm:text-base text-gray-900 mb-1"},He={key:0,class:"text-xs sm:text-sm text-gray-600 mt-1 line-clamp-2"},Je={class:"flex flex-wrap items-center gap-2 mt-2"},Ke={key:0,class:"text-xs text-gray-600 flex items-center"},Qe={key:0,class:"text-center py-8 sm:py-12 text-gray-500 text-sm sm:text-base"},Re={__name:"Calendar",setup(N){v.locale("ru");const f=R(),B=Z(),o=y(v()),Y=y([]),E=y(!1),z=y(!1),d=y("month"),k=y(!1),_=y(null),M=y(""),T=["Пн","Вт","Ср","Чт","Пт","Сб","Вс"],F=w(()=>o.value.format("MMMM")),L=w(()=>o.value.format("YYYY")),q=w(()=>{if(d.value==="month")return`${F.value} ${L.value}`;if(d.value==="week"){const t=o.value.startOf("week"),r=t.add(6,"day");return t.month()===r.month()?`${t.format("D")} - ${r.format("D MMMM YYYY")}`:`${t.format("D MMM")} - ${r.format("D MMM YYYY")}`}else return o.value.format("D MMMM YYYY")}),P=w(()=>{const t=o.value.startOf("week"),r=[];for(let e=0;e<7;e++){const i=t.add(e,"day"),a=i.format("YYYY-MM-DD"),u=Y.value.filter(m=>m.due_date&&v(m.due_date).format("YYYY-MM-DD")===a&&m.status!=="completed");r.push({day:i.date(),monthName:i.format("MMM"),date:a,isToday:i.isSame(v(),"day"),tasks:u})}return r}),V=w(()=>{const t=o.value.format("YYYY-MM-DD");return Y.value.filter(r=>r.due_date&&v(r.due_date).format("YYYY-MM-DD")===t&&r.status!=="completed")}),I=w(()=>{const t=[],r=o.value.startOf("month"),e=o.value.endOf("month"),i=r.day()===0?6:r.day()-1;for(let u=i-1;u>=0;u--){const m=r.subtract(u+1,"day");t.push(C(m,!1))}for(let u=0;u<e.date();u++){const m=r.add(u,"day");t.push(C(m,!0))}const a=42-t.length;for(let u=0;u<a;u++){const m=e.add(u+1,"day");t.push(C(m,!1))}return t}),C=(t,r)=>{const e=t.format("YYYY-MM-DD"),i=Y.value.filter(a=>a.due_date&&v(a.due_date).format("YYYY-MM-DD")===e&&a.status!=="completed");return{day:t.date(),date:e,currentMonth:r,isToday:t.isSame(v(),"day"),taskCount:i.length,tasks:i}},b=async()=>{E.value=!0;try{let t,r;if(d.value==="month")t=o.value.startOf("month").subtract(7,"days").format("YYYY-MM-DD"),r=o.value.endOf("month").add(7,"days").format("YYYY-MM-DD");else if(d.value==="week"){const e=o.value.startOf("week");t=e.format("YYYY-MM-DD"),r=e.add(6,"day").format("YYYY-MM-DD")}else t=o.value.format("YYYY-MM-DD"),r=o.value.format("YYYY-MM-DD");await f.fetchCalendar(t,r,z.value),Y.value=f.tasks}finally{E.value=!1}};W(()=>d.value,()=>{b()});const A=()=>{d.value==="month"?o.value=o.value.subtract(1,"month"):d.value==="week"?o.value=o.value.subtract(1,"week"):o.value=o.value.subtract(1,"day"),b()},G=()=>{d.value==="month"?o.value=o.value.add(1,"month"):d.value==="week"?o.value=o.value.add(1,"week"):o.value=o.value.add(1,"day"),b()},$=t=>t?/^\d{2}:\d{2}$/.test(t)?t:t.substring(0,5):"",H=t=>({high:"Высокий",medium:"Средний",low:"Низкий",urgent:"Срочный"})[t]||t,S=t=>{_.value=t,k.value=!0},J=t=>{o.value=v(t),d.value="day",b()},K=async t=>{var r,e,i,a,u;M.value="";try{_.value?await f.updateTask(_.value.id,t):await f.createTask(t),k.value=!1,_.value=null,await b()}catch(m){console.error("Error saving task:",m),console.error("Error details:",(r=m.response)==null?void 0:r.data);let j="Ошибка при сохранении задачи";(i=(e=m.response)==null?void 0:e.data)!=null&&i.errors?j=Object.values(m.response.data.errors).flat().join(", "):(u=(a=m.response)==null?void 0:a.data)!=null&&u.message&&(j=m.response.data.message),M.value=j}},Q=()=>{k.value=!1,_.value=null,M.value=""};return W(()=>{var t;return(t=B.currentWorkspace)==null?void 0:t.id},t=>{t&&b()},{immediate:!0}),te(()=>{var t;(t=B.currentWorkspace)!=null&&t.id&&b()}),(t,r)=>(l(),n("div",oe,[s("div",ne,[s("div",le,[r[3]||(r[3]=s("div",null,[s("h1",{class:"text-lg sm:text-xl lg:text-2xl font-semibold text-gray-900"},"Календарь")],-1)),s("div",ie,[s("button",{onClick:r[0]||(r[0]=e=>d.value="day"),class:g(["px-3 sm:px-4 py-2 text-xs sm:text-sm font-medium rounded-lg transition-colors whitespace-nowrap touch-manipulation",d.value==="day"?"bg-primary-600 text-white":"bg-gray-100 text-gray-700 active:bg-gray-200"])}," День ",2),s("button",{onClick:r[1]||(r[1]=e=>d.value="week"),class:g(["px-3 sm:px-4 py-2 text-xs sm:text-sm font-medium rounded-lg transition-colors whitespace-nowrap touch-manipulation",d.value==="week"?"bg-primary-600 text-white":"bg-gray-100 text-gray-700 active:bg-gray-200"])}," Неделя ",2),s("button",{onClick:r[2]||(r[2]=e=>d.value="month"),class:g(["px-3 sm:px-4 py-2 text-xs sm:text-sm font-medium rounded-lg transition-colors whitespace-nowrap touch-manipulation",d.value==="month"?"bg-primary-600 text-white":"bg-gray-100 text-gray-700 active:bg-gray-200"])}," Месяц ",2)])]),s("div",de,[s("div",ce,[s("button",{onClick:A,class:"p-2 sm:p-3 rounded-lg bg-gray-100 hover:bg-gray-200 active:bg-gray-300 transition-colors touch-manipulation"},[D(O(re),{class:"w-5 h-5 sm:w-6 sm:h-6 text-gray-700"})]),s("h2",ue,c(q.value),1),s("button",{onClick:G,class:"p-2 sm:p-3 rounded-lg bg-gray-100 hover:bg-gray-200 active:bg-gray-300 transition-colors touch-manipulation"},[D(O(ae),{class:"w-5 h-5 sm:w-6 sm:h-6 text-gray-700"})])])]),d.value==="month"?(l(),n("div",me,[s("div",ge,[(l(),n(h,null,x(T,e=>s("div",{key:e,class:"text-center py-2 sm:py-3 text-xs sm:text-sm font-medium text-gray-700 border-r border-gray-200 last:border-r-0"},c(e),1)),64))]),s("div",pe,[(l(!0),n(h,null,x(I.value,(e,i)=>(l(),n("div",{key:i,onClick:a=>J(e.date),class:g(["min-h-[60px] sm:min-h-[80px] lg:min-h-[100px] border-b border-r border-gray-200 last:border-r-0 p-1 sm:p-2 cursor-pointer touch-manipulation hover:bg-gray-50 active:bg-gray-100 transition-colors",{"bg-gray-50":!e.currentMonth,"bg-primary-50 hover:bg-primary-100":e.isToday}])},[s("div",ye,[s("div",he,[s("span",{class:g(["text-xs sm:text-sm font-medium",{"text-gray-400":!e.currentMonth,"text-primary-700":e.isToday,"text-gray-900":e.currentMonth&&!e.isToday}])},c(e.day),3),e.taskCount>0?(l(),n("span",xe,c(e.taskCount),1)):p("",!0)])])],10,ve))),128))])])):p("",!0),d.value==="week"?(l(),n("div",be,[s("div",fe,[s("div",_e,[(l(),n(h,null,x(T,e=>s("div",{key:e,class:"text-center py-3 text-sm font-medium text-gray-700 border-r border-gray-200 last:border-r-0"},c(e),1)),64))]),s("div",we,[(l(!0),n(h,null,x(P.value,(e,i)=>(l(),n("div",{key:i,class:g(["min-h-[400px] border-b border-r border-gray-200 last:border-r-0 p-3",{"bg-primary-50":e.isToday}])},[s("div",Ye,[s("span",{class:g(["text-sm font-medium",{"text-primary-700":e.isToday,"text-gray-900":!e.isToday}])},c(e.day)+" "+c(e.monthName),3)]),s("div",ke,[(l(!0),n(h,null,x(e.tasks,a=>(l(),n("div",{key:a.id,onClick:u=>S(a),class:g(["p-2 rounded cursor-pointer text-xs touch-manipulation",{"bg-primary-100 text-primary-700 border-l-2 border-primary-500":a.status!=="completed","bg-gray-100 text-gray-500 line-through":a.status==="completed"}])},[s("div",De,c(a.title),1),a.estimated_time?(l(),n("div",Te,c($(a.estimated_time)),1)):p("",!0)],10,Me))),128))])],2))),128))])]),s("div",Ce,[s("div",$e,[(l(!0),n(h,null,x(P.value,(e,i)=>(l(),n("div",{key:i,class:g(["w-[280px] min-w-[280px] border-r border-gray-200 last:border-r-0 p-3",{"bg-primary-50":e.isToday}])},[s("div",Se,[s("div",je,c(T[i]),1),s("span",{class:g(["text-base font-semibold",{"text-primary-700":e.isToday,"text-gray-900":!e.isToday}])},c(e.day)+" "+c(e.monthName),3)]),s("div",Oe,[(l(!0),n(h,null,x(e.tasks,a=>(l(),n("div",{key:a.id,onClick:u=>S(a),class:g(["p-3 rounded-lg cursor-pointer touch-manipulation",{"bg-primary-100 text-primary-700 border-l-4 border-primary-500":a.status!=="completed","bg-gray-100 text-gray-500 line-through":a.status==="completed"}])},[s("div",Be,c(a.title),1),a.estimated_time?(l(),n("div",Ee," ⏱ "+c($(a.estimated_time)),1)):p("",!0)],10,Ne))),128)),e.tasks.length===0?(l(),n("div",Pe," Нет задач ")):p("",!0)])],2))),128))])])])):p("",!0),d.value==="day"?(l(),n("div",Ve,[s("div",We,[s("h3",ze,c(o.value.format("D MMMM YYYY")),1)]),s("div",Fe,[s("div",Le,[(l(!0),n(h,null,x(V.value,e=>(l(),n("div",{key:e.id,onClick:i=>S(e),class:g(["p-3 sm:p-4 rounded-lg cursor-pointer border-l-4 touch-manipulation active:scale-[0.98] transition-transform",{"bg-primary-50 border-primary-500":e.status!=="completed","bg-gray-50 border-gray-300 line-through":e.status==="completed"}])},[s("div",Ie,[s("div",Ae,[s("div",Ge,c(e.title),1),e.description?(l(),n("div",He,c(e.description),1)):p("",!0),s("div",Je,[e.estimated_time?(l(),n("span",Ke,[D(O(X),{class:"w-3 h-3 mr-1"}),se(" "+c($(e.estimated_time)),1)])):p("",!0),s("span",{class:g(["text-xs px-2 py-0.5 rounded-full",{"bg-red-100 text-red-700":e.priority==="urgent","bg-primary-100 text-primary-700":e.priority==="high","bg-yellow-100 text-yellow-700":e.priority==="medium","bg-gray-100 text-gray-700":e.priority==="low"}])},c(H(e.priority)),3)])])])],10,qe))),128)),V.value.length===0?(l(),n("div",Qe," Нет задач на этот день ")):p("",!0)])])])):p("",!0),D(U,{show:k.value,task:_.value,"server-error":M.value,onClose:Q,onSubmit:K},null,8,["show","task","server-error"])])]))}},rt=ee(Re,[["__scopeId","data-v-d270489c"]]);export{rt as default};
