import{u as I,r as q,a as H,c as J,b as K,d as P,T as Q}from"./TaskModal-B9J9PHPt.js";import{u as R}from"./workspace-DG5f1HZi.js";import{T as U}from"./TaskList-CdNpxLRS.js";import{r as B}from"./CalendarDaysIcon-BSFB3av7.js";import{r as X}from"./RectangleStackIcon-CwUNgo4e.js";import{r as Y}from"./PlusIcon-BT8eW7_q.js";import{k as v,r as p,c as o,a,f as h,b as S,F as w,z as $,p as _,e as b,t as u,l as j,A as E,o as s,m as Z}from"./index-D4gUA9rq.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ru-B7JyRvIu.js";const ee={class:"p-4 lg:p-8"},te={class:"max-w-4xl mx-auto"},re={class:"mb-6"},ae={key:0,class:"flex flex-wrap gap-2"},se=["onClick"],oe={class:"ml-1.5 opacity-75"},le={class:"ml-1.5 opacity-75"},ne=["onClick"],ie={class:"ml-1.5 opacity-75"},de={key:0,class:"text-center py-12"},ue={key:0,class:"mb-3 flex items-center justify-between"},ce={class:"text-sm text-gray-500 dark:text-gray-400"},ge={key:2,class:"text-center py-12"},me={key:3,class:"text-center py-12"},ve={class:"max-w-md mx-auto"},pe={class:"w-16 h-16 mx-auto mb-4 rounded-full bg-gray-50 dark:bg-gray-800 flex items-center justify-center"},Se={__name:"AllTasks",setup(xe){const c=I(),F=R(),l=v(()=>c.allTasks),M=v(()=>c.loading),g=p(!1),i=p(null),x=p(""),d=p(null),n=p(null),N={inbox:{label:"Входящие",icon:P,activeBg:"bg-blue-500",order:0},today:{label:"Сегодня",icon:K,activeBg:"bg-amber-500",order:1},next_action:{label:"Следующие",icon:J,activeBg:"bg-yellow-500",order:2},tomorrow:{label:"Завтра",icon:B,activeBg:"bg-indigo-500",order:3},scheduled:{label:"Запланированные",icon:B,activeBg:"bg-teal-500",order:4},waiting:{label:"Ожидание",icon:H,activeBg:"bg-orange-500",order:5},someday:{label:"Когда-нибудь",icon:q,activeBg:"bg-purple-500",order:6}},V=v(()=>{const t={};for(const e of l.value)t[e.status]=(t[e.status]||0)+1;return Object.entries(N).filter(([e])=>t[e]>0).map(([e,r])=>({value:e,label:r.label,icon:r.icon,activeBg:r.activeBg,order:r.order,count:t[e]})).sort((e,r)=>e.order-r.order)}),A=v(()=>{const t={};for(const e of l.value)t[e.workspace_id]=(t[e.workspace_id]||0)+1;return F.workspaces.map(e=>({id:e.id,name:e.name,count:t[e.id]||0}))}),y=v(()=>{let t=l.value;return d.value&&(t=t.filter(e=>e.status===d.value)),n.value&&(t=t.filter(e=>e.workspace_id===n.value)),t}),L=t=>{d.value=d.value===t?null:t},T=()=>{d.value=null,n.value=null},z=t=>{i.value=t,g.value=!0},D=()=>{i.value=null,g.value=!0},O=async t=>{try{t.status==="completed"?await c.updateTask(t.id,{status:"inbox"}):await c.completeTask(t.id)}catch(e){console.error("Error toggling task:",e)}},W=async t=>{var e,r,k,C;x.value="";try{i.value?await c.updateTask(i.value.id,t):await c.createTask(t),g.value=!1,i.value=null}catch(m){console.error("Error saving task:",m);let f="Ошибка при сохранении задачи";(r=(e=m.response)==null?void 0:e.data)!=null&&r.errors?f=Object.values(m.response.data.errors).flat().join(", "):(C=(k=m.response)==null?void 0:k.data)!=null&&C.message&&(f=m.response.data.message),x.value=f}},G=()=>{g.value=!1,i.value=null,x.value=""};return(t,e)=>(s(),o("div",ee,[a("div",te,[a("div",re,[e[3]||(e[3]=a("h1",{class:"text-xl lg:text-2xl font-semibold text-gray-900 dark:text-white mb-4"},"Все задачи",-1)),l.value.length>0?(s(),o("div",ae,[(s(!0),o(w,null,$(V.value,r=>(s(),o("button",{key:r.value,onClick:k=>L(r.value),class:_(["inline-flex items-center px-3 py-1.5 text-xs font-medium rounded-full border transition-colors",d.value===r.value?"border-transparent text-white "+r.activeBg:"border-gray-200 dark:border-gray-600 text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700"])},[(s(),j(Z(r.icon),{class:"w-3.5 h-3.5 mr-1.5"})),b(" "+u(r.label)+" ",1),a("span",oe,u(r.count),1)],10,se))),128)),e[2]||(e[2]=a("div",{class:"w-px bg-gray-200 dark:bg-gray-600 mx-1 self-stretch"},null,-1)),a("button",{onClick:e[0]||(e[0]=r=>n.value=null),class:_(["inline-flex items-center px-3 py-1.5 text-xs font-medium rounded-full border transition-colors",n.value===null?"border-transparent bg-indigo-500 text-white":"border-gray-200 dark:border-gray-600 text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700"])},[e[1]||(e[1]=b(" Все ",-1)),a("span",le,u(l.value.length),1)],2),(s(!0),o(w,null,$(A.value,r=>(s(),o("button",{key:r.id,onClick:k=>n.value=r.id,class:_(["inline-flex items-center px-3 py-1.5 text-xs font-medium rounded-full border transition-colors",n.value===r.id?"border-transparent bg-indigo-500 text-white":"border-gray-200 dark:border-gray-600 text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700"])},[b(u(r.name)+" ",1),a("span",ie,u(r.count),1)],10,ne))),128))])):S("",!0)]),M.value?(s(),o("div",de,[...e[4]||(e[4]=[a("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"},null,-1)])])):(s(),o(w,{key:1},[l.value.length>0&&(d.value||n.value)?(s(),o("div",ue,[a("span",ce," Показано "+u(y.value.length)+" из "+u(l.value.length),1),a("button",{onClick:T,class:"text-xs text-primary-600 hover:text-primary-700 dark:text-primary-400"}," Сбросить фильтры ")])):S("",!0),y.value.length>0?(s(),j(U,{key:1,tasks:y.value,onTaskClick:z,onToggleComplete:O},null,8,["tasks"])):l.value.length>0?(s(),o("div",ge,[e[5]||(e[5]=a("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Нет задач по выбранным фильтрам",-1)),a("button",{onClick:T,class:"mt-2 text-sm text-primary-600 hover:text-primary-700 dark:text-primary-400"}," Сбросить фильтры ")])):(s(),o("div",me,[a("div",ve,[a("div",pe,[h(E(X),{class:"w-8 h-8 text-gray-400"})]),e[7]||(e[7]=a("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white mb-2"},"Задач пока нет",-1)),e[8]||(e[8]=a("p",{class:"text-sm text-gray-500 dark:text-gray-400 mb-6 leading-relaxed"}," Здесь отображаются все ваши активные задачи из всех разделов GTD. Начните с добавления задач во «Входящие» — записывайте всё, что приходит в голову, а затем распределяйте по нужным спискам. ",-1)),a("button",{onClick:D,class:"inline-flex items-center px-4 py-2 bg-primary-600 text-white text-sm font-medium rounded-lg hover:bg-primary-700 transition-colors"},[h(E(Y),{class:"w-5 h-5 mr-1.5"}),e[6]||(e[6]=b(" Добавить задачу ",-1))])])]))],64)),h(Q,{show:g.value,task:i.value,"server-error":x.value,onClose:G,onSubmit:W},null,8,["show","task","server-error"])])]))}};export{Se as default};
