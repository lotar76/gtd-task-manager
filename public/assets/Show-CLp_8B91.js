import{c as s,a as r,o as a,r as d,k as S,j as X,z as Y,f as i,b as p,t as g,F as w,C as U,y as x,e as ee,l as te,i as re,p as L}from"./index-CnkTNq8J.js";import{u as ae}from"./projects-CEoyNY3i.js";import{u as se,T as oe}from"./TaskModal-CY_2zmW9.js";import{u as le}from"./workspace-DnamxNfV.js";import{T as R}from"./TaskList-BEW7i1vc.js";import{T as ne}from"./TaskView-IIz2npxp.js";import{P as ce}from"./ProjectModal-KtmnbgHn.js";import{r as ie,a as ue,b as de}from"./PencilIcon-Cldvhjf3.js";import{r as ve}from"./RectangleStackIcon-WUCSvcFL.js";import"./lifeSpheres-BNGfdyGE.js";import"./goals-CNAspvLr.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ConfirmDialog-Ddzx0Jjq.js";function z(F,m){return a(),s("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[r("path",{"fill-rule":"evenodd",d:"M12 3.75a.75.75 0 0 1 .75.75v6.75h6.75a.75.75 0 0 1 0 1.5h-6.75v6.75a.75.75 0 0 1-1.5 0v-6.75H4.5a.75.75 0 0 1 0-1.5h6.75V4.5a.75.75 0 0 1 .75-.75Z","clip-rule":"evenodd"})])}const pe={class:"p-4 lg:p-8"},ge={class:"max-w-4xl mx-auto"},me={class:"flex items-center justify-between mb-6"},he={class:"flex items-center space-x-3 min-w-0 flex-1"},ke={class:"min-w-0"},ye={class:"flex items-center gap-3"},xe={class:"text-xl lg:text-2xl font-semibold text-gray-900 dark:text-white truncate"},fe={key:0,class:"text-sm text-gray-400 dark:text-gray-500 flex-shrink-0"},we={key:0,class:"flex items-center gap-1.5 mt-1 text-sm text-gray-500 dark:text-gray-400"},_e={key:0,class:"grayscale"},be={key:1,class:"text-sm text-gray-600 dark:text-gray-400 mt-1 truncate"},je=["title"],Te={class:"text-xs text-gray-400 ml-1"},Ce={class:"flex items-center space-x-1 flex-shrink-0 ml-2"},Ee={key:0,class:"text-center py-12"},Pe={key:0,class:"py-12 text-center"},Se={class:"max-w-md mx-auto"},$e={class:"w-16 h-16 mx-auto mb-4 rounded-full bg-blue-50 dark:bg-blue-900/30 flex items-center justify-center"},Ie={key:1,class:"mt-6"},Me={class:"opacity-50"},De={__name:"Show",setup(F){const m=X(),_=re(),b=ae(),v=se(),W=le(),o=d(null),$=d(!1),f=d(!1),j=d(!1),T=d(!1),u=d(null),C=d(""),E=d(""),n=S(()=>{const t=parseInt(m.params.projectId);return t?v.allTasks.filter(e=>e.project_id===t):[]}),M=S(()=>n.value.filter(t=>!t.completed_at)),h=S(()=>n.value.filter(t=>t.completed_at)),P=S(()=>o.value?W.workspaces.find(t=>t.id===o.value.workspace_id):null),I=async()=>{var c;const t=parseInt(m.params.projectId),e=parseInt(m.params.id);if(!e||!t){console.error("Missing workspaceId or projectId",{workspaceId:e,projectId:t});return}$.value=!0;try{const l=await b.fetchProject(t);if(!l){_.push(`/workspaces/${e}/projects`);return}if(o.value=l,o.value.workspace_id!==e){console.error("Project does not belong to workspace from URL"),_.push(`/workspaces/${e}/projects`);return}}catch(l){console.error("Error loading project:",l),((c=l.response)==null?void 0:c.status)===404&&_.push(`/workspaces/${e}/projects`)}finally{$.value=!1}},A=()=>{T.value=!0},H=async()=>{var t;if(confirm(`Архивировать поток "${(t=o.value)==null?void 0:t.name}"?`))try{await b.archiveProject(o.value.id),_.push(`/workspaces/${o.value.workspace_id}/projects`)}catch(e){console.error("Error archiving project:",e),alert("Ошибка при архивировании потока")}},Z=async()=>{try{await b.unarchiveProject(o.value.id),await I()}catch(t){console.error("Error unarchiving project:",t),alert("Ошибка при восстановлении потока")}},V=()=>{o.value&&(u.value={project_id:o.value.id},f.value=!0)},B=t=>{u.value=t,j.value=!0},q=()=>{j.value=!1,f.value=!0},D=async t=>{try{await v.completeTask(t.id)}catch(e){console.error("Error completing task:",e)}},G=async t=>{try{await v.uncompleteTask(t.id)}catch(e){console.error("Error uncompleting task:",e)}},J=async t=>{var e,c,l;C.value="";try{(e=u.value)!=null&&e.id?await v.updateTask(u.value.id,t):(t.project_id=o.value.id,await v.createTask(t)),f.value=!1,u.value=null}catch(k){console.error("Error saving task:",k),C.value=((l=(c=k.response)==null?void 0:c.data)==null?void 0:l.message)||k.message||"Ошибка при сохранении задачи"}},K=()=>{f.value=!1,u.value=null,C.value=""},O=async t=>{var e,c;E.value="";try{await b.updateProject(o.value.id,t),T.value=!1,await I()}catch(l){console.error("Error saving project:",l),E.value=((c=(e=l.response)==null?void 0:e.data)==null?void 0:c.message)||l.message||"Ошибка при сохранении потока"}},Q=()=>{T.value=!1,E.value=""},N=async t=>{try{t.completed_at?await v.uncompleteTask(t.id):await v.completeTask(t.id)}catch(e){console.error("Error toggling task:",e)}};return Y(()=>[m.params.projectId,m.params.id],()=>{I()},{immediate:!0}),(t,e)=>{var c,l,k;return a(),s("div",pe,[r("div",ge,[r("div",me,[r("div",he,[r("div",ke,[r("div",ye,[r("h1",xe,g(((c=o.value)==null?void 0:c.name)||"Загрузка..."),1),n.value.length>0?(a(),s("span",fe,g(n.value.length),1)):p("",!0)]),P.value?(a(),s("div",we,[P.value.emoji?(a(),s("span",_e,g(P.value.emoji),1)):p("",!0),r("span",null,g(P.value.name),1)])):p("",!0),(l=o.value)!=null&&l.description?(a(),s("p",be,g(o.value.description),1)):p("",!0),n.value.length>0?(a(),s("div",{key:2,class:"flex items-center gap-1 mt-2",title:`${h.value.length} / ${n.value.length} выполнено`},[n.value.length<=20?(a(!0),s(w,{key:0},U(n.value.length,y=>(a(),s("div",{key:y,class:L(["w-2.5 h-2.5 rounded-sm",y<=h.value.length?"bg-green-500":"bg-gray-300 dark:bg-gray-600"])},null,2))),128)):(a(),s(w,{key:1},[(a(),s(w,null,U(20,y=>r("div",{key:y,class:L(["w-2.5 h-2.5 rounded-sm",y<=Math.round(h.value.length/n.value.length*20)?"bg-green-500":"bg-gray-300 dark:bg-gray-600"])},null,2)),64)),r("span",Te,g(h.value.length)+"/"+g(n.value.length),1)],64))],8,je)):p("",!0)])]),r("div",Ce,[r("button",{onClick:V,class:"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",title:"Добавить задачу"},[i(x(z),{class:"w-5 h-5"})]),r("button",{onClick:A,class:"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",title:"Редактировать"},[i(x(ie),{class:"w-5 h-5"})]),((k=o.value)==null?void 0:k.status)!=="archived"?(a(),s("button",{key:0,onClick:H,class:"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",title:"Архивировать"},[i(x(ue),{class:"w-5 h-5"})])):(a(),s("button",{key:1,onClick:Z,class:"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",title:"Восстановить"},[i(x(de),{class:"w-5 h-5"})]))])]),$.value?(a(),s("div",Ee,[...e[1]||(e[1]=[r("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"},null,-1)])])):(a(),s(w,{key:1},[n.value.length===0?(a(),s("div",Pe,[r("div",Se,[r("div",$e,[i(x(ve),{class:"w-8 h-8 text-blue-500"})]),e[3]||(e[3]=r("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white mb-2"},"В потоке пока нет задач",-1)),e[4]||(e[4]=r("p",{class:"text-sm text-gray-500 dark:text-gray-400 mb-6 leading-relaxed"}," Поток — это любая цель, требующая более одного действия. Разбейте его на конкретные шаги и добавьте первую задачу, чтобы начать двигаться к результату. ",-1)),r("button",{onClick:V,class:"inline-flex items-center px-4 py-2 bg-primary-600 hover:bg-primary-700 text-white rounded-lg transition-colors text-sm font-medium"},[i(x(z),{class:"w-5 h-5 mr-1.5"}),e[2]||(e[2]=ee(" Добавить задачу ",-1))])])])):(a(),s(w,{key:1},[M.value.length>0?(a(),te(R,{key:0,tasks:M.value,onTaskClick:B,onToggleComplete:N},null,8,["tasks"])):p("",!0),h.value.length>0?(a(),s("div",Ie,[e[5]||(e[5]=r("h3",{class:"text-xs font-semibold text-gray-400 dark:text-gray-500 uppercase tracking-wider mb-3 px-1"}," Выполненные ",-1)),r("div",Me,[i(R,{tasks:h.value,onTaskClick:B,onToggleComplete:N},null,8,["tasks"])])])):p("",!0)],64))],64)),i(ne,{show:j.value,task:u.value,onClose:e[0]||(e[0]=y=>{j.value=!1,u.value=null}),onEnterEdit:q,onCompleteTask:D,onUncompleteTask:G},null,8,["show","task"]),i(oe,{show:f.value,task:u.value,"server-error":C.value,onClose:K,onSubmit:J},null,8,["show","task","server-error"]),i(ce,{show:T.value,project:o.value,"server-error":E.value,onClose:Q,onSubmit:O},null,8,["show","project","server-error"])])])}}};export{De as default};
