import{G as Q,r as b,k as V,E as m,c as w,o as f,a,z as T,q as X,s as Y,l as H,f as ee,g as te,b as O,w as W,t as M,d as $,H as ae,v as I,p as G,m as J,F as z,y as N,B as Z,T as se,A as oe,j as le}from"./index-k8OeIxN1.js";import{u as R}from"./workspace-CeXQgviw.js";import{_ as re}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Te=Q("tasks",()=>{const n=b([]),c=b(!1),k=b({inbox:0,next_actions:0,today:0,tomorrow:0,waiting:0,someday:0}),y=b(localStorage.getItem("taskViewMode")||"list"),S=b({status:null,projectId:null,myTasks:!1}),U=R(),d=V(()=>{var i;return(i=U.currentWorkspace)==null?void 0:i.id}),C=async(i=!1)=>{if(d.value){c.value=!0;try{const o=i?{my_tasks:!0}:{},r=await m.get(`/v1/workspaces/${d.value}/inbox`,{params:o});n.value=r.data}finally{c.value=!1}}},g=async(i=!1)=>{if(d.value){c.value=!0;try{const o=i?{my_tasks:!0}:{},r=await m.get(`/v1/workspaces/${d.value}/next-actions`,{params:o});n.value=r.data}finally{c.value=!1}}},L=async(i=!1)=>{if(d.value){c.value=!0;try{const o=i?{my_tasks:!0}:{},r=await m.get(`/v1/workspaces/${d.value}/waiting`,{params:o});n.value=r.data}finally{c.value=!1}}},B=async(i=!1)=>{if(d.value){c.value=!0;try{const o=i?{my_tasks:!0}:{},r=await m.get(`/v1/workspaces/${d.value}/someday`,{params:o});n.value=r.data}finally{c.value=!1}}},P=async(i=!1)=>{if(d.value){c.value=!0;try{const o=i?{my_tasks:!0}:{},r=await m.get(`/v1/workspaces/${d.value}/today`,{params:o});n.value=r.data.data||r.data||[]}finally{c.value=!1}}},s=async(i=!1)=>{if(d.value){c.value=!0;try{const o=i?{my_tasks:!0}:{},r=await m.get(`/v1/workspaces/${d.value}/tomorrow`,{params:o});n.value=r.data.data||r.data||[]}finally{c.value=!1}}},u=async(i,o,r=!1)=>{if(d.value){c.value=!0;try{const h={start_date:i,end_date:o};r&&(h.my_tasks=!0);const _=await m.get(`/v1/workspaces/${d.value}/calendar`,{params:h});n.value=_.data.data||_.data||[]}finally{c.value=!1}}},v=async(i=!1)=>{if(d.value)try{const o=i?{my_tasks:!0}:{},r=await m.get(`/v1/workspaces/${d.value}/counts`,{params:o});k.value=r.data}catch(o){console.error("Ошибка при получении счетчиков задач:",o)}};return{tasks:n,loading:c,counts:k,viewMode:y,filter:S,fetchInbox:C,fetchNextActions:g,fetchWaiting:L,fetchSomeday:B,fetchToday:P,fetchTomorrow:s,fetchCalendar:u,fetchCounts:v,createTask:async i=>{if(!d.value)return;const o={...i};o.estimated_time===""&&(o.estimated_time=null),o.due_date===""&&(o.due_date=null),o.description===""&&(o.description=null),(o.project_id===""||o.project_id===null)&&(o.project_id=null);const r=await m.post(`/v1/workspaces/${d.value}/tasks`,o);return n.value.unshift(r.data),await v(),r.data},updateTask:async(i,o)=>{var h;if(!d.value)return;const r={...o};delete r.workspace_id,r.estimated_time===""&&(r.estimated_time=null),r.due_date===""&&(r.due_date=null),(r.project_id===""||r.project_id===null)&&(r.project_id=null),console.log("Updating task with data:",r);try{const _=await m.put(`/v1/workspaces/${d.value}/tasks/${i}`,r),t=n.value.findIndex(e=>e.id===i);return t!==-1&&(n.value[t]=_.data),await v(),_.data}catch(_){throw console.error("Update task error:",(h=_.response)==null?void 0:h.data),_}},completeTask:async i=>{if(!d.value)return;const o=await m.post(`/v1/workspaces/${d.value}/tasks/${i}/complete`),r=n.value.findIndex(h=>h.id===i);return r!==-1&&(n.value[r]=o.data),await v(),o.data},deleteTask:async i=>{d.value&&(await m.delete(`/v1/workspaces/${d.value}/tasks/${i}`),n.value=n.value.filter(o=>o.id!==i),await v())},setViewMode:i=>{y.value=i,localStorage.setItem("taskViewMode",i)}}}),ne=Q("projects",()=>{const n=b([]),c=b(!1),k=R(),y=V(()=>{var u;return(u=k.currentWorkspace)==null?void 0:u.id}),S=async(u=!1)=>{if(y.value){c.value=!0;try{const v=u?{include_archived:!0}:{},p=await m.get(`/v1/workspaces/${y.value}/projects`,{params:v});n.value=p.data.data||p.data||[]}finally{c.value=!1}}},U=async u=>{if(y.value){c.value=!0;try{const v=await m.get(`/v1/workspaces/${y.value}/projects/${u}`);return v.data.data||v.data}finally{c.value=!1}}},d=async u=>{if(!y.value)return;const v=await m.post(`/v1/workspaces/${y.value}/projects`,u),p=v.data.data||v.data;return n.value.push(p),p},C=async(u,v)=>{if(!y.value)return;const p=await m.put(`/v1/workspaces/${y.value}/projects/${u}`,v),x=p.data.data||p.data,D=n.value.findIndex(F=>F.id===u);return D!==-1&&(n.value[D]=x),x},g=async u=>await C(u,{status:"archived"}),L=async u=>await C(u,{status:"active"}),B=async u=>{y.value&&(await m.delete(`/v1/workspaces/${y.value}/projects/${u}`),n.value=n.value.filter(v=>v.id!==u))},P=V(()=>n.value.filter(u=>u.status==="active"||!u.status)),s=V(()=>n.value.filter(u=>u.status==="archived"));return{projects:n,activeProjects:P,archivedProjects:s,loading:c,fetchProjects:S,fetchProject:U,createProject:d,updateProject:C,archiveProject:g,unarchiveProject:L,deleteProject:B}});function ie(n,c){return f(),w("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m20.25 7.5-.625 10.632a2.25 2.25 0 0 1-2.247 2.118H6.622a2.25 2.25 0 0 1-2.247-2.118L3.75 7.5M10 11.25h4M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125Z"})])}function ue(n,c){return f(),w("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m3.75 13.5 10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75Z"})])}function K(n,c){return f(),w("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5"})])}function de(n,c){return f(),w("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})])}function ce(n,c){return f(),w("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.25 13.5h3.86a2.25 2.25 0 0 1 2.012 1.244l.256.512a2.25 2.25 0 0 0 2.013 1.244h3.218a2.25 2.25 0 0 0 2.013-1.244l.256-.512a2.25 2.25 0 0 1 2.013-1.244h3.859m-19.5.338V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18v-4.162c0-.224-.034-.447-.1-.661L19.24 5.338a2.25 2.25 0 0 0-2.15-1.588H6.911a2.25 2.25 0 0 0-2.15 1.588L2.35 13.177a2.25 2.25 0 0 0-.1.661Z"})])}const ve={class:"flex min-h-screen items-center justify-center p-4"},pe={class:"flex items-center justify-between p-6 border-b border-gray-200"},me={class:"text-xl font-semibold text-gray-900"},fe={class:"flex items-center space-x-3 pb-4 border-b border-gray-200"},ye={class:"flex items-center space-x-2 cursor-pointer"},we={class:"text-sm font-medium text-gray-700"},ke={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ge={class:"relative"},xe={class:"flex items-center space-x-2"},be={key:0,class:"absolute z-10 mt-1 w-full bg-white border border-gray-300 rounded-lg shadow-lg"},_e=["onClick"],he={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},je={key:0},$e=["value"],Se=["value"],Ce={key:1,class:"text-red-600 text-sm bg-red-50 p-3 rounded-lg"},Me={class:"flex justify-end space-x-3 pt-4"},Ve=["disabled"],Be={__name:"TaskModal",props:{show:{type:Boolean,default:!1},task:{type:Object,default:null},serverError:{type:String,default:""}},emits:["close","submit"],setup(n,{emit:c}){const k=n,y=c,S=le(),U=R(),d=ne(),C=V(()=>U.workspaces),g=V(()=>U.currentWorkspace),L=V(()=>d.activeProjects),B=()=>{const t=S.path;return t.includes("/inbox")?"inbox":t.includes("/today")?"today":t.includes("/next-actions")?"next_action":t.includes("/tomorrow")?"tomorrow":t.includes("/waiting")?"waiting":t.includes("/someday")?"someday":"inbox"},P=()=>S.path.includes("/today")?new Date().toISOString().split("T")[0]:"",s=b({title:"",description:"",status:"inbox",priority:"medium",due_date:"",estimated_time:"",end_time:"",workspace_id:null,project_id:null}),u=b(!1),v=b(""),p=b(!1),x=b(null),D={inbox:{label:"Входящие",icon:ce},next_action:{label:"Следующие",icon:ue},today:{label:"Сегодня",icon:K},tomorrow:{label:"Завтра",icon:K},waiting:{label:"Ожидание",icon:de},someday:{label:"Когда-нибудь",icon:ie}},F=t=>{if(s.value.status=t,p.value=!1,t==="today"&&!s.value.due_date){const e=new Date;s.value.due_date=e.toISOString().split("T")[0]}},A=V(()=>s.value.status==="completed"),i=t=>{t.target.checked?s.value.status!=="completed"&&(x.value=s.value.status,s.value.status="completed"):(s.value.status=x.value||"inbox",x.value=null)},o=t=>t?/^\d{4}-\d{2}-\d{2}$/.test(t)?t:t.split("T")[0]:"",r=t=>t?/^\d{2}:\d{2}$/.test(t)?t:t.substring(0,5):"";T(()=>k.task,(t,e)=>{var l,j,E;if(e&&!t){s.value={title:"",description:"",status:"inbox",priority:"medium",due_date:"",estimated_time:"",end_time:"",workspace_id:(l=g.value)==null?void 0:l.id,project_id:null},x.value=null,v.value="",p.value=!1;return}if(t)console.log("Task received:",t),console.log("Original due_date:",t.due_date),console.log("Formatted due_date:",o(t.due_date)),t.status==="completed"?x.value=t.previous_status||"inbox":x.value=t.status||"inbox",s.value={title:t.title||"",description:t.description||"",status:t.status||"inbox",priority:t.priority||"medium",due_date:o(t.due_date),estimated_time:r(t.estimated_time),end_time:r(t.end_time),workspace_id:t.workspace_id||((j=g.value)==null?void 0:j.id),project_id:t.project_id||null};else{const q=B();x.value=q,s.value={title:"",description:"",status:q,priority:"medium",due_date:P(),estimated_time:"",end_time:"",workspace_id:(E=g.value)==null?void 0:E.id,project_id:null}}v.value="",p.value=!1},{immediate:!0}),T(()=>k.serverError,t=>{v.value=t,t&&(u.value=!1)}),T(()=>k.show,t=>{var e,l,j;t?k.task?s.value.workspace_id||(s.value.workspace_id=(l=g.value)==null?void 0:l.id):(s.value.workspace_id=(e=g.value)==null?void 0:e.id,s.value.status=B(),s.value.due_date=P()):(s.value={title:"",description:"",status:"inbox",priority:"medium",due_date:"",estimated_time:"",end_time:"",workspace_id:(j=g.value)==null?void 0:j.id,project_id:null},x.value=null,p.value=!1,u.value=!1,v.value="")}),T(()=>k.show,t=>{var e;t&&((e=g.value)!=null&&e.id)&&d.fetchProjects()}),T(()=>S.path,()=>{if(!k.task){s.value.status=B();const t=P();(t||S.path.includes("/today"))&&(s.value.due_date=t)}}),T(()=>{var t;return(t=g.value)==null?void 0:t.id},t=>{!k.task&&t&&(s.value.workspace_id=t)});const h=()=>{v.value="",u.value=!0,y("submit",s.value)},_=t=>{p.value&&!t.target.closest(".relative")&&(p.value=!1)};return X(()=>{document.addEventListener("click",_)}),Y(()=>{document.removeEventListener("click",_)}),(t,e)=>(f(),H(oe,{to:"body"},[ee(se,{name:"modal"},{default:te(()=>[n.show?(f(),w("div",{key:0,class:"fixed inset-0 z-50 overflow-y-auto",onClick:e[13]||(e[13]=W(l=>t.$emit("close"),["self"]))},[e[27]||(e[27]=a("div",{class:"fixed inset-0 bg-black bg-opacity-50 transition-opacity"},null,-1)),a("div",ve,[a("div",{class:"relative bg-white rounded-lg shadow-xl max-w-2xl w-full mx-auto",onClick:e[12]||(e[12]=W(()=>{},["stop"]))},[a("div",pe,[a("h3",me,M(n.task?"Редактировать задачу":"Новая задача"),1),a("button",{onClick:e[0]||(e[0]=l=>t.$emit("close")),class:"text-gray-400 hover:text-gray-600"},[...e[14]||(e[14]=[a("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),a("form",{onSubmit:W(h,["prevent"]),class:"p-6 space-y-4"},[a("div",fe,[a("label",ye,[$(a("input",{type:"checkbox","onUpdate:modelValue":e[1]||(e[1]=l=>A.value=l),onChange:i,class:"w-5 h-5 text-primary-600 border-gray-300 rounded focus:ring-primary-500"},null,544),[[ae,A.value]]),a("span",we,M(A.value?"Задача выполнена":"Отметить как выполненную"),1)])]),a("div",null,[e[15]||(e[15]=a("label",{for:"title",class:"block text-sm font-medium text-gray-700 mb-2"}," Название задачи * ",-1)),$(a("input",{id:"title","onUpdate:modelValue":e[2]||(e[2]=l=>s.value.title=l),type:"text",required:"",class:G(["input",{"opacity-60":A.value}]),placeholder:"Введите название задачи"},null,2),[[I,s.value.title]])]),a("div",null,[e[16]||(e[16]=a("label",{for:"description",class:"block text-sm font-medium text-gray-700 mb-2"}," Описание ",-1)),$(a("textarea",{id:"description","onUpdate:modelValue":e[3]||(e[3]=l=>s.value.description=l),rows:"3",class:"input",placeholder:"Добавьте описание"},null,512),[[I,s.value.description]])]),a("div",ke,[a("div",null,[e[18]||(e[18]=a("label",{for:"status",class:"block text-sm font-medium text-gray-700 mb-2"}," Статус ",-1)),a("div",ge,[a("button",{type:"button",onClick:e[4]||(e[4]=l=>p.value=!p.value),class:"input w-full flex items-center justify-between"},[a("span",xe,[(f(),H(J(D[s.value.status].icon),{class:"w-5 h-5 text-gray-500"})),a("span",null,M(D[s.value.status].label),1)]),e[17]||(e[17]=a("svg",{class:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})],-1))]),p.value?(f(),w("div",be,[(f(),w(z,null,N(D,(l,j)=>a("button",{key:j,type:"button",onClick:E=>F(j),class:G(["w-full flex items-center space-x-2 px-3 py-2 text-sm hover:bg-gray-50 first:rounded-t-lg last:rounded-b-lg transition-colors",s.value.status===j?"bg-primary-50 text-primary-700":"text-gray-700"])},[(f(),H(J(l.icon),{class:"w-5 h-5"})),a("span",null,M(l.label),1)],10,_e)),64))])):O("",!0)])]),a("div",null,[e[20]||(e[20]=a("label",{for:"priority",class:"block text-sm font-medium text-gray-700 mb-2"}," Приоритет ",-1)),$(a("select",{id:"priority","onUpdate:modelValue":e[5]||(e[5]=l=>s.value.priority=l),class:"input"},[...e[19]||(e[19]=[a("option",{value:"low"},"Низкий",-1),a("option",{value:"medium"},"Средний",-1),a("option",{value:"high"},"Высокий",-1),a("option",{value:"urgent"},"Срочный",-1)])],512),[[Z,s.value.priority]])])]),a("div",he,[a("div",null,[e[21]||(e[21]=a("label",{for:"due_date",class:"block text-sm font-medium text-gray-700 mb-2"}," Срок выполнения ",-1)),$(a("input",{id:"due_date","onUpdate:modelValue":e[6]||(e[6]=l=>s.value.due_date=l),type:"date",class:"input"},null,512),[[I,s.value.due_date]])]),a("div",null,[e[22]||(e[22]=a("label",{for:"estimated_time",class:"block text-sm font-medium text-gray-700 mb-2"}," Время начала ",-1)),$(a("input",{id:"estimated_time","onUpdate:modelValue":e[7]||(e[7]=l=>s.value.estimated_time=l),type:"time",class:"input",placeholder:"12:30"},null,512),[[I,s.value.estimated_time]])])]),a("div",null,[e[23]||(e[23]=a("label",{for:"end_time",class:"block text-sm font-medium text-gray-700 mb-2"}," Время окончания ",-1)),$(a("input",{id:"end_time","onUpdate:modelValue":e[8]||(e[8]=l=>s.value.end_time=l),type:"time",class:"input",placeholder:"13:30"},null,512),[[I,s.value.end_time]])]),C.value.length>1?(f(),w("div",je,[e[24]||(e[24]=a("label",{for:"workspace_id",class:"block text-sm font-medium text-gray-700 mb-2"}," Рабочее пространство ",-1)),$(a("select",{id:"workspace_id","onUpdate:modelValue":e[9]||(e[9]=l=>s.value.workspace_id=l),class:"input"},[(f(!0),w(z,null,N(C.value,l=>(f(),w("option",{key:l.id,value:l.id},M(l.name),9,$e))),128))],512),[[Z,s.value.workspace_id]])])):O("",!0),a("div",null,[e[26]||(e[26]=a("label",{for:"project_id",class:"block text-sm font-medium text-gray-700 mb-2"}," Проект ",-1)),$(a("select",{id:"project_id","onUpdate:modelValue":e[10]||(e[10]=l=>s.value.project_id=l),class:"input"},[e[25]||(e[25]=a("option",{value:null},"Без проекта",-1)),(f(!0),w(z,null,N(L.value,l=>(f(),w("option",{key:l.id,value:l.id},M(l.name),9,Se))),128))],512),[[Z,s.value.project_id]])]),v.value?(f(),w("div",Ce,M(v.value),1)):O("",!0),a("div",Me,[a("button",{type:"button",onClick:e[11]||(e[11]=l=>t.$emit("close")),class:"btn btn-secondary"}," Отмена "),a("button",{type:"submit",disabled:u.value,class:"btn btn-primary"},M(u.value?"Сохранение...":"Сохранить"),9,Ve)])],32)])])])):O("",!0)]),_:1})]))}},Le=re(Be,[["__scopeId","data-v-c9b0523a"]]);export{Le as T,de as a,K as b,ue as c,ce as d,ne as e,ie as r,Te as u};
