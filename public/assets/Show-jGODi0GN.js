import{c as s,a as t,o as l,r as u,A as P,f as v,b as S,D as U,t as E,z as g,e as I,i as D,j as F}from"./index-DjEtL7-U.js";import{u as W}from"./projects-dNZJFWso.js";import{u as q,T as G}from"./TaskModal-CG7VHDAX.js";import{u as J}from"./workspace-IdQpt3R2.js";import{T as K}from"./TaskList-DhO9Zfw7.js";import{T as O}from"./TaskView-NPDxdh6y.js";import{P as Q}from"./ProjectModal-BGkeUvVP.js";import{r as X}from"./RectangleStackIcon-DZ0gF4cw.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";function Y(k,i){return l(),s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m20.25 7.5-.625 10.632a2.25 2.25 0 0 1-2.247 2.118H6.622a2.25 2.25 0 0 1-2.247-2.118L3.75 7.5m8.25 3v6.75m0 0-3-3m3 3 3-3M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125Z"})])}function ee(k,i){return l(),s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 15 3 9m0 0 6-6M3 9h12a6 6 0 0 1 0 12h-3"})])}function re(k,i){return l(),s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L6.832 19.82a4.5 4.5 0 0 1-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 0 1 1.13-1.897L16.863 4.487Zm0 0L19.5 7.125"})])}function te(k,i){return l(),s("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"fill-rule":"evenodd",d:"M12 3.75a.75.75 0 0 1 .75.75v6.75h6.75a.75.75 0 0 1 0 1.5h-6.75v6.75a.75.75 0 0 1-1.5 0v-6.75H4.5a.75.75 0 0 1 0-1.5h6.75V4.5a.75.75 0 0 1 .75-.75Z","clip-rule":"evenodd"})])}const oe={class:"p-4 lg:p-8"},ae={class:"max-w-4xl mx-auto"},se={class:"flex items-center justify-between mb-6"},le={class:"flex items-center space-x-3 min-w-0 flex-1"},ne={class:"min-w-0"},ce={class:"text-xl lg:text-2xl font-semibold text-gray-900 dark:text-white truncate"},ie={key:0,class:"text-sm text-gray-600 dark:text-gray-400 mt-1 truncate"},de={class:"flex items-center space-x-1 flex-shrink-0 ml-2"},ue={key:0,class:"text-center py-12"},ve={key:1},he={key:0,class:"py-12 text-center"},pe={class:"max-w-md mx-auto"},me={class:"w-16 h-16 mx-auto mb-4 rounded-full bg-blue-50 dark:bg-blue-900/30 flex items-center justify-center"},ge={key:1,class:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700"},ke={class:"p-4 border-b border-gray-200 dark:border-gray-700"},we={class:"text-lg font-semibold text-gray-900 dark:text-white"},xe={class:"text-sm font-normal text-gray-500 dark:text-gray-400"},fe={class:"divide-y divide-gray-200 dark:divide-gray-700"},Me={__name:"Show",setup(k){const i=F(),w=D(),x=W(),h=q();J();const o=u(null),p=u([]),T=u(!1),m=u(!1),f=u(!1),y=u(!1),d=u(null),_=u(""),b=u(""),C=async()=>{var c,n;const r=parseInt(i.params.projectId),e=parseInt(i.params.id);if(!e||!r){console.error("Missing workspaceId or projectId",{workspaceId:e,projectId:r});return}T.value=!0;try{const a=await x.fetchProject(r);if(!a){w.push(`/workspaces/${e}/projects`);return}if(o.value=a,o.value.workspace_id!==e){console.error("Project does not belong to workspace from URL"),w.push(`/workspaces/${e}/projects`);return}j()}catch(a){console.error("Error loading project:",a),console.error("Error details:",(c=a.response)==null?void 0:c.data),((n=a.response)==null?void 0:n.status)===404&&w.push(`/workspaces/${e}/projects`)}finally{T.value=!1}},j=()=>{const r=parseInt(i.params.projectId);if(!r){p.value=[];return}p.value=h.allTasks.filter(e=>e.project_id===r)},M=()=>{y.value=!0},$=async()=>{var r;if(confirm(`Архивировать проект "${(r=o.value)==null?void 0:r.name}"?`))try{await x.archiveProject(o.value.id),w.push(`/workspaces/${o.value.workspace_id}/projects`)}catch(e){console.error("Error archiving project:",e),alert("Ошибка при архивировании проекта")}},B=async()=>{try{await x.unarchiveProject(o.value.id),await C()}catch(r){console.error("Error unarchiving project:",r),alert("Ошибка при восстановлении проекта")}},V=()=>{o.value&&(d.value={project_id:o.value.id},m.value=!0)},L=r=>{d.value=r,f.value=!0},N=()=>{f.value=!1,m.value=!0},H=async r=>{var e,c,n;_.value="";try{(e=d.value)!=null&&e.id?await h.updateTask(d.value.id,r):(r.project_id=o.value.id,await h.createTask(r)),m.value=!1,d.value=null,j()}catch(a){console.error("Error saving task:",a),_.value=((n=(c=a.response)==null?void 0:c.data)==null?void 0:n.message)||a.message||"Ошибка при сохранении задачи"}},R=()=>{m.value=!1,d.value=null,_.value=""},Z=async r=>{var e,c;b.value="";try{await x.updateProject(o.value.id,r),y.value=!1,await C()}catch(n){console.error("Error saving project:",n),b.value=((c=(e=n.response)==null?void 0:e.data)==null?void 0:c.message)||n.message||"Ошибка при сохранении проекта"}},z=()=>{y.value=!1,b.value=""},A=async r=>{try{r.status==="completed"?await h.updateTask(r.id,{status:"inbox"}):await h.completeTask(r.id),j()}catch(e){console.error("Error toggling task:",e)}};return P(()=>[i.params.projectId,i.params.id],()=>{C()},{immediate:!0}),P(()=>h.allTasks,()=>{j()},{deep:!0}),(r,e)=>{var c,n,a;return l(),s("div",oe,[t("div",ae,[t("div",se,[t("div",le,[o.value?(l(),s("div",{key:0,class:"w-4 h-4 rounded-full flex-shrink-0",style:U({backgroundColor:o.value.color||"#3B82F6"})},null,4)):S("",!0),t("div",ne,[t("h1",ce,E(((c=o.value)==null?void 0:c.name)||"Загрузка..."),1),(n=o.value)!=null&&n.description?(l(),s("p",ie,E(o.value.description),1)):S("",!0)])]),t("div",de,[t("button",{onClick:M,class:"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",title:"Редактировать"},[v(g(re),{class:"w-5 h-5"})]),((a=o.value)==null?void 0:a.status)!=="archived"?(l(),s("button",{key:0,onClick:$,class:"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",title:"Архивировать"},[v(g(Y),{class:"w-5 h-5"})])):(l(),s("button",{key:1,onClick:B,class:"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",title:"Восстановить"},[v(g(ee),{class:"w-5 h-5"})]))])]),T.value?(l(),s("div",ue,[...e[1]||(e[1]=[t("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"},null,-1)])])):(l(),s("div",ve,[p.value.length===0?(l(),s("div",he,[t("div",pe,[t("div",me,[v(g(X),{class:"w-8 h-8 text-blue-500"})]),e[3]||(e[3]=t("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white mb-2"},"В проекте пока нет задач",-1)),e[4]||(e[4]=t("p",{class:"text-sm text-gray-500 dark:text-gray-400 mb-6 leading-relaxed"}," Проект — это любая цель, требующая более одного действия. Разбейте его на конкретные шаги и добавьте первую задачу, чтобы начать двигаться к результату. ",-1)),t("button",{onClick:V,class:"inline-flex items-center px-4 py-2 bg-primary-600 hover:bg-primary-700 text-white rounded-lg transition-colors text-sm font-medium"},[v(g(te),{class:"w-5 h-5 mr-1.5"}),e[2]||(e[2]=I(" Добавить задачу ",-1))])])])):(l(),s("div",ge,[t("div",ke,[t("h2",we,[e[5]||(e[5]=I(" Задачи проекта ",-1)),t("span",xe," ("+E(p.value.length)+") ",1)])]),t("div",fe,[v(K,{tasks:p.value,onTaskClick:L,onToggleComplete:A},null,8,["tasks"])])]))])),v(O,{show:f.value,task:d.value,onClose:e[0]||(e[0]=ye=>{f.value=!1,d.value=null}),onEnterEdit:N},null,8,["show","task"]),v(G,{show:m.value,task:d.value,"server-error":_.value,onClose:R,onSubmit:H},null,8,["show","task","server-error"]),v(Q,{show:y.value,project:o.value,"server-error":b.value,onClose:z,onSubmit:Z},null,8,["show","project","server-error"])])])}}};export{Me as default};
