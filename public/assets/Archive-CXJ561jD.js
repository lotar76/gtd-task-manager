import{u as F,r as U,T as W}from"./TaskModal-DYQHwC4h.js";import{u as z}from"./workspace-BYVjBJK-.js";import{T as D}from"./TaskList-C1L5RpCc.js";import{T as I}from"./TaskView-DxYmFJch.js";import{k as p,r as k,c as l,a as s,f as h,b,p as w,e as _,t as v,F as C,C as O,l as q,y as G,o as r}from"./index-BJYz_qWG.js";import"./projects-DhmFNHb7.js";import"./lifeSpheres-C_w5SGPO.js";import"./goals-fjQW4waJ.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ru-B7JyRvIu.js";const H={class:"p-4 lg:p-8"},J={class:"max-w-4xl mx-auto"},K={class:"mb-6"},P={key:0,class:"flex flex-wrap gap-2"},Q={class:"ml-1.5 opacity-75"},R=["onClick"],X={class:"ml-1.5 opacity-75"},Y={key:1,class:"text-sm text-gray-500 dark:text-gray-400 mt-3"},Z={key:0,class:"text-center py-12"},ee={key:0,class:"mb-3 flex items-center justify-between"},te={class:"text-sm text-gray-500 dark:text-gray-400"},se={key:2,class:"text-center py-12"},ae={key:3,class:"text-center py-12"},re={class:"max-w-md mx-auto"},oe={class:"w-16 h-16 mx-auto mb-4 rounded-full bg-green-50 dark:bg-green-900/30 flex items-center justify-center"},ye={__name:"Archive",setup(le){const u=F(),E=z(),n=p(()=>u.archivedTasks),S=p(()=>u.loading),m=k(!1),d=k(!1),o=k(null),g=k(""),i=k(null),V=p(()=>{const t={};for(const e of n.value)t[e.workspace_id]=(t[e.workspace_id]||0)+1;return E.workspaces.map(e=>({id:e.id,name:e.name,count:t[e.id]||0})).filter(e=>e.count>0)}),x=p(()=>i.value?n.value.filter(t=>t.workspace_id===i.value):n.value),$=t=>{o.value=t,d.value=!0},j=()=>{d.value=!1,m.value=!0},B=async t=>{try{await u.completeTask(t.id),d.value=!1,o.value=null}catch(e){console.error("Error completing task:",e)}},M=async t=>{try{await u.uncompleteTask(t.id),d.value=!1,o.value=null}catch(e){console.error("Error uncompleting task:",e)}},N=async t=>{try{await u.uncompleteTask(t.id)}catch(e){console.error("Error toggling task:",e)}},L=async t=>{var e,a,y,T;g.value="";try{o.value&&await u.updateTask(o.value.id,t),m.value=!1,o.value=null}catch(c){console.error("Error saving task:",c);let f="Ошибка при сохранении задачи";(a=(e=c.response)==null?void 0:e.data)!=null&&a.errors?f=Object.values(c.response.data.errors).flat().join(", "):(T=(y=c.response)==null?void 0:y.data)!=null&&T.message&&(f=c.response.data.message),g.value=f}},A=()=>{m.value=!1,o.value=null,g.value=""};return(t,e)=>(r(),l("div",H,[s("div",J,[s("div",K,[e[5]||(e[5]=s("h1",{class:"text-xl lg:text-2xl font-semibold text-gray-900 dark:text-white mb-4"},"Архив",-1)),n.value.length>0?(r(),l("div",P,[s("button",{onClick:e[0]||(e[0]=a=>i.value=null),class:w(["inline-flex items-center px-3 py-1.5 text-xs font-medium rounded-full border transition-colors",i.value===null?"border-transparent bg-green-500 text-white":"border-gray-200 dark:border-gray-600 text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700"])},[e[4]||(e[4]=_(" Все ",-1)),s("span",Q,v(n.value.length),1)],2),(r(!0),l(C,null,O(V.value,a=>(r(),l("button",{key:a.id,onClick:y=>i.value=a.id,class:w(["inline-flex items-center px-3 py-1.5 text-xs font-medium rounded-full border transition-colors",i.value===a.id?"border-transparent bg-green-500 text-white":"border-gray-200 dark:border-gray-600 text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700"])},[_(v(a.name)+" ",1),s("span",X,v(a.count),1)],10,R))),128))])):b("",!0),n.value.length>0?(r(),l("p",Y," Показаны последние 20 завершённых задач ")):b("",!0)]),S.value?(r(),l("div",Z,[...e[6]||(e[6]=[s("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"},null,-1)])])):(r(),l(C,{key:1},[n.value.length>0&&i.value?(r(),l("div",ee,[s("span",te," Показано "+v(x.value.length)+" из "+v(n.value.length),1),s("button",{onClick:e[1]||(e[1]=a=>i.value=null),class:"text-xs text-green-600 hover:text-green-700 dark:text-green-400"}," Сбросить фильтр ")])):b("",!0),x.value.length>0?(r(),q(D,{key:1,tasks:x.value,onTaskClick:$,onToggleComplete:N},null,8,["tasks"])):n.value.length>0?(r(),l("div",se,[e[7]||(e[7]=s("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Нет завершённых задач в этом пространстве",-1)),s("button",{onClick:e[2]||(e[2]=a=>i.value=null),class:"mt-2 text-sm text-green-600 hover:text-green-700 dark:text-green-400"}," Показать все ")])):(r(),l("div",ae,[s("div",re,[s("div",oe,[h(G(U),{class:"w-8 h-8 text-green-500"})]),e[8]||(e[8]=s("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white mb-2"},"Архив пуст",-1)),e[9]||(e[9]=s("p",{class:"text-sm text-gray-500 dark:text-gray-400 leading-relaxed"}," Здесь будут отображаться последние 20 завершённых задач. Завершите любую задачу, и она появится здесь. ",-1))])]))],64)),h(I,{show:d.value,task:o.value,onClose:e[3]||(e[3]=a=>{d.value=!1,o.value=null}),onEnterEdit:j,onCompleteTask:B,onUncompleteTask:M},null,8,["show","task"]),h(W,{show:m.value,task:o.value,"server-error":g.value,onClose:A,onSubmit:L},null,8,["show","task","server-error"])])]))}};export{ye as default};
