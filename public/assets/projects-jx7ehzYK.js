import{G,r as P,k as v,H as l}from"./index-Gx0RcN7_.js";import{u as H}from"./workspace-B6_fDG2E.js";const q=G("projects",()=>{const t=P([]),i=P(!1),p=P(!1),d=H(),S=v(()=>d.selectedWorkspaces.map(e=>e.id)),w=v(()=>{const e=S.value;return e.length?t.value.filter(s=>e.includes(s.workspace_id)):[]}),m=v(()=>w.value.filter(e=>e.status==="active"||!e.status)),W=v(()=>w.value.filter(e=>e.status==="archived")),_=async({force:e=!1,includeArchived:s=!1}={})=>{if(!(p.value&&!e)){i.value=!0;try{const a=s?{include_archived:!0}:{},n=await l.get("/v1/projects",{params:a});t.value=n.data.data||n.data||[],p.value=!0}finally{i.value=!1}}},$=async e=>{var r;const s=(e==null?void 0:e.workspace_id)||((r=d.currentWorkspace)==null?void 0:r.id);if(!s){console.error("Cannot create project: workspace_id not found");return}e.workspace_id=s;const a=await l.post(`/v1/workspaces/${s}/projects`,e),n=a.data.data||a.data;return t.value.unshift(n),n},k=async(e,s)=>{var f;const a=t.value.find(h=>h.id===e),n=(a==null?void 0:a.workspace_id)||(s==null?void 0:s.workspace_id)||((f=d.currentWorkspace)==null?void 0:f.id);if(!n){console.error("Cannot update project: workspace_id not found");return}const r={...s};delete r.workspace_id;const c=await l.put(`/v1/workspaces/${n}/projects/${e}`,r),o=c.data.data||c.data,u=t.value.findIndex(h=>h.id===e);return u!==-1&&(t.value[u]=o),o},x=async e=>(t.value.find(s=>s.id===e),await k(e,{status:"archived"})),g=async e=>(t.value.find(s=>s.id===e),await k(e,{status:"active"})),C=async e=>{var n;const s=t.value.find(r=>r.id===e),a=(s==null?void 0:s.workspace_id)||((n=d.currentWorkspace)==null?void 0:n.id);if(!a){console.error("Cannot delete project: workspace_id not found");return}await l.delete(`/v1/workspaces/${a}/projects/${e}`),t.value=t.value.filter(r=>r.id!==e)},A=async e=>{var r;const s=t.value.find(c=>c.id===e);if(s)return s;const a=t.value.find(c=>c.id===e),n=(a==null?void 0:a.workspace_id)||((r=d.currentWorkspace)==null?void 0:r.id);if(!n)return null;i.value=!0;try{const c=await l.get(`/v1/workspaces/${n}/projects/${e}`),o=c.data.data||c.data,u=t.value.findIndex(f=>f.id===e);return u===-1?t.value.push(o):t.value[u]=o,o}finally{i.value=!1}};let y=null;return{allProjects:t,loading:i,loaded:p,filteredProjects:w,activeProjects:m,archivedProjects:W,fetchAllProjects:_,fetchProject:A,createProject:$,updateProject:k,archiveProject:x,unarchiveProject:g,deleteProject:C,startSync:()=>{y=setInterval(()=>_({force:!0}),5*60*1e3)},stopSync:()=>{y&&clearInterval(y)}}});export{q as u};
