import{I as se,r as _,k as p,G as h,c as w,a,o as c,B,s as ae,x as oe,l as R,f as re,g as le,b as z,w as q,t as I,d as $,J as ne,v as W,p as ee,m as te,F as G,z as J,D as K,T as ie,C as de,j as ue}from"./index-ClmPpOKJ.js";import{u as X}from"./workspace-DvgHGsNB.js";import{_ as ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Ae=se("tasks",()=>{const r=_([]),v=_(!1),k=_(!1),m=_(localStorage.getItem("taskViewMode")||"list"),b=X(),P=p(()=>b.selectedWorkspaces.map(e=>e.id)),g=p(()=>{const e=P.value;return e.length?r.value.filter(t=>e.includes(t.workspace_id)):[]}),j=p(()=>g.value.filter(e=>e.status==="inbox")),x=p(()=>g.value.filter(e=>e.status==="next_action")),D=p(()=>g.value.filter(e=>e.status==="today")),C=p(()=>g.value.filter(e=>e.status==="tomorrow")),M=p(()=>g.value.filter(e=>e.status==="waiting")),o=p(()=>g.value.filter(e=>e.status==="someday")),l=p(()=>g.value.filter(e=>e.status==="scheduled")),i=p(()=>({inbox:j.value.length,next_actions:x.value.length,today:D.value.length,tomorrow:C.value.length,waiting:M.value.length,someday:o.value.length,scheduled:l.value.length})),d=(e,t)=>g.value.filter(n=>{if(!n.due_date)return!1;const u=n.due_date.substring(0,10);return u>=e&&u<=t}),y=async({force:e=!1}={})=>{var t;if(!(k.value&&!e)){v.value=!0;try{const n=await h.get("/v1/tasks");r.value=((t=n.data.data)==null?void 0:t.tasks)||n.data.tasks||n.data||[],k.value=!0}finally{v.value=!1}}},S=e=>{const t={...e};return t.estimated_time===""&&(t.estimated_time=null),t.due_date===""&&(t.due_date=null),t.description===""&&(t.description=null),(t.project_id===""||t.project_id===null)&&(t.project_id=null),t},U=async e=>{var T;const t=(e==null?void 0:e.workspace_id)||((T=b.currentWorkspace)==null?void 0:T.id);if(!t){console.error("Cannot create task: workspace_id not found");return}const n=S(e);n.workspace_id=t;const u=await h.post(`/v1/workspaces/${t}/tasks`,n),f=u.data.data||u.data;return f.status!=="completed"&&r.value.unshift(f),f},O=async(e,t)=>{var Y;const n=r.value.find(N=>N.id===e),u=(n==null?void 0:n.workspace_id)||(t==null?void 0:t.workspace_id)||((Y=b.currentWorkspace)==null?void 0:Y.id);if(!u){console.error("Cannot update task: workspace_id not found");return}const f=S(t);delete f.workspace_id;const T=await h.put(`/v1/workspaces/${u}/tasks/${e}`,f),V=T.data.data||T.data,Z=r.value.findIndex(N=>N.id===e);return Z!==-1&&(V.status==="completed"?r.value.splice(Z,1):r.value[Z]=V),V},E=async e=>{var T;const t=r.value.findIndex(V=>V.id===e);if(t===-1)return;const n=r.value[t],u=n.workspace_id||((T=b.currentWorkspace)==null?void 0:T.id);if(!u){console.error("Cannot complete task: workspace_id not found");return}const f={...n};r.value.splice(t,1);try{await h.post(`/v1/workspaces/${u}/tasks/${e}/complete`)}catch(V){throw r.value.splice(t,0,f),V}},A=async e=>{var u;const t=r.value.find(f=>f.id===e),n=(t==null?void 0:t.workspace_id)||((u=b.currentWorkspace)==null?void 0:u.id);if(!n){console.error("Cannot delete task: workspace_id not found");return}await h.delete(`/v1/workspaces/${n}/tasks/${e}`),r.value=r.value.filter(f=>f.id!==e)},F=e=>{m.value=e,localStorage.setItem("taskViewMode",e)};let L=null;return{allTasks:r,loading:v,loaded:k,filteredTasks:g,inboxTasks:j,nextActionTasks:x,todayTasks:D,tomorrowTasks:C,waitingTasks:M,somedayTasks:o,scheduledTasks:l,counts:i,calendarTasks:d,viewMode:m,fetchAllTasks:y,createTask:U,updateTask:O,completeTask:E,deleteTask:A,setViewMode:F,startSync:()=>{L=setInterval(()=>y({force:!0}),5*60*1e3)},stopSync:()=>{L&&clearInterval(L)}}}),pe=se("projects",()=>{const r=_([]),v=_(!1),k=X(),m=p(()=>{var l;return(l=k.currentWorkspace)==null?void 0:l.id}),b=async(l=!1)=>{if(m.value){v.value=!0;try{const i=l?{include_archived:!0}:{},d=await h.get(`/v1/workspaces/${m.value}/projects`,{params:i});r.value=d.data.data||d.data||[]}finally{v.value=!1}}},P=async l=>{if(m.value){v.value=!0;try{const i=await h.get(`/v1/workspaces/${m.value}/projects/${l}`);return i.data.data||i.data}finally{v.value=!1}}},g=async l=>{if(!m.value)return;const i=await h.post(`/v1/workspaces/${m.value}/projects`,l),d=i.data.data||i.data;return r.value.push(d),d},j=async(l,i)=>{if(!m.value)return;const d=await h.put(`/v1/workspaces/${m.value}/projects/${l}`,i),y=d.data.data||d.data,S=r.value.findIndex(U=>U.id===l);return S!==-1&&(r.value[S]=y),y},x=async l=>await j(l,{status:"archived"}),D=async l=>await j(l,{status:"active"}),C=async l=>{m.value&&(await h.delete(`/v1/workspaces/${m.value}/projects/${l}`),r.value=r.value.filter(i=>i.id!==l))},M=p(()=>r.value.filter(l=>l.status==="active"||!l.status)),o=p(()=>r.value.filter(l=>l.status==="archived"));return{projects:r,activeProjects:M,archivedProjects:o,loading:v,fetchProjects:b,fetchProject:P,createProject:g,updateProject:j,archiveProject:x,unarchiveProject:D,deleteProject:C}});function ve(r,v){return c(),w("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m20.25 7.5-.625 10.632a2.25 2.25 0 0 1-2.247 2.118H6.622a2.25 2.25 0 0 1-2.247-2.118L3.75 7.5M10 11.25h4M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125Z"})])}function me(r,v){return c(),w("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m3.75 13.5 10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75Z"})])}function Q(r,v){return c(),w("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5"})])}function fe(r,v){return c(),w("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})])}function ke(r,v){return c(),w("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.25 13.5h3.86a2.25 2.25 0 0 1 2.012 1.244l.256.512a2.25 2.25 0 0 0 2.013 1.244h3.218a2.25 2.25 0 0 0 2.013-1.244l.256-.512a2.25 2.25 0 0 1 2.013-1.244h3.859m-19.5.338V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18v-4.162c0-.224-.034-.447-.1-.661L19.24 5.338a2.25 2.25 0 0 0-2.15-1.588H6.911a2.25 2.25 0 0 0-2.15 1.588L2.35 13.177a2.25 2.25 0 0 0-.1.661Z"})])}const ge={class:"flex min-h-screen items-center justify-center p-4"},ye={class:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700"},we={class:"text-xl font-semibold text-gray-900 dark:text-white"},xe={class:"flex items-center space-x-3 pb-4 border-b border-gray-200 dark:border-gray-700"},be={class:"flex items-center space-x-2 cursor-pointer"},_e={class:"text-sm font-medium text-gray-700 dark:text-gray-300"},he={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},je={class:"relative"},Se={class:"flex items-center space-x-2"},$e={key:0,class:"absolute z-10 mt-1 w-full bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg shadow-lg"},Ce=["onClick"],Me={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Te={key:0},Ie=["value"],Ve=["value"],Be={key:1,class:"text-red-600 dark:text-red-400 text-sm bg-red-50 dark:bg-red-900/20 p-3 rounded-lg"},Pe={class:"flex justify-end space-x-3 pt-4"},De=["disabled"],Oe={__name:"TaskModal",props:{show:{type:Boolean,default:!1},task:{type:Object,default:null},serverError:{type:String,default:""},defaultDate:{type:String,default:""}},emits:["close","submit"],setup(r,{emit:v}){const k=r,m=v,b=ue(),P=X(),g=pe(),j=p(()=>P.workspaces),x=p(()=>P.currentWorkspace),D=p(()=>g.activeProjects),C=()=>{const s=b.path;return s.includes("/inbox")?"inbox":s.includes("/today")?"today":s.includes("/next-actions")?"next_action":s.includes("/tomorrow")?"tomorrow":s.includes("/waiting")?"waiting":s.includes("/someday")?"someday":"inbox"},M=()=>{const s=b.path;if(s.includes("/today"))return new Date().toISOString().split("T")[0];if(s.includes("/tomorrow")){const e=new Date;return e.setDate(e.getDate()+1),e.toISOString().split("T")[0]}return""},o=_({title:"",description:"",status:"inbox",priority:"medium",due_date:"",estimated_time:"",end_time:"",workspace_id:null,project_id:null}),l=_(!1),i=_(""),d=_(!1),y=_(null),S={inbox:{label:"Входящие",icon:ke},next_action:{label:"Следующие",icon:me},today:{label:"Сегодня",icon:Q},tomorrow:{label:"Завтра",icon:Q},waiting:{label:"Ожидание",icon:fe},someday:{label:"Когда-нибудь",icon:ve},scheduled:{label:"Запланировано",icon:Q}},U=s=>{if(o.value.status=s,d.value=!1,s==="today"){const e=new Date;o.value.due_date=e.toISOString().split("T")[0]}else if(s==="tomorrow"){const e=new Date;e.setDate(e.getDate()+1),o.value.due_date=e.toISOString().split("T")[0]}},O=p(()=>o.value.status==="completed"),E=s=>{s.target.checked?o.value.status!=="completed"&&(y.value=o.value.status,o.value.status="completed"):(o.value.status=y.value||"inbox",y.value=null)},A=s=>s?/^\d{4}-\d{2}-\d{2}$/.test(s)?s:s.split("T")[0]:"",F=s=>s?/^\d{2}:\d{2}$/.test(s)?s:s.substring(0,5):"";B(()=>k.task,(s,e)=>{var t,n,u;if(e&&!s){o.value={title:"",description:"",status:"inbox",priority:"medium",due_date:"",estimated_time:"",end_time:"",workspace_id:(t=x.value)==null?void 0:t.id,project_id:null},y.value=null,i.value="",d.value=!1;return}if(s)console.log("Task received:",s),console.log("Original due_date:",s.due_date),console.log("Formatted due_date:",A(s.due_date)),s.status==="completed"?y.value=s.previous_status||"inbox":y.value=s.status||"inbox",o.value={title:s.title||"",description:s.description||"",status:s.status||"inbox",priority:s.priority||"medium",due_date:A(s.due_date),estimated_time:F(s.estimated_time),end_time:F(s.end_time),workspace_id:s.workspace_id||((n=x.value)==null?void 0:n.id),project_id:s.project_id||null};else{const f=C();y.value=f,o.value={title:"",description:"",status:f,priority:"medium",due_date:M(),estimated_time:"",end_time:"",workspace_id:(u=x.value)==null?void 0:u.id,project_id:null}}i.value="",d.value=!1},{immediate:!0}),B(()=>k.serverError,s=>{i.value=s,s&&(l.value=!1)}),B(()=>k.show,s=>{var e,t,n;s?k.task?o.value.workspace_id||(o.value.workspace_id=(t=x.value)==null?void 0:t.id):(o.value.workspace_id=(e=x.value)==null?void 0:e.id,o.value.status=C(),o.value.due_date=k.defaultDate||M()):(o.value={title:"",description:"",status:"inbox",priority:"medium",due_date:"",estimated_time:"",end_time:"",workspace_id:(n=x.value)==null?void 0:n.id,project_id:null},y.value=null,d.value=!1,l.value=!1,i.value="")}),B(()=>k.show,s=>{var e;s&&((e=x.value)!=null&&e.id)&&g.fetchProjects()}),B(()=>b.path,()=>{if(!k.task){o.value.status=C();const s=M();(s||b.path.includes("/today"))&&(o.value.due_date=s)}}),B(()=>{var s;return(s=x.value)==null?void 0:s.id},s=>{!k.task&&s&&(o.value.workspace_id=s)}),B(()=>o.value.due_date,s=>{if(!s||o.value.status==="completed")return;const e=new Date().toISOString().split("T")[0],t=new Date;t.setDate(t.getDate()+1);const n=t.toISOString().split("T")[0];s===e?o.value.status="today":s===n?o.value.status="tomorrow":["today","tomorrow","completed"].includes(o.value.status)||(o.value.status="scheduled")});const L=()=>{i.value="",l.value=!0,m("submit",o.value)},H=s=>{d.value&&!s.target.closest(".relative")&&(d.value=!1)};return ae(()=>{document.addEventListener("click",H)}),oe(()=>{document.removeEventListener("click",H)}),(s,e)=>(c(),R(de,{to:"body"},[re(ie,{name:"modal"},{default:le(()=>[r.show?(c(),w("div",{key:0,class:"fixed inset-0 z-50 overflow-y-auto",onClick:e[13]||(e[13]=q(t=>s.$emit("close"),["self"]))},[e[27]||(e[27]=a("div",{class:"fixed inset-0 bg-black bg-opacity-50 transition-opacity"},null,-1)),a("div",ge,[a("div",{class:"relative bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full mx-auto",onClick:e[12]||(e[12]=q(()=>{},["stop"]))},[a("div",ye,[a("h3",we,I(r.task?"Редактировать задачу":"Новая задача"),1),a("button",{onClick:e[0]||(e[0]=t=>s.$emit("close")),class:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"},[...e[14]||(e[14]=[a("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),a("form",{onSubmit:q(L,["prevent"]),class:"p-6 space-y-4"},[a("div",xe,[a("label",be,[$(a("input",{type:"checkbox","onUpdate:modelValue":e[1]||(e[1]=t=>O.value=t),onChange:E,class:"w-5 h-5 text-primary-600 border-gray-300 dark:border-gray-600 rounded focus:ring-primary-500 dark:bg-gray-700"},null,544),[[ne,O.value]]),a("span",_e,I(O.value?"Задача выполнена":"Отметить как выполненную"),1)])]),a("div",null,[e[15]||(e[15]=a("label",{for:"title",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Название задачи * ",-1)),$(a("input",{id:"title","onUpdate:modelValue":e[2]||(e[2]=t=>o.value.title=t),type:"text",required:"",class:ee(["input",{"opacity-60":O.value}]),placeholder:"Введите название задачи"},null,2),[[W,o.value.title]])]),a("div",null,[e[16]||(e[16]=a("label",{for:"description",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Описание ",-1)),$(a("textarea",{id:"description","onUpdate:modelValue":e[3]||(e[3]=t=>o.value.description=t),rows:"3",class:"input",placeholder:"Добавьте описание"},null,512),[[W,o.value.description]])]),a("div",he,[a("div",null,[e[18]||(e[18]=a("label",{for:"status",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Статус ",-1)),a("div",je,[a("button",{type:"button",onClick:e[4]||(e[4]=t=>d.value=!d.value),class:"input w-full flex items-center justify-between"},[a("span",Se,[(c(),R(te(S[o.value.status].icon),{class:"w-5 h-5 text-gray-500 dark:text-gray-400"})),a("span",null,I(S[o.value.status].label),1)]),e[17]||(e[17]=a("svg",{class:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})],-1))]),d.value?(c(),w("div",$e,[(c(),w(G,null,J(S,(t,n)=>a("button",{key:n,type:"button",onClick:u=>U(n),class:ee(["w-full flex items-center space-x-2 px-3 py-2 text-sm hover:bg-gray-50 dark:hover:bg-gray-600 first:rounded-t-lg last:rounded-b-lg transition-colors",o.value.status===n?"bg-primary-50 dark:bg-primary-900/30 text-primary-700 dark:text-primary-400":"text-gray-700 dark:text-gray-300"])},[(c(),R(te(t.icon),{class:"w-5 h-5"})),a("span",null,I(t.label),1)],10,Ce)),64))])):z("",!0)])]),a("div",null,[e[20]||(e[20]=a("label",{for:"priority",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Приоритет ",-1)),$(a("select",{id:"priority","onUpdate:modelValue":e[5]||(e[5]=t=>o.value.priority=t),class:"input"},[...e[19]||(e[19]=[a("option",{value:"low"},"Низкий",-1),a("option",{value:"medium"},"Средний",-1),a("option",{value:"high"},"Высокий",-1),a("option",{value:"urgent"},"Срочный",-1)])],512),[[K,o.value.priority]])])]),a("div",Me,[a("div",null,[e[21]||(e[21]=a("label",{for:"due_date",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Срок выполнения ",-1)),$(a("input",{id:"due_date","onUpdate:modelValue":e[6]||(e[6]=t=>o.value.due_date=t),type:"date",class:"input"},null,512),[[W,o.value.due_date]])]),a("div",null,[e[22]||(e[22]=a("label",{for:"estimated_time",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Время начала ",-1)),$(a("input",{id:"estimated_time","onUpdate:modelValue":e[7]||(e[7]=t=>o.value.estimated_time=t),type:"time",class:"input",placeholder:"12:30"},null,512),[[W,o.value.estimated_time]])])]),a("div",null,[e[23]||(e[23]=a("label",{for:"end_time",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Время окончания ",-1)),$(a("input",{id:"end_time","onUpdate:modelValue":e[8]||(e[8]=t=>o.value.end_time=t),type:"time",class:"input",placeholder:"13:30"},null,512),[[W,o.value.end_time]])]),j.value.length>1?(c(),w("div",Te,[e[24]||(e[24]=a("label",{for:"workspace_id",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Рабочее пространство ",-1)),$(a("select",{id:"workspace_id","onUpdate:modelValue":e[9]||(e[9]=t=>o.value.workspace_id=t),class:"input"},[(c(!0),w(G,null,J(j.value,t=>(c(),w("option",{key:t.id,value:t.id},I(t.name),9,Ie))),128))],512),[[K,o.value.workspace_id]])])):z("",!0),a("div",null,[e[26]||(e[26]=a("label",{for:"project_id",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Проект ",-1)),$(a("select",{id:"project_id","onUpdate:modelValue":e[10]||(e[10]=t=>o.value.project_id=t),class:"input"},[e[25]||(e[25]=a("option",{value:null},"Без проекта",-1)),(c(!0),w(G,null,J(D.value,t=>(c(),w("option",{key:t.id,value:t.id},I(t.name),9,Ve))),128))],512),[[K,o.value.project_id]])]),i.value?(c(),w("div",Be,I(i.value),1)):z("",!0),a("div",Pe,[a("button",{type:"button",onClick:e[11]||(e[11]=t=>s.$emit("close")),class:"btn btn-secondary"}," Отмена "),a("button",{type:"submit",disabled:l.value,class:"btn btn-primary"},I(l.value?"Сохранение...":"Сохранить"),9,De)])],32)])])])):z("",!0)]),_:1})]))}},Fe=ce(Oe,[["__scopeId","data-v-4aa7d7d5"]]);export{Fe as T,fe as a,Q as b,me as c,ke as d,pe as e,ve as r,Ae as u};
