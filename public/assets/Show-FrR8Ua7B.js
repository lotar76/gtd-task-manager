import{r as d,B as C,c as l,a,f as x,b as _,E as L,t as T,e as U,i as z,j as A,o as n}from"./index-MzOD3XP9.js";import{u as F}from"./projects-T51eDYB8.js";import{u as H,T as W}from"./TaskModal-CSXCzbJv.js";import{u as q}from"./workspace-hJjFiezT.js";import{T as D}from"./TaskList-BajDOjDO.js";import{P as G}from"./ProjectModal-BsAk70PG.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ru-B7JyRvIu.js";const J={class:"p-4 lg:p-8"},K={class:"max-w-4xl mx-auto"},O={class:"flex flex-col lg:flex-row lg:items-center lg:justify-between mb-6"},Q={class:"flex items-center space-x-3 mb-4 lg:mb-0"},X={class:"text-xl lg:text-2xl font-semibold text-gray-900 dark:text-white"},Y={key:0,class:"text-sm text-gray-600 dark:text-gray-400 mt-1"},Z={class:"flex items-center space-x-2"},ee={key:0,class:"text-center py-12"},re={key:1},te={class:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700"},ae={class:"p-4 border-b border-gray-200 dark:border-gray-700"},oe={class:"text-lg font-semibold text-gray-900 dark:text-white"},se={key:0,class:"text-sm font-normal text-gray-500 dark:text-gray-400"},le={key:0,class:"p-12 text-center text-gray-500 dark:text-gray-400"},ne={key:1,class:"divide-y divide-gray-200 dark:divide-gray-700"},ge={__name:"Show",setup(ce){const v=A(),j=z(),m=F(),u=H();q();const t=d(null),p=d([]),b=d(!1),k=d(!1),h=d(!1),c=d(null),g=d(""),y=d(""),w=async()=>{var s,o;const r=parseInt(v.params.projectId),e=parseInt(v.params.id);if(!e||!r){console.error("Missing workspaceId or projectId",{workspaceId:e,projectId:r});return}b.value=!0;try{const i=await m.fetchProject(r);if(t.value=i,t.value.workspace_id!==e){console.error("Project does not belong to workspace from URL"),j.push(`/workspaces/${e}/projects`);return}f()}catch(i){console.error("Error loading project:",i),console.error("Error details:",(s=i.response)==null?void 0:s.data),((o=i.response)==null?void 0:o.status)===404&&j.push(`/workspaces/${e}/projects`)}finally{b.value=!1}},f=()=>{const r=parseInt(v.params.projectId);if(!r){p.value=[];return}p.value=u.allTasks.filter(e=>e.project_id===r)},P=()=>{h.value=!0},E=async()=>{var r;if(confirm(`Архивировать проект "${(r=t.value)==null?void 0:r.name}"?`))try{await m.archiveProject(t.value.id),j.push(`/workspaces/${t.value.workspace_id}/projects`)}catch(e){console.error("Error archiving project:",e),alert("Ошибка при архивировании проекта")}},S=async()=>{try{await m.unarchiveProject(t.value.id),await w()}catch(r){console.error("Error unarchiving project:",r),alert("Ошибка при восстановлении проекта")}},I=()=>{c.value={project_id:t.value.id},k.value=!0},M=r=>{c.value=r,k.value=!0},B=async r=>{var e,s;g.value="";try{c.value||(r.project_id=t.value.id),c.value?await u.updateTask(c.value.id,r):await u.createTask(r),k.value=!1,c.value=null,f()}catch(o){console.error("Error saving task:",o),g.value=((s=(e=o.response)==null?void 0:e.data)==null?void 0:s.message)||o.message||"Ошибка при сохранении задачи"}},V=()=>{k.value=!1,c.value=null,g.value=""},N=async r=>{var e,s;y.value="";try{await m.updateProject(t.value.id,r),h.value=!1,await w()}catch(o){console.error("Error saving project:",o),y.value=((s=(e=o.response)==null?void 0:e.data)==null?void 0:s.message)||o.message||"Ошибка при сохранении проекта"}},$=()=>{h.value=!1,y.value=""},R=async r=>{try{r.status==="completed"?await u.updateTask(r.id,{status:"inbox"}):await u.completeTask(r.id),f()}catch(e){console.error("Error toggling task:",e)}};return C(()=>[v.params.projectId,v.params.id],()=>{w()},{immediate:!0}),C(()=>u.allTasks,()=>{f()},{deep:!0}),(r,e)=>{var s,o,i;return n(),l("div",J,[a("div",K,[a("div",O,[a("div",Q,[t.value?(n(),l("div",{key:0,class:"w-4 h-4 rounded-full",style:L({backgroundColor:t.value.color||"#3B82F6"})},null,4)):_("",!0),a("div",null,[a("h1",X,T(((s=t.value)==null?void 0:s.name)||"Загрузка..."),1),(o=t.value)!=null&&o.description?(n(),l("p",Y,T(t.value.description),1)):_("",!0)])]),a("div",Z,[a("button",{onClick:P,class:"btn btn-secondary"}," Редактировать "),((i=t.value)==null?void 0:i.status)!=="archived"?(n(),l("button",{key:0,onClick:E,class:"btn btn-secondary"}," Архивировать ")):(n(),l("button",{key:1,onClick:S,class:"btn btn-secondary"}," Восстановить "))])]),b.value?(n(),l("div",ee,[...e[0]||(e[0]=[a("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"},null,-1)])])):(n(),l("div",re,[a("div",te,[a("div",ae,[a("h2",oe,[e[1]||(e[1]=U(" Задачи проекта ",-1)),p.value.length>0?(n(),l("span",se," ("+T(p.value.length)+") ",1)):_("",!0)])]),p.value.length===0?(n(),l("div",le,[e[2]||(e[2]=a("svg",{class:"w-16 h-16 mx-auto mb-4 text-gray-300 dark:text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})],-1)),e[3]||(e[3]=a("p",null,"Нет задач в проекте",-1)),a("button",{onClick:I,class:"mt-4 btn btn-primary"}," Создать задачу ")])):(n(),l("div",ne,[x(D,{tasks:p.value,onTaskClick:M,onToggleComplete:R},null,8,["tasks"])]))])])),x(W,{show:k.value,task:c.value,"server-error":g.value,onClose:V,onSubmit:B},null,8,["show","task","server-error"]),x(G,{show:h.value,project:t.value,"server-error":y.value,onClose:$,onSubmit:N},null,8,["show","project","server-error"])])])}}};export{ge as default};
