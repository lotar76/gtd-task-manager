import{E as W,r as k,k as f,H as i}from"./index-B82rmahJ.js";import{u as C}from"./workspace-BO8xjwdg.js";const I=W("goals",()=>{const r=k([]),v=k(!1),m=k(!1),p=C(),G=f(()=>p.selectedWorkspaces.map(e=>e.id)),w=f(()=>{const e=G.value;return e.length?r.value.filter(s=>e.includes(s.workspace_id)):[]}),_=f(()=>w.value.filter(e=>e.status==="active"||!e.status)),h=f(()=>w.value.filter(e=>e.status==="archived")),$=f(()=>w.value.filter(e=>e.status==="completed"));return{allGoals:r,loading:v,loaded:m,filteredGoals:w,activeGoals:_,archivedGoals:h,completedGoals:$,fetchAllGoals:async({force:e=!1}={})=>{if(!(m.value&&!e)){v.value=!0;try{const s=await i.get("/v1/goals");r.value=s.data.data||s.data||[],m.value=!0}finally{v.value=!1}}},fetchGoal:async(e,s)=>{const t=await i.get(`/v1/workspaces/${e}/goals/${s}`);return t.data.data||t.data},createGoal:async e=>{var a;const s=(e==null?void 0:e.workspace_id)||((a=p.currentWorkspace)==null?void 0:a.id);if(!s){console.error("Cannot create goal: workspace_id not found");return}e.workspace_id=s;let t;if(e.imageFile){const c=new FormData;c.append("image",e.imageFile),Object.keys(e).forEach(o=>{o!=="imageFile"&&e[o]!==null&&e[o]!==void 0&&c.append(o,e[o])}),t=await i.post(`/v1/workspaces/${s}/goals`,c,{headers:{"Content-Type":"multipart/form-data"}})}else{const{imageFile:c,...o}=e;t=await i.post(`/v1/workspaces/${s}/goals`,o)}const n=t.data.data||t.data;return r.value.unshift(n),n},updateGoal:async(e,s)=>{var u;const t=r.value.find(d=>d.id===e),n=(t==null?void 0:t.workspace_id)||(s==null?void 0:s.workspace_id)||((u=p.currentWorkspace)==null?void 0:u.id);if(!n){console.error("Cannot update goal: workspace_id not found");return}let a;if(s.imageFile){const d=new FormData;d.append("_method","PUT"),d.append("image",s.imageFile),Object.keys(s).forEach(l=>{l==="imageFile"||l==="workspace_id"||s[l]!==null&&s[l]!==void 0&&d.append(l,s[l])}),a=await i.post(`/v1/workspaces/${n}/goals/${e}`,d,{headers:{"Content-Type":"multipart/form-data"}})}else{const{imageFile:d,workspace_id:l,...F}=s;a=await i.put(`/v1/workspaces/${n}/goals/${e}`,F)}const c=a.data.data||a.data,o=r.value.findIndex(d=>d.id===e);return o!==-1&&(r.value[o]=c),c},deleteGoal:async e=>{var n;const s=r.value.find(a=>a.id===e),t=(s==null?void 0:s.workspace_id)||((n=p.currentWorkspace)==null?void 0:n.id);if(!t){console.error("Cannot delete goal: workspace_id not found");return}await i.delete(`/v1/workspaces/${t}/goals/${e}`),r.value=r.value.filter(a=>a.id!==e)},deleteGoalImage:async e=>{var o;const s=r.value.find(u=>u.id===e),t=(s==null?void 0:s.workspace_id)||((o=p.currentWorkspace)==null?void 0:o.id);if(!t){console.error("Cannot delete goal image: workspace_id not found");return}const n=await i.delete(`/v1/workspaces/${t}/goals/${e}/image`),a=n.data.data||n.data,c=r.value.findIndex(u=>u.id===e);return c!==-1&&(r.value[c]=a),a}}});export{I as u};
