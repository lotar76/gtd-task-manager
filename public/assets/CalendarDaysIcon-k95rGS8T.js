import{E as N,r as k,k as l,H as v,c as O,a as q,o as F}from"./index-BQRmz4GQ.js";import{u as G}from"./workspace-DTkHaZL8.js";const Q=N("tasks",()=>{const a=k([]),p=k(!1),f=k(!1),m=k(localStorage.getItem("taskViewMode")||"list"),u=G(),_=l(()=>u.selectedWorkspaces.map(e=>e.id)),d=l(()=>{const e=_.value;return e.length?a.value.filter(t=>e.includes(t.workspace_id)&&!t.completed_at):[]}),g=l(()=>d.value.filter(e=>e.status==="inbox")),y=l(()=>d.value.filter(e=>e.status==="next_action")),T=l(()=>d.value.filter(e=>e.status==="today")),x=l(()=>d.value.filter(e=>e.status==="tomorrow")),S=l(()=>d.value.filter(e=>e.status==="waiting")),Z=l(()=>d.value.filter(e=>e.status==="someday")),I=l(()=>d.value.filter(e=>e.status==="scheduled")),$=l(()=>{const e=_.value;return e.length?a.value.filter(t=>e.includes(t.workspace_id)&&t.completed_at).sort((t,s)=>new Date(s.completed_at||s.updated_at)-new Date(t.completed_at||t.updated_at)).slice(0,20):[]}),W=l(()=>({inbox:g.value.length,next_actions:y.value.length,today:T.value.length,tomorrow:x.value.length,waiting:S.value.length,someday:Z.value.length,scheduled:I.value.length})),A=(e,t)=>d.value.filter(s=>{if(!s.due_date)return!1;const o=s.due_date.substring(0,10);return o>=e&&o<=t}),H=async({force:e=!1}={})=>{var t;if(!(f.value&&!e)){p.value=!0;try{const s=await v.get("/v1/tasks");a.value=((t=s.data.data)==null?void 0:t.tasks)||s.data.tasks||s.data||[],f.value=!0}finally{p.value=!1}}},M=e=>{const t={...e};return t.estimated_time===""&&(t.estimated_time=null),t.due_date===""&&(t.due_date=null),t.description===""&&(t.description=null),(t.project_id===""||t.project_id===null)&&(t.project_id=null),t},C=async e=>{var c;const t=(e==null?void 0:e.workspace_id)||((c=u.currentWorkspace)==null?void 0:c.id);if(!t){console.error("Cannot create task: workspace_id not found");return}const s=M(e);s.workspace_id=t;const o=await v.post(`/v1/workspaces/${t}/tasks`,s),r=o.data.data||o.data;return a.value.unshift(r),r},b=async(e,t)=>{var V;const s=a.value.find(h=>h.id===e),o=(t==null?void 0:t.workspace_id)||(s==null?void 0:s.workspace_id)||((V=u.currentWorkspace)==null?void 0:V.id);if(!o){console.error("Cannot update task: workspace_id not found");return}const r=M(t),c=await v.put(`/v1/workspaces/${o}/tasks/${e}`,r),n=c.data.data||c.data,i=a.value.findIndex(h=>h.id===e);return i!==-1&&(a.value[i]=n),n},j=async e=>{var c;const t=a.value.findIndex(n=>n.id===e);if(t===-1)return;const s=a.value[t],o=s.workspace_id||((c=u.currentWorkspace)==null?void 0:c.id);if(!o){console.error("Cannot complete task: workspace_id not found");return}const r={...s};a.value[t]={...s,completed_at:new Date().toISOString()};try{const n=await v.post(`/v1/workspaces/${o}/tasks/${e}/complete`),i=n.data.data||n.data;a.value[t]=i}catch(n){throw a.value[t]=r,n}},B=async e=>{var c;const t=a.value.findIndex(n=>n.id===e);if(t===-1)return;const s=a.value[t],o=s.workspace_id||((c=u.currentWorkspace)==null?void 0:c.id);if(!o){console.error("Cannot uncomplete task: workspace_id not found");return}const r={...s};a.value[t]={...s,completed_at:null};try{const n=await v.post(`/v1/workspaces/${o}/tasks/${e}/uncomplete`),i=n.data.data||n.data;a.value[t]=i}catch(n){throw a.value[t]=r,n}},E=async e=>{var o;const t=a.value.find(r=>r.id===e),s=(t==null?void 0:t.workspace_id)||((o=u.currentWorkspace)==null?void 0:o.id);if(!s){console.error("Cannot delete task: workspace_id not found");return}await v.delete(`/v1/workspaces/${s}/tasks/${e}`),a.value=a.value.filter(r=>r.id!==e)},z=e=>{m.value=e,localStorage.setItem("taskViewMode",e)};let w=null;return{allTasks:a,loading:p,loaded:f,filteredTasks:d,inboxTasks:g,nextActionTasks:y,todayTasks:T,tomorrowTasks:x,waitingTasks:S,somedayTasks:Z,scheduledTasks:I,archivedTasks:$,counts:W,calendarTasks:A,viewMode:m,fetchAllTasks:H,createTask:C,updateTask:b,completeTask:j,uncompleteTask:B,deleteTask:E,setViewMode:z,startSync:()=>{w=setInterval(()=>H({force:!0}),5*60*1e3)},stopSync:()=>{w&&clearInterval(w)}}});function R(a,p){return F(),O("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[q("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5m-9-6h.008v.008H12v-.008ZM12 15h.008v.008H12V15Zm0 2.25h.008v.008H12v-.008ZM9.75 15h.008v.008H9.75V15Zm0 2.25h.008v.008H9.75v-.008ZM7.5 15h.008v.008H7.5V15Zm0 2.25h.008v.008H7.5v-.008Zm6.75-4.5h.008v.008h-.008v-.008Zm0 2.25h.008v.008h-.008V15Zm0 2.25h.008v.008h-.008v-.008Zm2.25-4.5h.008v.008H16.5v-.008Zm0 2.25h.008v.008H16.5V15Z"})])}export{R as r,Q as u};
