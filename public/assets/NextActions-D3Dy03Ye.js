import{u as C,T as S}from"./TaskModal-Btxrnpn9.js";import{u as B}from"./workspace-BcMlt9md.js";import{u as M}from"./useTaskEvents-BOWVF7Ur.js";import{_ as N}from"./TaskList-BGhsgTDZ.js";import{r,z as g,c as x,a as i,l as j,f as A,o as k}from"./index-D5Pxl4fZ.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ru-B7JyRvIu.js";const V={class:"p-4 lg:p-8"},W={class:"max-w-4xl mx-auto"},z={key:0,class:"text-center py-12"},K={__name:"NextActions",setup(O){const a=C(),_=B(),{taskUpdatedEvent:h}=M(),p=r([]),u=r(!1),l=r(!1),t=r(null),n=r(""),c=async()=>{u.value=!0;try{await a.fetchNextActions(!1),p.value=a.tasks}finally{u.value=!1}},w=e=>{t.value=e,l.value=!0},y=async e=>{try{e.status==="completed"?await a.updateTask(e.id,{status:"next_action"}):await a.completeTask(e.id),c()}catch(s){console.error("Error toggling task:",s)}},b=async e=>{var s,m,v,f,T;n.value="";try{t.value?await a.updateTask(t.value.id,e):await a.createTask(e),l.value=!1,t.value=null,await c()}catch(o){console.error("Error saving task:",o),console.error("Error details:",(s=o.response)==null?void 0:s.data);let d="Ошибка при сохранении задачи";(v=(m=o.response)==null?void 0:m.data)!=null&&v.errors?d=Object.values(o.response.data.errors).flat().join(", "):(T=(f=o.response)==null?void 0:f.data)!=null&&T.message&&(d=o.response.data.message),n.value=d}},E=()=>{l.value=!1,t.value=null,n.value=""};return g(()=>{var e;return(e=_.currentWorkspace)==null?void 0:e.id},e=>{e&&c()},{immediate:!0}),g(h,()=>{c()}),(e,s)=>(k(),x("div",V,[i("div",W,[s[1]||(s[1]=i("div",{class:"mb-6"},[i("h1",{class:"text-xl lg:text-2xl font-semibold text-gray-900"},"Следующие")],-1)),u.value?(k(),x("div",z,[...s[0]||(s[0]=[i("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"},null,-1)])])):(k(),j(N,{key:1,tasks:p.value,onTaskClick:w,onToggleComplete:y},null,8,["tasks"])),A(S,{show:l.value,task:t.value,"server-error":n.value,onClose:E,onSubmit:b},null,8,["show","task","server-error"])])]))}};export{K as default};
